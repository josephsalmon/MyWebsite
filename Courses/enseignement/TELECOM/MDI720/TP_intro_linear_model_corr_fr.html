<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="<strong>?meta:description</strong>">

<title>Joseph Salmon - Correction (Joseph Salmon)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<link href="../../../..//img/Flag_of_Occitania.svg" rel="icon" type="image/svg+xml">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(../../../../img/bg_pine_trees.jpg);
background-size: cover;
      }
</style>
<meta name="author" content="Joseph Salmon">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../../img/Flag_of_Occitania.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">Joseph Salmon</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../Courses/index.html"> 
<span class="menu-text">Courses</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../talks/index.html"> 
<span class="menu-text">Talks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../team/index.html"> 
<span class="menu-text">Team</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/josephsalmon"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://sigmoid.social/@josephsalmon"> <i class="bi bi-mastodon" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/joseph-salmon-6134262a6/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:joseph.salmon@inria.fr"> <i class="bi bi-envelope" role="img" aria-label="email">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default blog-post page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Correction (Joseph Salmon)</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#correction-joseph-salmon" id="toc-correction-joseph-salmon" class="nav-link active" data-scroll-target="#correction-joseph-salmon">Correction (Joseph Salmon)</a></li>
  <li><a href="#plot-initialization" id="toc-plot-initialization" class="nav-link" data-scroll-target="#plot-initialization">Plot initialization</a></li>
  <li><a href="#exercise-1" id="toc-exercise-1" class="nav-link" data-scroll-target="#exercise-1">EXERCISE 1</a></li>
  <li><a href="#q1-loading-cm-and-rounding" id="toc-q1-loading-cm-and-rounding" class="nav-link" data-scroll-target="#q1-loading-cm-and-rounding">Q1: Loading, cm and rounding</a></li>
  <li><a href="#q2-any-na-in-the-dataframe" id="toc-q2-any-na-in-the-dataframe" class="nav-link" data-scroll-target="#q2-any-na-in-the-dataframe">Q2: Any Na in the dataframe?</a></li>
  <li><a href="#q3-plot-height-density-for-mothers-and-fathers" id="toc-q3-plot-height-density-for-mothers-and-fathers" class="nav-link" data-scroll-target="#q3-plot-height-density-for-mothers-and-fathers">Q3: Plot height density for Mothers and Fathers</a></li>
  <li><a href="#q4-plot-father-height-as-a-function-of-mother-height-with-ols-prediction" id="toc-q4-plot-father-height-as-a-function-of-mother-height-with-ols-prediction" class="nav-link" data-scroll-target="#q4-plot-father-height-as-a-function-of-mother-height-with-ols-prediction">Q4: Plot Father height as a function of Mother height, with OLS prediction</a></li>
  <li><a href="#q5-distribution-of-the-number-of-children-by-family" id="toc-q5-distribution-of-the-number-of-children-by-family" class="nav-link" data-scroll-target="#q5-distribution-of-the-number-of-children-by-family">Q5: Distribution of the number of children by family</a></li>
  <li><a href="#q6-midparents-creation" id="toc-q6-midparents-creation" class="nav-link" data-scroll-target="#q6-midparents-creation">Q6: MidParents creation</a></li>
  <li><a href="#q7-regression-midparents-vs-kids" id="toc-q7-regression-midparents-vs-kids" class="nav-link" data-scroll-target="#q7-regression-midparents-vs-kids">Q7: Regression MidParents vs kids</a></li>
  <li><a href="#q8-compute-and-display-predictions-with-different-colors-by-gender" id="toc-q8-compute-and-display-predictions-with-different-colors-by-gender" class="nav-link" data-scroll-target="#q8-compute-and-display-predictions-with-different-colors-by-gender">Q8: Compute and display predictions with different colors by gender</a></li>
  <li><a href="#q9-residual-density-estimation" id="toc-q9-residual-density-estimation" class="nav-link" data-scroll-target="#q9-residual-density-estimation">Q9: Residual density estimation</a></li>
  <li><a href="#q10-inverting-the-model" id="toc-q10-inverting-the-model" class="nav-link" data-scroll-target="#q10-inverting-the-model">Q10 : Inverting the model</a></li>
  <li><a href="#exercise-2" id="toc-exercise-2" class="nav-link" data-scroll-target="#exercise-2">EXERCISE 2</a></li>
  <li><a href="#q11-auto-mpg.data-original-loading" id="toc-q11-auto-mpg.data-original-loading" class="nav-link" data-scroll-target="#q11-auto-mpg.data-original-loading">Q11: auto-mpg.data-original loading</a></li>
  <li><a href="#q12-ols-over-a-subset-of-the-dataset" id="toc-q12-ols-over-a-subset-of-the-dataset" class="nav-link" data-scroll-target="#q12-ols-over-a-subset-of-the-dataset">Q12: OLS over a subset of the dataset</a></li>
  <li><a href="#q13-ols-over-a-full-dataset-after-rescalingcentering" id="toc-q13-ols-over-a-full-dataset-after-rescalingcentering" class="nav-link" data-scroll-target="#q13-ols-over-a-full-dataset-after-rescalingcentering">Q13: OLS over a full dataset after rescaling/centering</a></li>
  <li><a href="#q14-residual" id="toc-q14-residual" class="nav-link" data-scroll-target="#q14-residual">Q14: Residual</a></li>
  <li><a href="#q15-new-observation" id="toc-q15-new-observation" class="nav-link" data-scroll-target="#q15-new-observation">Q15: New observation</a></li>
  <li><a href="#q16-polynomial-features." id="toc-q16-polynomial-features." class="nav-link" data-scroll-target="#q16-polynomial-features.">Q16: Polynomial features.</a></li>
  <li><a href="#q-17-handling-origins" id="toc-q-17-handling-origins" class="nav-link" data-scroll-target="#q-17-handling-origins">Q 17: Handling origins</a></li>
  <li><a href="#q18-handling-brands-with-some-text-processing" id="toc-q18-handling-brands-with-some-text-processing" class="nav-link" data-scroll-target="#q18-handling-brands-with-some-text-processing">Q18: Handling brands with some text processing</a></li>
  <li><a href="#q19" id="toc-q19" class="nav-link" data-scroll-target="#q19">Q19</a></li>
  <li><a href="#q20" id="toc-q20" class="nav-link" data-scroll-target="#q20">Q20:</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="correction-joseph-salmon" class="level1">
<h1>Correction (Joseph Salmon)</h1>
<div id="cell-1" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> rc</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> linear_model</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.nonparametric.kde <span class="im">import</span> KDEUnivariate</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> gaussian_kde</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> linear_model</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, PolynomialFeatures</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy.linalg <span class="im">import</span> svd</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> HTML</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># REM: LaTeX needs to be install on the machine for some</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co">#      display to be fined</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/jo/anaconda3/lib/python3.6/site-packages/statsmodels/compat/pandas.py:56: FutureWarning: The pandas.core.datetools module is deprecated and will be removed in a future version. Please use the pandas.tseries module instead.
  from pandas.core import datetools</code></pre>
</div>
</div>
</section>
<section id="plot-initialization" class="level1">
<h1>Plot initialization</h1>
<div id="cell-3" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>rc(<span class="st">'font'</span>, <span class="op">**</span>{<span class="st">'family'</span>: <span class="st">'sans-serif'</span>, <span class="st">'sans-serif'</span>: [<span class="st">'Computer Modern Roman'</span>]})</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">'axes.labelsize'</span>: <span class="dv">12</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>          <span class="st">'font.size'</span>: <span class="dv">12</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>          <span class="st">'legend.fontsize'</span>: <span class="dv">12</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">'xtick.labelsize'</span>: <span class="dv">10</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>          <span class="st">'ytick.labelsize'</span>: <span class="dv">10</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">'text.usetex'</span>: <span class="va">True</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">'figure.figsize'</span>: (<span class="dv">8</span>, <span class="dv">6</span>)}</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update(params)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>plt.close(<span class="st">"all"</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>sns.set_palette(<span class="st">"colorblind"</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>sns.axes_style()</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>sns.set_style({<span class="st">'legend.frameon'</span>: <span class="va">True</span>})</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>color_blind_list <span class="op">=</span> sns.color_palette(<span class="st">"colorblind"</span>, <span class="dv">8</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>my_orange <span class="op">=</span> color_blind_list[<span class="dv">2</span>]</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>my_green <span class="op">=</span> color_blind_list[<span class="dv">1</span>]</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>my_blue <span class="op">=</span> color_blind_list[<span class="dv">0</span>]</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>my_purple <span class="op">=</span> color_blind_list[<span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-4" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>plt.close(<span class="st">"all"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exercise-1" class="level1">
<h1>EXERCISE 1</h1>
<p>Le terme <strong>régression</strong> a été introduit par Sir Francis Galton (cousin de C. Darwin) alors qu’il étudiait la taille des individus au sein d’une descendance. Il tentait de comprendre pourquoi les grands individus d’une population semblaient avoir des enfants d’une taille plus petite, plus proche de la taille moyenne de la population; d’où l’introduction du terme “régression”.</p>
<p>Dans la suite on va s’intéresser aux données récoltées par Galton.</p>
</section>
<section id="q1-loading-cm-and-rounding" class="level1">
<h1>Q1: Loading, cm and rounding</h1>
<p>Récupérer les données du fichier http://josephsalmon.eu/enseignement/TELECOM/MDI720/datasets/Galton.txt et les charger avec <strong>Pandas</strong>. On utilisera <em>read_csv</em> pour cela et on transformera les tailles en cm (pour cela on pourra consulter la description des données proposées en http://www.math.uah.edu/stat/data/Galton.html, en arrondissant sans chiffre après la virgule.</p>
<div id="cell-7" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">'http://josephsalmon.eu/enseignement/TELECOM/MDI720/datasets/Galton.txt'</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(url, sep<span class="op">=</span><span class="st">'</span><span class="ch">\t</span><span class="st">'</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert inches to cm</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">'Father'</span>, <span class="st">'Mother'</span>, <span class="st">'Height'</span>]] <span class="op">=</span> <span class="fl">2.54</span> <span class="op">*</span> df[[<span class="st">'Father'</span>, <span class="st">'Mother'</span>, <span class="st">'Height'</span>]]</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'precision'</span>, <span class="dv">0</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>df.head()</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative:</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># df.round({'Father': 0, 'Mother': 0, 'Height': 0})</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># BEWARE: the display option does not necessarily affect the underlying float</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># values so, depending on the choice performed, there might be a (tiny)</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># difference in the estimators obtained latter on...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Family</th>
<th data-quarto-table-cell-role="th">Father</th>
<th data-quarto-table-cell-role="th">Mother</th>
<th data-quarto-table-cell-role="th">Gender</th>
<th data-quarto-table-cell-role="th">Height</th>
<th data-quarto-table-cell-role="th">Kids</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>199</td>
<td>170</td>
<td>M</td>
<td>186</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>199</td>
<td>170</td>
<td>F</td>
<td>176</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>199</td>
<td>170</td>
<td>F</td>
<td>175</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>199</td>
<td>170</td>
<td>F</td>
<td>175</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2</td>
<td>192</td>
<td>169</td>
<td>M</td>
<td>187</td>
<td>4</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
<section id="q2-any-na-in-the-dataframe" class="level1">
<h1>Q2: Any Na in the dataframe?</h1>
<p>Combien de données manquantes y-t-il dans cette base de données ? Enlever si besoin les lignes ayant des données manquantes.</p>
<div id="cell-9" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>null_data <span class="op">=</span> df[df.isnull().<span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"There are "</span> <span class="op">+</span> <span class="bu">str</span>(df.isnull().<span class="bu">sum</span>().<span class="bu">sum</span>()) <span class="op">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">' total missing values.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>There are 0 total missing values.</code></pre>
</div>
</div>
<p><strong>Conclusion</strong> : pas de données manquantes dans cette table.</p>
</section>
<section id="q3-plot-height-density-for-mothers-and-fathers" class="level1">
<h1>Q3: Plot height density for Mothers and Fathers</h1>
<p>Afficher sur un même graphe un estimateur de la densité de la population des pères en bleu, et de celles des mères en orange.</p>
<div id="cell-12" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>kde_father <span class="op">=</span> KDEUnivariate(df[<span class="st">'Father'</span>])</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>kde_father.fit(bw<span class="op">=</span><span class="dv">2</span>, kernel<span class="op">=</span><span class="st">'gau'</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>x_grid <span class="op">=</span> np.linspace(<span class="dv">140</span>, <span class="dv">210</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>pdf_est_father <span class="op">=</span> kde_father.evaluate(x_grid)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>kde_mother <span class="op">=</span> KDEUnivariate(df[<span class="st">'Mother'</span>])</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>kde_mother.fit(bw<span class="op">=</span><span class="dv">2</span>, kernel<span class="op">=</span><span class="st">'gau'</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>x_grid <span class="op">=</span> np.linspace(<span class="dv">140</span>, <span class="dv">210</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>pdf_est_mother <span class="op">=</span> kde_mother.evaluate(x_grid)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>plt.plot(x_grid, pdf_est_father, color<span class="op">=</span>my_blue, label<span class="op">=</span><span class="st">'Father'</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>plt.fill_between(x_grid, <span class="dv">0</span>, pdf_est_father, facecolor<span class="op">=</span>my_blue, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>plt.plot(x_grid, pdf_est_mother, color<span class="op">=</span>my_orange, label<span class="op">=</span><span class="st">'Mother'</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>plt.fill_between(x_grid, <span class="dv">0</span>, pdf_est_mother, facecolor<span class="op">=</span>my_orange, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Density'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Height (in cm.)'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Distribution of parents height (by gender)"</span>)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TP_intro_linear_model_corr_fr_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-13" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Another possibility when the data has unique observations,</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># with gaussian_kde from scipy.stats</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>father_unique <span class="op">=</span> df[<span class="st">'Father'</span>].groupby(df[<span class="st">'Family'</span>]).first()</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>mother_unique <span class="op">=</span> df[<span class="st">'Mother'</span>].groupby(df[<span class="st">'Family'</span>]).first()</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>kde_father <span class="op">=</span> gaussian_kde(father_unique)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>x_grid <span class="op">=</span> np.linspace(<span class="dv">140</span>, <span class="dv">210</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>pdf_est_father <span class="op">=</span> kde_father(x_grid)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>kde_mother <span class="op">=</span> gaussian_kde(mother_unique)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>x_grid <span class="op">=</span> np.linspace(<span class="dv">140</span>, <span class="dv">210</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>pdf_est_mother <span class="op">=</span> kde_mother(x_grid)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>plt.plot(x_grid, pdf_est_father, color<span class="op">=</span>my_blue, label<span class="op">=</span><span class="st">'Father'</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>plt.fill_between(x_grid, <span class="dv">0</span>, pdf_est_father, facecolor<span class="op">=</span>my_blue, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>plt.plot(x_grid, pdf_est_mother, color<span class="op">=</span>my_purple, label<span class="op">=</span><span class="st">'Mother'</span>)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>plt.fill_between(x_grid, <span class="dv">0</span>, pdf_est_mother, facecolor<span class="op">=</span>my_orange, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Density'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Height (in cm.)'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Distribution of parents height (by gender)"</span>)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TP_intro_linear_model_corr_fr_files/figure-html/cell-8-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="q4-plot-father-height-as-a-function-of-mother-height-with-ols-prediction" class="level1">
<h1>Q4: Plot Father height as a function of Mother height, with OLS prediction</h1>
<p>Afficher la taille du père en fonction de la taille de la mère pour les <span class="math inline">n</span> observations figurant dans les données. Ajouter la droite de prédiction obtenue par la méthode des moindres carrés (avec constante et sans centrage/normalisation).</p>
<div id="cell-15" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">'Father'</span>]</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df[[<span class="st">'Mother'</span>]]</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>plt.plot(X, y, <span class="st">'o'</span>,label<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Father height'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>plt.ylim([df[<span class="st">'Father'</span>].<span class="bu">min</span>()<span class="op">-</span><span class="dv">1</span>, df[<span class="st">'Father'</span>].<span class="bu">max</span>()<span class="op">+</span><span class="dv">1</span>])</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>plt.xlim([df[<span class="st">'Mother'</span>].<span class="bu">min</span>()<span class="op">-</span><span class="dv">1</span>, df[<span class="st">'Mother'</span>].<span class="bu">max</span>()<span class="op">+</span><span class="dv">1</span>])</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Mother height'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>skl_lm <span class="op">=</span> linear_model.LinearRegression(fit_intercept<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>skl_lm.fit(X, y)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>plt.plot(x_grid, skl_lm.predict(x_grid.reshape(x_grid.shape[<span class="dv">0</span>], <span class="dv">1</span>)), <span class="st">'-'</span>, label<span class="op">=</span><span class="st">'Model prediction'</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Father height w.r.t. Mother heigh (observed and predicted)"</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(skl_lm.score(X, y))  <span class="co"># it is pretty small...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TP_intro_linear_model_corr_fr_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>0.00542647493462</code></pre>
</div>
</div>
</section>
<section id="q5-distribution-of-the-number-of-children-by-family" class="level1">
<h1>Q5: Distribution of the number of children by family</h1>
<p>Afficher un histogramme du nombre d’enfants par famille.</p>
<div id="cell-17" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># second solution : normed=True</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>groupby_family <span class="op">=</span> df[<span class="st">'Family'</span>].groupby(df[<span class="st">'Family'</span>]).count()</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>plt.hist(groupby_family, bins<span class="op">=</span><span class="dv">14</span>, normed<span class="op">=</span><span class="va">True</span>, rwidth<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="fl">0.5</span>, <span class="fl">15.5</span>])</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>plt.xticks(np.arange(<span class="dv">1</span>,<span class="dv">16</span>))</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Number of children'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Density'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Distribution of the number of children per family (frequency)"</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TP_intro_linear_model_corr_fr_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-18" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># second solution : normed=False</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"There are </span><span class="sc">{}</span><span class="st"> families"</span>.<span class="bu">format</span>(<span class="bu">len</span>(df[<span class="st">'Family'</span>].unique())))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>groupby_family <span class="op">=</span> df[<span class="st">'Family'</span>].groupby(df[<span class="st">'Family'</span>]).count()</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>plt.hist(groupby_family, bins<span class="op">=</span><span class="dv">14</span>, normed<span class="op">=</span><span class="va">False</span>, rwidth<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="fl">0.5</span>, <span class="fl">15.5</span>])</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>plt.xticks(np.arange(<span class="dv">1</span>,<span class="dv">16</span>))</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Number of children'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Count"</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Distribution of the number of children per family (count)"</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>There are 197 families</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TP_intro_linear_model_corr_fr_files/figure-html/cell-11-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="q6-midparents-creation" class="level1">
<h1>Q6: MidParents creation</h1>
<p>Créer une colonne supplémentaire appelée <em>‘MidParents’</em> qui contient la taille du sorte de “parent moyen”, et valant (‘Father’+ 1.08 * ‘Mother’) / 2.</p>
<div id="cell-20" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'MidParents'</span>] <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> (df[<span class="st">'Father'</span>] <span class="op">+</span> <span class="fl">1.08</span> <span class="op">*</span> df[<span class="st">'Mother'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>REM: The factor 1.08 gives a rescaled women’s height variable which has the same average as the men’s height. Indeed, the ratio of the average men’s height over the average women’s height is</p>
<div id="cell-22" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>Ratio <span class="op">=</span> np.mean(df[<span class="st">'Father'</span>]) <span class="op">/</span> np.mean(df[<span class="st">'Mother'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-23" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Ratio)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1.0803384317037383</code></pre>
</div>
</div>
<p>Pour la <span class="math inline">i^{ieme}</span> observation, on note <span class="math inline">x_i</span> la taille du parent moyen et <span class="math inline">y_i</span> la taille de l’enfant. On se base sur le modèle linéaire suivant: <span class="math inline">y_i = \theta_0 + \theta_1 x_i + \varepsilon_i</span> et on suppose que les variables <span class="math inline">\varepsilon_i</span> sont centrées, indépendantes et de même variance <span class="math inline">\sigma^2</span> inconnue.</p>
</section>
<section id="q7-regression-midparents-vs-kids" class="level1">
<h1>Q7: Regression MidParents vs kids</h1>
<p>Estimer <span class="math inline">\theta_0</span>, <span class="math inline">\theta_1</span>, par <span class="math inline">\hat{\theta}_0</span>, <span class="math inline">\hat{\theta}_1</span> en utilisant la fonction <strong>LinearRegression</strong> de <strong>sklearn</strong>, puis vérifier numériquement (on pourra utiliser par exemple <strong>np.isclose</strong>) les formules vues en cours pour le cas unidimensionnel:</p>
<p><span class="math display">
\hat\theta_0= \overline{y}_n -\hat{\theta}_1 \overline{x}_n,\qquad  \hat\theta_1=  \displaystyle\frac{ \sum_{i=1}^n (x_i-\overline{x}_n)(y_i -\overline{y}_n)}{\sum_{i=1}^n (x_i-\overline{x}_n)^2} .
</span></p>
<p>On fera attention aux normalisations utilisées pour la variance qui peuvent changer selon les packages.</p>
<div id="cell-27" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>X0 <span class="op">=</span> df[[<span class="st">'MidParents'</span>]]</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">'Height'</span>]</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>skl_lm <span class="op">=</span> linear_model.LinearRegression()</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>skl_lm.fit(X0, y)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>theta0 <span class="op">=</span> skl_lm.intercept_</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>theta1 <span class="op">=</span> skl_lm.coef_[<span class="dv">0</span>]</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>y_mean <span class="op">=</span> y.mean()</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>X0_mean <span class="op">=</span> (X0.mean(axis<span class="op">=</span><span class="dv">0</span>)).squeeze()</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>X0_var <span class="op">=</span> X0.var(ddof<span class="op">=</span><span class="dv">0</span>).squeeze()</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>y_var <span class="op">=</span> y.var(ddof<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>theta1_manual <span class="op">=</span> ((X0.squeeze() <span class="op">-</span> X0_mean) <span class="op">*</span> (y <span class="op">-</span> y_mean)).mean() <span class="op">/</span> X0_var</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>theta0_manual <span class="op">=</span> y_mean <span class="op">-</span> theta1_manual <span class="op">*</span> X0_mean</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(theta1)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(theta1_manual)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Are the two computations of theta1'</span> <span class="op">+</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">' the same? This is </span><span class="sc">{}</span><span class="st"> and theta1=</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(np.isclose(theta1, theta1_manual),theta1))</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Are the two computations of theta0'</span> <span class="op">+</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">' the same? This is </span><span class="sc">{}</span><span class="st">, and theta0=</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(np.isclose(theta0, theta0_manual),theta0))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.641190379591
0.641190379591
Are the two computations of theta1 the same? This is True and theta1=0.6411903795908169
Are the two computations of theta0 the same? This is True, and theta0=56.83556243483079</code></pre>
</div>
</div>
</section>
<section id="q8-compute-and-display-predictions-with-different-colors-by-gender" class="level1">
<h1>Q8: Compute and display predictions with different colors by gender</h1>
<p>Calculer et visualiser les valeurs prédites $y_i = _0 + _1 x_i $ et les <span class="math inline">y_i</span> sur un même graphique. On affichera de deux couleurs différentes les garçons et les filles.</p>
<div id="cell-29" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>male <span class="op">=</span> df[<span class="st">'Gender'</span>] <span class="op">==</span> <span class="st">'M'</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>female <span class="op">=</span> df[<span class="st">'Gender'</span>] <span class="op">==</span> <span class="st">'F'</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure()</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>plt.plot(df[<span class="st">'MidParents'</span>][male], y[male], <span class="st">'o'</span>, c<span class="op">=</span>my_blue, label<span class="op">=</span><span class="st">"Male"</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>plt.plot(df[<span class="st">'MidParents'</span>][female], y[female], <span class="st">'o'</span>, c<span class="op">=</span>my_orange, label<span class="op">=</span><span class="st">"Female"</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>plt.plot(X0, skl_lm.predict(X0), label<span class="op">=</span><span class="st">'OLS prediction'</span>, c<span class="op">=</span><span class="st">'k'</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'MidParents'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Kids height'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Kids Heigh by gender"</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TP_intro_linear_model_corr_fr_files/figure-html/cell-16-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="q9-residual-density-estimation" class="level1">
<h1>Q9: Residual density estimation</h1>
<p>Visualiser un estimateur de la densité des résidus <span class="math inline">r_i = y_i -\hat y_i</span>. L’hypothèse de normalité est-elle crédible selon vous? On ajoutera ensuite un estimateur par genre de la densité des résidus (en mettant un facteur proportionnel au nombre de personnes de chaque genre).</p>
<div id="cell-31" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>nb_f <span class="op">=</span> <span class="bu">float</span>(female.<span class="bu">sum</span>())</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>nb_m <span class="op">=</span> <span class="bu">float</span>(male.<span class="bu">sum</span>())</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>alpha_f <span class="op">=</span> nb_f <span class="op">/</span> (nb_f <span class="op">+</span> nb_m)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>alpha_m <span class="op">=</span> nb_m <span class="op">/</span> (nb_f <span class="op">+</span> nb_m)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>residual <span class="op">=</span> y <span class="op">-</span> skl_lm.predict(X0)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>x_grid <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">40</span>, <span class="dv">30</span>, num<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Residual Histogram/ KDE'</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Residual value'</span>)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>kde_residual <span class="op">=</span> KDEUnivariate(residual)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>kde_residual.fit(bw<span class="op">=</span><span class="dv">2</span>, kernel<span class="op">=</span><span class="st">'gau'</span>)</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>pdf_est_residual <span class="op">=</span> kde_residual.evaluate(x_grid)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>plt.plot(x_grid, pdf_est_residual, color<span class="op">=</span><span class="st">'k'</span>)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>plt.fill_between(x_grid, pdf_est_residual, alpha<span class="op">=</span><span class="fl">0.1</span>, color<span class="op">=</span><span class="st">'k'</span>, label<span class="op">=</span><span class="st">'All'</span>)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>kde_residual_m <span class="op">=</span> KDEUnivariate(residual[male])</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>kde_residual_m.fit(bw<span class="op">=</span><span class="dv">2</span>, kernel<span class="op">=</span><span class="st">'gau'</span>)</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>pdf_est_residual_m <span class="op">=</span> kde_residual_m.evaluate(x_grid)</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>plt.fill_between(x_grid, alpha_m <span class="op">*</span> pdf_est_residual_m, color<span class="op">=</span>my_blue, alpha<span class="op">=</span><span class="fl">0.5</span>,label<span class="op">=</span><span class="st">'Male'</span>)</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>kde_residual_f <span class="op">=</span> KDEUnivariate(residual[female])</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>kde_residual_f.fit(bw<span class="op">=</span><span class="dv">2</span>, kernel<span class="op">=</span><span class="st">'gau'</span>)</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>pdf_est_residual_f <span class="op">=</span> kde_residual_f.evaluate(x_grid)</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>plt.fill_between(x_grid, alpha_f <span class="op">*</span> pdf_est_residual_f, color<span class="op">=</span>my_orange, alpha<span class="op">=</span><span class="fl">0.5</span>,label<span class="op">=</span><span class="st">'Female'</span>)</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TP_intro_linear_model_corr_fr_files/figure-html/cell-17-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>L’hypothèse de normalité globale des résidus n’est pas crédible (distribution bimodale). Cependant elle semble plus raisonnable si l’on fait l’étude séparement par genre.</p>
</section>
<section id="q10-inverting-the-model" class="level1">
<h1>Q10 : Inverting the model</h1>
<p>Régresser cette fois les <span class="math inline">x_i</span> sur les <span class="math inline">y_i</span> (et non plus les <span class="math inline">y_i</span> sur les <span class="math inline">x_i</span>). Comparer les coefficients <span class="math inline">\hat{\alpha}_0</span> et <span class="math inline">\hat{\alpha}_1</span> obtenus par rapport aux <span class="math inline">\hat{\theta}_0</span> et <span class="math inline">\hat{\theta}_1</span> du modèle original. Vérifier numériquement que: <span class="math display">
\begin{cases}
\hat{\alpha}_0=&amp;\bar{x}_n+\displaystyle\frac{\bar{y}_n}{\bar{x}_n}\frac{var_n(x)}{var_n(y)}
(\hat{\theta}_0-\bar{y}_n), \\
\hat{\alpha}_1=&amp;\frac{var_n(x)}{var_n(y)} \hat{\theta}_1 .
\end{cases}
</span></p>
<div id="cell-34" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>skl_lm <span class="op">=</span> linear_model.LinearRegression()</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>skl_lm.fit(df[[<span class="st">'Height'</span>]], df[<span class="st">'MidParents'</span>])</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>alpha0 <span class="op">=</span> skl_lm.intercept_</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>alpha1 <span class="op">=</span> skl_lm.coef_[<span class="dv">0</span>]</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>alpha0_manual <span class="op">=</span> X0_mean <span class="op">+</span> y_mean <span class="op">/</span> X0_mean <span class="op">*</span> X0_var <span class="op">/</span> y_var <span class="op">*</span> (theta0 <span class="op">-</span> y_mean)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>alpha1_manual <span class="op">=</span> X0_var <span class="op">/</span> y_var <span class="op">*</span> theta1_manual</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(alpha1)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(alpha1_manual)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Are the two computations of alpha1'</span> <span class="op">+</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">' the same? This is </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(np.isclose(alpha1, alpha1_manual)))</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Are the two computations of alpha0'</span> <span class="op">+</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">' the same? This is </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(np.isclose(alpha0, alpha0_manual)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.165038310213
0.165038310213
Are the two computations of alpha1 the same? This is True
Are the two computations of alpha0 the same? This is True</code></pre>
</div>
</div>
</section>
<section id="exercise-2" class="level1">
<h1>EXERCISE 2</h1>
<p>On travaille dans cette partie sur le fichier <strong>auto-mpg.data</strong>. On cherche à régresser linéairement la consommation des voitures sur leurs caractéristiques: nombre de cylindres, cylindrées (<em>engine displacement</em> en anglais), puissance, poids, accélération, année, pays d’origine et le nom de la voiture.</p>
<p>Le vecteur contenant la consommation des voitures (plus précisément la distance parcourue, en miles, pour un gallon, ou mpg) est noté <span class="math inline">y</span>; les colonnes de <span class="math inline">X</span> sont les régresseurs quantitatifs, donc pour le moment on laisse de côté les variables <em>origin</em> et <em>car name</em>.</p>
</section>
<section id="q11-auto-mpg.data-original-loading" class="level1">
<h1>Q11: auto-mpg.data-original loading</h1>
<p>Importer avec <strong>Pandas</strong> la base de données disponible ici https://archive.ics.uci.edu/ml/machine-learning-databases/auto-mpg/auto-mpg.data-original.</p>
<p>On ajoutera le nom des colonnes en consultant l’adresse: https://archive.ics.uci.edu/ml/machine-learning-databases/auto-mpg/auto-mpg.names avec l’attribut <strong>‘name’</strong> de <strong>read_csv</strong>. On pourra regarder l’intérêt de l’option <strong>sep=r”+“</strong> si besoin.</p>
<p>Y a-t-il un marqueur utilisé pour les données manquantes dans le fichier utilisé? Si besoin, enlever les lignes possédant des valeurs manquantes dans la base de données.</p>
<div id="cell-38" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># url = 'https://archive.ics.uci.edu/ml/machine-learning-databases/auto-mpg/' +\</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">#       'auto-mpg.data-original'</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative URL when UCI is down:</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">'http://josephsalmon.eu/enseignement/TELECOM/MDI720/datasets/auto-mpg.data-original'</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>u_cols <span class="op">=</span> [<span class="st">'mpg'</span>, <span class="st">'cylinders'</span>, <span class="st">'displacement'</span>, <span class="st">'horsepower'</span>,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>          <span class="st">'weight'</span>, <span class="st">'acceleration'</span>, <span class="st">'model_year'</span>, <span class="st">'origin'</span>, <span class="st">'car_name'</span>]</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># To get correct display format</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>pd.options.display.float_format <span class="op">=</span> <span class="st">'</span><span class="sc">{:,.0f}</span><span class="st">'</span>.<span class="bu">format</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co"># for this dataset na_values are marked as NA.</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(url, sep<span class="op">=</span><span class="vs">r"\s+"</span>, names<span class="op">=</span>u_cols, na_values<span class="op">=</span><span class="st">'NA'</span>)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>n_samples_ini <span class="op">=</span> data.shape[<span class="dv">0</span>]</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The original dataset has </span><span class="sc">{}</span><span class="st"> samples and </span><span class="sc">{}</span><span class="st"> features"</span>.<span class="bu">format</span>(</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    data.shape[<span class="dv">0</span>], data.shape[<span class="dv">1</span>]))</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove NA:</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.dropna(axis<span class="op">=</span><span class="dv">0</span>, how<span class="op">=</span><span class="st">'any'</span>)</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>n_samples <span class="op">=</span> data.shape[<span class="dv">0</span>]</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>data.head()</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="co"># To get origin with meaningful names</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>origins <span class="op">=</span> data[<span class="st">'origin'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>origins <span class="op">=</span> origins.<span class="bu">str</span>.replace(<span class="st">'1.0'</span>, <span class="st">'1USA'</span>)</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>origins <span class="op">=</span> origins.<span class="bu">str</span>.replace(<span class="st">'2.0'</span>, <span class="st">'2Europe'</span>)</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>origins <span class="op">=</span> origins.<span class="bu">str</span>.replace(<span class="st">'3.0'</span>, <span class="st">'3Japan'</span>)</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'origin'</span>] <span class="op">=</span> origins</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The original dataset has 406 samples and 9 features</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mpg</th>
<th data-quarto-table-cell-role="th">cylinders</th>
<th data-quarto-table-cell-role="th">displacement</th>
<th data-quarto-table-cell-role="th">horsepower</th>
<th data-quarto-table-cell-role="th">weight</th>
<th data-quarto-table-cell-role="th">acceleration</th>
<th data-quarto-table-cell-role="th">model_year</th>
<th data-quarto-table-cell-role="th">origin</th>
<th data-quarto-table-cell-role="th">car_name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>18</td>
<td>8</td>
<td>307</td>
<td>130</td>
<td>3,504</td>
<td>12</td>
<td>70</td>
<td>1USA</td>
<td>chevrolet chevelle malibu</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>15</td>
<td>8</td>
<td>350</td>
<td>165</td>
<td>3,693</td>
<td>12</td>
<td>70</td>
<td>1USA</td>
<td>buick skylark 320</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>18</td>
<td>8</td>
<td>318</td>
<td>150</td>
<td>3,436</td>
<td>11</td>
<td>70</td>
<td>1USA</td>
<td>plymouth satellite</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>16</td>
<td>8</td>
<td>304</td>
<td>150</td>
<td>3,433</td>
<td>12</td>
<td>70</td>
<td>1USA</td>
<td>amc rebel sst</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>17</td>
<td>8</td>
<td>302</td>
<td>140</td>
<td>3,449</td>
<td>10</td>
<td>70</td>
<td>1USA</td>
<td>ford torino</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="cell-39" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"There are </span><span class="sc">{}</span><span class="st"> missing values (NA)."</span>.<span class="bu">format</span>(n_samples_ini <span class="op">-</span> n_samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>There are 14 missing values (NA).</code></pre>
</div>
</div>
</section>
<section id="q12-ols-over-a-subset-of-the-dataset" class="level1">
<h1>Q12: OLS over a subset of the dataset</h1>
<p>Calculer l’estimateur des moindres carrés (avec ordonnée à l’origine) <span class="math inline">\hat\theta</span> et sa prédiction <span class="math inline">\hat{y}</span> sur une sous partie de la base obtenue en gardant les <span class="math inline">9</span> premières lignes. Que constatez-vous pour les variables <strong>cylinders</strong> et <strong>model year</strong>?</p>
<div id="cell-41" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> data[<span class="st">'mpg'</span>]</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># data.drop(['mpg'], axis=1)</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>X_partial <span class="op">=</span> data.drop([<span class="st">'origin'</span>, <span class="st">'car_name'</span>, <span class="st">'mpg'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit regression model (with sklearn) degenerate case</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>skl_linmod <span class="op">=</span> linear_model.LinearRegression()</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>skl_linmod.fit(X_partial[:<span class="dv">9</span>], y[:<span class="dv">9</span>])</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_partial.columns)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(skl_linmod.coef_)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(skl_linmod.intercept_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Index(['cylinders', 'displacement', 'horsepower', 'weight', 'acceleration',
       'model_year'],
      dtype='object')
[ 0.          0.05408848 -0.0945306  -0.00424074 -0.19936701  0.        ]
30.7716953656</code></pre>
</div>
</div>
<p>Les coefficients des variables <strong>cylinders</strong> et <strong>model year</strong> sont nuls. Ceci est étrange, et vient du fait que le modèle est mal specifié. En effet, pour cette sous-partie de la base les colonnes de ces deux variables sont constantes et sont donc redondantes avec la colonnes constantes.</p>
</section>
<section id="q13-ols-over-a-full-dataset-after-rescalingcentering" class="level1">
<h1>Q13: OLS over a full dataset after rescaling/centering</h1>
<p>Calculer <span class="math inline">\hat\theta</span> et <span class="math inline">\hat y</span> cette fois sur l’intégralité des données, après les avoir centrées et réduites. Quelles sont les deux variables qui expliquent le plus la consommation d’un véhicule selon vous?</p>
<div id="cell-44" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit regression model (with sklearn)</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>skl_linmod <span class="op">=</span> linear_model.LinearRegression()</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler().fit(X_partial)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> scaler.transform(X_partial)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>skl_linmod.fit(X, y)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_partial.columns)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(skl_linmod.coef_)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co"># print(skl_linmod.intercept_)</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>ranked_variables <span class="op">=</span> np.argsort(np.<span class="bu">abs</span>(skl_linmod.coef_))</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_partial.columns[ranked_variables[<span class="op">-</span><span class="dv">2</span>:]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Index(['cylinders', 'displacement', 'horsepower', 'weight', 'acceleration',
       'model_year'],
      dtype='object')
[-0.56194996  0.80247616 -0.0150445  -5.76399971  0.23495704  2.77166415]
Index(['model_year', 'weight'], dtype='object')</code></pre>
</div>
</div>
<p>Les deux variables qui semblent les plus explicative de la consomation (d’après l’amplitudes de leurs coefficients de régression) sont l’ancienneté (<strong>model year</strong>) et le poids (<strong>weight</strong>) de la voiture.</p>
</section>
<section id="q14-residual" class="level1">
<h1>Q14: Residual</h1>
<p>Calculer <span class="math inline">\|r\|^2</span> (le carré de la norme du vecteur des résidus), puis <span class="math inline">\|r\|^2/(n-p)</span>. Vérifier numériquement que:</p>
<p><span class="math display">\begin{equation*}
\| y - \bar{y}_n\mathbf{1}_n\|^2=\|r\|^2 +\| \hat{y} - \bar{y}_n \mathbf{1}_n\|^2.
\end{equation*}</span></p>
<div id="cell-47" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>residual <span class="op">=</span> skl_linmod.predict(X) <span class="op">-</span> y</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>term_1 <span class="op">=</span> np.linalg.norm(y <span class="op">-</span> np.mean(y)) <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>term_2 <span class="op">=</span> np.linalg.norm(residual) <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>term_3 <span class="op">=</span> np.linalg.norm(skl_linmod.predict(X) <span class="op">-</span> np.mean(y)) <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.isclose(term_1, term_2 <span class="op">+</span> term_3))</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(term_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>True
23818.9934694</code></pre>
</div>
</div>
</section>
<section id="q15-new-observation" class="level1">
<h1>Q15: New observation</h1>
<p>Supposons que l’on vous fournisse les caractéristiques suivantes d’un nouveau véhicule :</p>
<table class="table">
<thead>
<tr class="header">
<th>cylinders</th>
<th>displacement</th>
<th>horsepower</th>
<th>weight</th>
<th>acceleration</th>
<th>year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>6</td>
<td>225</td>
<td>100</td>
<td>3233</td>
<td>15.4</td>
<td>76</td>
</tr>
</tbody>
</table>
<p>Prédire sa consommation (pour information, la consommation effectivement mesurée sur cet exemple était de 22 mpg).</p>
<div id="cell-49" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>X_new <span class="op">=</span> np.array([[<span class="dv">6</span>, <span class="dv">225</span>, <span class="dv">100</span>, <span class="dv">3233</span>, <span class="fl">15.4</span>, <span class="dv">76</span>]])</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>prediction_new <span class="op">=</span> skl_linmod.predict(scaler.transform(X_new))[<span class="dv">0</span>]</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The consumption predicted is </span><span class="sc">{}</span><span class="st"> mpg."</span>.<span class="bu">format</span>(prediction_new))</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"This is </span><span class="sc">{:.4}</span><span class="st">% away from the proposed value."</span>.<span class="bu">format</span>(</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">100</span> <span class="op">-</span> (prediction_new <span class="op">/</span> <span class="fl">22.</span> <span class="op">*</span> <span class="dv">100</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The consumption predicted is 21.776220182609453 mpg.
This is 1.017% away from the proposed value.</code></pre>
</div>
</div>
</section>
<section id="q16-polynomial-features." class="level1">
<h1>Q16: Polynomial features.</h1>
<p>Utiliser la transformation <strong>PolynomialFeatures</strong> de <strong>sklearn</strong> sur les données brutes, pour ajuster un modèle d’ordre deux (avec les termes d’interactions: <strong>interaction_only=False</strong>). On normalisera et recentrera après avoir créé les nouvelles variables explicatives. Quelle est alors la variable la plus explicative de la consomation?</p>
<div id="cell-52" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>poly <span class="op">=</span> PolynomialFeatures(<span class="dv">2</span>, interaction_only<span class="op">=</span><span class="va">False</span>, include_bias<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>poly.fit(X_partial)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>XX <span class="op">=</span> poly.transform(X_partial) </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>all_names <span class="op">=</span> poly.get_feature_names(X_partial.columns)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>scalerXX <span class="op">=</span> StandardScaler().fit(XX)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>XX <span class="op">=</span> scalerXX.transform(XX)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>skl_linmod.fit(XX, y)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(all_names)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(skl_linmod.coef_)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(skl_linmod.intercept_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['cylinders', 'displacement', 'horsepower', 'weight', 'acceleration', 'model_year', 'cylinders^2', 'cylinders displacement', 'cylinders horsepower', 'cylinders weight', 'cylinders acceleration', 'cylinders model_year', 'displacement^2', 'displacement horsepower', 'displacement weight', 'displacement acceleration', 'displacement model_year', 'horsepower^2', 'horsepower weight', 'horsepower acceleration', 'horsepower model_year', 'weight^2', 'weight acceleration', 'weight model_year', 'acceleration^2', 'acceleration model_year', 'model_year^2']
[ 13.34357536 -48.43391341   5.15417707  17.47091667 -16.05072528
 -26.88104821  -8.13486673  -2.94736774  11.95174218   5.33737455
   4.87668634 -16.22928128   1.29969118   3.38005168   5.2047413
  -3.29326443  43.68431432  -3.59171565  -6.15116573  -2.38675585
  -4.85057027   3.15822997   0.84918913 -25.11606269   1.99403567
  13.91361302  29.84851135]
23.4459183673</code></pre>
</div>
</div>
<div id="cell-53" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>rank_variables <span class="op">=</span> np.argsort(np.<span class="bu">abs</span>(skl_linmod.coef_))[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>([all_names[i] <span class="cf">for</span> i <span class="kw">in</span> rank_variables])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['displacement', 'displacement model_year', 'model_year^2', 'model_year', 'weight model_year', 'weight', 'cylinders model_year', 'acceleration', 'acceleration model_year', 'cylinders', 'cylinders horsepower', 'cylinders^2', 'horsepower weight', 'cylinders weight', 'displacement weight', 'horsepower', 'cylinders acceleration', 'horsepower model_year', 'horsepower^2', 'displacement horsepower', 'displacement acceleration', 'weight^2', 'cylinders displacement', 'horsepower acceleration', 'acceleration^2', 'displacement^2', 'weight acceleration']</code></pre>
</div>
</div>
<p>Cette fois la variable la plus pertinente semble être “displacement”. C’est un paradoxe classique: en ajoutant de nouvelles variables (ici les produits de variables), il se peut que le classement par ordre d’influence des variables (mesuré par l’amplitude des coefficients) change. Ce problème est partiellement résolu par sélection de variables.</p>
<div id="cell-55" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># BEWARE: it might lead to different interpretation if one perform the steps:</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) center/rescale the design matrix</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) create the interaction features</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) center/rescale the new design matrix</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) create the interaction features</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) center/rescale the new design matrix.</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The most reasonable is to rather proceed as proposed above (ie 2nd choice)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="q-17-handling-origins" class="level1">
<h1>Q 17: Handling origins</h1>
<p>On revient ici au modèle sans interactions. Proposer une manière de gérer la variable”origin” par exemple avec <strong>pd.get_dummies</strong>. On ajustera un modèle linéaire sans constante dans ce cas. Déterminer laquelle des trois origines est la plus efficace en terme de consommation (Pour info, 1 = usa; 2 = europe; 3 = japan).</p>
<div id="cell-57" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution 1: all origins, no intercpet, no rescalling.</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>X_origin1 <span class="op">=</span> data.copy().drop([<span class="st">'car_name'</span>, <span class="st">'mpg'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>X_origin1 <span class="op">=</span> pd.get_dummies(X_origin1, columns<span class="op">=</span>[<span class="st">'origin'</span>])</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler(with_mean<span class="op">=</span><span class="va">False</span>,with_std<span class="op">=</span><span class="va">False</span>).fit(X_origin1)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>Z1 <span class="op">=</span> scaler.transform(X_origin1)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>skl_linmod1 <span class="op">=</span> linear_model.LinearRegression(fit_intercept<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>skl_linmod1.fit(Z1, y)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_origin1.columns[<span class="dv">6</span>:])</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(skl_linmod1.coef_[<span class="dv">6</span>:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Index(['origin_1USA', 'origin_2Europe', 'origin_3Japan'], dtype='object')
[-17.95460207 -15.32459971 -15.10137384]</code></pre>
</div>
</div>
<p><strong>Conclusion</strong>: Result sugest that Japan is the most efficient, then come Europe, and USA is far behind.</p>
<div id="cell-59" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution 2: removing USA, and considering an intercpet</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>X_origin2 <span class="op">=</span> data.copy().drop([<span class="st">'car_name'</span>, <span class="st">'mpg'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>X_origin2 <span class="op">=</span> pd.get_dummies(X_origin2, columns<span class="op">=</span>[<span class="st">'origin'</span>],drop_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler(with_mean<span class="op">=</span><span class="va">False</span>,with_std<span class="op">=</span><span class="va">False</span>).fit(X_origin2)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>Z2 <span class="op">=</span> scaler.transform(X_origin2)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>skl_linmod2 <span class="op">=</span> linear_model.LinearRegression(fit_intercept<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>skl_linmod2.fit(Z2, y)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_origin2.columns[:])</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(skl_linmod2.coef_[<span class="dv">6</span>:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Index(['cylinders', 'displacement', 'horsepower', 'weight', 'acceleration',
       'model_year', 'origin_2Europe', 'origin_3Japan'],
      dtype='object')
[ 2.63000236  2.85322823]</code></pre>
</div>
</div>
<div id="cell-60" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Testing link between models:</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>Europe_cst <span class="op">=</span> skl_linmod2.intercept_</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>testing_coef <span class="op">=</span> np.concatenate(</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    [skl_linmod2.coef_[:<span class="dv">6</span>],  [Europe_cst], skl_linmod2.coef_[<span class="dv">6</span>:] <span class="op">+</span> Europe_cst])</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.allclose(testing_coef, skl_linmod1.coef_))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>True</code></pre>
</div>
</div>
<p><strong>Conclusion</strong>: Japon is still the most efficent then w.r.t. Europe (positive coefficient), and USA is less efficient than Europe (negative coefficient).</p>
<div id="cell-62" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution 3: normalizing all columns implies that a post-processing is needed:</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co"># to get meaningfull coefficient, scaling is required!</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>origines_count <span class="op">=</span> data[<span class="st">'origin'</span>].value_counts()</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(origines_count)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>X_origin3 <span class="op">=</span> data.copy().drop([<span class="st">'car_name'</span>, <span class="st">'mpg'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>X_origin3 <span class="op">=</span> pd.get_dummies(X_origin3, columns<span class="op">=</span>[<span class="st">'origin'</span>], drop_first<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler(with_mean<span class="op">=</span><span class="va">False</span>, with_std<span class="op">=</span><span class="va">True</span>).fit(X_origin3)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>Z3 <span class="op">=</span> scaler.transform(X_origin3)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>skl_linmod3 <span class="op">=</span> linear_model.LinearRegression(fit_intercept<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>skl_linmod3.fit(Z3, y)</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_origin3.columns[<span class="dv">6</span>:])</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(skl_linmod3.coef_[<span class="dv">6</span>:])</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(skl_linmod3.coef_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1USA       245
3Japan      79
2Europe     68
Name: origin, dtype: int64
Index(['origin_1USA', 'origin_2Europe', 'origin_3Japan'], dtype='object')
[-8.69223435 -5.80269887 -6.05781639]
[-0.83427197  2.50601874 -0.69900932 -5.69254264  0.21795599  2.85870923
 -8.69223435 -5.80269887 -6.05781639]</code></pre>
</div>
</div>
<p>Beware: the result above wrongly suggests Europe is the best. But this is a scaling issue:</p>
<div id="cell-64" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(skl_linmod3.coef_[<span class="dv">6</span>:] <span class="op">/</span> scaler.scale_[<span class="dv">6</span>:])</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.allclose(skl_linmod3.coef_ <span class="op">/</span> scaler.scale_, skl_linmod1.coef_))</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Europe has more variability : because it has fewer samples</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(scaler.scale_[<span class="dv">6</span>:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[-17.95460207 -15.32459971 -15.10137384]
True
[ 0.48412292  0.37865256  0.4011434 ]</code></pre>
</div>
</div>
<p><strong>Conclusion</strong>: we recover the same conclusion after a careful normalisation…</p>
<div id="cell-66" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># best is to check t-statistics NOT the coefficients themselves:</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co"># cf. William H. Greene, Econometric analysis, Prentice Hall (2003), page 79, 4-14</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co"># cf. http://josephsalmon.eu/enseignement/TELECOM/MDI720/IntroTests_fr.pdf</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> sm.OLS(y, Z1).fit()</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_origin1.columns[:])</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results.tvalues.values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Index(['cylinders', 'displacement', 'horsepower', 'weight', 'acceleration',
       'model_year', 'origin_1USA', 'origin_2Europe', 'origin_3Japan'],
      dtype='object')
[ -1.52447816   3.13312444  -1.32642763 -10.24277927   0.80537819
  15.00512974  -3.83896851  -3.32972233  -3.22628516]</code></pre>
</div>
</div>
<p><strong>Conclusion</strong>: the order is still Japan&gt;Europe&gt;USA</p>
</section>
<section id="q18-handling-brands-with-some-text-processing" class="level1">
<h1>Q18: Handling brands with some text processing</h1>
<p>Procéder de même cette fois en fonction de la marque de la voiture. On pourra utiliser <strong>str.split</strong> et <strong>str.replace</strong> pour créer une nouvelle variable <strong>‘brand’</strong>.</p>
<div id="cell-69" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>car_names <span class="op">=</span> data[<span class="st">'car_name'</span>]</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>brands <span class="op">=</span> pd.Series(car_names.<span class="bu">str</span>.split().<span class="bu">str</span>.get(<span class="dv">0</span>))</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co"># A bit of cleaning:</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>brands <span class="op">=</span> brands.<span class="bu">str</span>.replace(<span class="st">'volkswagen'</span>, <span class="st">'vw'</span>, case<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>brands <span class="op">=</span> brands.<span class="bu">str</span>.replace(<span class="st">'vokswagen'</span>, <span class="st">'vw'</span>, case<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>brands <span class="op">=</span> brands.<span class="bu">str</span>.replace(<span class="st">'toyouta'</span>, <span class="st">'toyota'</span>, case<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>brands <span class="op">=</span> brands.<span class="bu">str</span>.replace(<span class="st">'maxda'</span>, <span class="st">'mazda'</span>, case<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>brands <span class="op">=</span> brands.<span class="bu">str</span>.replace(<span class="st">'chevy'</span>, <span class="st">'chevrolet'</span>, case<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>brands <span class="op">=</span> brands.<span class="bu">str</span>.replace(<span class="st">'chevroelt'</span>, <span class="st">'chevrolet'</span>, case<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>brands <span class="op">=</span> brands.<span class="bu">str</span>.replace(<span class="st">'mercedes-benz'</span>, <span class="st">'mercedes'</span>, case<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>brands <span class="op">=</span> brands.<span class="bu">str</span>.replace(<span class="st">'capri'</span>, <span class="st">'ford'</span>, case<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>brands <span class="op">=</span> brands.<span class="bu">str</span>.replace(<span class="st">'datsun'</span>, <span class="st">'nissan'</span>, case<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>brands <span class="op">=</span> brands.<span class="bu">str</span>.replace(<span class="st">'dodge'</span>, <span class="st">'chrysler'</span>, case<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'brand'</span>] <span class="op">=</span> pd.Series(brands)</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>X_brand <span class="op">=</span> data.drop([<span class="st">'car_name'</span>, <span class="st">'mpg'</span>, <span class="st">'origin'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>X_brand <span class="op">=</span> pd.get_dummies(X_brand, columns<span class="op">=</span>[<span class="st">'brand'</span>], drop_first<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: the first in alphabetical order is amc: if drop_first=True, that's the one removed.</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Number of cars per brand:"</span>)</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data[<span class="st">'brand'</span>].value_counts())</span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler(with_mean<span class="op">=</span><span class="va">False</span>, with_std<span class="op">=</span><span class="va">False</span>).fit(X_brand)</span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>X_brand_scaled <span class="op">=</span> scaler.transform(X_brand)</span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>skl_linmod <span class="op">=</span> linear_model.LinearRegression(fit_intercept<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a>skl_linmod.fit(X_brand_scaled, y)</span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a><span class="co"># sort by negative influence over the coefficients:</span></span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a>brands <span class="op">=</span> X_brand.columns[<span class="dv">6</span>:]</span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a>coef_brands <span class="op">=</span> skl_linmod.coef_[<span class="dv">6</span>:]</span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a>rank_variables <span class="op">=</span> np.argsort(coef_brands)</span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">""</span>)</span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Brands by increasing coefficients:"</span>)</span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(brands[rank_variables])</span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(coef_brands[rank_variables])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of cars per brand:
ford          49
chevrolet     47
chrysler      34
plymouth      31
amc           27
toyota        26
nissan        24
vw            22
buick         17
pontiac       16
honda         13
mazda         12
mercury       11
oldsmobile    10
fiat           8
peugeot        8
audi           7
volvo          6
opel           4
subaru         4
saab           4
renault        3
mercedes       3
bmw            2
cadillac       2
triumph        1
hi             1
Name: brand, dtype: int64

Brands by increasing coefficients:
Index(['brand_amc', 'brand_mercury', 'brand_ford', 'brand_buick',
       'brand_chevrolet', 'brand_volvo', 'brand_chrysler', 'brand_opel',
       'brand_bmw', 'brand_oldsmobile', 'brand_plymouth', 'brand_pontiac',
       'brand_mazda', 'brand_saab', 'brand_subaru', 'brand_toyota',
       'brand_peugeot', 'brand_cadillac', 'brand_audi', 'brand_renault',
       'brand_hi', 'brand_mercedes', 'brand_fiat', 'brand_vw', 'brand_honda',
       'brand_nissan', 'brand_triumph'],
      dtype='object')
[-15.8448334  -15.37441593 -15.08920332 -14.50317471 -14.48617161
 -14.25639745 -14.04276501 -13.5846621  -13.58250469 -13.33139153
 -13.07055588 -12.88460789 -12.69522852 -12.54530737 -12.46089461
 -12.42248327 -12.19739697 -11.78508034 -11.74517299 -11.49121929
 -11.28489187 -11.20006111 -11.10051666 -10.98287058 -10.73670551
 -10.08042111  -7.31920326]</code></pre>
</div>
</div>
<div id="cell-70" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sorted by negative influence over the tvalues:</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> sm.OLS(y, X_brand_scaled).fit()</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>brands <span class="op">=</span> X_brand.columns[<span class="dv">6</span>:]</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>ttest_brands <span class="op">=</span> results.tvalues.values[<span class="dv">6</span>:]</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>rank_variables <span class="op">=</span> np.argsort(ttest_brands)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(brands[rank_variables])</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ttest_brands[rank_variables])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Index(['brand_amc', 'brand_ford', 'brand_mercury', 'brand_chevrolet',
       'brand_buick', 'brand_volvo', 'brand_chrysler', 'brand_opel',
       'brand_plymouth', 'brand_bmw', 'brand_oldsmobile', 'brand_pontiac',
       'brand_toyota', 'brand_mazda', 'brand_saab', 'brand_peugeot',
       'brand_subaru', 'brand_audi', 'brand_fiat', 'brand_vw', 'brand_renault',
       'brand_honda', 'brand_mercedes', 'brand_cadillac', 'brand_nissan',
       'brand_hi', 'brand_triumph'],
      dtype='object')
[-3.24363016 -3.0706495  -3.04164157 -2.93096041 -2.84541389 -2.8103812
 -2.80314176 -2.7449872  -2.66925169 -2.57678996 -2.56807667 -2.56645127
 -2.5293144  -2.52610382 -2.45373763 -2.40481246 -2.39941372 -2.35765008
 -2.29523846 -2.24301229 -2.23016877 -2.14972989 -2.08367061 -2.07656736
 -2.02414966 -1.80671684 -1.23027746]</code></pre>
</div>
</div>
<p>The most favorable influence is from the <strong>triumph</strong> brand, but the worst is coming from <strong>amc</strong>.</p>
<div id="cell-72" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Illustration of what would be the prediction for one car if the brand</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co"># was substituted by another one. This will illustrate that the Triumph</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># "would" make a more efficient car that any other brand for the car</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co"># considered.</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>brands_df <span class="op">=</span> pd.Series(brands, name<span class="op">=</span><span class="st">"brands"</span>).<span class="bu">str</span>.replace(<span class="st">'brand_'</span>, <span class="st">''</span>, case<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>  i, brand_name <span class="kw">in</span> <span class="bu">enumerate</span>(brands_df):</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>    X_to_pred <span class="op">=</span> X_brand_scaled[<span class="dv">28</span>].copy()</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>    X_to_pred[<span class="dv">6</span> <span class="op">+</span> <span class="dv">9</span>] <span class="op">=</span> <span class="fl">0.</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>    X_to_pred[<span class="dv">6</span> <span class="op">+</span> i] <span class="op">=</span> <span class="fl">1.</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"If the hi car's brand was </span><span class="sc">{}</span><span class="st">, </span><span class="ch">\n</span><span class="st"> then instead of </span><span class="sc">{}</span><span class="st">, the its consumption would be </span><span class="sc">{:.4}</span><span class="st">"</span>.<span class="bu">format</span>(brand_name, y.iloc[<span class="dv">28</span>],</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>    skl_linmod.predict(X_to_pred.reshape(<span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>If the hi car's brand was amc, 
 then instead of 9.0, the its consumption would be 4.44
If the hi car's brand was audi, 
 then instead of 9.0, the its consumption would be 8.54
If the hi car's brand was bmw, 
 then instead of 9.0, the its consumption would be 6.702
If the hi car's brand was buick, 
 then instead of 9.0, the its consumption would be 5.782
If the hi car's brand was cadillac, 
 then instead of 9.0, the its consumption would be 8.5
If the hi car's brand was chevrolet, 
 then instead of 9.0, the its consumption would be 5.799
If the hi car's brand was chrysler, 
 then instead of 9.0, the its consumption would be 6.242
If the hi car's brand was fiat, 
 then instead of 9.0, the its consumption would be 9.184
If the hi car's brand was ford, 
 then instead of 9.0, the its consumption would be 5.196
If the hi car's brand was hi, 
 then instead of 9.0, the its consumption would be 9.0
If the hi car's brand was honda, 
 then instead of 9.0, the its consumption would be 9.548
If the hi car's brand was mazda, 
 then instead of 9.0, the its consumption would be 7.59
If the hi car's brand was mercedes, 
 then instead of 9.0, the its consumption would be 9.085
If the hi car's brand was mercury, 
 then instead of 9.0, the its consumption would be 4.91
If the hi car's brand was nissan, 
 then instead of 9.0, the its consumption would be 10.2
If the hi car's brand was oldsmobile, 
 then instead of 9.0, the its consumption would be 6.954
If the hi car's brand was opel, 
 then instead of 9.0, the its consumption would be 6.7
If the hi car's brand was peugeot, 
 then instead of 9.0, the its consumption would be 8.087
If the hi car's brand was plymouth, 
 then instead of 9.0, the its consumption would be 7.214
If the hi car's brand was pontiac, 
 then instead of 9.0, the its consumption would be 7.4
If the hi car's brand was renault, 
 then instead of 9.0, the its consumption would be 8.794
If the hi car's brand was saab, 
 then instead of 9.0, the its consumption would be 7.74
If the hi car's brand was subaru, 
 then instead of 9.0, the its consumption would be 7.824
If the hi car's brand was toyota, 
 then instead of 9.0, the its consumption would be 7.862
If the hi car's brand was triumph, 
 then instead of 9.0, the its consumption would be 12.97
If the hi car's brand was volvo, 
 then instead of 9.0, the its consumption would be 6.028
If the hi car's brand was vw, 
 then instead of 9.0, the its consumption would be 9.302</code></pre>
</div>
</div>
<p>Pour aller plus loin : https://perso.univ-rennes1.fr/bernard.delyon/regression.pdf ( I.2.8 Traitement des variables catégorielles)</p>
</section>
<section id="q19" class="level1">
<h1>Q19</h1>
<p>Reprendre la matrice <span class="math inline">X</span> obtenue sans variables catégorielles. Obtenez numériquement la SVD (partielle) de <span class="math inline">X = U S V^\top</span> (par exemple en considérant l’option <strong>full_matrices=False</strong>); vérifier numériquement que $H = U U^$ est une projection orthogonale (on admettra si besoin que c’est la matrice chapeau, H, vue en cours).</p>
<div id="cell-75" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: TO improve and may be give a standard threshold as in Delyon ...</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>U, s, V <span class="op">=</span> svd(X, full_matrices<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>proj_mat <span class="op">=</span> np.dot(U, U.T)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.allclose(proj_mat.dot(proj_mat), proj_mat))</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.allclose(proj_mat.T, proj_mat))</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Rem: Note that the centering/rescaling step does not modify the leverage.</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>leverage <span class="op">=</span> np.diag(proj_mat)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'leverage'</span>] <span class="op">=</span> leverage</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>True
True</code></pre>
</div>
</div>
</section>
<section id="q20" class="level1">
<h1>Q20:</h1>
<p>La diagonale de la matrice <span class="math inline">H</span>, forme le vecteur des “leviers”, qu’on ajoutera comme nouvelle variable. Trier la base de données en fonction de cette variable, et expliquer en quoi les voitures ayant les trois valeurs de “levier” les plus grandes semblent atypiques.</p>
<div id="cell-77" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.sort_values([<span class="st">'leverage'</span>], ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>display(HTML(data.describe().to_html(formatters<span class="op">=</span>{<span class="st">'leverage'</span>: <span class="st">'</span><span class="sc">{:,.3f}</span><span class="st">'</span>.<span class="bu">format</span>})))</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>display(HTML(data.head(<span class="dv">6</span>).to_html(formatters<span class="op">=</span>{<span class="st">'leverage'</span>: <span class="st">'</span><span class="sc">{:,.3f}</span><span class="st">'</span>.<span class="bu">format</span>})))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mpg</th>
<th data-quarto-table-cell-role="th">cylinders</th>
<th data-quarto-table-cell-role="th">displacement</th>
<th data-quarto-table-cell-role="th">horsepower</th>
<th data-quarto-table-cell-role="th">weight</th>
<th data-quarto-table-cell-role="th">acceleration</th>
<th data-quarto-table-cell-role="th">model_year</th>
<th data-quarto-table-cell-role="th">leverage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>392</td>
<td>392</td>
<td>392</td>
<td>392</td>
<td>392</td>
<td>392</td>
<td>392</td>
<td>392.000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>23</td>
<td>5</td>
<td>194</td>
<td>104</td>
<td>2,978</td>
<td>16</td>
<td>76</td>
<td>0.015</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>8</td>
<td>2</td>
<td>105</td>
<td>38</td>
<td>849</td>
<td>3</td>
<td>4</td>
<td>0.014</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>9</td>
<td>3</td>
<td>68</td>
<td>46</td>
<td>1,613</td>
<td>8</td>
<td>70</td>
<td>0.002</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>17</td>
<td>4</td>
<td>105</td>
<td>75</td>
<td>2,225</td>
<td>14</td>
<td>73</td>
<td>0.008</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>23</td>
<td>4</td>
<td>151</td>
<td>94</td>
<td>2,804</td>
<td>16</td>
<td>76</td>
<td>0.012</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>29</td>
<td>8</td>
<td>276</td>
<td>126</td>
<td>3,615</td>
<td>17</td>
<td>79</td>
<td>0.018</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>47</td>
<td>8</td>
<td>455</td>
<td>230</td>
<td>5,140</td>
<td>25</td>
<td>82</td>
<td>0.187</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mpg</th>
<th data-quarto-table-cell-role="th">cylinders</th>
<th data-quarto-table-cell-role="th">displacement</th>
<th data-quarto-table-cell-role="th">horsepower</th>
<th data-quarto-table-cell-role="th">weight</th>
<th data-quarto-table-cell-role="th">acceleration</th>
<th data-quarto-table-cell-role="th">model_year</th>
<th data-quarto-table-cell-role="th">origin</th>
<th data-quarto-table-cell-role="th">car_name</th>
<th data-quarto-table-cell-role="th">brand</th>
<th data-quarto-table-cell-role="th">leverage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">19</td>
<td>14</td>
<td>8</td>
<td>455</td>
<td>225</td>
<td>3,086</td>
<td>10</td>
<td>70</td>
<td>1USA</td>
<td>buick estate wagon (sw)</td>
<td>buick</td>
<td>0.187</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">34</td>
<td>9</td>
<td>8</td>
<td>304</td>
<td>193</td>
<td>4,732</td>
<td>18</td>
<td>70</td>
<td>1USA</td>
<td>hi 1200d</td>
<td>hi</td>
<td>0.085</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>10</td>
<td>8</td>
<td>307</td>
<td>200</td>
<td>4,376</td>
<td>15</td>
<td>70</td>
<td>1USA</td>
<td>chevy c20</td>
<td>chevrolet</td>
<td>0.062</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>11</td>
<td>8</td>
<td>318</td>
<td>210</td>
<td>4,382</td>
<td>14</td>
<td>70</td>
<td>1USA</td>
<td>dodge d200</td>
<td>chrysler</td>
<td>0.061</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>14</td>
<td>8</td>
<td>455</td>
<td>225</td>
<td>4,425</td>
<td>10</td>
<td>70</td>
<td>1USA</td>
<td>pontiac catalina</td>
<td>pontiac</td>
<td>0.059</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">307</td>
<td>24</td>
<td>8</td>
<td>260</td>
<td>90</td>
<td>3,420</td>
<td>22</td>
<td>79</td>
<td>1USA</td>
<td>oldsmobile cutlass salon brougham</td>
<td>oldsmobile</td>
<td>0.055</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Conclusion: - L’observation de levier maximum a des valeurs extrêmes pour: ‘cylinders’, ‘displacement’ et ‘model_year’ - L’observation de deuxième levier maximum a des valeurs extrêmes pour: ‘cylinders’, ‘weight’, ‘acceleration’, ‘horsepower’ et ‘model_year’ - L’observation de deuxième levier maximum a des valeurs extrêmes pour: ‘cylinders’, ‘horsepower’, ‘weight’ and ‘model_year’</p>
<div id="cell-79" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bonus:  visualisation of the leverage points with empirical cut-off for "large" leverage points</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>threshold <span class="op">=</span> <span class="fl">2.5</span> <span class="op">*</span> (<span class="bu">float</span>(X.shape[<span class="dv">1</span>] <span class="op">+</span> <span class="dv">1</span>) <span class="op">/</span> <span class="bu">float</span>(X.shape[<span class="dv">0</span>]))</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>plt.plot(np.arange(X.shape[<span class="dv">0</span>]), leverage, label<span class="op">=</span><span class="st">"Leverage"</span>)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>plt.plot(np.arange(X.shape[<span class="dv">0</span>]), threshold <span class="op">*</span> np.ones(X.shape[<span class="dv">0</span>]), label<span class="op">=</span><span class="st">"threshold"</span>)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Leverage points with empirical cut-off"</span>)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TP_intro_linear_model_corr_fr_files/figure-html/cell-39-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<hr>

<span style="margin-top:20px; margin-bottom: 20px"></span>

<!-- <img style="width:100%;" src="/img/marvins_log_thumbnail.png"> -->

<!-- <p style="margin: 20px"> Do you enjoy my blog? Subscribe here to get notifications and updates (it's free!):</p> -->

<!-- <div class="grid">
  <div class=".d-none .d-md-block g-col-md-1"></div>
  <div class="g-col-12 g-col-md-10">
    <iframe src="https://embeds.beehiiv.com/c7111066-479b-43db-ad92-8d703fe96bf0?slim=true" data-test-id="beehiiv-embed" frameborder="0" scrolling="no" style="margin: 0; border-radius: 0px !important; background-color: transparent; width:100%; padding: 20px"></iframe>
  </div>
  <div class=".d-none .d-md-block g-col-md-1"></div>
</div> -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><span class="faux-block"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> 2024 Joseph Salmon</span> <span class="faux-block"><a href="https://github.com/josephsalmon/MyWebsite"><i class="fa-brands fa-github" aria-label="github"></i> Source Code</a></span></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p><span class="faux-block"> Designed with <i class="fa-solid fa-heart" aria-label="heart"></i></span> <span class="faux-block"> Built with <a href="https://quarto.org/">Quarto</a></span></p>
</div>
  </div>
</footer>




</body></html>