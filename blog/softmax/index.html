<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joseph Salmon">
<meta name="author" content="François-David Collin">
<meta name="dcterms.date" content="2024-09-03">
<meta name="description" content="Back to exponential weights and log-sum-exp functions">

<title>Soft-max and Soft-argmax – Joseph Salmon</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../..//img/Flag_of_Occitania.svg" rel="icon" type="image/svg+xml">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-25d362aa3afec45ecf1ae134bfa15e67.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-7b78b88afbcb31605f781eb1d5bd0002.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(../../img/bg_pine_trees.jpg);
background-size: cover;
      }
</style>
<meta name="author" content="Joseph Salmon">
<script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../img/Flag_of_Occitania.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Joseph Salmon</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../Courses/index.html"> 
<span class="menu-text">Courses</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications/index.html"> 
<span class="menu-text">Articles</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../talks/index.html"> 
<span class="menu-text">Talks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../team/index.html"> 
<span class="menu-text">Team</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../code_new/index.html"> 
<span class="menu-text">Code</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../misc/index.html"> 
<span class="menu-text">Misc</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="../../blog/index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/josephsalmon"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://sigmoid.social/@josephsalmon" rel="me"> <i class="bi bi-mastodon" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/joseph-salmon-6134262a6/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:joseph.salmon@inria.fr"> <i class="bi bi-envelope" role="img" aria-label="email">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default blog-post page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Soft-max and Soft-argmax</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
                  <div>
        <div class="description">
          Back to exponential weights and log-sum-exp functions
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">statistics</div>
                <div class="quarto-category">optimization</div>
                <div class="quarto-category">machine learning</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Authors</div>
      <div class="quarto-title-meta-contents">
               <p>Joseph Salmon </p>
               <p>François-David Collin </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 3, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#definition-and-notation" id="toc-definition-and-notation" class="nav-link active" data-scroll-target="#definition-and-notation"><i class="fa-solid fa-pencil-alt" title="pencil" aria-label="pencil-alt"></i> Definition and notation</a></li>
  <li><a href="#variational-formulation" id="toc-variational-formulation" class="nav-link" data-scroll-target="#variational-formulation"><i class="fa-solid fa-wave-square" aria-label="wave-square"></i> Variational formulation</a></li>
  <li><a href="#invariance-properties" id="toc-invariance-properties" class="nav-link" data-scroll-target="#invariance-properties"><i class="fa-solid fa-sync-alt" aria-label="sync-alt"></i> Invariance properties</a></li>
  <li><a href="#visualization" id="toc-visualization" class="nav-link" data-scroll-target="#visualization"><i class="fa-solid fa-sliders" aria-label="sliders"></i> Visualization</a></li>
  <li><a href="#credit" id="toc-credit" class="nav-link" data-scroll-target="#credit"><i class="fa-solid fa-handshake" title="handshakes" aria-label="handshake"></i> Credit</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><i class="fa-solid fa-link" title="link" aria-label="link"></i> References</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">
<div class="no-row-height column-margin column-container">
  <div class="">
    <img src="softmax.png" style="width:100%">
  </div>
</div>





<p>The softmax function is a smooth approximation of the max function, and is used in many machine learning models. Similarly we can define the soft-argmax function, which is a smooth approximation of the argmax function.</p>
<section id="definition-and-notation" class="level2">
<h2 class="anchored" data-anchor-id="definition-and-notation"><i class="fa-solid fa-pencil-alt" title="pencil" aria-label="pencil-alt"></i> Definition and notation</h2>
<p>First, let us define <span class="math inline">\Delta_{K} = \{p \in \mathbb{R}^K \geq 0: \sum_{k} p_k = 1\}</span> the probability simplex in <span class="math inline">\mathbb{R}^K</span>, and <span class="math inline">u_K = (1/K, \dots, 1/K)^\top</span> the uniform distribution in <span class="math inline">\Delta_{K}</span>, and the standard basis vectors <span class="math inline">(\delta_k)_{k=1,\dots,K}</span>, where <span class="math inline">\delta_k = (0,\dots,\underbrace{1}_{k-\rm{th}},\dots,0)^\top \in \mathbb{R}^K</span>.</p>
<p>Formally, the standard <strong>soft-argmax</strong> function <span class="math inline">\sigma \colon \mathbb{R}^{K} \to (0, 1)^{K}</span>, where <span class="math inline">K \geq 1</span>, takes a vector <span class="math inline">z = (z_{1}, \dots, z_{K})^\top \in \mathbb{R}^{K}</span> and computes each component of the vector <span class="math inline">\sigma(z) \in [0, 1]^{K}</span> by <span class="math display">
\left(\sigma(z)\right)_k = \frac{\exp(z_k)}{\sum_{k'=1}^{K} \exp(z_{k'})}\enspace, \quad \text{for } k = 1, \dots, K.
</span></p>
<p>Note in particular that <span class="math inline">\sigma(z)=\sigma_{u_K, 1}(z)</span> for any <span class="math inline">z \in \mathbb{R}^K</span>.</p>
<p>We also define for any <span class="math inline">q \in \Delta_{K}</span> with positive coordinates<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, <em>i.e.</em>, <span class="math inline">q_k&gt;0</span>, for all <span class="math inline">k\in [K]</span>, the function <span class="math inline">\sigma_{q,\beta} \colon \mathbb{R}^{K} \to \mathbb{R}^K</span> as</p>
<p><span class="math display">
\left(\sigma_{q,\beta}(z)\right)_k = \frac{q_k\exp(z_k/\beta)}{\sum_{k'=1}^{K} q_{k'}\exp(z_{k'}/\beta)} \enspace, \quad \text{for } k = 1, \dots, K.
</span></p>
<p>Last but not least, we introduce the real valued log-sum-exp function (or weighted <strong>softmax</strong>), defined for any vector <span class="math inline">z \in \mathbb{R}^K</span> by</p>
<p><span class="math display">
\text{logsumexp}_{q,\beta}(z) = \beta \cdot \log\left(\sum_{k=1}^{K} q_k \cdot \exp(z_k/\beta)\right).
</span></p>
</section>
<section id="variational-formulation" class="level2">
<h2 class="anchored" data-anchor-id="variational-formulation"><i class="fa-solid fa-wave-square" aria-label="wave-square"></i> Variational formulation</h2>
<p>In this note we show that the soft-argmax function can be written as the conjugate of the log-sum-exp function.</p>
<div id="thm-lfgn" class="theorem">
<p><span class="theorem-title"><strong>Theorem 1</strong></span> Let <span class="math inline">q \in \Delta_{K}</span> be with positive coordinates, <em>i.e.</em>, <span class="math inline">q_k&gt;0</span>, for all <span class="math inline">k\in [K]</span>, <span class="math inline">\beta&gt;0</span> and let <span class="math inline">z \in \mathbb{R}^K</span>. Then,</p>
<p><span class="math display">
\begin{align*}
\text{logsumexp}_{q,\beta}(z)
&amp; =
\max_{ p \in \Delta_K} \langle z, p \rangle - \beta\sum_{k=1}^{K} p_k \log(p_k / q_k) \\
\sigma_{q,\beta}(z)
&amp; =
\argmax_{ p \in \Delta_K} \langle z, p \rangle - \beta\sum_{k=1}^{K} p_k \log(p_k / q_k)\enspace.
\end{align*}
</span></p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>Using Lagrange multipliers <span class="citation" data-cites="Boyd_Vandenberghe04">(see for instance Ch. 5, <a href="#ref-Boyd_Vandenberghe04" role="doc-biblioref">Boyd and Vandenberghe 2004</a>)</span> you get for <span class="math inline">\Lambda=(\lambda_1,\dots,\lambda_K)^\top</span>, <span class="math inline">\mu \in \mathbb{R}</span> and <span class="math inline">p \in \Delta_K</span> the Lagrangian function:</p>
<p><span class="math display">
\mathcal{L}(p,\mu,\Lambda) = \langle z, p \rangle - \beta\sum_{k=1}^{K} p_k \log(p_k / q_k) + \mu\left(\sum_{k=1}^{K} p_k - 1\right) - \sum_{k=1}^{K} \lambda_k p_k.
</span></p>
<p>The Slater condition is satisfied, so the KKT conditions are necessary and sufficient for optimality. The KKT conditions are <span class="math display">
\begin{align*}
\frac{\partial \mathcal{L}}{\partial p_k} &amp;= z_k - \beta\log(p_k / q_k) - \beta - \mu - \lambda_k = 0, \quad k = 1, \dots, K,\\
\mu\left(\sum_{k=1}^{K} p_k - 1\right) &amp;= 0,\\
\lambda_k p_k &amp;= 0, \quad k = 1, \dots, K,\\
p_k &amp;\geq 0, \quad k = 1, \dots, K.
\end{align*}
</span> From the first KKT condition we get <span class="math display">
p_k = q_k\exp\left(\frac{z_k-\beta-\mu-\lambda_k}{\beta}\right), \quad k = 1, \dots, K.
</span> Now, since <span class="math inline">\lambda_k p_k = 0</span> and that <span class="math inline">q_k&gt;0</span> for all <span class="math inline">k</span>, we have that <span class="math inline">\lambda_k = 0</span> for all <span class="math inline">k</span>. Thus, we get after normalisation that <span class="math display">
p_k = \frac{q_k\exp(z_k/\beta)}{\sum_{k'=1}^{K} q_{k'}\exp(z_{k'}/\beta)}, \quad k = 1, \dots, K.
</span> Note that <span class="math display">
\begin{align*}
&amp; p_k = \frac{q_k\exp(z_k/\beta)}{\sum_{k'=1}^{K} q_{k'}\exp(z_{k'}/\beta)}\\
\iff &amp; \log( p_k) = \log(q_k) + \frac{z_k}{\beta} - \frac{1}{\beta} \cdot  \text{logsumexp}_{q,\beta}(z).
\end{align*}
</span> Finally, we have that <span class="math display">
\begin{align*}
\beta\sum_{k=1}^{K} p_k \log(p_k / q_k) &amp;= \beta\sum_{k=1}^{K} p_k \left(\frac{z_k}{\beta} - \frac{1}{\beta} \cdot \text{logsumexp}_{q,\beta}(z)\right)\\
&amp;= \sum_{k=1}^{K} p_k z_k - \text{logsumexp}_{q,\beta}(z),
\end{align*}
</span> Hence, <span class="math inline">\sum_{k=1}^{K} p_k z_k - \beta \sum_{k=1}^{K} p_k \log(p_k / q_k) = \text{logsumexp}_{q,\beta}(z)</span>.</p>
</div>
<p>The following limit properties for infinitesimal <span class="math inline">\beta</span> explain the naming and the regularizing property of the (temperature) parameter <span class="math inline">\beta</span>:</p>
<div id="prp-soft" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 1</strong></span> Reminding that <span class="math inline">u_K=(1/K,\dots,1/K)^\top</span> and <span class="math inline">\delta_{k}</span> is the <span class="math inline">k</span>-th standard basis vector, for any <span class="math inline">z \in \mathbb{R}^K</span>, we have that</p>
<p><span class="math display">
\begin{align*}
\sigma_{u_K,\beta}(z) &amp; \xrightarrow[\beta \to 0]{}  \delta_{k_0}, \text{ where } k_0=\argmax_{k\in [K]} z_k \\
\text{logsumexp}_{u_K,\beta}(z) &amp; \xrightarrow[\beta \to 0]{} \max_{k\in [K]} z_k \enspace.
\end{align*}
</span></p>
</div>
<p>The first limit show that the soft-argmax function is a kind of smooth approximation of the argmax function, while the log-sum-exp function is a smooth approximation of the max function.</p>
</section>
<section id="invariance-properties" class="level2">
<h2 class="anchored" data-anchor-id="invariance-properties"><i class="fa-solid fa-sync-alt" aria-label="sync-alt"></i> Invariance properties</h2>
<p>The softmax function is invariant to the addition of a constant to each component of the input vector. More precisely, we have the following result:</p>
<div id="thm-invariance" class="theorem">
<p><span class="theorem-title"><strong>Theorem 2</strong></span> Let <span class="math inline">q \in \Delta_{K}</span> be with positive coordinates, <em>i.e.</em>, <span class="math inline">q_k&gt;0</span>, for all <span class="math inline">k\in [K]</span>, <span class="math inline">\beta&gt;0</span> and let <span class="math inline">z \in \mathbb{R}^K</span>. Then, for any <span class="math inline">c \in \mathbb{R}</span>, we have that <span class="math display">
\sigma_{q,\beta}(z) = \sigma_{q,\beta}(z+c).
</span></p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>We have that <span class="math display">
\begin{align*}
\sigma_{q,\beta}(z+c)_k &amp;= \frac{q_k\exp((z_k+c)/\beta)}{\sum_{k'=1}^{K} q_{k'}\exp((z_{k'}+c)/\beta)}\\
&amp;= \frac{q_k\exp(z_k/\beta)\exp(c/\beta)}{\sum_{k'=1}^{K} q_{k'}\exp(z_{k'}/\beta)\exp(c/\beta)}\\
&amp;= \frac{q_k\exp(z_k/\beta)}{\sum_{k'=1}^{K} q_{k'}\exp(z_{k'}/\beta)}\\
&amp;= \sigma_{q,\beta}(z)_k.
\end{align*}
</span></p>
</div>
<p>Let us consider also the effect of rescaling the input vector by a positive constant. We have the following result:</p>
<div id="thm-rescaling" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3</strong></span> Let <span class="math inline">q \in \Delta_{K}</span> be with positive coordinates, <em>i.e.</em>, <span class="math inline">q_k&gt;0</span>, for all <span class="math inline">k\in [K]</span>, <span class="math inline">\beta&gt;0</span> and let <span class="math inline">z \in \mathbb{R}^K</span>. Then, for any <span class="math inline">\alpha &gt;0</span>, we have that <span class="math display">
\sigma_{q,\beta}(\alpha z) = \sigma_{q,\tfrac{\beta}{\alpha}}(z).
</span></p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>We have that <span class="math display">
\begin{align*}
\left(\sigma_{q,\beta}(\alpha z)\right)_k &amp;= \frac{q_k\exp(\alpha z_k/\beta)}{\sum_{k'=1}^{K} q_{k'}\exp(\alpha z_{k'}/\beta)}\\
&amp;= \frac{q_k\exp(z_k/\frac{\beta}{\alpha})}{\sum_{k'=1}^{K} q_{k'}\exp(z_{k'}/\frac{\beta}{\alpha})}\\
&amp;= \left(\sigma_{q,\tfrac{\beta}{\alpha}}(z)\right)_k.
\end{align*}
</span></p>
</div>
</section>
<section id="visualization" class="level2">
<h2 class="anchored" data-anchor-id="visualization"><i class="fa-solid fa-sliders" aria-label="sliders"></i> Visualization</h2>
<p>We consider the case <span class="math inline">K=3</span> for visualization. <!-- color a word in purple with html in the following sentence--></p>
<p>You can click on the plot to move <span class="math inline">z</span> <span style="color: purple;">(the purple dot)</span>, and see the corresponding soft-argmax <span class="math inline">\sigma_{q,\beta}</span> <span style="color: red;">(the red dot)</span>. You can modify <span class="math inline">q</span> (the black dot) and <span class="math inline">\beta</span> with the slider. The level sets displayed are for the function after the max in the log-sum-exp definition, <em>i.e.</em>, for a fixed <span class="math inline">z\in \mathbb{R}^3</span>, <span class="math inline">q\in \Delta_K</span> and <span class="math inline">\beta&gt;0</span>, the level set is the set of points <span class="math inline">p\in \Delta_K</span> such that <span class="math display">
\begin{align*}
\Delta_K &amp;\to \mathbb{R} \\
p &amp; \mapsto \langle z, p \rangle - \beta\sum_{k=1}^{K} p_k \log(p_k / q_k)
\end{align*}
</span></p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" data-startfrom="218" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 217;"><span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>d3 <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3@v6"</span><span class="op">,</span> <span class="st">"d3-hexbin@0.2"</span>)</span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>math <span class="op">=</span> <span class="pp">require</span>(<span class="st">"mathjs"</span>)</span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>digamma <span class="op">=</span> <span class="pp">require</span>( <span class="st">'https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-digamma@umd/browser.js'</span> )</span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> {legend} <span class="im">from</span> <span class="st">"@d3/color-legend"</span></span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>densityResolution <span class="op">=</span> <span class="dv">80</span></span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>margin <span class="op">=</span> ({ <span class="dt">left</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span> <span class="dt">top</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">30</span> })</span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a>height <span class="op">=</span> <span class="dv">400</span></span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>beta <span class="op">=</span> [inputs<span class="op">.</span><span class="at">beta</span>]</span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a><span class="co">// lbd = [0.3,0.3,0.4]</span></span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a>viewof q1 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.01</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`q_1`</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span>})</span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>viewof q2 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.01</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`q_2`</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span>})</span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>viewof q3 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.01</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`q_3`</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span>})</span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>viewof z1 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="op">-</span><span class="dv">10</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="fl">0.4</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`z_1`</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span>})</span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a>viewof z2 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="op">-</span><span class="dv">10</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="fl">0.2</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`z_2`</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span>})</span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a>viewof z3 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="op">-</span><span class="dv">10</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="fl">0.2</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`z_3`</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span>})</span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a>viewof inputs <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>({</span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a>  <span class="dt">z1</span><span class="op">:</span> viewof z1<span class="op">,</span></span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a>  <span class="dt">z2</span><span class="op">:</span> viewof z2<span class="op">,</span></span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a>  <span class="dt">z3</span><span class="op">:</span> viewof z3<span class="op">,</span></span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a>  <span class="dt">beta</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.01</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\b</span><span class="vs">eta`</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span>})<span class="op">,</span></span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a>  <span class="dt">q1</span><span class="op">:</span> viewof q1<span class="op">,</span></span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>  <span class="dt">q2</span><span class="op">:</span> viewof q2<span class="op">,</span></span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>  <span class="dt">q3</span><span class="op">:</span> viewof q3<span class="op">,</span></span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> [q1<span class="op">,</span> q2<span class="op">,</span> q3]</span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> [z1<span class="op">,</span> z2<span class="op">,</span> z3]</span>
<span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a>logsumexp <span class="op">=</span> (x<span class="op">,</span> alpha<span class="op">,</span> beta) <span class="kw">=&gt;</span> {</span>
<span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> result <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> x<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) result <span class="op">+=</span> alpha[i] <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(x[i] <span class="op">/</span> beta)<span class="op">;</span></span>
<span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> beta <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(result)<span class="op">;</span></span>
<span id="cb1-259"><a href="#cb1-259" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-260"><a href="#cb1-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-261"><a href="#cb1-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-262"><a href="#cb1-262" aria-hidden="true" tabindex="-1"></a>objective <span class="op">=</span> (x<span class="op">,</span> z<span class="op">,</span> alpha<span class="op">,</span> beta) <span class="kw">=&gt;</span> {</span>
<span id="cb1-263"><a href="#cb1-263" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> result <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-264"><a href="#cb1-264" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> x<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) result <span class="op">-=</span> beta <span class="op">*</span> x[i] <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(x[i] <span class="op">/</span> alpha[i])<span class="op">;</span></span>
<span id="cb1-265"><a href="#cb1-265" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> x<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) result <span class="op">+=</span> x[i] <span class="op">*</span> z[i]<span class="op">;</span></span>
<span id="cb1-266"><a href="#cb1-266" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb1-267"><a href="#cb1-267" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-268"><a href="#cb1-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-269"><a href="#cb1-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-270"><a href="#cb1-270" aria-hidden="true" tabindex="-1"></a>kull_leibler <span class="op">=</span> (x<span class="op">,</span> alpha<span class="op">,</span> beta) <span class="kw">=&gt;</span> {</span>
<span id="cb1-271"><a href="#cb1-271" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> result <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-272"><a href="#cb1-272" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> x<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) result <span class="op">-=</span> x[i] <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(x[i] <span class="op">/</span> alpha[i])<span class="op">;</span></span>
<span id="cb1-273"><a href="#cb1-273" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> beta <span class="op">*</span> result<span class="op">;</span></span>
<span id="cb1-274"><a href="#cb1-274" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-275"><a href="#cb1-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-276"><a href="#cb1-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-277"><a href="#cb1-277" aria-hidden="true" tabindex="-1"></a>softmax <span class="op">=</span> (x<span class="op">,</span> alpha<span class="op">,</span> beta) <span class="kw">=&gt;</span> {</span>
<span id="cb1-278"><a href="#cb1-278" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> result <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-279"><a href="#cb1-279" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> sum <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-280"><a href="#cb1-280" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> x<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-281"><a href="#cb1-281" aria-hidden="true" tabindex="-1"></a>    result<span class="op">.</span><span class="fu">push</span>(alpha[i] <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(x[i] <span class="op">/</span> beta))<span class="op">;</span></span>
<span id="cb1-282"><a href="#cb1-282" aria-hidden="true" tabindex="-1"></a>    sum <span class="op">+=</span> result[i]<span class="op">;</span></span>
<span id="cb1-283"><a href="#cb1-283" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-284"><a href="#cb1-284" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> x<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) result[i] <span class="op">/=</span> sum<span class="op">;</span></span>
<span id="cb1-285"><a href="#cb1-285" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb1-286"><a href="#cb1-286" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-287"><a href="#cb1-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-288"><a href="#cb1-288" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">cartesianToBarycentric</span>(x<span class="op">,</span> y<span class="op">,</span> corners) {</span>
<span id="cb1-289"><a href="#cb1-289" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> A <span class="op">=</span> corners[<span class="dv">0</span>]<span class="op">,</span> B <span class="op">=</span> corners[<span class="dv">1</span>]<span class="op">,</span> C <span class="op">=</span> corners[<span class="dv">2</span>]<span class="op">;</span></span>
<span id="cb1-290"><a href="#cb1-290" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> v0 <span class="op">=</span> { <span class="dt">x</span><span class="op">:</span> C<span class="op">.</span><span class="at">x</span> <span class="op">-</span> A<span class="op">.</span><span class="at">x</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> C<span class="op">.</span><span class="at">y</span> <span class="op">-</span> A<span class="op">.</span><span class="at">y</span> }<span class="op">;</span></span>
<span id="cb1-291"><a href="#cb1-291" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> v1 <span class="op">=</span> { <span class="dt">x</span><span class="op">:</span> B<span class="op">.</span><span class="at">x</span> <span class="op">-</span> A<span class="op">.</span><span class="at">x</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> B<span class="op">.</span><span class="at">y</span> <span class="op">-</span> A<span class="op">.</span><span class="at">y</span> }<span class="op">;</span></span>
<span id="cb1-292"><a href="#cb1-292" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> v2 <span class="op">=</span> { <span class="dt">x</span><span class="op">:</span> x <span class="op">-</span> A<span class="op">.</span><span class="at">x</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> y <span class="op">-</span> A<span class="op">.</span><span class="at">y</span> }<span class="op">;</span></span>
<span id="cb1-293"><a href="#cb1-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-294"><a href="#cb1-294" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> d00 <span class="op">=</span> <span class="fu">dot</span>(v0<span class="op">,</span> v0)<span class="op">;</span></span>
<span id="cb1-295"><a href="#cb1-295" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> d01 <span class="op">=</span> <span class="fu">dot</span>(v0<span class="op">,</span> v1)<span class="op">;</span></span>
<span id="cb1-296"><a href="#cb1-296" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> d11 <span class="op">=</span> <span class="fu">dot</span>(v1<span class="op">,</span> v1)<span class="op">;</span></span>
<span id="cb1-297"><a href="#cb1-297" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> d20 <span class="op">=</span> <span class="fu">dot</span>(v2<span class="op">,</span> v0)<span class="op">;</span></span>
<span id="cb1-298"><a href="#cb1-298" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> d21 <span class="op">=</span> <span class="fu">dot</span>(v2<span class="op">,</span> v1)<span class="op">;</span></span>
<span id="cb1-299"><a href="#cb1-299" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> denom <span class="op">=</span> d00 <span class="op">*</span> d11 <span class="op">-</span> d01 <span class="op">*</span> d01<span class="op">;</span></span>
<span id="cb1-300"><a href="#cb1-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-301"><a href="#cb1-301" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> lambda1 <span class="op">=</span> (d11 <span class="op">*</span> d20 <span class="op">-</span> d01 <span class="op">*</span> d21) <span class="op">/</span> denom<span class="op">;</span></span>
<span id="cb1-302"><a href="#cb1-302" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> lambda2 <span class="op">=</span> (d00 <span class="op">*</span> d21 <span class="op">-</span> d01 <span class="op">*</span> d20) <span class="op">/</span> denom<span class="op">;</span></span>
<span id="cb1-303"><a href="#cb1-303" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> lambda3 <span class="op">=</span> <span class="fl">1.0</span> <span class="op">-</span> lambda1 <span class="op">-</span> lambda2<span class="op">;</span></span>
<span id="cb1-304"><a href="#cb1-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-305"><a href="#cb1-305" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [lambda1<span class="op">,</span> lambda2<span class="op">,</span> lambda3]<span class="op">;</span></span>
<span id="cb1-306"><a href="#cb1-306" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-307"><a href="#cb1-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-308"><a href="#cb1-308" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">barycentricToCartesian</span>(q<span class="op">,</span> corners) {</span>
<span id="cb1-309"><a href="#cb1-309" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [</span>
<span id="cb1-310"><a href="#cb1-310" aria-hidden="true" tabindex="-1"></a>    corners[<span class="dv">0</span>]<span class="op">.</span><span class="at">x</span> <span class="op">*</span> q[<span class="dv">0</span>] <span class="op">+</span> corners[<span class="dv">1</span>]<span class="op">.</span><span class="at">x</span> <span class="op">*</span> q[<span class="dv">1</span>] <span class="op">+</span> corners[<span class="dv">2</span>]<span class="op">.</span><span class="at">x</span> <span class="op">*</span> q[<span class="dv">2</span>]<span class="op">,</span></span>
<span id="cb1-311"><a href="#cb1-311" aria-hidden="true" tabindex="-1"></a>    corners[<span class="dv">0</span>]<span class="op">.</span><span class="at">y</span> <span class="op">*</span> q[<span class="dv">0</span>] <span class="op">+</span> corners[<span class="dv">1</span>]<span class="op">.</span><span class="at">y</span> <span class="op">*</span> q[<span class="dv">1</span>] <span class="op">+</span> corners[<span class="dv">2</span>]<span class="op">.</span><span class="at">y</span> <span class="op">*</span> q[<span class="dv">2</span>]</span>
<span id="cb1-312"><a href="#cb1-312" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb1-313"><a href="#cb1-313" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-314"><a href="#cb1-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-315"><a href="#cb1-315" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">dot</span>(v1<span class="op">,</span> v2) {</span>
<span id="cb1-316"><a href="#cb1-316" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> v1<span class="op">.</span><span class="at">x</span> <span class="op">*</span> v2<span class="op">.</span><span class="at">x</span> <span class="op">+</span> v1<span class="op">.</span><span class="at">y</span> <span class="op">*</span> v2<span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb1-317"><a href="#cb1-317" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-318"><a href="#cb1-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-319"><a href="#cb1-319" aria-hidden="true" tabindex="-1"></a>ternaryDensity <span class="op">=</span> (density<span class="op">,</span> resolution<span class="op">,</span> options<span class="op">,</span> lbd) <span class="kw">=&gt;</span> {</span>
<span id="cb1-320"><a href="#cb1-320" aria-hidden="true" tabindex="-1"></a>  options <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">assign</span>({</span>
<span id="cb1-321"><a href="#cb1-321" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size</span><span class="op">:</span> <span class="dv">400</span><span class="op">,</span></span>
<span id="cb1-322"><a href="#cb1-322" aria-hidden="true" tabindex="-1"></a>    <span class="dt">margin</span><span class="op">:</span> { <span class="dt">left</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span> <span class="dt">top</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">30</span> }<span class="op">,</span></span>
<span id="cb1-323"><a href="#cb1-323" aria-hidden="true" tabindex="-1"></a>    <span class="dt">colorScheme</span><span class="op">:</span> d3<span class="op">.</span><span class="at">interpolateBlues</span></span>
<span id="cb1-324"><a href="#cb1-324" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> options)<span class="op">;</span></span>
<span id="cb1-325"><a href="#cb1-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-326"><a href="#cb1-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-327"><a href="#cb1-327" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> fillScale <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleSequential</span>(options<span class="op">.</span><span class="at">colorScheme</span>)<span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span></span>
<span id="cb1-328"><a href="#cb1-328" aria-hidden="true" tabindex="-1"></a>  <span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(q[<span class="dv">0</span>]<span class="op">,</span>q[<span class="dv">1</span>]<span class="op">,</span>q[<span class="dv">2</span>]))])<span class="op">;</span></span>
<span id="cb1-329"><a href="#cb1-329" aria-hidden="true" tabindex="-1"></a>  <span class="co">// const fillScale = d3.scaleSequential(options.colorScheme).domain(d3.extent(density.map(d =&gt; d.density)))</span></span>
<span id="cb1-330"><a href="#cb1-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-331"><a href="#cb1-331" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb1-332"><a href="#cb1-332" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> options<span class="op">.</span><span class="at">size</span>)</span>
<span id="cb1-333"><a href="#cb1-333" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> options<span class="op">.</span><span class="at">size</span>)<span class="op">;</span></span>
<span id="cb1-334"><a href="#cb1-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-335"><a href="#cb1-335" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-336"><a href="#cb1-336" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>])</span>
<span id="cb1-337"><a href="#cb1-337" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([options<span class="op">.</span><span class="at">margin</span><span class="op">.</span><span class="at">left</span><span class="op">,</span> options<span class="op">.</span><span class="at">size</span> <span class="op">-</span> options<span class="op">.</span><span class="at">margin</span><span class="op">.</span><span class="at">right</span>])</span>
<span id="cb1-338"><a href="#cb1-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-339"><a href="#cb1-339" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> y <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-340"><a href="#cb1-340" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>])</span>
<span id="cb1-341"><a href="#cb1-341" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([options<span class="op">.</span><span class="at">size</span> <span class="op">-</span> options<span class="op">.</span><span class="at">margin</span><span class="op">.</span><span class="at">bottom</span><span class="op">,</span> options<span class="op">.</span><span class="at">margin</span><span class="op">.</span><span class="at">top</span>])<span class="op">;</span></span>
<span id="cb1-342"><a href="#cb1-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-343"><a href="#cb1-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-344"><a href="#cb1-344" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">inverseScaleX</span>(value) {</span>
<span id="cb1-345"><a href="#cb1-345" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Constants from the original scale</span></span>
<span id="cb1-346"><a href="#cb1-346" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> domainMin <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-347"><a href="#cb1-347" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> domainMax <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-348"><a href="#cb1-348" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> rangeMin <span class="op">=</span> options<span class="op">.</span><span class="at">margin</span><span class="op">.</span><span class="at">left</span><span class="op">;</span></span>
<span id="cb1-349"><a href="#cb1-349" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> rangeMax <span class="op">=</span> options<span class="op">.</span><span class="at">size</span> <span class="op">-</span> options<span class="op">.</span><span class="at">margin</span><span class="op">.</span><span class="at">right</span><span class="op">;</span></span>
<span id="cb1-350"><a href="#cb1-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-351"><a href="#cb1-351" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Calculate the proportion of the input value within the range</span></span>
<span id="cb1-352"><a href="#cb1-352" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> proportion <span class="op">=</span> (value <span class="op">-</span> rangeMin) <span class="op">/</span> (rangeMax <span class="op">-</span> rangeMin)<span class="op">;</span></span>
<span id="cb1-353"><a href="#cb1-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-354"><a href="#cb1-354" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Apply the proportion to the domain</span></span>
<span id="cb1-355"><a href="#cb1-355" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> proportion <span class="op">*</span> (domainMax <span class="op">-</span> domainMin) <span class="op">+</span> domainMin<span class="op">;</span></span>
<span id="cb1-356"><a href="#cb1-356" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-357"><a href="#cb1-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-358"><a href="#cb1-358" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">inverseInverseScaleX</span>(value) {</span>
<span id="cb1-359"><a href="#cb1-359" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Constants from the original scale</span></span>
<span id="cb1-360"><a href="#cb1-360" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> domainMin <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-361"><a href="#cb1-361" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> domainMax <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-362"><a href="#cb1-362" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> rangeMin <span class="op">=</span> options<span class="op">.</span><span class="at">size</span> <span class="op">-</span> options<span class="op">.</span><span class="at">margin</span><span class="op">.</span><span class="at">right</span><span class="op">;</span></span>
<span id="cb1-363"><a href="#cb1-363" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> rangeMax <span class="op">=</span> options<span class="op">.</span><span class="at">margin</span><span class="op">.</span><span class="at">left</span><span class="op">;</span></span>
<span id="cb1-364"><a href="#cb1-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-365"><a href="#cb1-365" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Calculate the proportion of the input value within the range</span></span>
<span id="cb1-366"><a href="#cb1-366" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> proportion <span class="op">=</span> (rangeMax <span class="op">-</span> rangeMin)<span class="op">;</span></span>
<span id="cb1-367"><a href="#cb1-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-368"><a href="#cb1-368" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Apply the proportion to the domain</span></span>
<span id="cb1-369"><a href="#cb1-369" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rangeMax <span class="op">-</span> proportion <span class="op">*</span> value <span class="op">;</span></span>
<span id="cb1-370"><a href="#cb1-370" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-371"><a href="#cb1-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-372"><a href="#cb1-372" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">inverseScaleY</span>(value) {</span>
<span id="cb1-373"><a href="#cb1-373" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Constants from the original scale</span></span>
<span id="cb1-374"><a href="#cb1-374" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> domainMin <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-375"><a href="#cb1-375" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> domainMax <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-376"><a href="#cb1-376" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> rangeMin <span class="op">=</span> options<span class="op">.</span><span class="at">size</span> <span class="op">-</span> options<span class="op">.</span><span class="at">margin</span><span class="op">.</span><span class="at">bottom</span><span class="op">;</span></span>
<span id="cb1-377"><a href="#cb1-377" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> rangeMax <span class="op">=</span> options<span class="op">.</span><span class="at">margin</span><span class="op">.</span><span class="at">top</span><span class="op">;</span></span>
<span id="cb1-378"><a href="#cb1-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-379"><a href="#cb1-379" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Calculate the proportion of the input value within the range</span></span>
<span id="cb1-380"><a href="#cb1-380" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> proportion <span class="op">=</span> (value <span class="op">-</span> rangeMin) <span class="op">/</span> (rangeMax <span class="op">-</span> rangeMin)<span class="op">;</span></span>
<span id="cb1-381"><a href="#cb1-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-382"><a href="#cb1-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-383"><a href="#cb1-383" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Apply the proportion to the domain</span></span>
<span id="cb1-384"><a href="#cb1-384" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> proportion <span class="op">*</span> (domainMax <span class="op">-</span> domainMin) <span class="op">+</span> domainMin<span class="op">;</span></span>
<span id="cb1-385"><a href="#cb1-385" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-386"><a href="#cb1-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-387"><a href="#cb1-387" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">inverseInverseScaleY</span>(value) {</span>
<span id="cb1-388"><a href="#cb1-388" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Constants from the original scale</span></span>
<span id="cb1-389"><a href="#cb1-389" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> domainMin <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-390"><a href="#cb1-390" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> domainMax <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-391"><a href="#cb1-391" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> rangeMin <span class="op">=</span> options<span class="op">.</span><span class="at">size</span> <span class="op">-</span> options<span class="op">.</span><span class="at">margin</span><span class="op">.</span><span class="at">bottom</span><span class="op">;</span></span>
<span id="cb1-392"><a href="#cb1-392" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> rangeMax <span class="op">=</span> options<span class="op">.</span><span class="at">margin</span><span class="op">.</span><span class="at">top</span><span class="op">;</span></span>
<span id="cb1-393"><a href="#cb1-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-394"><a href="#cb1-394" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Calculate the proportion of the input value within the range</span></span>
<span id="cb1-395"><a href="#cb1-395" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> proportion <span class="op">=</span> (rangeMax <span class="op">-</span> rangeMin)<span class="op">;</span></span>
<span id="cb1-396"><a href="#cb1-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-397"><a href="#cb1-397" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Apply the proportion to the domain</span></span>
<span id="cb1-398"><a href="#cb1-398" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> proportion <span class="op">*</span> value <span class="op">+</span> rangeMin<span class="op">;</span></span>
<span id="cb1-399"><a href="#cb1-399" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-400"><a href="#cb1-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-401"><a href="#cb1-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-402"><a href="#cb1-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-403"><a href="#cb1-403" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisBottom <span class="op">=</span> g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">axisBottom</span>(x)<span class="op">.</span><span class="fu">ticks</span>(<span class="dv">4</span>))</span>
<span id="cb1-404"><a href="#cb1-404" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTop <span class="op">=</span> g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">axisTop</span>(x)<span class="op">.</span><span class="fu">ticks</span>(<span class="dv">4</span>))<span class="op">;</span></span>
<span id="cb1-405"><a href="#cb1-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-406"><a href="#cb1-406" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> hexagonSize <span class="op">=</span> ((<span class="fu">x</span>(<span class="dv">1</span> <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> resolution)) <span class="op">-</span> <span class="fu">x</span>(<span class="dv">0</span>))) <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">6</span>) <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-407"><a href="#cb1-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-408"><a href="#cb1-408" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> corners <span class="op">=</span> [{ <span class="dt">x</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="dv">3</span>)<span class="op">/</span><span class="dv">2</span> }<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span> {<span class="dt">x</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">0</span> }]<span class="op">;</span></span>
<span id="cb1-409"><a href="#cb1-409" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> corners_expanded <span class="op">=</span> [{ <span class="dt">x</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="dv">3</span>)<span class="op">/</span><span class="dv">2</span> <span class="op">+</span> <span class="fl">0.1</span> }<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="op">-</span><span class="fl">0.1</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="op">-</span><span class="fl">0.05</span> }<span class="op">,</span> {<span class="dt">x</span><span class="op">:</span> <span class="fl">1.1</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="op">-</span><span class="fl">0.05</span> }]<span class="op">;</span></span>
<span id="cb1-410"><a href="#cb1-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-411"><a href="#cb1-411" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> line <span class="op">=</span> d3<span class="op">.</span><span class="fu">line</span>()<span class="op">.</span><span class="fu">x</span>(d <span class="kw">=&gt;</span> <span class="fu">x</span>(d<span class="op">.</span><span class="at">x</span>))<span class="op">.</span><span class="fu">y</span>(d <span class="kw">=&gt;</span> <span class="fu">y</span>(d<span class="op">.</span><span class="at">y</span>))<span class="op">;</span></span>
<span id="cb1-412"><a href="#cb1-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-413"><a href="#cb1-413" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">'defs'</span>)</span>
<span id="cb1-414"><a href="#cb1-414" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'clipPath'</span>)</span>
<span id="cb1-415"><a href="#cb1-415" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'id'</span><span class="op">,</span> <span class="st">'triangle'</span>)</span>
<span id="cb1-416"><a href="#cb1-416" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'path'</span>)</span>
<span id="cb1-417"><a href="#cb1-417" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> options<span class="op">.</span><span class="at">size</span> <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb1-418"><a href="#cb1-418" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> options<span class="op">.</span><span class="at">size</span> <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb1-419"><a href="#cb1-419" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'d'</span><span class="op">,</span> <span class="fu">line</span>(corners))</span>
<span id="cb1-420"><a href="#cb1-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-421"><a href="#cb1-421" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.border'</span>)</span>
<span id="cb1-422"><a href="#cb1-422" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>([[corners[<span class="dv">0</span>]<span class="op">,</span> corners[<span class="dv">1</span>]]<span class="op">,</span></span>
<span id="cb1-423"><a href="#cb1-423" aria-hidden="true" tabindex="-1"></a>           [corners[<span class="dv">1</span>]<span class="op">,</span> corners[<span class="dv">2</span>]]<span class="op">,</span></span>
<span id="cb1-424"><a href="#cb1-424" aria-hidden="true" tabindex="-1"></a>           [corners[<span class="dv">2</span>]<span class="op">,</span> corners[<span class="dv">0</span>]]])</span>
<span id="cb1-425"><a href="#cb1-425" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-426"><a href="#cb1-426" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'line'</span>)</span>
<span id="cb1-427"><a href="#cb1-427" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x1'</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">x</span>(d[<span class="dv">0</span>]<span class="op">.</span><span class="at">x</span>))</span>
<span id="cb1-428"><a href="#cb1-428" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x2'</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">x</span>(d[<span class="dv">1</span>]<span class="op">.</span><span class="at">x</span>))</span>
<span id="cb1-429"><a href="#cb1-429" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y1'</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">y</span>(d[<span class="dv">0</span>]<span class="op">.</span><span class="at">y</span>))</span>
<span id="cb1-430"><a href="#cb1-430" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y2'</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">y</span>(d[<span class="dv">1</span>]<span class="op">.</span><span class="at">y</span>))</span>
<span id="cb1-431"><a href="#cb1-431" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'border'</span>)</span>
<span id="cb1-432"><a href="#cb1-432" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'stroke'</span><span class="op">,</span> <span class="st">'black'</span>)<span class="op">;</span></span>
<span id="cb1-433"><a href="#cb1-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-434"><a href="#cb1-434" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> hexbin <span class="op">=</span> d3<span class="op">.</span><span class="fu">hexbin</span>()<span class="op">;</span></span>
<span id="cb1-435"><a href="#cb1-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-436"><a href="#cb1-436" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">'g'</span>)</span>
<span id="cb1-437"><a href="#cb1-437" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'clip-path'</span><span class="op">,</span> <span class="st">'url(#triangle)'</span>)</span>
<span id="cb1-438"><a href="#cb1-438" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".point"</span>)</span>
<span id="cb1-439"><a href="#cb1-439" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(density)</span>
<span id="cb1-440"><a href="#cb1-440" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">'path'</span>)</span>
<span id="cb1-441"><a href="#cb1-441" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'transform'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`translate(</span><span class="sc">${</span><span class="fu">x</span>(corners[<span class="dv">0</span>]<span class="op">.</span><span class="at">x</span> <span class="op">*</span> d<span class="op">.</span><span class="at">x</span>[<span class="dv">0</span>] <span class="op">+</span> corners[<span class="dv">1</span>]<span class="op">.</span><span class="at">x</span> <span class="op">*</span> d<span class="op">.</span><span class="at">x</span>[<span class="dv">1</span>] <span class="op">+</span> corners[<span class="dv">2</span>]<span class="op">.</span><span class="at">x</span> <span class="op">*</span> d<span class="op">.</span><span class="at">x</span>[<span class="dv">2</span>])<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span><span class="fu">y</span>(corners[<span class="dv">0</span>]<span class="op">.</span><span class="at">y</span> <span class="op">*</span> d<span class="op">.</span><span class="at">x</span>[<span class="dv">0</span>] <span class="op">+</span> corners[<span class="dv">1</span>]<span class="op">.</span><span class="at">y</span> <span class="op">*</span> d<span class="op">.</span><span class="at">x</span>[<span class="dv">1</span>] <span class="op">+</span> corners[<span class="dv">2</span>]<span class="op">.</span><span class="at">y</span> <span class="op">*</span> d<span class="op">.</span><span class="at">x</span>[<span class="dv">2</span>])<span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb1-442"><a href="#cb1-442" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'fill'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">fillScale</span>(d<span class="op">.</span><span class="at">density</span>))</span>
<span id="cb1-443"><a href="#cb1-443" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'d'</span><span class="op">,</span> hexbin<span class="op">.</span><span class="fu">hexagon</span>(hexagonSize))<span class="op">;</span></span>
<span id="cb1-444"><a href="#cb1-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-445"><a href="#cb1-445" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'text'</span>)</span>
<span id="cb1-446"><a href="#cb1-446" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>([[corners_expanded[<span class="dv">0</span>]<span class="op">,</span> corners_expanded[<span class="dv">1</span>]]<span class="op">,</span></span>
<span id="cb1-447"><a href="#cb1-447" aria-hidden="true" tabindex="-1"></a>           [corners_expanded[<span class="dv">1</span>]<span class="op">,</span> corners_expanded[<span class="dv">2</span>]]<span class="op">,</span></span>
<span id="cb1-448"><a href="#cb1-448" aria-hidden="true" tabindex="-1"></a>           [corners_expanded[<span class="dv">2</span>]<span class="op">,</span> corners_expanded[<span class="dv">0</span>]]])</span>
<span id="cb1-449"><a href="#cb1-449" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"text"</span>)</span>
<span id="cb1-450"><a href="#cb1-450" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-451"><a href="#cb1-451" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"alignment-baseline"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-452"><a href="#cb1-452" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-style"</span><span class="op">,</span> <span class="st">"italic"</span>)</span>
<span id="cb1-453"><a href="#cb1-453" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> (<span class="fu">x</span>(d[<span class="dv">0</span>]<span class="op">.</span><span class="at">x</span>) <span class="op">+</span> <span class="fu">x</span>(d[<span class="dv">1</span>]<span class="op">.</span><span class="at">x</span>)) <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb1-454"><a href="#cb1-454" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> d <span class="kw">=&gt;</span> (<span class="fu">y</span>(d[<span class="dv">0</span>]<span class="op">.</span><span class="at">y</span>) <span class="op">+</span> <span class="fu">y</span>(d[<span class="dv">1</span>]<span class="op">.</span><span class="at">y</span>)) <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb1-455"><a href="#cb1-455" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>((d<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb1-456"><a href="#cb1-456" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(i <span class="op">==</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="st">"x₂"</span> <span class="op">;</span></span>
<span id="cb1-457"><a href="#cb1-457" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(i <span class="op">==</span> <span class="dv">1</span>) <span class="cf">return</span> <span class="st">"x₃"</span><span class="op">;</span></span>
<span id="cb1-458"><a href="#cb1-458" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(i <span class="op">==</span> <span class="dv">2</span>) <span class="cf">return</span> <span class="st">"x₁"</span><span class="op">;</span></span>
<span id="cb1-459"><a href="#cb1-459" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb1-460"><a href="#cb1-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-461"><a href="#cb1-461" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> xy <span class="op">=</span> <span class="fu">barycentricToCartesian</span>(z<span class="op">,</span> corners)</span>
<span id="cb1-462"><a href="#cb1-462" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> xyr <span class="op">=</span> [<span class="fu">inverseInverseScaleX</span>(xy[<span class="dv">0</span>])<span class="op">,</span> <span class="fu">inverseInverseScaleY</span>(xy[<span class="dv">1</span>])]<span class="op">;</span></span>
<span id="cb1-463"><a href="#cb1-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-464"><a href="#cb1-464" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> xy_q <span class="op">=</span> <span class="fu">barycentricToCartesian</span>(q<span class="op">,</span> corners)</span>
<span id="cb1-465"><a href="#cb1-465" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> xyr_q <span class="op">=</span> [<span class="fu">inverseInverseScaleX</span>(xy_q[<span class="dv">0</span>])<span class="op">,</span> <span class="fu">inverseInverseScaleY</span>(xy_q[<span class="dv">1</span>])]<span class="op">;</span></span>
<span id="cb1-466"><a href="#cb1-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-467"><a href="#cb1-467" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> sftmax <span class="op">=</span> <span class="fu">softmax</span>([z1<span class="op">,</span> z2<span class="op">,</span> z3]<span class="op">,</span> q<span class="op">,</span> beta)</span>
<span id="cb1-468"><a href="#cb1-468" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> xy_s <span class="op">=</span> <span class="fu">barycentricToCartesian</span>(sftmax<span class="op">,</span> corners)</span>
<span id="cb1-469"><a href="#cb1-469" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> xyr_s <span class="op">=</span> [<span class="fu">inverseInverseScaleX</span>(xy_s[<span class="dv">0</span>])<span class="op">,</span> <span class="fu">inverseInverseScaleY</span>(xy_s[<span class="dv">1</span>])]<span class="op">;</span></span>
<span id="cb1-470"><a href="#cb1-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-471"><a href="#cb1-471" aria-hidden="true" tabindex="-1"></a>    <span class="co">// If it does not exist, append a new red circle</span></span>
<span id="cb1-472"><a href="#cb1-472" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb1-473"><a href="#cb1-473" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"red-circle"</span>) <span class="co">// Add a class for easy selection</span></span>
<span id="cb1-474"><a href="#cb1-474" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> xyr_s[<span class="dv">0</span>])</span>
<span id="cb1-475"><a href="#cb1-475" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> xyr_s[<span class="dv">1</span>])</span>
<span id="cb1-476"><a href="#cb1-476" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"z-index"</span><span class="op">,</span> <span class="dv">1000</span>)</span>
<span id="cb1-477"><a href="#cb1-477" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">7</span>) <span class="co">// Radius of the circle</span></span>
<span id="cb1-478"><a href="#cb1-478" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"red"</span>)<span class="op">;</span> <span class="co">// Fill color of the circle</span></span>
<span id="cb1-479"><a href="#cb1-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-480"><a href="#cb1-480" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb1-481"><a href="#cb1-481" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"purple-circle"</span>) <span class="co">// Add a class for easy selection</span></span>
<span id="cb1-482"><a href="#cb1-482" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> xyr[<span class="dv">0</span>])</span>
<span id="cb1-483"><a href="#cb1-483" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> xyr[<span class="dv">1</span>])</span>
<span id="cb1-484"><a href="#cb1-484" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"z-index"</span><span class="op">,</span> <span class="dv">1000</span>)</span>
<span id="cb1-485"><a href="#cb1-485" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">7</span>) <span class="co">// Radius of the circle</span></span>
<span id="cb1-486"><a href="#cb1-486" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"purple"</span>)<span class="op">;</span> <span class="co">// Fill color of the circle</span></span>
<span id="cb1-487"><a href="#cb1-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-488"><a href="#cb1-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-489"><a href="#cb1-489" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb1-490"><a href="#cb1-490" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"black-circle"</span>) <span class="co">// Add a class for easy selection</span></span>
<span id="cb1-491"><a href="#cb1-491" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> xyr_q[<span class="dv">0</span>])</span>
<span id="cb1-492"><a href="#cb1-492" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> xyr_q[<span class="dv">1</span>])</span>
<span id="cb1-493"><a href="#cb1-493" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"z-index"</span><span class="op">,</span> <span class="dv">1000</span>)</span>
<span id="cb1-494"><a href="#cb1-494" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">7</span>) <span class="co">// Radius of the circle</span></span>
<span id="cb1-495"><a href="#cb1-495" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span> <span class="co">// Fill color of the circle</span></span>
<span id="cb1-496"><a href="#cb1-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-497"><a href="#cb1-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-498"><a href="#cb1-498" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Append text for the coordinates</span></span>
<span id="cb1-499"><a href="#cb1-499" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-500"><a href="#cb1-500" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"coord-text"</span>) <span class="co">// Add a class for easy selection</span></span>
<span id="cb1-501"><a href="#cb1-501" aria-hidden="true" tabindex="-1"></a>      <span class="co">// .attr("x", xyr[0] + 10) // Position the text right next to the circle</span></span>
<span id="cb1-502"><a href="#cb1-502" aria-hidden="true" tabindex="-1"></a>      <span class="co">// .attr("y", xyr[1])</span></span>
<span id="cb1-503"><a href="#cb1-503" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">300</span>) <span class="co">// Position the text right next to the circle</span></span>
<span id="cb1-504"><a href="#cb1-504" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">80</span>)</span>
<span id="cb1-505"><a href="#cb1-505" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>) <span class="co">// Text color</span></span>
<span id="cb1-506"><a href="#cb1-506" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"10px"</span>)</span>
<span id="cb1-507"><a href="#cb1-507" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="vs">`q=(</span><span class="sc">${</span>q[<span class="dv">0</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>q[<span class="dv">1</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>q[<span class="dv">2</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span> <span class="co">// Display coordinates</span></span>
<span id="cb1-508"><a href="#cb1-508" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Append color legend for purple-circle and red-circle:</span></span>
<span id="cb1-509"><a href="#cb1-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-510"><a href="#cb1-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-511"><a href="#cb1-511" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Append text for the coordinates</span></span>
<span id="cb1-512"><a href="#cb1-512" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-513"><a href="#cb1-513" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"coord-text"</span>) <span class="co">// Add a class for easy selection</span></span>
<span id="cb1-514"><a href="#cb1-514" aria-hidden="true" tabindex="-1"></a>      <span class="co">// .attr("x", xyr[0] + 10) // Position the text right next to the circle</span></span>
<span id="cb1-515"><a href="#cb1-515" aria-hidden="true" tabindex="-1"></a>      <span class="co">// .attr("y", xyr[1])</span></span>
<span id="cb1-516"><a href="#cb1-516" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">300</span>) <span class="co">// Position the text right next to the circle</span></span>
<span id="cb1-517"><a href="#cb1-517" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">100</span>)</span>
<span id="cb1-518"><a href="#cb1-518" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"red"</span>) <span class="co">// Text color</span></span>
<span id="cb1-519"><a href="#cb1-519" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"10px"</span>)</span>
<span id="cb1-520"><a href="#cb1-520" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="vs">`σ_{q,β}=(</span><span class="sc">${</span>sftmax[<span class="dv">0</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>sftmax[<span class="dv">1</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>sftmax[<span class="dv">2</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span> <span class="co">// Display coordinates</span></span>
<span id="cb1-521"><a href="#cb1-521" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Append color legend for purple-circle and red-circle:</span></span>
<span id="cb1-522"><a href="#cb1-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-523"><a href="#cb1-523" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-524"><a href="#cb1-524" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"coord-text"</span>) <span class="co">// Add a class for easy selection</span></span>
<span id="cb1-525"><a href="#cb1-525" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">300</span>) <span class="co">// Position the text right next to the circle</span></span>
<span id="cb1-526"><a href="#cb1-526" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">120</span>)</span>
<span id="cb1-527"><a href="#cb1-527" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"purple"</span>) <span class="co">// Text color</span></span>
<span id="cb1-528"><a href="#cb1-528" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"10px"</span>)</span>
<span id="cb1-529"><a href="#cb1-529" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="vs">`z=(</span><span class="sc">${</span>z1<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>z2<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>z3<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span> <span class="co">// Display coordinates</span></span>
<span id="cb1-530"><a href="#cb1-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-531"><a href="#cb1-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-532"><a href="#cb1-532" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> removeLine <span class="op">=</span> g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb1-533"><a href="#cb1-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-534"><a href="#cb1-534" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="kw">set</span>(input<span class="op">,</span> value) {</span>
<span id="cb1-535"><a href="#cb1-535" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="at">value</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb1-536"><a href="#cb1-536" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">Event</span>(<span class="st">"input"</span><span class="op">,</span> {<span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span>}))<span class="op">;</span></span>
<span id="cb1-537"><a href="#cb1-537" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-538"><a href="#cb1-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-539"><a href="#cb1-539" aria-hidden="true" tabindex="-1"></a><span class="co">// Attach a click event listener to the SVG</span></span>
<span id="cb1-540"><a href="#cb1-540" aria-hidden="true" tabindex="-1"></a>svg<span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> <span class="kw">function</span>(<span class="bu">event</span>) {</span>
<span id="cb1-541"><a href="#cb1-541" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Extract the click coordinates</span></span>
<span id="cb1-542"><a href="#cb1-542" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [clickX<span class="op">,</span> clickY] <span class="op">=</span> d3<span class="op">.</span><span class="fu">pointer</span>(<span class="bu">event</span>)<span class="op">;</span></span>
<span id="cb1-543"><a href="#cb1-543" aria-hidden="true" tabindex="-1"></a>  lbd <span class="op">=</span> <span class="fu">cartesianToBarycentric</span>(<span class="fu">inverseScaleX</span>(clickX)<span class="op">,</span> <span class="fu">inverseScaleY</span>(clickY)<span class="op">,</span> corners)<span class="op">;</span></span>
<span id="cb1-544"><a href="#cb1-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-545"><a href="#cb1-545" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span>(viewof z1<span class="op">,</span> lbd[<span class="dv">2</span>])<span class="op">;</span></span>
<span id="cb1-546"><a href="#cb1-546" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span>(viewof z2<span class="op">,</span> lbd[<span class="dv">1</span>])<span class="op">;</span></span>
<span id="cb1-547"><a href="#cb1-547" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span>(viewof z3<span class="op">,</span> lbd[<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb1-548"><a href="#cb1-548" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb1-549"><a href="#cb1-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-550"><a href="#cb1-550" aria-hidden="true" tabindex="-1"></a> <span class="co">// display axis values</span></span>
<span id="cb1-551"><a href="#cb1-551" aria-hidden="true" tabindex="-1"></a>svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-552"><a href="#cb1-552" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(0, </span><span class="sc">${</span>options<span class="op">.</span><span class="at">size</span> <span class="op">-</span> options<span class="op">.</span><span class="at">margin</span><span class="op">.</span><span class="at">bottom</span><span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb1-553"><a href="#cb1-553" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(axisBottom)</span>
<span id="cb1-554"><a href="#cb1-554" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(removeLine)</span>
<span id="cb1-555"><a href="#cb1-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-556"><a href="#cb1-556" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-557"><a href="#cb1-557" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span><span class="fu">x</span>(<span class="dv">1</span>) <span class="op">+</span> options<span class="op">.</span><span class="at">margin</span><span class="op">.</span><span class="at">right</span> <span class="op">/</span> <span class="dv">2</span> <span class="sc">}</span><span class="vs">, </span><span class="sc">${</span><span class="fu">y</span>(<span class="dv">0</span>) <span class="op">+</span> <span class="dv">26</span><span class="sc">}</span><span class="vs">) rotate(-120)`</span>)</span>
<span id="cb1-558"><a href="#cb1-558" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(axisBottom)</span>
<span id="cb1-559"><a href="#cb1-559" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(removeLine)</span>
<span id="cb1-560"><a href="#cb1-560" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="st">"translate(11, 22) rotate(120)"</span>))<span class="op">;</span></span>
<span id="cb1-561"><a href="#cb1-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-562"><a href="#cb1-562" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-563"><a href="#cb1-563" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span><span class="fu">x</span>(<span class="fl">0.5</span>) <span class="op">+</span> options<span class="op">.</span><span class="at">margin</span><span class="op">.</span><span class="at">left</span> <span class="op">/</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span><span class="fu">y</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="dv">3</span>) <span class="op">/</span> <span class="dv">2</span>) <span class="op">-</span> <span class="dv">26</span><span class="sc">}</span><span class="vs">) rotate(120)`</span>)</span>
<span id="cb1-564"><a href="#cb1-564" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(axisBottom)</span>
<span id="cb1-565"><a href="#cb1-565" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(removeLine)</span>
<span id="cb1-566"><a href="#cb1-566" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="st">"translate(-11, 22) rotate(-120)"</span>))<span class="op">;</span></span>
<span id="cb1-567"><a href="#cb1-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-568"><a href="#cb1-568" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb1-569"><a href="#cb1-569" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-570"><a href="#cb1-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-571"><a href="#cb1-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-572"><a href="#cb1-572" aria-hidden="true" tabindex="-1"></a>levelLogsumexp <span class="op">=</span> {</span>
<span id="cb1-573"><a href="#cb1-573" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> density <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-574"><a href="#cb1-574" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="kw">let</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> densityResolution<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-575"><a href="#cb1-575" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> j <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> j <span class="op">&lt;</span> densityResolution <span class="op">-</span> i<span class="op">;</span> j<span class="op">++</span>) {</span>
<span id="cb1-576"><a href="#cb1-576" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x1 <span class="op">=</span> i <span class="op">/</span> densityResolution <span class="op">;</span></span>
<span id="cb1-577"><a href="#cb1-577" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x2 <span class="op">=</span> j <span class="op">/</span> densityResolution<span class="op">;</span></span>
<span id="cb1-578"><a href="#cb1-578" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x3 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span> <span class="op">-</span> x1 <span class="op">-</span> x2)<span class="op">;</span></span>
<span id="cb1-579"><a href="#cb1-579" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x <span class="op">=</span> [ x1<span class="op">,</span> x2<span class="op">,</span> x3 ]<span class="op">;</span></span>
<span id="cb1-580"><a href="#cb1-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-581"><a href="#cb1-581" aria-hidden="true" tabindex="-1"></a>      density<span class="op">.</span><span class="fu">push</span>({ x<span class="op">,</span> <span class="dt">density</span><span class="op">:</span> <span class="fu">logsumexp</span>(x<span class="op">,</span> q<span class="op">,</span> beta) })<span class="op">;</span></span>
<span id="cb1-582"><a href="#cb1-582" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-583"><a href="#cb1-583" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-584"><a href="#cb1-584" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> density<span class="op">;</span></span>
<span id="cb1-585"><a href="#cb1-585" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-586"><a href="#cb1-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-587"><a href="#cb1-587" aria-hidden="true" tabindex="-1"></a>levelKL <span class="op">=</span> {</span>
<span id="cb1-588"><a href="#cb1-588" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> density <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-589"><a href="#cb1-589" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="kw">let</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> densityResolution<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-590"><a href="#cb1-590" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> j <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> j <span class="op">&lt;</span> densityResolution <span class="op">-</span> i<span class="op">;</span> j<span class="op">++</span>) {</span>
<span id="cb1-591"><a href="#cb1-591" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x1 <span class="op">=</span> i <span class="op">/</span> densityResolution <span class="op">;</span></span>
<span id="cb1-592"><a href="#cb1-592" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x2 <span class="op">=</span> j <span class="op">/</span> densityResolution<span class="op">;</span></span>
<span id="cb1-593"><a href="#cb1-593" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x3 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span> <span class="op">-</span> x1 <span class="op">-</span> x2)<span class="op">;</span></span>
<span id="cb1-594"><a href="#cb1-594" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x <span class="op">=</span> [ x1<span class="op">,</span> x2<span class="op">,</span> x3 ]<span class="op">;</span></span>
<span id="cb1-595"><a href="#cb1-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-596"><a href="#cb1-596" aria-hidden="true" tabindex="-1"></a>      <span class="co">// density.push({ x, density: logsumexp(x, q, beta) / Math.log(Math.max(q[0],q[1], q[2]) * Math.exp(1/beta)) });</span></span>
<span id="cb1-597"><a href="#cb1-597" aria-hidden="true" tabindex="-1"></a>      density<span class="op">.</span><span class="fu">push</span>({ x<span class="op">,</span> <span class="dt">density</span><span class="op">:</span> <span class="fu">kull_leibler</span>(x<span class="op">,</span> q<span class="op">,</span> beta) })<span class="op">;</span></span>
<span id="cb1-598"><a href="#cb1-598" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-599"><a href="#cb1-599" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-600"><a href="#cb1-600" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> density<span class="op">;</span></span>
<span id="cb1-601"><a href="#cb1-601" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-602"><a href="#cb1-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-603"><a href="#cb1-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-604"><a href="#cb1-604" aria-hidden="true" tabindex="-1"></a>levelKL_full <span class="op">=</span> {</span>
<span id="cb1-605"><a href="#cb1-605" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> density <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-606"><a href="#cb1-606" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="kw">let</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> densityResolution<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-607"><a href="#cb1-607" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> j <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> j <span class="op">&lt;</span> densityResolution <span class="op">-</span> i<span class="op">;</span> j<span class="op">++</span>) {</span>
<span id="cb1-608"><a href="#cb1-608" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x1 <span class="op">=</span> i <span class="op">/</span> densityResolution <span class="op">;</span></span>
<span id="cb1-609"><a href="#cb1-609" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x2 <span class="op">=</span> j <span class="op">/</span> densityResolution<span class="op">;</span></span>
<span id="cb1-610"><a href="#cb1-610" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x3 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span> <span class="op">-</span> x1 <span class="op">-</span> x2)<span class="op">;</span></span>
<span id="cb1-611"><a href="#cb1-611" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x <span class="op">=</span> [ x1<span class="op">,</span> x2<span class="op">,</span> x3 ]<span class="op">;</span></span>
<span id="cb1-612"><a href="#cb1-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-613"><a href="#cb1-613" aria-hidden="true" tabindex="-1"></a>      <span class="co">// density.push({ x, density: logsumexp(x, q, beta) / Math.log(Math.max(q[0],q[1], q[2]) * Math.exp(1/beta)) });</span></span>
<span id="cb1-614"><a href="#cb1-614" aria-hidden="true" tabindex="-1"></a>      density<span class="op">.</span><span class="fu">push</span>({ x<span class="op">,</span> <span class="dt">density</span><span class="op">:</span> <span class="fu">objective</span>(x<span class="op">,</span> z<span class="op">,</span> q<span class="op">,</span> beta) })<span class="op">;</span></span>
<span id="cb1-615"><a href="#cb1-615" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-616"><a href="#cb1-616" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-617"><a href="#cb1-617" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> density<span class="op">;</span></span>
<span id="cb1-618"><a href="#cb1-618" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-619"><a href="#cb1-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-620"><a href="#cb1-620" aria-hidden="true" tabindex="-1"></a><span class="fu">ternaryDensity</span>(levelKL_full<span class="op">,</span> densityResolution<span class="op">,</span> { <span class="dt">size</span><span class="op">:</span> <span class="dv">500</span><span class="op">,</span> <span class="dt">colorScheme</span><span class="op">:</span> d3<span class="op">.</span><span class="at">interpolateBlues</span>})</span>
<span id="cb1-621"><a href="#cb1-621" aria-hidden="true" tabindex="-1"></a>logsumexpColorScale <span class="op">=</span> <span class="fu">legend</span>({<span class="dt">color</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">scaleSequential</span>(d3<span class="op">.</span><span class="fu">extent</span>([<span class="dv">0</span><span class="op">,</span>  <span class="fu">logsumexp</span>(z<span class="op">,</span> q<span class="op">,</span> beta)])<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateBlues</span>)<span class="op">,</span> <span class="dt">title</span><span class="op">:</span> <span class="st">"Intensity"</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel" data-layout-align="left" data-layout-ncol="1">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-19" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-20" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-21" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-22" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-23" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-24" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-25" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-26" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-27" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-28" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-29" data-nodetype="expression">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-30" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</section>
<section id="credit" class="level2">
<h2 class="anchored" data-anchor-id="credit"><i class="fa-solid fa-handshake" title="handshakes" aria-label="handshake"></i> Credit</h2>
<ul>
<li><p>The observable code was made with the help of <a href="https://github.com/fradav" target="_blank">François-David Collin</a></p></li>
<li><p>The plot is freely inspired from <a href="http://herbsusmann.com/" target="_blank">Herb Susmann</a>’s code on <a href="https://observablehq.com/@herbps10/dirichlet-distribution" target="_blank">Dirichlet Distribution</a></p></li>
<li><p>The terminology is inspired by posts from Gabriel Peyré: <a href="https://x.com/gabrielpeyre/status/1830470713041354968" target="_blank">https://x.com/gabrielpeyre/status/1830470713041354968</a>, <a href="https://x.com/gabrielpeyre/status/1680804520862056448" target="_blank">https://x.com/gabrielpeyre/status/1680804520862056448</a></p></li>
</ul>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references"><i class="fa-solid fa-link" title="link" aria-label="link"></i> References</h2>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Boyd_Vandenberghe04" class="csl-entry" role="listitem">
Boyd, S., and L. Vandenberghe. 2004. <em>Convex Optimization</em>. Cambridge University Press.
</div>
</div>


<!-- -->

</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>the case with <span class="math inline">q_k=0</span> for some <span class="math inline">k</span> can be reduced to a case with fewer coordinates<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<hr>

<span style="margin-top:20px; margin-bottom: 20px"></span>

<!-- <img style="width:100%;" src="/img/marvins_log_thumbnail.png"> -->

<!-- <p style="margin: 20px"> Do you enjoy my blog? Subscribe here to get notifications and updates (it's free!):</p> -->

<!-- <div class="grid">
  <div class=".d-none .d-md-block g-col-md-1"></div>
  <div class="g-col-12 g-col-md-10">
    <iframe src="https://embeds.beehiiv.com/c7111066-479b-43db-ad92-8d703fe96bf0?slim=true" data-test-id="beehiiv-embed" frameborder="0" scrolling="no" style="margin: 0; border-radius: 0px !important; background-color: transparent; width:100%; padding: 20px"></iframe>
  </div>
  <div class=".d-none .d-md-block g-col-md-1"></div>
</div> -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuZDMgPSByZXF1aXJlKFwiZDNAdjZcIiwgXCJkMy1oZXhiaW5AMC4yXCIpXG5tYXRoID0gcmVxdWlyZShcIm1hdGhqc1wiKVxuZGlnYW1tYSA9IHJlcXVpcmUoICdodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvc3RkbGliLWpzL21hdGgtYmFzZS1zcGVjaWFsLWRpZ2FtbWFAdW1kL2Jyb3dzZXIuanMnIClcblxuaW1wb3J0IHtsZWdlbmR9IGZyb20gXCJAZDMvY29sb3ItbGVnZW5kXCJcblxuXG5kZW5zaXR5UmVzb2x1dGlvbiA9IDgwXG5tYXJnaW4gPSAoeyBsZWZ0OiAzMCwgdG9wOiAzMCwgcmlnaHQ6IDMwLCBib3R0b206IDMwIH0pXG5oZWlnaHQgPSA0MDBcblxuXG5cbmJldGEgPSBbaW5wdXRzLmJldGFdXG4vLyBsYmQgPSBbMC4zLDAuMywwLjRdXG5cbnZpZXdvZiBxMSA9IElucHV0cy5yYW5nZShbMC4wMSwgMV0sIHt2YWx1ZTogMS8zLCBsYWJlbDogdGV4YHFfMWAsIHN0ZXA6IDAuMDF9KVxudmlld29mIHEyID0gSW5wdXRzLnJhbmdlKFswLjAxLCAxXSwge3ZhbHVlOiAxLzMsIGxhYmVsOiB0ZXhgcV8yYCwgc3RlcDogMC4wMX0pXG52aWV3b2YgcTMgPSBJbnB1dHMucmFuZ2UoWzAuMDEsIDFdLCB7dmFsdWU6IDEvMywgbGFiZWw6IHRleGBxXzNgLCBzdGVwOiAwLjAxfSlcbnZpZXdvZiB6MSA9IElucHV0cy5yYW5nZShbLTEwLCAxMF0sIHt2YWx1ZTogMC40LCBsYWJlbDogdGV4YHpfMWAsIHN0ZXA6IDAuMDF9KVxudmlld29mIHoyID0gSW5wdXRzLnJhbmdlKFstMTAsIDEwXSwge3ZhbHVlOiAwLjIsIGxhYmVsOiB0ZXhgel8yYCwgc3RlcDogMC4wMX0pXG52aWV3b2YgejMgPSBJbnB1dHMucmFuZ2UoWy0xMCwgMTBdLCB7dmFsdWU6IDAuMiwgbGFiZWw6IHRleGB6XzNgLCBzdGVwOiAwLjAxfSlcblxuXG52aWV3b2YgaW5wdXRzID0gSW5wdXRzLmZvcm0oe1xuICB6MTogdmlld29mIHoxLFxuICB6Mjogdmlld29mIHoyLFxuICB6Mzogdmlld29mIHozLFxuICBiZXRhOiBJbnB1dHMucmFuZ2UoWzAuMDEsIDEwXSwge3ZhbHVlOiAxLCBsYWJlbDogdGV4YFxcYmV0YWAsIHN0ZXA6IDAuMDF9KSxcbiAgcTE6IHZpZXdvZiBxMSxcbiAgcTI6IHZpZXdvZiBxMixcbiAgcTM6IHZpZXdvZiBxMyxcbn0pXG5cbnEgPSBbcTEsIHEyLCBxM11cbnogPSBbejEsIHoyLCB6M11cblxubG9nc3VtZXhwID0gKHgsIGFscGhhLCBiZXRhKSA9PiB7XG4gIGxldCByZXN1bHQgPSAwO1xuICBmb3IobGV0IGkgPSAwOyBpIDwgeC5sZW5ndGg7IGkrKykgcmVzdWx0ICs9IGFscGhhW2ldICogTWF0aC5leHAoeFtpXSAvIGJldGEpO1xuICByZXR1cm4gYmV0YSAqIE1hdGgubG9nKHJlc3VsdCk7XG59XG5cblxub2JqZWN0aXZlID0gKHgsIHosIGFscGhhLCBiZXRhKSA9PiB7XG4gIGxldCByZXN1bHQgPSAwO1xuICBmb3IobGV0IGkgPSAwOyBpIDwgeC5sZW5ndGg7IGkrKykgcmVzdWx0IC09IGJldGEgKiB4W2ldICogTWF0aC5sb2coeFtpXSAvIGFscGhhW2ldKTtcbiAgZm9yKGxldCBpID0gMDsgaSA8IHgubGVuZ3RoOyBpKyspIHJlc3VsdCArPSB4W2ldICogeltpXTtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuXG5rdWxsX2xlaWJsZXIgPSAoeCwgYWxwaGEsIGJldGEpID0+IHtcbiAgbGV0IHJlc3VsdCA9IDA7XG4gIGZvcihsZXQgaSA9IDA7IGkgPCB4Lmxlbmd0aDsgaSsrKSByZXN1bHQgLT0geFtpXSAqIE1hdGgubG9nKHhbaV0gLyBhbHBoYVtpXSk7XG4gIHJldHVybiBiZXRhICogcmVzdWx0O1xufVxuXG5cbnNvZnRtYXggPSAoeCwgYWxwaGEsIGJldGEpID0+IHtcbiAgbGV0IHJlc3VsdCA9IFtdO1xuICBsZXQgc3VtID0gMDtcbiAgZm9yKGxldCBpID0gMDsgaSA8IHgubGVuZ3RoOyBpKyspIHtcbiAgICByZXN1bHQucHVzaChhbHBoYVtpXSAqIE1hdGguZXhwKHhbaV0gLyBiZXRhKSk7XG4gICAgc3VtICs9IHJlc3VsdFtpXTtcbiAgfVxuICBmb3IobGV0IGkgPSAwOyBpIDwgeC5sZW5ndGg7IGkrKykgcmVzdWx0W2ldIC89IHN1bTtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZnVuY3Rpb24gY2FydGVzaWFuVG9CYXJ5Y2VudHJpYyh4LCB5LCBjb3JuZXJzKSB7XG4gIGNvbnN0IEEgPSBjb3JuZXJzWzBdLCBCID0gY29ybmVyc1sxXSwgQyA9IGNvcm5lcnNbMl07XG4gIGNvbnN0IHYwID0geyB4OiBDLnggLSBBLngsIHk6IEMueSAtIEEueSB9O1xuICBjb25zdCB2MSA9IHsgeDogQi54IC0gQS54LCB5OiBCLnkgLSBBLnkgfTtcbiAgY29uc3QgdjIgPSB7IHg6IHggLSBBLngsIHk6IHkgLSBBLnkgfTtcblxuICBjb25zdCBkMDAgPSBkb3QodjAsIHYwKTtcbiAgY29uc3QgZDAxID0gZG90KHYwLCB2MSk7XG4gIGNvbnN0IGQxMSA9IGRvdCh2MSwgdjEpO1xuICBjb25zdCBkMjAgPSBkb3QodjIsIHYwKTtcbiAgY29uc3QgZDIxID0gZG90KHYyLCB2MSk7XG4gIGNvbnN0IGRlbm9tID0gZDAwICogZDExIC0gZDAxICogZDAxO1xuXG4gIGNvbnN0IGxhbWJkYTEgPSAoZDExICogZDIwIC0gZDAxICogZDIxKSAvIGRlbm9tO1xuICBjb25zdCBsYW1iZGEyID0gKGQwMCAqIGQyMSAtIGQwMSAqIGQyMCkgLyBkZW5vbTtcbiAgY29uc3QgbGFtYmRhMyA9IDEuMCAtIGxhbWJkYTEgLSBsYW1iZGEyO1xuXG4gIHJldHVybiBbbGFtYmRhMSwgbGFtYmRhMiwgbGFtYmRhM107XG59XG5cbmZ1bmN0aW9uIGJhcnljZW50cmljVG9DYXJ0ZXNpYW4ocSwgY29ybmVycykge1xuICByZXR1cm4gW1xuICAgIGNvcm5lcnNbMF0ueCAqIHFbMF0gKyBjb3JuZXJzWzFdLnggKiBxWzFdICsgY29ybmVyc1syXS54ICogcVsyXSxcbiAgICBjb3JuZXJzWzBdLnkgKiBxWzBdICsgY29ybmVyc1sxXS55ICogcVsxXSArIGNvcm5lcnNbMl0ueSAqIHFbMl1cbiAgXTtcbn1cblxuZnVuY3Rpb24gZG90KHYxLCB2Mikge1xuICByZXR1cm4gdjEueCAqIHYyLnggKyB2MS55ICogdjIueTtcbn1cblxudGVybmFyeURlbnNpdHkgPSAoZGVuc2l0eSwgcmVzb2x1dGlvbiwgb3B0aW9ucywgbGJkKSA9PiB7XG4gIG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHtcbiAgICBzaXplOiA0MDAsXG4gICAgbWFyZ2luOiB7IGxlZnQ6IDMwLCB0b3A6IDMwLCByaWdodDogMzAsIGJvdHRvbTogMzAgfSxcbiAgICBjb2xvclNjaGVtZTogZDMuaW50ZXJwb2xhdGVCbHVlc1xuICB9LCBvcHRpb25zKTtcblxuXG4gIGNvbnN0IGZpbGxTY2FsZSA9IGQzLnNjYWxlU2VxdWVudGlhbChvcHRpb25zLmNvbG9yU2NoZW1lKS5kb21haW4oWzBcbiAgLCBNYXRoLmxvZyhNYXRoLm1heChxWzBdLHFbMV0scVsyXSkpXSk7XG4gIC8vIGNvbnN0IGZpbGxTY2FsZSA9IGQzLnNjYWxlU2VxdWVudGlhbChvcHRpb25zLmNvbG9yU2NoZW1lKS5kb21haW4oZDMuZXh0ZW50KGRlbnNpdHkubWFwKGQgPT4gZC5kZW5zaXR5KSkpXG5cbiAgY29uc3Qgc3ZnID0gZDMuY3JlYXRlKFwic3ZnXCIpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCBvcHRpb25zLnNpemUpXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgb3B0aW9ucy5zaXplKTtcblxuICBjb25zdCB4ID0gZDMuc2NhbGVMaW5lYXIoKVxuICAgIC5kb21haW4oWzAsIDFdKVxuICAgIC5yYW5nZShbb3B0aW9ucy5tYXJnaW4ubGVmdCwgb3B0aW9ucy5zaXplIC0gb3B0aW9ucy5tYXJnaW4ucmlnaHRdKVxuXG4gIGNvbnN0IHkgPSBkMy5zY2FsZUxpbmVhcigpXG4gICAgLmRvbWFpbihbMCwgMV0pXG4gICAgLnJhbmdlKFtvcHRpb25zLnNpemUgLSBvcHRpb25zLm1hcmdpbi5ib3R0b20sIG9wdGlvbnMubWFyZ2luLnRvcF0pO1xuXG5cbiAgZnVuY3Rpb24gaW52ZXJzZVNjYWxlWCh2YWx1ZSkge1xuICAgIC8vIENvbnN0YW50cyBmcm9tIHRoZSBvcmlnaW5hbCBzY2FsZVxuICAgIGNvbnN0IGRvbWFpbk1pbiA9IDA7XG4gICAgY29uc3QgZG9tYWluTWF4ID0gMTtcbiAgICBjb25zdCByYW5nZU1pbiA9IG9wdGlvbnMubWFyZ2luLmxlZnQ7XG4gICAgY29uc3QgcmFuZ2VNYXggPSBvcHRpb25zLnNpemUgLSBvcHRpb25zLm1hcmdpbi5yaWdodDtcblxuICAgIC8vIENhbGN1bGF0ZSB0aGUgcHJvcG9ydGlvbiBvZiB0aGUgaW5wdXQgdmFsdWUgd2l0aGluIHRoZSByYW5nZVxuICAgIGNvbnN0IHByb3BvcnRpb24gPSAodmFsdWUgLSByYW5nZU1pbikgLyAocmFuZ2VNYXggLSByYW5nZU1pbik7XG5cbiAgICAvLyBBcHBseSB0aGUgcHJvcG9ydGlvbiB0byB0aGUgZG9tYWluXG4gICAgcmV0dXJuIHByb3BvcnRpb24gKiAoZG9tYWluTWF4IC0gZG9tYWluTWluKSArIGRvbWFpbk1pbjtcbiAgfVxuXG4gIGZ1bmN0aW9uIGludmVyc2VJbnZlcnNlU2NhbGVYKHZhbHVlKSB7XG4gICAgLy8gQ29uc3RhbnRzIGZyb20gdGhlIG9yaWdpbmFsIHNjYWxlXG4gICAgY29uc3QgZG9tYWluTWluID0gMDtcbiAgICBjb25zdCBkb21haW5NYXggPSAxO1xuICAgIGNvbnN0IHJhbmdlTWluID0gb3B0aW9ucy5zaXplIC0gb3B0aW9ucy5tYXJnaW4ucmlnaHQ7XG4gICAgY29uc3QgcmFuZ2VNYXggPSBvcHRpb25zLm1hcmdpbi5sZWZ0O1xuXG4gICAgLy8gQ2FsY3VsYXRlIHRoZSBwcm9wb3J0aW9uIG9mIHRoZSBpbnB1dCB2YWx1ZSB3aXRoaW4gdGhlIHJhbmdlXG4gICAgY29uc3QgcHJvcG9ydGlvbiA9IChyYW5nZU1heCAtIHJhbmdlTWluKTtcblxuICAgIC8vIEFwcGx5IHRoZSBwcm9wb3J0aW9uIHRvIHRoZSBkb21haW5cbiAgICByZXR1cm4gcmFuZ2VNYXggLSBwcm9wb3J0aW9uICogdmFsdWUgO1xuICB9XG5cbiAgZnVuY3Rpb24gaW52ZXJzZVNjYWxlWSh2YWx1ZSkge1xuICAgIC8vIENvbnN0YW50cyBmcm9tIHRoZSBvcmlnaW5hbCBzY2FsZVxuICAgIGNvbnN0IGRvbWFpbk1pbiA9IDA7XG4gICAgY29uc3QgZG9tYWluTWF4ID0gMTtcbiAgICBjb25zdCByYW5nZU1pbiA9IG9wdGlvbnMuc2l6ZSAtIG9wdGlvbnMubWFyZ2luLmJvdHRvbTtcbiAgICBjb25zdCByYW5nZU1heCA9IG9wdGlvbnMubWFyZ2luLnRvcDtcblxuICAgIC8vIENhbGN1bGF0ZSB0aGUgcHJvcG9ydGlvbiBvZiB0aGUgaW5wdXQgdmFsdWUgd2l0aGluIHRoZSByYW5nZVxuICAgIGNvbnN0IHByb3BvcnRpb24gPSAodmFsdWUgLSByYW5nZU1pbikgLyAocmFuZ2VNYXggLSByYW5nZU1pbik7XG5cblxuICAgIC8vIEFwcGx5IHRoZSBwcm9wb3J0aW9uIHRvIHRoZSBkb21haW5cbiAgICByZXR1cm4gcHJvcG9ydGlvbiAqIChkb21haW5NYXggLSBkb21haW5NaW4pICsgZG9tYWluTWluO1xuICB9XG5cbiAgZnVuY3Rpb24gaW52ZXJzZUludmVyc2VTY2FsZVkodmFsdWUpIHtcbiAgICAvLyBDb25zdGFudHMgZnJvbSB0aGUgb3JpZ2luYWwgc2NhbGVcbiAgICBjb25zdCBkb21haW5NaW4gPSAwO1xuICAgIGNvbnN0IGRvbWFpbk1heCA9IDE7XG4gICAgY29uc3QgcmFuZ2VNaW4gPSBvcHRpb25zLnNpemUgLSBvcHRpb25zLm1hcmdpbi5ib3R0b207XG4gICAgY29uc3QgcmFuZ2VNYXggPSBvcHRpb25zLm1hcmdpbi50b3A7XG5cbiAgICAvLyBDYWxjdWxhdGUgdGhlIHByb3BvcnRpb24gb2YgdGhlIGlucHV0IHZhbHVlIHdpdGhpbiB0aGUgcmFuZ2VcbiAgICBjb25zdCBwcm9wb3J0aW9uID0gKHJhbmdlTWF4IC0gcmFuZ2VNaW4pO1xuXG4gICAgLy8gQXBwbHkgdGhlIHByb3BvcnRpb24gdG8gdGhlIGRvbWFpblxuICAgIHJldHVybiBwcm9wb3J0aW9uICogdmFsdWUgKyByYW5nZU1pbjtcbiAgfVxuXG5cblxuICBjb25zdCBheGlzQm90dG9tID0gZyA9PiBnLmNhbGwoZDMuYXhpc0JvdHRvbSh4KS50aWNrcyg0KSlcbiAgY29uc3QgYXhpc1RvcCA9IGcgPT4gZy5jYWxsKGQzLmF4aXNUb3AoeCkudGlja3MoNCkpO1xuXG4gIGNvbnN0IGhleGFnb25TaXplID0gKCh4KDEgLyAoMiAqIHJlc29sdXRpb24pKSAtIHgoMCkpKSAvIE1hdGguY29zKE1hdGguUEkgLyA2KSArIDE7XG5cbiAgY29uc3QgY29ybmVycyA9IFt7IHg6IDAuNSwgeTogTWF0aC5zcXJ0KDMpLzIgfSwgeyB4OiAwLCB5OiAwIH0sIHt4OiAxLCB5OiAwIH1dO1xuICBjb25zdCBjb3JuZXJzX2V4cGFuZGVkID0gW3sgeDogMC41LCB5OiBNYXRoLnNxcnQoMykvMiArIDAuMSB9LCB7IHg6IC0wLjEsIHk6IC0wLjA1IH0sIHt4OiAxLjEsIHk6IC0wLjA1IH1dO1xuXG4gIGNvbnN0IGxpbmUgPSBkMy5saW5lKCkueChkID0+IHgoZC54KSkueShkID0+IHkoZC55KSk7XG5cbiAgc3ZnLmFwcGVuZCgnZGVmcycpXG4gICAgLmFwcGVuZCgnY2xpcFBhdGgnKVxuICAgIC5hdHRyKCdpZCcsICd0cmlhbmdsZScpXG4gICAgLmFwcGVuZCgncGF0aCcpXG4gICAgLmF0dHIoJ3gnLCBvcHRpb25zLnNpemUgLyAyKVxuICAgIC5hdHRyKCd5Jywgb3B0aW9ucy5zaXplIC8gMilcbiAgICAuYXR0cignZCcsIGxpbmUoY29ybmVycykpXG5cbiAgc3ZnLnNlbGVjdEFsbCgnLmJvcmRlcicpXG4gICAgLmRhdGEoW1tjb3JuZXJzWzBdLCBjb3JuZXJzWzFdXSxcbiAgICAgICAgICAgW2Nvcm5lcnNbMV0sIGNvcm5lcnNbMl1dLFxuICAgICAgICAgICBbY29ybmVyc1syXSwgY29ybmVyc1swXV1dKVxuICAgIC5lbnRlcigpXG4gICAgLmFwcGVuZCgnbGluZScpXG4gICAgLmF0dHIoJ3gxJywgKGQpID0+IHgoZFswXS54KSlcbiAgICAuYXR0cigneDInLCAoZCkgPT4geChkWzFdLngpKVxuICAgIC5hdHRyKCd5MScsIChkKSA9PiB5KGRbMF0ueSkpXG4gICAgLmF0dHIoJ3kyJywgKGQpID0+IHkoZFsxXS55KSlcbiAgICAuYXR0cignY2xhc3MnLCAnYm9yZGVyJylcbiAgICAuYXR0cignc3Ryb2tlJywgJ2JsYWNrJyk7XG5cbiAgY29uc3QgaGV4YmluID0gZDMuaGV4YmluKCk7XG5cbiAgc3ZnLmFwcGVuZCgnZycpXG4gICAgLmF0dHIoJ2NsaXAtcGF0aCcsICd1cmwoI3RyaWFuZ2xlKScpXG4gICAgLnNlbGVjdEFsbChcIi5wb2ludFwiKVxuICAgIC5kYXRhKGRlbnNpdHkpXG4gICAgLmpvaW4oJ3BhdGgnKVxuICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCBkID0+IGB0cmFuc2xhdGUoJHt4KGNvcm5lcnNbMF0ueCAqIGQueFswXSArIGNvcm5lcnNbMV0ueCAqIGQueFsxXSArIGNvcm5lcnNbMl0ueCAqIGQueFsyXSl9LCAke3koY29ybmVyc1swXS55ICogZC54WzBdICsgY29ybmVyc1sxXS55ICogZC54WzFdICsgY29ybmVyc1syXS55ICogZC54WzJdKX0pYClcbiAgICAuYXR0cignZmlsbCcsIGQgPT4gZmlsbFNjYWxlKGQuZGVuc2l0eSkpXG4gICAgLmF0dHIoJ2QnLCBoZXhiaW4uaGV4YWdvbihoZXhhZ29uU2l6ZSkpO1xuXG4gIHN2Zy5zZWxlY3RBbGwoJ3RleHQnKVxuICAgIC5kYXRhKFtbY29ybmVyc19leHBhbmRlZFswXSwgY29ybmVyc19leHBhbmRlZFsxXV0sXG4gICAgICAgICAgIFtjb3JuZXJzX2V4cGFuZGVkWzFdLCBjb3JuZXJzX2V4cGFuZGVkWzJdXSxcbiAgICAgICAgICAgW2Nvcm5lcnNfZXhwYW5kZWRbMl0sIGNvcm5lcnNfZXhwYW5kZWRbMF1dXSlcbiAgICAuam9pbihcInRleHRcIilcbiAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgLmF0dHIoXCJhbGlnbm1lbnQtYmFzZWxpbmVcIiwgXCJtaWRkbGVcIilcbiAgICAuYXR0cihcImZvbnQtc3R5bGVcIiwgXCJpdGFsaWNcIilcbiAgICAuYXR0cihcInhcIiwgZCA9PiAoeChkWzBdLngpICsgeChkWzFdLngpKSAvIDIpXG4gICAgLmF0dHIoXCJ5XCIsIGQgPT4gKHkoZFswXS55KSArIHkoZFsxXS55KSkgLyAyKVxuICAgIC50ZXh0KChkLCBpKSA9PiB7XG4gICAgICBpZihpID09IDApIHJldHVybiBcInjigoJcIiA7XG4gICAgICBpZihpID09IDEpIHJldHVybiBcInjigoNcIjtcbiAgICAgIGlmKGkgPT0gMikgcmV0dXJuIFwieOKCgVwiO1xuICAgIH0pXG5cbiAgICBsZXQgeHkgPSBiYXJ5Y2VudHJpY1RvQ2FydGVzaWFuKHosIGNvcm5lcnMpXG4gICAgbGV0IHh5ciA9IFtpbnZlcnNlSW52ZXJzZVNjYWxlWCh4eVswXSksIGludmVyc2VJbnZlcnNlU2NhbGVZKHh5WzFdKV07XG5cbiAgICBsZXQgeHlfcSA9IGJhcnljZW50cmljVG9DYXJ0ZXNpYW4ocSwgY29ybmVycylcbiAgICBsZXQgeHlyX3EgPSBbaW52ZXJzZUludmVyc2VTY2FsZVgoeHlfcVswXSksIGludmVyc2VJbnZlcnNlU2NhbGVZKHh5X3FbMV0pXTtcblxuICAgIGxldCBzZnRtYXggPSBzb2Z0bWF4KFt6MSwgejIsIHozXSwgcSwgYmV0YSlcbiAgICBsZXQgeHlfcyA9IGJhcnljZW50cmljVG9DYXJ0ZXNpYW4oc2Z0bWF4LCBjb3JuZXJzKVxuICAgIGxldCB4eXJfcyA9IFtpbnZlcnNlSW52ZXJzZVNjYWxlWCh4eV9zWzBdKSwgaW52ZXJzZUludmVyc2VTY2FsZVkoeHlfc1sxXSldO1xuXG4gICAgLy8gSWYgaXQgZG9lcyBub3QgZXhpc3QsIGFwcGVuZCBhIG5ldyByZWQgY2lyY2xlXG4gICAgc3ZnLmFwcGVuZChcImNpcmNsZVwiKVxuICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInJlZC1jaXJjbGVcIikgLy8gQWRkIGEgY2xhc3MgZm9yIGVhc3kgc2VsZWN0aW9uXG4gICAgICAuYXR0cihcImN4XCIsIHh5cl9zWzBdKVxuICAgICAgLmF0dHIoXCJjeVwiLCB4eXJfc1sxXSlcbiAgICAgIC5hdHRyKFwiei1pbmRleFwiLCAxMDAwKVxuICAgICAgLmF0dHIoXCJyXCIsIDcpIC8vIFJhZGl1cyBvZiB0aGUgY2lyY2xlXG4gICAgICAuYXR0cihcImZpbGxcIiwgXCJyZWRcIik7IC8vIEZpbGwgY29sb3Igb2YgdGhlIGNpcmNsZVxuXG4gICAgc3ZnLmFwcGVuZChcImNpcmNsZVwiKVxuICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInB1cnBsZS1jaXJjbGVcIikgLy8gQWRkIGEgY2xhc3MgZm9yIGVhc3kgc2VsZWN0aW9uXG4gICAgICAuYXR0cihcImN4XCIsIHh5clswXSlcbiAgICAgIC5hdHRyKFwiY3lcIiwgeHlyWzFdKVxuICAgICAgLmF0dHIoXCJ6LWluZGV4XCIsIDEwMDApXG4gICAgICAuYXR0cihcInJcIiwgNykgLy8gUmFkaXVzIG9mIHRoZSBjaXJjbGVcbiAgICAgIC5hdHRyKFwiZmlsbFwiLCBcInB1cnBsZVwiKTsgLy8gRmlsbCBjb2xvciBvZiB0aGUgY2lyY2xlXG5cblxuICAgIHN2Zy5hcHBlbmQoXCJjaXJjbGVcIilcbiAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJibGFjay1jaXJjbGVcIikgLy8gQWRkIGEgY2xhc3MgZm9yIGVhc3kgc2VsZWN0aW9uXG4gICAgICAuYXR0cihcImN4XCIsIHh5cl9xWzBdKVxuICAgICAgLmF0dHIoXCJjeVwiLCB4eXJfcVsxXSlcbiAgICAgIC5hdHRyKFwiei1pbmRleFwiLCAxMDAwKVxuICAgICAgLmF0dHIoXCJyXCIsIDcpIC8vIFJhZGl1cyBvZiB0aGUgY2lyY2xlXG4gICAgICAuYXR0cihcImZpbGxcIiwgXCJibGFja1wiKTsgLy8gRmlsbCBjb2xvciBvZiB0aGUgY2lyY2xlXG5cblxuICAgIC8vIEFwcGVuZCB0ZXh0IGZvciB0aGUgY29vcmRpbmF0ZXNcbiAgICBzdmcuYXBwZW5kKFwidGV4dFwiKVxuICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImNvb3JkLXRleHRcIikgLy8gQWRkIGEgY2xhc3MgZm9yIGVhc3kgc2VsZWN0aW9uXG4gICAgICAvLyAuYXR0cihcInhcIiwgeHlyWzBdICsgMTApIC8vIFBvc2l0aW9uIHRoZSB0ZXh0IHJpZ2h0IG5leHQgdG8gdGhlIGNpcmNsZVxuICAgICAgLy8gLmF0dHIoXCJ5XCIsIHh5clsxXSlcbiAgICAgIC5hdHRyKFwieFwiLCAzMDApIC8vIFBvc2l0aW9uIHRoZSB0ZXh0IHJpZ2h0IG5leHQgdG8gdGhlIGNpcmNsZVxuICAgICAgLmF0dHIoXCJ5XCIsIDgwKVxuICAgICAgLmF0dHIoXCJmaWxsXCIsIFwiYmxhY2tcIikgLy8gVGV4dCBjb2xvclxuICAgICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIFwiMTBweFwiKVxuICAgICAgLnRleHQoYHE9KCR7cVswXS50b0ZpeGVkKDIpfSwgJHtxWzFdLnRvRml4ZWQoMil9LCAke3FbMl0udG9GaXhlZCgyKX0pYCk7IC8vIERpc3BsYXkgY29vcmRpbmF0ZXNcbiAgICAvLyBBcHBlbmQgY29sb3IgbGVnZW5kIGZvciBwdXJwbGUtY2lyY2xlIGFuZCByZWQtY2lyY2xlOlxuXG5cbiAgICAvLyBBcHBlbmQgdGV4dCBmb3IgdGhlIGNvb3JkaW5hdGVzXG4gICAgc3ZnLmFwcGVuZChcInRleHRcIilcbiAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJjb29yZC10ZXh0XCIpIC8vIEFkZCBhIGNsYXNzIGZvciBlYXN5IHNlbGVjdGlvblxuICAgICAgLy8gLmF0dHIoXCJ4XCIsIHh5clswXSArIDEwKSAvLyBQb3NpdGlvbiB0aGUgdGV4dCByaWdodCBuZXh0IHRvIHRoZSBjaXJjbGVcbiAgICAgIC8vIC5hdHRyKFwieVwiLCB4eXJbMV0pXG4gICAgICAuYXR0cihcInhcIiwgMzAwKSAvLyBQb3NpdGlvbiB0aGUgdGV4dCByaWdodCBuZXh0IHRvIHRoZSBjaXJjbGVcbiAgICAgIC5hdHRyKFwieVwiLCAxMDApXG4gICAgICAuYXR0cihcImZpbGxcIiwgXCJyZWRcIikgLy8gVGV4dCBjb2xvclxuICAgICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIFwiMTBweFwiKVxuICAgICAgLnRleHQoYM+DX3txLM6yfT0oJHtzZnRtYXhbMF0udG9GaXhlZCgyKX0sICR7c2Z0bWF4WzFdLnRvRml4ZWQoMil9LCAke3NmdG1heFsyXS50b0ZpeGVkKDIpfSlgKTsgLy8gRGlzcGxheSBjb29yZGluYXRlc1xuICAgIC8vIEFwcGVuZCBjb2xvciBsZWdlbmQgZm9yIHB1cnBsZS1jaXJjbGUgYW5kIHJlZC1jaXJjbGU6XG5cbiAgICBzdmcuYXBwZW5kKFwidGV4dFwiKVxuICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImNvb3JkLXRleHRcIikgLy8gQWRkIGEgY2xhc3MgZm9yIGVhc3kgc2VsZWN0aW9uXG4gICAgICAuYXR0cihcInhcIiwgMzAwKSAvLyBQb3NpdGlvbiB0aGUgdGV4dCByaWdodCBuZXh0IHRvIHRoZSBjaXJjbGVcbiAgICAgIC5hdHRyKFwieVwiLCAxMjApXG4gICAgICAuYXR0cihcImZpbGxcIiwgXCJwdXJwbGVcIikgLy8gVGV4dCBjb2xvclxuICAgICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIFwiMTBweFwiKVxuICAgICAgLnRleHQoYHo9KCR7ejEudG9GaXhlZCgyKX0sICR7ejIudG9GaXhlZCgyKX0sICR7ejMudG9GaXhlZCgyKX0pYCk7IC8vIERpc3BsYXkgY29vcmRpbmF0ZXNcblxuXG4gIGNvbnN0IHJlbW92ZUxpbmUgPSBnID0+IGcuc2VsZWN0KFwiLmRvbWFpblwiKS5yZW1vdmUoKTtcblxuZnVuY3Rpb24gc2V0KGlucHV0LCB2YWx1ZSkge1xuICBpbnB1dC52YWx1ZSA9IHZhbHVlO1xuICBpbnB1dC5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudChcImlucHV0XCIsIHtidWJibGVzOiB0cnVlfSkpO1xufVxuXG4vLyBBdHRhY2ggYSBjbGljayBldmVudCBsaXN0ZW5lciB0byB0aGUgU1ZHXG5zdmcub24oXCJjbGlja1wiLCBmdW5jdGlvbihldmVudCkge1xuICAvLyBFeHRyYWN0IHRoZSBjbGljayBjb29yZGluYXRlc1xuICBjb25zdCBbY2xpY2tYLCBjbGlja1ldID0gZDMucG9pbnRlcihldmVudCk7XG4gIGxiZCA9IGNhcnRlc2lhblRvQmFyeWNlbnRyaWMoaW52ZXJzZVNjYWxlWChjbGlja1gpLCBpbnZlcnNlU2NhbGVZKGNsaWNrWSksIGNvcm5lcnMpO1xuXG4gIHNldCh2aWV3b2YgejEsIGxiZFsyXSk7XG4gIHNldCh2aWV3b2YgejIsIGxiZFsxXSk7XG4gIHNldCh2aWV3b2YgejMsIGxiZFswXSk7XG59KTtcblxuIC8vIGRpc3BsYXkgYXhpcyB2YWx1ZXNcbnN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgwLCAke29wdGlvbnMuc2l6ZSAtIG9wdGlvbnMubWFyZ2luLmJvdHRvbX0pYClcbiAgICAuY2FsbChheGlzQm90dG9tKVxuICAgIC5jYWxsKHJlbW92ZUxpbmUpXG5cbiAgc3ZnLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7eCgxKSArIG9wdGlvbnMubWFyZ2luLnJpZ2h0IC8gMiB9LCAke3koMCkgKyAyNn0pIHJvdGF0ZSgtMTIwKWApXG4gICAgLmNhbGwoYXhpc0JvdHRvbSlcbiAgICAuY2FsbChyZW1vdmVMaW5lKVxuICAgIC5jYWxsKGcgPT4gZy5zZWxlY3RBbGwoXCJ0ZXh0XCIpLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoMTEsIDIyKSByb3RhdGUoMTIwKVwiKSk7XG5cbiAgc3ZnLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7eCgwLjUpICsgb3B0aW9ucy5tYXJnaW4ubGVmdCAvIDJ9LCAke3koTWF0aC5zcXJ0KDMpIC8gMikgLSAyNn0pIHJvdGF0ZSgxMjApYClcbiAgICAuY2FsbChheGlzQm90dG9tKVxuICAgIC5jYWxsKHJlbW92ZUxpbmUpXG4gICAgLmNhbGwoZyA9PiBnLnNlbGVjdEFsbChcInRleHRcIikuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSgtMTEsIDIyKSByb3RhdGUoLTEyMClcIikpO1xuXG4gIHJldHVybiBzdmcubm9kZSgpO1xufVxuXG5cbmxldmVsTG9nc3VtZXhwID0ge1xuICBjb25zdCBkZW5zaXR5ID0gW107XG4gIGZvcihsZXQgaSA9IDE7IGkgPCBkZW5zaXR5UmVzb2x1dGlvbjsgaSsrKSB7XG4gICAgZm9yKGxldCBqID0gMTsgaiA8IGRlbnNpdHlSZXNvbHV0aW9uIC0gaTsgaisrKSB7XG4gICAgICBjb25zdCB4MSA9IGkgLyBkZW5zaXR5UmVzb2x1dGlvbiA7XG4gICAgICBjb25zdCB4MiA9IGogLyBkZW5zaXR5UmVzb2x1dGlvbjtcbiAgICAgIGNvbnN0IHgzID0gTWF0aC5tYXgoMCwgMSAtIHgxIC0geDIpO1xuICAgICAgY29uc3QgeCA9IFsgeDEsIHgyLCB4MyBdO1xuXG4gICAgICBkZW5zaXR5LnB1c2goeyB4LCBkZW5zaXR5OiBsb2dzdW1leHAoeCwgcSwgYmV0YSkgfSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBkZW5zaXR5O1xufVxuXG5sZXZlbEtMID0ge1xuICBjb25zdCBkZW5zaXR5ID0gW107XG4gIGZvcihsZXQgaSA9IDE7IGkgPCBkZW5zaXR5UmVzb2x1dGlvbjsgaSsrKSB7XG4gICAgZm9yKGxldCBqID0gMTsgaiA8IGRlbnNpdHlSZXNvbHV0aW9uIC0gaTsgaisrKSB7XG4gICAgICBjb25zdCB4MSA9IGkgLyBkZW5zaXR5UmVzb2x1dGlvbiA7XG4gICAgICBjb25zdCB4MiA9IGogLyBkZW5zaXR5UmVzb2x1dGlvbjtcbiAgICAgIGNvbnN0IHgzID0gTWF0aC5tYXgoMCwgMSAtIHgxIC0geDIpO1xuICAgICAgY29uc3QgeCA9IFsgeDEsIHgyLCB4MyBdO1xuXG4gICAgICAvLyBkZW5zaXR5LnB1c2goeyB4LCBkZW5zaXR5OiBsb2dzdW1leHAoeCwgcSwgYmV0YSkgLyBNYXRoLmxvZyhNYXRoLm1heChxWzBdLHFbMV0sIHFbMl0pICogTWF0aC5leHAoMS9iZXRhKSkgfSk7XG4gICAgICBkZW5zaXR5LnB1c2goeyB4LCBkZW5zaXR5OiBrdWxsX2xlaWJsZXIoeCwgcSwgYmV0YSkgfSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBkZW5zaXR5O1xufVxuXG5cbmxldmVsS0xfZnVsbCA9IHtcbiAgY29uc3QgZGVuc2l0eSA9IFtdO1xuICBmb3IobGV0IGkgPSAxOyBpIDwgZGVuc2l0eVJlc29sdXRpb247IGkrKykge1xuICAgIGZvcihsZXQgaiA9IDE7IGogPCBkZW5zaXR5UmVzb2x1dGlvbiAtIGk7IGorKykge1xuICAgICAgY29uc3QgeDEgPSBpIC8gZGVuc2l0eVJlc29sdXRpb24gO1xuICAgICAgY29uc3QgeDIgPSBqIC8gZGVuc2l0eVJlc29sdXRpb247XG4gICAgICBjb25zdCB4MyA9IE1hdGgubWF4KDAsIDEgLSB4MSAtIHgyKTtcbiAgICAgIGNvbnN0IHggPSBbIHgxLCB4MiwgeDMgXTtcblxuICAgICAgLy8gZGVuc2l0eS5wdXNoKHsgeCwgZGVuc2l0eTogbG9nc3VtZXhwKHgsIHEsIGJldGEpIC8gTWF0aC5sb2coTWF0aC5tYXgocVswXSxxWzFdLCBxWzJdKSAqIE1hdGguZXhwKDEvYmV0YSkpIH0pO1xuICAgICAgZGVuc2l0eS5wdXNoKHsgeCwgZGVuc2l0eTogb2JqZWN0aXZlKHgsIHosIHEsIGJldGEpIH0pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZGVuc2l0eTtcbn1cblxudGVybmFyeURlbnNpdHkobGV2ZWxLTF9mdWxsLCBkZW5zaXR5UmVzb2x1dGlvbiwgeyBzaXplOiA1MDAsIGNvbG9yU2NoZW1lOiBkMy5pbnRlcnBvbGF0ZUJsdWVzfSlcblxubG9nc3VtZXhwQ29sb3JTY2FsZSA9IGxlZ2VuZCh7Y29sb3I6IGQzLnNjYWxlU2VxdWVudGlhbChkMy5leHRlbnQoWzAsICBsb2dzdW1leHAoeiwgcSwgYmV0YSldKSwgZDMuaW50ZXJwb2xhdGVCbHVlcyksIHRpdGxlOiBcIkludGVuc2l0eVwifSlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgncTEnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgncTInKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgncTMnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnejEnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnejInKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnejMnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXRzJykifV19
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../blog/softmax";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/josephsalmon\.eu\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb2" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Soft-max and Soft-argmax"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - name:</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">      given: Joseph</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">      family: Salmon</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - name:</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">      given: François-David</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">      family: Collin</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2024-09-03"</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Back to exponential weights and log-sum-exp functions"</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [statistics, optimization, machine learning]</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> "softmax.png"</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="an">reference-location:</span><span class="co"> document</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="an">fig-cap-location:</span><span class="co"> bottom</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="an">draft:</span><span class="co"> false</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># title-block-banner: hello-world-bg.jpg</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co">    include-before-body: ../../html/margin_image.html</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co">    include-after-body: ../../html/blog_footer.html</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>::: {.content-hidden}</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>\DeclareMathOperator*{\argmin}{arg\,min} % thin space, limits underneath in displays</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>\DeclareMathOperator*{\argmax}{arg\,max} % thin space, limits underneath in displays</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>The softmax function is a smooth approximation of the max function, and is used in many machine learning models.</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>Similarly we can define the soft-argmax function, which is a smooth approximation of the argmax function.</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="fu">## {{&lt;fa pencil-alt title="pencil"&gt;}} Definition and notation</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>First, let us define $\Delta_{K} = <span class="sc">\{</span>p \in \mathbb{R}^K \geq 0: \sum_{k} p_k = 1<span class="sc">\}</span>$ the probability simplex in $\mathbb{R}^K$, and $u_K = (1/K, \dots, 1/K)^\top$ the uniform distribution in $\Delta_{K}$, and the standard basis vectors $(\delta_k)_{k=1,\dots,K}$, where $\delta_k = (0,\dots,\underbrace{1}_{k-\rm{th}},\dots,0)^\top \in \mathbb{R}^K$.</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>Formally, the standard **soft-argmax** function $\sigma \colon \mathbb{R}^{K} \to (0, 1)^{K}$, where $K \geq 1$, takes a vector $z = (z_{1}, \dots, z_{K})^\top \in \mathbb{R}^{K}$ and computes each component of the vector $\sigma(z) \in <span class="co">[</span><span class="ot">0, 1</span><span class="co">]</span>^{K}$ by</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>\left(\sigma(z)\right)_k = \frac{\exp(z_k)}{\sum_{k'=1}^{K} \exp(z_{k'})}\enspace, \quad \text{for } k = 1, \dots, K.</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>Note in particular that $\sigma(z)=\sigma_{u_K, 1}(z)$ for any $z \in \mathbb{R}^K$.</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>We also define for any $q \in \Delta_{K}$ with positive coordinates^<span class="co">[</span><span class="ot">the case with $q_k=0$ for some $k$ can be reduced to a case with fewer coordinates</span><span class="co">]</span>, *i.e.*, $q_k&gt;0$, for all $k\in <span class="co">[</span><span class="ot">K</span><span class="co">]</span>$, the function $\sigma_{q,\beta} \colon \mathbb{R}^{K} \to \mathbb{R}^K$ as</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>\left(\sigma_{q,\beta}(z)\right)_k = \frac{q_k\exp(z_k/\beta)}{\sum_{k'=1}^{K} q_{k'}\exp(z_{k'}/\beta)} \enspace, \quad \text{for } k = 1, \dots, K.</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>Last but not least, we introduce the real valued log-sum-exp function (or weighted **softmax**), defined for any vector $z \in \mathbb{R}^K$ by</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>\text{logsumexp}_{q,\beta}(z) = \beta \cdot \log\left(\sum_{k=1}^{K} q_k \cdot \exp(z_k/\beta)\right).</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a><span class="fu">## {{&lt; fa wave-square &gt;}} Variational formulation</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>In this note we show that the soft-argmax function can be written as the conjugate of the log-sum-exp function.</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>:::: {#thm-lfgn}</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>Let $q \in \Delta_{K}$ be with positive coordinates, *i.e.*, $q_k&gt;0$, for all $k\in <span class="co">[</span><span class="ot">K</span><span class="co">]</span>$, $\beta&gt;0$ and let $z \in \mathbb{R}^K$.</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>Then,</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>\text{logsumexp}_{q,\beta}(z)</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>&amp; =</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>\max_{ p \in \Delta_K} \langle z, p \rangle - \beta\sum_{k=1}^{K} p_k \log(p_k / q_k) <span class="sc">\\</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>\sigma_{q,\beta}(z)</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>&amp; =</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>\argmax_{ p \in \Delta_K} \langle z, p \rangle - \beta\sum_{k=1}^{K} p_k \log(p_k / q_k)\enspace.</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>::: {.proof}</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>Using Lagrange multipliers <span class="co">[</span><span class="ot">see for instance Ch. 5, @Boyd_Vandenberghe04</span><span class="co">]</span> you get for $\Lambda=(\lambda_1,\dots,\lambda_K)^\top$, $\mu \in \mathbb{R}$ and $p \in \Delta_K$ the Lagrangian function:</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>\mathcal{L}(p,\mu,\Lambda) = \langle z, p \rangle - \beta\sum_{k=1}^{K} p_k \log(p_k / q_k) + \mu\left(\sum_{k=1}^{K} p_k - 1\right) - \sum_{k=1}^{K} \lambda_k p_k.</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>The Slater condition is satisfied, so the KKT conditions are necessary and sufficient for optimality. The KKT conditions are</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>\frac{\partial \mathcal{L}}{\partial p_k} &amp;= z_k - \beta\log(p_k / q_k) - \beta - \mu - \lambda_k = 0, \quad k = 1, \dots, K,<span class="sc">\\</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>\mu\left(\sum_{k=1}^{K} p_k - 1\right) &amp;= 0,<span class="sc">\\</span></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>\lambda_k p_k &amp;= 0, \quad k = 1, \dots, K,<span class="sc">\\</span></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>p_k &amp;\geq 0, \quad k = 1, \dots, K.</span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>From the first KKT condition we get</span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>p_k = q_k\exp\left(\frac{z_k-\beta-\mu-\lambda_k}{\beta}\right), \quad k = 1, \dots, K.</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>Now, since $\lambda_k p_k = 0$ and that $q_k&gt;0$ for all $k$, we have that $\lambda_k = 0$ for all $k$. Thus, we get after normalisation that</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>p_k = \frac{q_k\exp(z_k/\beta)}{\sum_{k'=1}^{K} q_{k'}\exp(z_{k'}/\beta)}, \quad k = 1, \dots, K.</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>Note that</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>&amp; p_k = \frac{q_k\exp(z_k/\beta)}{\sum_{k'=1}^{K} q_{k'}\exp(z_{k'}/\beta)}<span class="sc">\\</span></span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>\iff &amp; \log( p_k) = \log(q_k) + \frac{z_k}{\beta} - \frac{1}{\beta} \cdot  \text{logsumexp}_{q,\beta}(z).</span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>Finally, we have that</span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>\beta\sum_{k=1}^{K} p_k \log(p_k / q_k) &amp;= \beta\sum_{k=1}^{K} p_k \left(\frac{z_k}{\beta} - \frac{1}{\beta} \cdot \text{logsumexp}_{q,\beta}(z)\right)<span class="sc">\\</span></span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>&amp;= \sum_{k=1}^{K} p_k z_k - \text{logsumexp}_{q,\beta}(z),</span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>Hence, $\sum_{k=1}^{K} p_k z_k - \beta \sum_{k=1}^{K} p_k \log(p_k / q_k) = \text{logsumexp}_{q,\beta}(z)$.</span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>The following limit properties for infinitesimal $\beta$ explain the naming and the regularizing property of the (temperature) parameter $\beta$:</span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>:::: {#prp-soft}</span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>Reminding that $u_K=(1/K,\dots,1/K)^\top$ and $\delta_{k}$ is the $k$-th standard basis vector, for any $z \in \mathbb{R}^K$, we have that</span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>\sigma_{u_K,\beta}(z) &amp; \xrightarrow<span class="co">[</span><span class="ot">\beta \to 0</span><span class="co">]</span>{}  \delta_{k_0}, \text{ where } k_0=\argmax_{k\in <span class="co">[</span><span class="ot">K</span><span class="co">]</span>} z_k <span class="sc">\\</span></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a> \text{logsumexp}_{u_K,\beta}(z) &amp; \xrightarrow[\beta \to 0]{} \max_{k\in <span class="co">[</span><span class="ot">K</span><span class="co">]</span>} z_k \enspace.</span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>The first limit show that the soft-argmax function is a kind of smooth approximation of the argmax function, while the log-sum-exp function is a smooth approximation of the max function.</span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a><span class="fu">## {{&lt;fa sync-alt&gt;}} Invariance properties</span></span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>The softmax function is invariant to the addition of a constant to each component of the input vector. More precisely, we have the following result:</span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>:::: {#thm-invariance}</span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>Let $q \in \Delta_{K}$ be with positive coordinates, *i.e.*, $q_k&gt;0$, for all $k\in <span class="co">[</span><span class="ot">K</span><span class="co">]</span>$, $\beta&gt;0$ and let $z \in \mathbb{R}^K$.</span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>Then, for any $c \in \mathbb{R}$, we have that</span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>\sigma_{q,\beta}(z) = \sigma_{q,\beta}(z+c).</span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>::: {.proof}</span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a>We have that</span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a>\sigma_{q,\beta}(z+c)_k &amp;= \frac{q_k\exp((z_k+c)/\beta)}{\sum_{k'=1}^{K} q_{k'}\exp((z_{k'}+c)/\beta)}<span class="sc">\\</span></span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{q_k\exp(z_k/\beta)\exp(c/\beta)}{\sum_{k'=1}^{K} q_{k'}\exp(z_{k'}/\beta)\exp(c/\beta)}<span class="sc">\\</span></span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{q_k\exp(z_k/\beta)}{\sum_{k'=1}^{K} q_{k'}\exp(z_{k'}/\beta)}<span class="sc">\\</span></span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>&amp;= \sigma_{q,\beta}(z)_k.</span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>Let us consider also the effect of rescaling the input vector by a positive constant. We have the following result:</span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a>:::: {#thm-rescaling}</span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>Let $q \in \Delta_{K}$ be with positive coordinates, *i.e.*, $q_k&gt;0$, for all $k\in <span class="co">[</span><span class="ot">K</span><span class="co">]</span>$, $\beta&gt;0$ and let $z \in \mathbb{R}^K$.</span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a>Then, for any $\alpha &gt;0$, we have that</span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a>\sigma_{q,\beta}(\alpha z) = \sigma_{q,\tfrac{\beta}{\alpha}}(z).</span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>::: {.proof}</span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a>We have that</span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a>\left(\sigma_{q,\beta}(\alpha z)\right)_k &amp;= \frac{q_k\exp(\alpha z_k/\beta)}{\sum_{k'=1}^{K} q_{k'}\exp(\alpha z_{k'}/\beta)}<span class="sc">\\</span></span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{q_k\exp(z_k/\frac{\beta}{\alpha})}{\sum_{k'=1}^{K} q_{k'}\exp(z_{k'}/\frac{\beta}{\alpha})}<span class="sc">\\</span></span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a>&amp;= \left(\sigma_{q,\tfrac{\beta}{\alpha}}(z)\right)_k.</span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a><span class="fu">## {{&lt; fa sliders &gt;}} Visualization</span></span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a>We consider the case $K=3$ for visualization.</span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- color a word in purple with html in the following sentence--&gt;</span></span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a>You can click on the plot to move $z$ &lt;span style="color: purple;"&gt;(the purple dot)&lt;/span&gt;, and see the corresponding soft-argmax $\sigma_{q,\beta}$ &lt;span style="color: red;"&gt;(the red dot)&lt;/span&gt;. You can modify $q$ (the black dot) and $\beta$ with the slider.</span>
<span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a>The level sets displayed are for the function after the max in the log-sum-exp definition, *i.e.*, for a fixed $z\in \mathbb{R}^3$, $q\in \Delta_K$ and $\beta&gt;0$, the level set is the set of points $p\in \Delta_K$ such that</span>
<span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a>\Delta_K &amp;\to \mathbb{R} <span class="sc">\\</span></span>
<span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a>p &amp; \mapsto \langle z, p \rangle - \beta\sum_{k=1}^{K} p_k \log(p_k / q_k)</span>
<span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a><span class="in">// | layout-ncol: 1</span></span>
<span id="cb2-218"><a href="#cb2-218" aria-hidden="true" tabindex="-1"></a><span class="in">// | fig-align: left</span></span>
<span id="cb2-219"><a href="#cb2-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-220"><a href="#cb2-220" aria-hidden="true" tabindex="-1"></a><span class="in">d3 = require("d3@v6", "d3-hexbin@0.2")</span></span>
<span id="cb2-221"><a href="#cb2-221" aria-hidden="true" tabindex="-1"></a><span class="in">math = require("mathjs")</span></span>
<span id="cb2-222"><a href="#cb2-222" aria-hidden="true" tabindex="-1"></a><span class="in">digamma = require( 'https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-digamma@umd/browser.js' )</span></span>
<span id="cb2-223"><a href="#cb2-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-224"><a href="#cb2-224" aria-hidden="true" tabindex="-1"></a><span class="in">import {legend} from "@d3/color-legend"</span></span>
<span id="cb2-225"><a href="#cb2-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-226"><a href="#cb2-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-227"><a href="#cb2-227" aria-hidden="true" tabindex="-1"></a><span class="in">densityResolution = 80</span></span>
<span id="cb2-228"><a href="#cb2-228" aria-hidden="true" tabindex="-1"></a><span class="in">margin = ({ left: 30, top: 30, right: 30, bottom: 30 })</span></span>
<span id="cb2-229"><a href="#cb2-229" aria-hidden="true" tabindex="-1"></a><span class="in">height = 400</span></span>
<span id="cb2-230"><a href="#cb2-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-231"><a href="#cb2-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-232"><a href="#cb2-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-233"><a href="#cb2-233" aria-hidden="true" tabindex="-1"></a><span class="in">beta = [inputs.beta]</span></span>
<span id="cb2-234"><a href="#cb2-234" aria-hidden="true" tabindex="-1"></a><span class="in">// lbd = [0.3,0.3,0.4]</span></span>
<span id="cb2-235"><a href="#cb2-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-236"><a href="#cb2-236" aria-hidden="true" tabindex="-1"></a><span class="in">viewof q1 = Inputs.range([0.01, 1], {value: 1/3, label: tex`q_1`, step: 0.01})</span></span>
<span id="cb2-237"><a href="#cb2-237" aria-hidden="true" tabindex="-1"></a><span class="in">viewof q2 = Inputs.range([0.01, 1], {value: 1/3, label: tex`q_2`, step: 0.01})</span></span>
<span id="cb2-238"><a href="#cb2-238" aria-hidden="true" tabindex="-1"></a><span class="in">viewof q3 = Inputs.range([0.01, 1], {value: 1/3, label: tex`q_3`, step: 0.01})</span></span>
<span id="cb2-239"><a href="#cb2-239" aria-hidden="true" tabindex="-1"></a><span class="in">viewof z1 = Inputs.range([-10, 10], {value: 0.4, label: tex`z_1`, step: 0.01})</span></span>
<span id="cb2-240"><a href="#cb2-240" aria-hidden="true" tabindex="-1"></a><span class="in">viewof z2 = Inputs.range([-10, 10], {value: 0.2, label: tex`z_2`, step: 0.01})</span></span>
<span id="cb2-241"><a href="#cb2-241" aria-hidden="true" tabindex="-1"></a><span class="in">viewof z3 = Inputs.range([-10, 10], {value: 0.2, label: tex`z_3`, step: 0.01})</span></span>
<span id="cb2-242"><a href="#cb2-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-243"><a href="#cb2-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-244"><a href="#cb2-244" aria-hidden="true" tabindex="-1"></a><span class="in">viewof inputs = Inputs.form({</span></span>
<span id="cb2-245"><a href="#cb2-245" aria-hidden="true" tabindex="-1"></a><span class="in">  z1: viewof z1,</span></span>
<span id="cb2-246"><a href="#cb2-246" aria-hidden="true" tabindex="-1"></a><span class="in">  z2: viewof z2,</span></span>
<span id="cb2-247"><a href="#cb2-247" aria-hidden="true" tabindex="-1"></a><span class="in">  z3: viewof z3,</span></span>
<span id="cb2-248"><a href="#cb2-248" aria-hidden="true" tabindex="-1"></a><span class="in">  beta: Inputs.range([0.01, 10], {value: 1, label: tex`\beta`, step: 0.01}),</span></span>
<span id="cb2-249"><a href="#cb2-249" aria-hidden="true" tabindex="-1"></a><span class="in">  q1: viewof q1,</span></span>
<span id="cb2-250"><a href="#cb2-250" aria-hidden="true" tabindex="-1"></a><span class="in">  q2: viewof q2,</span></span>
<span id="cb2-251"><a href="#cb2-251" aria-hidden="true" tabindex="-1"></a><span class="in">  q3: viewof q3,</span></span>
<span id="cb2-252"><a href="#cb2-252" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb2-253"><a href="#cb2-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-254"><a href="#cb2-254" aria-hidden="true" tabindex="-1"></a><span class="in">q = [q1, q2, q3]</span></span>
<span id="cb2-255"><a href="#cb2-255" aria-hidden="true" tabindex="-1"></a><span class="in">z = [z1, z2, z3]</span></span>
<span id="cb2-256"><a href="#cb2-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-257"><a href="#cb2-257" aria-hidden="true" tabindex="-1"></a><span class="in">logsumexp = (x, alpha, beta) =&gt; {</span></span>
<span id="cb2-258"><a href="#cb2-258" aria-hidden="true" tabindex="-1"></a><span class="in">  let result = 0;</span></span>
<span id="cb2-259"><a href="#cb2-259" aria-hidden="true" tabindex="-1"></a><span class="in">  for(let i = 0; i &lt; x.length; i++) result += alpha[i] * Math.exp(x[i] / beta);</span></span>
<span id="cb2-260"><a href="#cb2-260" aria-hidden="true" tabindex="-1"></a><span class="in">  return beta * Math.log(result);</span></span>
<span id="cb2-261"><a href="#cb2-261" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb2-262"><a href="#cb2-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-263"><a href="#cb2-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-264"><a href="#cb2-264" aria-hidden="true" tabindex="-1"></a><span class="in">objective = (x, z, alpha, beta) =&gt; {</span></span>
<span id="cb2-265"><a href="#cb2-265" aria-hidden="true" tabindex="-1"></a><span class="in">  let result = 0;</span></span>
<span id="cb2-266"><a href="#cb2-266" aria-hidden="true" tabindex="-1"></a><span class="in">  for(let i = 0; i &lt; x.length; i++) result -= beta * x[i] * Math.log(x[i] / alpha[i]);</span></span>
<span id="cb2-267"><a href="#cb2-267" aria-hidden="true" tabindex="-1"></a><span class="in">  for(let i = 0; i &lt; x.length; i++) result += x[i] * z[i];</span></span>
<span id="cb2-268"><a href="#cb2-268" aria-hidden="true" tabindex="-1"></a><span class="in">  return result;</span></span>
<span id="cb2-269"><a href="#cb2-269" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb2-270"><a href="#cb2-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-271"><a href="#cb2-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-272"><a href="#cb2-272" aria-hidden="true" tabindex="-1"></a><span class="in">kull_leibler = (x, alpha, beta) =&gt; {</span></span>
<span id="cb2-273"><a href="#cb2-273" aria-hidden="true" tabindex="-1"></a><span class="in">  let result = 0;</span></span>
<span id="cb2-274"><a href="#cb2-274" aria-hidden="true" tabindex="-1"></a><span class="in">  for(let i = 0; i &lt; x.length; i++) result -= x[i] * Math.log(x[i] / alpha[i]);</span></span>
<span id="cb2-275"><a href="#cb2-275" aria-hidden="true" tabindex="-1"></a><span class="in">  return beta * result;</span></span>
<span id="cb2-276"><a href="#cb2-276" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb2-277"><a href="#cb2-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-278"><a href="#cb2-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-279"><a href="#cb2-279" aria-hidden="true" tabindex="-1"></a><span class="in">softmax = (x, alpha, beta) =&gt; {</span></span>
<span id="cb2-280"><a href="#cb2-280" aria-hidden="true" tabindex="-1"></a><span class="in">  let result = [];</span></span>
<span id="cb2-281"><a href="#cb2-281" aria-hidden="true" tabindex="-1"></a><span class="in">  let sum = 0;</span></span>
<span id="cb2-282"><a href="#cb2-282" aria-hidden="true" tabindex="-1"></a><span class="in">  for(let i = 0; i &lt; x.length; i++) {</span></span>
<span id="cb2-283"><a href="#cb2-283" aria-hidden="true" tabindex="-1"></a><span class="in">    result.push(alpha[i] * Math.exp(x[i] / beta));</span></span>
<span id="cb2-284"><a href="#cb2-284" aria-hidden="true" tabindex="-1"></a><span class="in">    sum += result[i];</span></span>
<span id="cb2-285"><a href="#cb2-285" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb2-286"><a href="#cb2-286" aria-hidden="true" tabindex="-1"></a><span class="in">  for(let i = 0; i &lt; x.length; i++) result[i] /= sum;</span></span>
<span id="cb2-287"><a href="#cb2-287" aria-hidden="true" tabindex="-1"></a><span class="in">  return result;</span></span>
<span id="cb2-288"><a href="#cb2-288" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb2-289"><a href="#cb2-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-290"><a href="#cb2-290" aria-hidden="true" tabindex="-1"></a><span class="in">function cartesianToBarycentric(x, y, corners) {</span></span>
<span id="cb2-291"><a href="#cb2-291" aria-hidden="true" tabindex="-1"></a><span class="in">  const A = corners[0], B = corners[1], C = corners[2];</span></span>
<span id="cb2-292"><a href="#cb2-292" aria-hidden="true" tabindex="-1"></a><span class="in">  const v0 = { x: C.x - A.x, y: C.y - A.y };</span></span>
<span id="cb2-293"><a href="#cb2-293" aria-hidden="true" tabindex="-1"></a><span class="in">  const v1 = { x: B.x - A.x, y: B.y - A.y };</span></span>
<span id="cb2-294"><a href="#cb2-294" aria-hidden="true" tabindex="-1"></a><span class="in">  const v2 = { x: x - A.x, y: y - A.y };</span></span>
<span id="cb2-295"><a href="#cb2-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-296"><a href="#cb2-296" aria-hidden="true" tabindex="-1"></a><span class="in">  const d00 = dot(v0, v0);</span></span>
<span id="cb2-297"><a href="#cb2-297" aria-hidden="true" tabindex="-1"></a><span class="in">  const d01 = dot(v0, v1);</span></span>
<span id="cb2-298"><a href="#cb2-298" aria-hidden="true" tabindex="-1"></a><span class="in">  const d11 = dot(v1, v1);</span></span>
<span id="cb2-299"><a href="#cb2-299" aria-hidden="true" tabindex="-1"></a><span class="in">  const d20 = dot(v2, v0);</span></span>
<span id="cb2-300"><a href="#cb2-300" aria-hidden="true" tabindex="-1"></a><span class="in">  const d21 = dot(v2, v1);</span></span>
<span id="cb2-301"><a href="#cb2-301" aria-hidden="true" tabindex="-1"></a><span class="in">  const denom = d00 * d11 - d01 * d01;</span></span>
<span id="cb2-302"><a href="#cb2-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-303"><a href="#cb2-303" aria-hidden="true" tabindex="-1"></a><span class="in">  const lambda1 = (d11 * d20 - d01 * d21) / denom;</span></span>
<span id="cb2-304"><a href="#cb2-304" aria-hidden="true" tabindex="-1"></a><span class="in">  const lambda2 = (d00 * d21 - d01 * d20) / denom;</span></span>
<span id="cb2-305"><a href="#cb2-305" aria-hidden="true" tabindex="-1"></a><span class="in">  const lambda3 = 1.0 - lambda1 - lambda2;</span></span>
<span id="cb2-306"><a href="#cb2-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-307"><a href="#cb2-307" aria-hidden="true" tabindex="-1"></a><span class="in">  return [lambda1, lambda2, lambda3];</span></span>
<span id="cb2-308"><a href="#cb2-308" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb2-309"><a href="#cb2-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-310"><a href="#cb2-310" aria-hidden="true" tabindex="-1"></a><span class="in">function barycentricToCartesian(q, corners) {</span></span>
<span id="cb2-311"><a href="#cb2-311" aria-hidden="true" tabindex="-1"></a><span class="in">  return [</span></span>
<span id="cb2-312"><a href="#cb2-312" aria-hidden="true" tabindex="-1"></a><span class="in">    corners[0].x * q[0] + corners[1].x * q[1] + corners[2].x * q[2],</span></span>
<span id="cb2-313"><a href="#cb2-313" aria-hidden="true" tabindex="-1"></a><span class="in">    corners[0].y * q[0] + corners[1].y * q[1] + corners[2].y * q[2]</span></span>
<span id="cb2-314"><a href="#cb2-314" aria-hidden="true" tabindex="-1"></a><span class="in">  ];</span></span>
<span id="cb2-315"><a href="#cb2-315" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb2-316"><a href="#cb2-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-317"><a href="#cb2-317" aria-hidden="true" tabindex="-1"></a><span class="in">function dot(v1, v2) {</span></span>
<span id="cb2-318"><a href="#cb2-318" aria-hidden="true" tabindex="-1"></a><span class="in">  return v1.x * v2.x + v1.y * v2.y;</span></span>
<span id="cb2-319"><a href="#cb2-319" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb2-320"><a href="#cb2-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-321"><a href="#cb2-321" aria-hidden="true" tabindex="-1"></a><span class="in">ternaryDensity = (density, resolution, options, lbd) =&gt; {</span></span>
<span id="cb2-322"><a href="#cb2-322" aria-hidden="true" tabindex="-1"></a><span class="in">  options = Object.assign({</span></span>
<span id="cb2-323"><a href="#cb2-323" aria-hidden="true" tabindex="-1"></a><span class="in">    size: 400,</span></span>
<span id="cb2-324"><a href="#cb2-324" aria-hidden="true" tabindex="-1"></a><span class="in">    margin: { left: 30, top: 30, right: 30, bottom: 30 },</span></span>
<span id="cb2-325"><a href="#cb2-325" aria-hidden="true" tabindex="-1"></a><span class="in">    colorScheme: d3.interpolateBlues</span></span>
<span id="cb2-326"><a href="#cb2-326" aria-hidden="true" tabindex="-1"></a><span class="in">  }, options);</span></span>
<span id="cb2-327"><a href="#cb2-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-328"><a href="#cb2-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-329"><a href="#cb2-329" aria-hidden="true" tabindex="-1"></a><span class="in">  const fillScale = d3.scaleSequential(options.colorScheme).domain([0</span></span>
<span id="cb2-330"><a href="#cb2-330" aria-hidden="true" tabindex="-1"></a><span class="in">  , Math.log(Math.max(q[0],q[1],q[2]))]);</span></span>
<span id="cb2-331"><a href="#cb2-331" aria-hidden="true" tabindex="-1"></a><span class="in">  // const fillScale = d3.scaleSequential(options.colorScheme).domain(d3.extent(density.map(d =&gt; d.density)))</span></span>
<span id="cb2-332"><a href="#cb2-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-333"><a href="#cb2-333" aria-hidden="true" tabindex="-1"></a><span class="in">  const svg = d3.create("svg")</span></span>
<span id="cb2-334"><a href="#cb2-334" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("width", options.size)</span></span>
<span id="cb2-335"><a href="#cb2-335" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("height", options.size);</span></span>
<span id="cb2-336"><a href="#cb2-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-337"><a href="#cb2-337" aria-hidden="true" tabindex="-1"></a><span class="in">  const x = d3.scaleLinear()</span></span>
<span id="cb2-338"><a href="#cb2-338" aria-hidden="true" tabindex="-1"></a><span class="in">    .domain([0, 1])</span></span>
<span id="cb2-339"><a href="#cb2-339" aria-hidden="true" tabindex="-1"></a><span class="in">    .range([options.margin.left, options.size - options.margin.right])</span></span>
<span id="cb2-340"><a href="#cb2-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-341"><a href="#cb2-341" aria-hidden="true" tabindex="-1"></a><span class="in">  const y = d3.scaleLinear()</span></span>
<span id="cb2-342"><a href="#cb2-342" aria-hidden="true" tabindex="-1"></a><span class="in">    .domain([0, 1])</span></span>
<span id="cb2-343"><a href="#cb2-343" aria-hidden="true" tabindex="-1"></a><span class="in">    .range([options.size - options.margin.bottom, options.margin.top]);</span></span>
<span id="cb2-344"><a href="#cb2-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-345"><a href="#cb2-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-346"><a href="#cb2-346" aria-hidden="true" tabindex="-1"></a><span class="in">  function inverseScaleX(value) {</span></span>
<span id="cb2-347"><a href="#cb2-347" aria-hidden="true" tabindex="-1"></a><span class="in">    // Constants from the original scale</span></span>
<span id="cb2-348"><a href="#cb2-348" aria-hidden="true" tabindex="-1"></a><span class="in">    const domainMin = 0;</span></span>
<span id="cb2-349"><a href="#cb2-349" aria-hidden="true" tabindex="-1"></a><span class="in">    const domainMax = 1;</span></span>
<span id="cb2-350"><a href="#cb2-350" aria-hidden="true" tabindex="-1"></a><span class="in">    const rangeMin = options.margin.left;</span></span>
<span id="cb2-351"><a href="#cb2-351" aria-hidden="true" tabindex="-1"></a><span class="in">    const rangeMax = options.size - options.margin.right;</span></span>
<span id="cb2-352"><a href="#cb2-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-353"><a href="#cb2-353" aria-hidden="true" tabindex="-1"></a><span class="in">    // Calculate the proportion of the input value within the range</span></span>
<span id="cb2-354"><a href="#cb2-354" aria-hidden="true" tabindex="-1"></a><span class="in">    const proportion = (value - rangeMin) / (rangeMax - rangeMin);</span></span>
<span id="cb2-355"><a href="#cb2-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-356"><a href="#cb2-356" aria-hidden="true" tabindex="-1"></a><span class="in">    // Apply the proportion to the domain</span></span>
<span id="cb2-357"><a href="#cb2-357" aria-hidden="true" tabindex="-1"></a><span class="in">    return proportion * (domainMax - domainMin) + domainMin;</span></span>
<span id="cb2-358"><a href="#cb2-358" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb2-359"><a href="#cb2-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-360"><a href="#cb2-360" aria-hidden="true" tabindex="-1"></a><span class="in">  function inverseInverseScaleX(value) {</span></span>
<span id="cb2-361"><a href="#cb2-361" aria-hidden="true" tabindex="-1"></a><span class="in">    // Constants from the original scale</span></span>
<span id="cb2-362"><a href="#cb2-362" aria-hidden="true" tabindex="-1"></a><span class="in">    const domainMin = 0;</span></span>
<span id="cb2-363"><a href="#cb2-363" aria-hidden="true" tabindex="-1"></a><span class="in">    const domainMax = 1;</span></span>
<span id="cb2-364"><a href="#cb2-364" aria-hidden="true" tabindex="-1"></a><span class="in">    const rangeMin = options.size - options.margin.right;</span></span>
<span id="cb2-365"><a href="#cb2-365" aria-hidden="true" tabindex="-1"></a><span class="in">    const rangeMax = options.margin.left;</span></span>
<span id="cb2-366"><a href="#cb2-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-367"><a href="#cb2-367" aria-hidden="true" tabindex="-1"></a><span class="in">    // Calculate the proportion of the input value within the range</span></span>
<span id="cb2-368"><a href="#cb2-368" aria-hidden="true" tabindex="-1"></a><span class="in">    const proportion = (rangeMax - rangeMin);</span></span>
<span id="cb2-369"><a href="#cb2-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-370"><a href="#cb2-370" aria-hidden="true" tabindex="-1"></a><span class="in">    // Apply the proportion to the domain</span></span>
<span id="cb2-371"><a href="#cb2-371" aria-hidden="true" tabindex="-1"></a><span class="in">    return rangeMax - proportion * value ;</span></span>
<span id="cb2-372"><a href="#cb2-372" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb2-373"><a href="#cb2-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-374"><a href="#cb2-374" aria-hidden="true" tabindex="-1"></a><span class="in">  function inverseScaleY(value) {</span></span>
<span id="cb2-375"><a href="#cb2-375" aria-hidden="true" tabindex="-1"></a><span class="in">    // Constants from the original scale</span></span>
<span id="cb2-376"><a href="#cb2-376" aria-hidden="true" tabindex="-1"></a><span class="in">    const domainMin = 0;</span></span>
<span id="cb2-377"><a href="#cb2-377" aria-hidden="true" tabindex="-1"></a><span class="in">    const domainMax = 1;</span></span>
<span id="cb2-378"><a href="#cb2-378" aria-hidden="true" tabindex="-1"></a><span class="in">    const rangeMin = options.size - options.margin.bottom;</span></span>
<span id="cb2-379"><a href="#cb2-379" aria-hidden="true" tabindex="-1"></a><span class="in">    const rangeMax = options.margin.top;</span></span>
<span id="cb2-380"><a href="#cb2-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-381"><a href="#cb2-381" aria-hidden="true" tabindex="-1"></a><span class="in">    // Calculate the proportion of the input value within the range</span></span>
<span id="cb2-382"><a href="#cb2-382" aria-hidden="true" tabindex="-1"></a><span class="in">    const proportion = (value - rangeMin) / (rangeMax - rangeMin);</span></span>
<span id="cb2-383"><a href="#cb2-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-384"><a href="#cb2-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-385"><a href="#cb2-385" aria-hidden="true" tabindex="-1"></a><span class="in">    // Apply the proportion to the domain</span></span>
<span id="cb2-386"><a href="#cb2-386" aria-hidden="true" tabindex="-1"></a><span class="in">    return proportion * (domainMax - domainMin) + domainMin;</span></span>
<span id="cb2-387"><a href="#cb2-387" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb2-388"><a href="#cb2-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-389"><a href="#cb2-389" aria-hidden="true" tabindex="-1"></a><span class="in">  function inverseInverseScaleY(value) {</span></span>
<span id="cb2-390"><a href="#cb2-390" aria-hidden="true" tabindex="-1"></a><span class="in">    // Constants from the original scale</span></span>
<span id="cb2-391"><a href="#cb2-391" aria-hidden="true" tabindex="-1"></a><span class="in">    const domainMin = 0;</span></span>
<span id="cb2-392"><a href="#cb2-392" aria-hidden="true" tabindex="-1"></a><span class="in">    const domainMax = 1;</span></span>
<span id="cb2-393"><a href="#cb2-393" aria-hidden="true" tabindex="-1"></a><span class="in">    const rangeMin = options.size - options.margin.bottom;</span></span>
<span id="cb2-394"><a href="#cb2-394" aria-hidden="true" tabindex="-1"></a><span class="in">    const rangeMax = options.margin.top;</span></span>
<span id="cb2-395"><a href="#cb2-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-396"><a href="#cb2-396" aria-hidden="true" tabindex="-1"></a><span class="in">    // Calculate the proportion of the input value within the range</span></span>
<span id="cb2-397"><a href="#cb2-397" aria-hidden="true" tabindex="-1"></a><span class="in">    const proportion = (rangeMax - rangeMin);</span></span>
<span id="cb2-398"><a href="#cb2-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-399"><a href="#cb2-399" aria-hidden="true" tabindex="-1"></a><span class="in">    // Apply the proportion to the domain</span></span>
<span id="cb2-400"><a href="#cb2-400" aria-hidden="true" tabindex="-1"></a><span class="in">    return proportion * value + rangeMin;</span></span>
<span id="cb2-401"><a href="#cb2-401" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb2-402"><a href="#cb2-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-403"><a href="#cb2-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-404"><a href="#cb2-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-405"><a href="#cb2-405" aria-hidden="true" tabindex="-1"></a><span class="in">  const axisBottom = g =&gt; g.call(d3.axisBottom(x).ticks(4))</span></span>
<span id="cb2-406"><a href="#cb2-406" aria-hidden="true" tabindex="-1"></a><span class="in">  const axisTop = g =&gt; g.call(d3.axisTop(x).ticks(4));</span></span>
<span id="cb2-407"><a href="#cb2-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-408"><a href="#cb2-408" aria-hidden="true" tabindex="-1"></a><span class="in">  const hexagonSize = ((x(1 / (2 * resolution)) - x(0))) / Math.cos(Math.PI / 6) + 1;</span></span>
<span id="cb2-409"><a href="#cb2-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-410"><a href="#cb2-410" aria-hidden="true" tabindex="-1"></a><span class="in">  const corners = [{ x: 0.5, y: Math.sqrt(3)/2 }, { x: 0, y: 0 }, {x: 1, y: 0 }];</span></span>
<span id="cb2-411"><a href="#cb2-411" aria-hidden="true" tabindex="-1"></a><span class="in">  const corners_expanded = [{ x: 0.5, y: Math.sqrt(3)/2 + 0.1 }, { x: -0.1, y: -0.05 }, {x: 1.1, y: -0.05 }];</span></span>
<span id="cb2-412"><a href="#cb2-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-413"><a href="#cb2-413" aria-hidden="true" tabindex="-1"></a><span class="in">  const line = d3.line().x(d =&gt; x(d.x)).y(d =&gt; y(d.y));</span></span>
<span id="cb2-414"><a href="#cb2-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-415"><a href="#cb2-415" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.append('defs')</span></span>
<span id="cb2-416"><a href="#cb2-416" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('clipPath')</span></span>
<span id="cb2-417"><a href="#cb2-417" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('id', 'triangle')</span></span>
<span id="cb2-418"><a href="#cb2-418" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('path')</span></span>
<span id="cb2-419"><a href="#cb2-419" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('x', options.size / 2)</span></span>
<span id="cb2-420"><a href="#cb2-420" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', options.size / 2)</span></span>
<span id="cb2-421"><a href="#cb2-421" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('d', line(corners))</span></span>
<span id="cb2-422"><a href="#cb2-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-423"><a href="#cb2-423" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.selectAll('.border')</span></span>
<span id="cb2-424"><a href="#cb2-424" aria-hidden="true" tabindex="-1"></a><span class="in">    .data([[corners[0], corners[1]],</span></span>
<span id="cb2-425"><a href="#cb2-425" aria-hidden="true" tabindex="-1"></a><span class="in">           [corners[1], corners[2]],</span></span>
<span id="cb2-426"><a href="#cb2-426" aria-hidden="true" tabindex="-1"></a><span class="in">           [corners[2], corners[0]]])</span></span>
<span id="cb2-427"><a href="#cb2-427" aria-hidden="true" tabindex="-1"></a><span class="in">    .enter()</span></span>
<span id="cb2-428"><a href="#cb2-428" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('line')</span></span>
<span id="cb2-429"><a href="#cb2-429" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('x1', (d) =&gt; x(d[0].x))</span></span>
<span id="cb2-430"><a href="#cb2-430" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('x2', (d) =&gt; x(d[1].x))</span></span>
<span id="cb2-431"><a href="#cb2-431" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y1', (d) =&gt; y(d[0].y))</span></span>
<span id="cb2-432"><a href="#cb2-432" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y2', (d) =&gt; y(d[1].y))</span></span>
<span id="cb2-433"><a href="#cb2-433" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'border')</span></span>
<span id="cb2-434"><a href="#cb2-434" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('stroke', 'black');</span></span>
<span id="cb2-435"><a href="#cb2-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-436"><a href="#cb2-436" aria-hidden="true" tabindex="-1"></a><span class="in">  const hexbin = d3.hexbin();</span></span>
<span id="cb2-437"><a href="#cb2-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-438"><a href="#cb2-438" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.append('g')</span></span>
<span id="cb2-439"><a href="#cb2-439" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('clip-path', 'url(#triangle)')</span></span>
<span id="cb2-440"><a href="#cb2-440" aria-hidden="true" tabindex="-1"></a><span class="in">    .selectAll(".point")</span></span>
<span id="cb2-441"><a href="#cb2-441" aria-hidden="true" tabindex="-1"></a><span class="in">    .data(density)</span></span>
<span id="cb2-442"><a href="#cb2-442" aria-hidden="true" tabindex="-1"></a><span class="in">    .join('path')</span></span>
<span id="cb2-443"><a href="#cb2-443" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('transform', d =&gt; `translate(${x(corners[0].x * d.x[0] + corners[1].x * d.x[1] + corners[2].x * d.x[2])}, ${y(corners[0].y * d.x[0] + corners[1].y * d.x[1] + corners[2].y * d.x[2])})`)</span></span>
<span id="cb2-444"><a href="#cb2-444" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('fill', d =&gt; fillScale(d.density))</span></span>
<span id="cb2-445"><a href="#cb2-445" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('d', hexbin.hexagon(hexagonSize));</span></span>
<span id="cb2-446"><a href="#cb2-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-447"><a href="#cb2-447" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.selectAll('text')</span></span>
<span id="cb2-448"><a href="#cb2-448" aria-hidden="true" tabindex="-1"></a><span class="in">    .data([[corners_expanded[0], corners_expanded[1]],</span></span>
<span id="cb2-449"><a href="#cb2-449" aria-hidden="true" tabindex="-1"></a><span class="in">           [corners_expanded[1], corners_expanded[2]],</span></span>
<span id="cb2-450"><a href="#cb2-450" aria-hidden="true" tabindex="-1"></a><span class="in">           [corners_expanded[2], corners_expanded[0]]])</span></span>
<span id="cb2-451"><a href="#cb2-451" aria-hidden="true" tabindex="-1"></a><span class="in">    .join("text")</span></span>
<span id="cb2-452"><a href="#cb2-452" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("text-anchor", "middle")</span></span>
<span id="cb2-453"><a href="#cb2-453" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("alignment-baseline", "middle")</span></span>
<span id="cb2-454"><a href="#cb2-454" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-style", "italic")</span></span>
<span id="cb2-455"><a href="#cb2-455" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", d =&gt; (x(d[0].x) + x(d[1].x)) / 2)</span></span>
<span id="cb2-456"><a href="#cb2-456" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", d =&gt; (y(d[0].y) + y(d[1].y)) / 2)</span></span>
<span id="cb2-457"><a href="#cb2-457" aria-hidden="true" tabindex="-1"></a><span class="in">    .text((d, i) =&gt; {</span></span>
<span id="cb2-458"><a href="#cb2-458" aria-hidden="true" tabindex="-1"></a><span class="in">      if(i == 0) return "x₂" ;</span></span>
<span id="cb2-459"><a href="#cb2-459" aria-hidden="true" tabindex="-1"></a><span class="in">      if(i == 1) return "x₃";</span></span>
<span id="cb2-460"><a href="#cb2-460" aria-hidden="true" tabindex="-1"></a><span class="in">      if(i == 2) return "x₁";</span></span>
<span id="cb2-461"><a href="#cb2-461" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb2-462"><a href="#cb2-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-463"><a href="#cb2-463" aria-hidden="true" tabindex="-1"></a><span class="in">    let xy = barycentricToCartesian(z, corners)</span></span>
<span id="cb2-464"><a href="#cb2-464" aria-hidden="true" tabindex="-1"></a><span class="in">    let xyr = [inverseInverseScaleX(xy[0]), inverseInverseScaleY(xy[1])];</span></span>
<span id="cb2-465"><a href="#cb2-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-466"><a href="#cb2-466" aria-hidden="true" tabindex="-1"></a><span class="in">    let xy_q = barycentricToCartesian(q, corners)</span></span>
<span id="cb2-467"><a href="#cb2-467" aria-hidden="true" tabindex="-1"></a><span class="in">    let xyr_q = [inverseInverseScaleX(xy_q[0]), inverseInverseScaleY(xy_q[1])];</span></span>
<span id="cb2-468"><a href="#cb2-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-469"><a href="#cb2-469" aria-hidden="true" tabindex="-1"></a><span class="in">    let sftmax = softmax([z1, z2, z3], q, beta)</span></span>
<span id="cb2-470"><a href="#cb2-470" aria-hidden="true" tabindex="-1"></a><span class="in">    let xy_s = barycentricToCartesian(sftmax, corners)</span></span>
<span id="cb2-471"><a href="#cb2-471" aria-hidden="true" tabindex="-1"></a><span class="in">    let xyr_s = [inverseInverseScaleX(xy_s[0]), inverseInverseScaleY(xy_s[1])];</span></span>
<span id="cb2-472"><a href="#cb2-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-473"><a href="#cb2-473" aria-hidden="true" tabindex="-1"></a><span class="in">    // If it does not exist, append a new red circle</span></span>
<span id="cb2-474"><a href="#cb2-474" aria-hidden="true" tabindex="-1"></a><span class="in">    svg.append("circle")</span></span>
<span id="cb2-475"><a href="#cb2-475" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("class", "red-circle") // Add a class for easy selection</span></span>
<span id="cb2-476"><a href="#cb2-476" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("cx", xyr_s[0])</span></span>
<span id="cb2-477"><a href="#cb2-477" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("cy", xyr_s[1])</span></span>
<span id="cb2-478"><a href="#cb2-478" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("z-index", 1000)</span></span>
<span id="cb2-479"><a href="#cb2-479" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("r", 7) // Radius of the circle</span></span>
<span id="cb2-480"><a href="#cb2-480" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("fill", "red"); // Fill color of the circle</span></span>
<span id="cb2-481"><a href="#cb2-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-482"><a href="#cb2-482" aria-hidden="true" tabindex="-1"></a><span class="in">    svg.append("circle")</span></span>
<span id="cb2-483"><a href="#cb2-483" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("class", "purple-circle") // Add a class for easy selection</span></span>
<span id="cb2-484"><a href="#cb2-484" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("cx", xyr[0])</span></span>
<span id="cb2-485"><a href="#cb2-485" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("cy", xyr[1])</span></span>
<span id="cb2-486"><a href="#cb2-486" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("z-index", 1000)</span></span>
<span id="cb2-487"><a href="#cb2-487" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("r", 7) // Radius of the circle</span></span>
<span id="cb2-488"><a href="#cb2-488" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("fill", "purple"); // Fill color of the circle</span></span>
<span id="cb2-489"><a href="#cb2-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-490"><a href="#cb2-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-491"><a href="#cb2-491" aria-hidden="true" tabindex="-1"></a><span class="in">    svg.append("circle")</span></span>
<span id="cb2-492"><a href="#cb2-492" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("class", "black-circle") // Add a class for easy selection</span></span>
<span id="cb2-493"><a href="#cb2-493" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("cx", xyr_q[0])</span></span>
<span id="cb2-494"><a href="#cb2-494" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("cy", xyr_q[1])</span></span>
<span id="cb2-495"><a href="#cb2-495" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("z-index", 1000)</span></span>
<span id="cb2-496"><a href="#cb2-496" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("r", 7) // Radius of the circle</span></span>
<span id="cb2-497"><a href="#cb2-497" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("fill", "black"); // Fill color of the circle</span></span>
<span id="cb2-498"><a href="#cb2-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-499"><a href="#cb2-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-500"><a href="#cb2-500" aria-hidden="true" tabindex="-1"></a><span class="in">    // Append text for the coordinates</span></span>
<span id="cb2-501"><a href="#cb2-501" aria-hidden="true" tabindex="-1"></a><span class="in">    svg.append("text")</span></span>
<span id="cb2-502"><a href="#cb2-502" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("class", "coord-text") // Add a class for easy selection</span></span>
<span id="cb2-503"><a href="#cb2-503" aria-hidden="true" tabindex="-1"></a><span class="in">      // .attr("x", xyr[0] + 10) // Position the text right next to the circle</span></span>
<span id="cb2-504"><a href="#cb2-504" aria-hidden="true" tabindex="-1"></a><span class="in">      // .attr("y", xyr[1])</span></span>
<span id="cb2-505"><a href="#cb2-505" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x", 300) // Position the text right next to the circle</span></span>
<span id="cb2-506"><a href="#cb2-506" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("y", 80)</span></span>
<span id="cb2-507"><a href="#cb2-507" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("fill", "black") // Text color</span></span>
<span id="cb2-508"><a href="#cb2-508" aria-hidden="true" tabindex="-1"></a><span class="in">      .style("font-size", "10px")</span></span>
<span id="cb2-509"><a href="#cb2-509" aria-hidden="true" tabindex="-1"></a><span class="in">      .text(`q=(${q[0].toFixed(2)}, ${q[1].toFixed(2)}, ${q[2].toFixed(2)})`); // Display coordinates</span></span>
<span id="cb2-510"><a href="#cb2-510" aria-hidden="true" tabindex="-1"></a><span class="in">    // Append color legend for purple-circle and red-circle:</span></span>
<span id="cb2-511"><a href="#cb2-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-512"><a href="#cb2-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-513"><a href="#cb2-513" aria-hidden="true" tabindex="-1"></a><span class="in">    // Append text for the coordinates</span></span>
<span id="cb2-514"><a href="#cb2-514" aria-hidden="true" tabindex="-1"></a><span class="in">    svg.append("text")</span></span>
<span id="cb2-515"><a href="#cb2-515" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("class", "coord-text") // Add a class for easy selection</span></span>
<span id="cb2-516"><a href="#cb2-516" aria-hidden="true" tabindex="-1"></a><span class="in">      // .attr("x", xyr[0] + 10) // Position the text right next to the circle</span></span>
<span id="cb2-517"><a href="#cb2-517" aria-hidden="true" tabindex="-1"></a><span class="in">      // .attr("y", xyr[1])</span></span>
<span id="cb2-518"><a href="#cb2-518" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x", 300) // Position the text right next to the circle</span></span>
<span id="cb2-519"><a href="#cb2-519" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("y", 100)</span></span>
<span id="cb2-520"><a href="#cb2-520" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("fill", "red") // Text color</span></span>
<span id="cb2-521"><a href="#cb2-521" aria-hidden="true" tabindex="-1"></a><span class="in">      .style("font-size", "10px")</span></span>
<span id="cb2-522"><a href="#cb2-522" aria-hidden="true" tabindex="-1"></a><span class="in">      .text(`σ_{q,β}=(${sftmax[0].toFixed(2)}, ${sftmax[1].toFixed(2)}, ${sftmax[2].toFixed(2)})`); // Display coordinates</span></span>
<span id="cb2-523"><a href="#cb2-523" aria-hidden="true" tabindex="-1"></a><span class="in">    // Append color legend for purple-circle and red-circle:</span></span>
<span id="cb2-524"><a href="#cb2-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-525"><a href="#cb2-525" aria-hidden="true" tabindex="-1"></a><span class="in">    svg.append("text")</span></span>
<span id="cb2-526"><a href="#cb2-526" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("class", "coord-text") // Add a class for easy selection</span></span>
<span id="cb2-527"><a href="#cb2-527" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x", 300) // Position the text right next to the circle</span></span>
<span id="cb2-528"><a href="#cb2-528" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("y", 120)</span></span>
<span id="cb2-529"><a href="#cb2-529" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("fill", "purple") // Text color</span></span>
<span id="cb2-530"><a href="#cb2-530" aria-hidden="true" tabindex="-1"></a><span class="in">      .style("font-size", "10px")</span></span>
<span id="cb2-531"><a href="#cb2-531" aria-hidden="true" tabindex="-1"></a><span class="in">      .text(`z=(${z1.toFixed(2)}, ${z2.toFixed(2)}, ${z3.toFixed(2)})`); // Display coordinates</span></span>
<span id="cb2-532"><a href="#cb2-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-533"><a href="#cb2-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-534"><a href="#cb2-534" aria-hidden="true" tabindex="-1"></a><span class="in">  const removeLine = g =&gt; g.select(".domain").remove();</span></span>
<span id="cb2-535"><a href="#cb2-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-536"><a href="#cb2-536" aria-hidden="true" tabindex="-1"></a><span class="in">function set(input, value) {</span></span>
<span id="cb2-537"><a href="#cb2-537" aria-hidden="true" tabindex="-1"></a><span class="in">  input.value = value;</span></span>
<span id="cb2-538"><a href="#cb2-538" aria-hidden="true" tabindex="-1"></a><span class="in">  input.dispatchEvent(new Event("input", {bubbles: true}));</span></span>
<span id="cb2-539"><a href="#cb2-539" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb2-540"><a href="#cb2-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-541"><a href="#cb2-541" aria-hidden="true" tabindex="-1"></a><span class="in">// Attach a click event listener to the SVG</span></span>
<span id="cb2-542"><a href="#cb2-542" aria-hidden="true" tabindex="-1"></a><span class="in">svg.on("click", function(event) {</span></span>
<span id="cb2-543"><a href="#cb2-543" aria-hidden="true" tabindex="-1"></a><span class="in">  // Extract the click coordinates</span></span>
<span id="cb2-544"><a href="#cb2-544" aria-hidden="true" tabindex="-1"></a><span class="in">  const [clickX, clickY] = d3.pointer(event);</span></span>
<span id="cb2-545"><a href="#cb2-545" aria-hidden="true" tabindex="-1"></a><span class="in">  lbd = cartesianToBarycentric(inverseScaleX(clickX), inverseScaleY(clickY), corners);</span></span>
<span id="cb2-546"><a href="#cb2-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-547"><a href="#cb2-547" aria-hidden="true" tabindex="-1"></a><span class="in">  set(viewof z1, lbd[2]);</span></span>
<span id="cb2-548"><a href="#cb2-548" aria-hidden="true" tabindex="-1"></a><span class="in">  set(viewof z2, lbd[1]);</span></span>
<span id="cb2-549"><a href="#cb2-549" aria-hidden="true" tabindex="-1"></a><span class="in">  set(viewof z3, lbd[0]);</span></span>
<span id="cb2-550"><a href="#cb2-550" aria-hidden="true" tabindex="-1"></a><span class="in">});</span></span>
<span id="cb2-551"><a href="#cb2-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-552"><a href="#cb2-552" aria-hidden="true" tabindex="-1"></a><span class="in"> // display axis values</span></span>
<span id="cb2-553"><a href="#cb2-553" aria-hidden="true" tabindex="-1"></a><span class="in">svg.append("g")</span></span>
<span id="cb2-554"><a href="#cb2-554" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("transform", `translate(0, ${options.size - options.margin.bottom})`)</span></span>
<span id="cb2-555"><a href="#cb2-555" aria-hidden="true" tabindex="-1"></a><span class="in">    .call(axisBottom)</span></span>
<span id="cb2-556"><a href="#cb2-556" aria-hidden="true" tabindex="-1"></a><span class="in">    .call(removeLine)</span></span>
<span id="cb2-557"><a href="#cb2-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-558"><a href="#cb2-558" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.append("g")</span></span>
<span id="cb2-559"><a href="#cb2-559" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("transform", `translate(${x(1) + options.margin.right / 2 }, ${y(0) + 26}) rotate(-120)`)</span></span>
<span id="cb2-560"><a href="#cb2-560" aria-hidden="true" tabindex="-1"></a><span class="in">    .call(axisBottom)</span></span>
<span id="cb2-561"><a href="#cb2-561" aria-hidden="true" tabindex="-1"></a><span class="in">    .call(removeLine)</span></span>
<span id="cb2-562"><a href="#cb2-562" aria-hidden="true" tabindex="-1"></a><span class="in">    .call(g =&gt; g.selectAll("text").attr("transform", "translate(11, 22) rotate(120)"));</span></span>
<span id="cb2-563"><a href="#cb2-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-564"><a href="#cb2-564" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.append("g")</span></span>
<span id="cb2-565"><a href="#cb2-565" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("transform", `translate(${x(0.5) + options.margin.left / 2}, ${y(Math.sqrt(3) / 2) - 26}) rotate(120)`)</span></span>
<span id="cb2-566"><a href="#cb2-566" aria-hidden="true" tabindex="-1"></a><span class="in">    .call(axisBottom)</span></span>
<span id="cb2-567"><a href="#cb2-567" aria-hidden="true" tabindex="-1"></a><span class="in">    .call(removeLine)</span></span>
<span id="cb2-568"><a href="#cb2-568" aria-hidden="true" tabindex="-1"></a><span class="in">    .call(g =&gt; g.selectAll("text").attr("transform", "translate(-11, 22) rotate(-120)"));</span></span>
<span id="cb2-569"><a href="#cb2-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-570"><a href="#cb2-570" aria-hidden="true" tabindex="-1"></a><span class="in">  return svg.node();</span></span>
<span id="cb2-571"><a href="#cb2-571" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb2-572"><a href="#cb2-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-573"><a href="#cb2-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-574"><a href="#cb2-574" aria-hidden="true" tabindex="-1"></a><span class="in">levelLogsumexp = {</span></span>
<span id="cb2-575"><a href="#cb2-575" aria-hidden="true" tabindex="-1"></a><span class="in">  const density = [];</span></span>
<span id="cb2-576"><a href="#cb2-576" aria-hidden="true" tabindex="-1"></a><span class="in">  for(let i = 1; i &lt; densityResolution; i++) {</span></span>
<span id="cb2-577"><a href="#cb2-577" aria-hidden="true" tabindex="-1"></a><span class="in">    for(let j = 1; j &lt; densityResolution - i; j++) {</span></span>
<span id="cb2-578"><a href="#cb2-578" aria-hidden="true" tabindex="-1"></a><span class="in">      const x1 = i / densityResolution ;</span></span>
<span id="cb2-579"><a href="#cb2-579" aria-hidden="true" tabindex="-1"></a><span class="in">      const x2 = j / densityResolution;</span></span>
<span id="cb2-580"><a href="#cb2-580" aria-hidden="true" tabindex="-1"></a><span class="in">      const x3 = Math.max(0, 1 - x1 - x2);</span></span>
<span id="cb2-581"><a href="#cb2-581" aria-hidden="true" tabindex="-1"></a><span class="in">      const x = [ x1, x2, x3 ];</span></span>
<span id="cb2-582"><a href="#cb2-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-583"><a href="#cb2-583" aria-hidden="true" tabindex="-1"></a><span class="in">      density.push({ x, density: logsumexp(x, q, beta) });</span></span>
<span id="cb2-584"><a href="#cb2-584" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb2-585"><a href="#cb2-585" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb2-586"><a href="#cb2-586" aria-hidden="true" tabindex="-1"></a><span class="in">  return density;</span></span>
<span id="cb2-587"><a href="#cb2-587" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb2-588"><a href="#cb2-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-589"><a href="#cb2-589" aria-hidden="true" tabindex="-1"></a><span class="in">levelKL = {</span></span>
<span id="cb2-590"><a href="#cb2-590" aria-hidden="true" tabindex="-1"></a><span class="in">  const density = [];</span></span>
<span id="cb2-591"><a href="#cb2-591" aria-hidden="true" tabindex="-1"></a><span class="in">  for(let i = 1; i &lt; densityResolution; i++) {</span></span>
<span id="cb2-592"><a href="#cb2-592" aria-hidden="true" tabindex="-1"></a><span class="in">    for(let j = 1; j &lt; densityResolution - i; j++) {</span></span>
<span id="cb2-593"><a href="#cb2-593" aria-hidden="true" tabindex="-1"></a><span class="in">      const x1 = i / densityResolution ;</span></span>
<span id="cb2-594"><a href="#cb2-594" aria-hidden="true" tabindex="-1"></a><span class="in">      const x2 = j / densityResolution;</span></span>
<span id="cb2-595"><a href="#cb2-595" aria-hidden="true" tabindex="-1"></a><span class="in">      const x3 = Math.max(0, 1 - x1 - x2);</span></span>
<span id="cb2-596"><a href="#cb2-596" aria-hidden="true" tabindex="-1"></a><span class="in">      const x = [ x1, x2, x3 ];</span></span>
<span id="cb2-597"><a href="#cb2-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-598"><a href="#cb2-598" aria-hidden="true" tabindex="-1"></a><span class="in">      // density.push({ x, density: logsumexp(x, q, beta) / Math.log(Math.max(q[0],q[1], q[2]) * Math.exp(1/beta)) });</span></span>
<span id="cb2-599"><a href="#cb2-599" aria-hidden="true" tabindex="-1"></a><span class="in">      density.push({ x, density: kull_leibler(x, q, beta) });</span></span>
<span id="cb2-600"><a href="#cb2-600" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb2-601"><a href="#cb2-601" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb2-602"><a href="#cb2-602" aria-hidden="true" tabindex="-1"></a><span class="in">  return density;</span></span>
<span id="cb2-603"><a href="#cb2-603" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb2-604"><a href="#cb2-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-605"><a href="#cb2-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-606"><a href="#cb2-606" aria-hidden="true" tabindex="-1"></a><span class="in">levelKL_full = {</span></span>
<span id="cb2-607"><a href="#cb2-607" aria-hidden="true" tabindex="-1"></a><span class="in">  const density = [];</span></span>
<span id="cb2-608"><a href="#cb2-608" aria-hidden="true" tabindex="-1"></a><span class="in">  for(let i = 1; i &lt; densityResolution; i++) {</span></span>
<span id="cb2-609"><a href="#cb2-609" aria-hidden="true" tabindex="-1"></a><span class="in">    for(let j = 1; j &lt; densityResolution - i; j++) {</span></span>
<span id="cb2-610"><a href="#cb2-610" aria-hidden="true" tabindex="-1"></a><span class="in">      const x1 = i / densityResolution ;</span></span>
<span id="cb2-611"><a href="#cb2-611" aria-hidden="true" tabindex="-1"></a><span class="in">      const x2 = j / densityResolution;</span></span>
<span id="cb2-612"><a href="#cb2-612" aria-hidden="true" tabindex="-1"></a><span class="in">      const x3 = Math.max(0, 1 - x1 - x2);</span></span>
<span id="cb2-613"><a href="#cb2-613" aria-hidden="true" tabindex="-1"></a><span class="in">      const x = [ x1, x2, x3 ];</span></span>
<span id="cb2-614"><a href="#cb2-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-615"><a href="#cb2-615" aria-hidden="true" tabindex="-1"></a><span class="in">      // density.push({ x, density: logsumexp(x, q, beta) / Math.log(Math.max(q[0],q[1], q[2]) * Math.exp(1/beta)) });</span></span>
<span id="cb2-616"><a href="#cb2-616" aria-hidden="true" tabindex="-1"></a><span class="in">      density.push({ x, density: objective(x, z, q, beta) });</span></span>
<span id="cb2-617"><a href="#cb2-617" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb2-618"><a href="#cb2-618" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb2-619"><a href="#cb2-619" aria-hidden="true" tabindex="-1"></a><span class="in">  return density;</span></span>
<span id="cb2-620"><a href="#cb2-620" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb2-621"><a href="#cb2-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-622"><a href="#cb2-622" aria-hidden="true" tabindex="-1"></a><span class="in">ternaryDensity(levelKL_full, densityResolution, { size: 500, colorScheme: d3.interpolateBlues})</span></span>
<span id="cb2-623"><a href="#cb2-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-624"><a href="#cb2-624" aria-hidden="true" tabindex="-1"></a><span class="in">logsumexpColorScale = legend({color: d3.scaleSequential(d3.extent([0,  logsumexp(z, q, beta)]), d3.interpolateBlues), title: "Intensity"})</span></span>
<span id="cb2-625"><a href="#cb2-625" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-626"><a href="#cb2-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-627"><a href="#cb2-627" aria-hidden="true" tabindex="-1"></a><span class="fu">##  {{&lt; fa handshake title="handshakes" &gt;}} Credit </span></span>
<span id="cb2-628"><a href="#cb2-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-629"><a href="#cb2-629" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The observable code was made with the help of <span class="co">[</span><span class="ot">François-David Collin</span><span class="co">](https://github.com/fradav)</span></span>
<span id="cb2-630"><a href="#cb2-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-631"><a href="#cb2-631" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The plot is freely inspired from <span class="co">[</span><span class="ot">Herb Susmann</span><span class="co">](http://herbsusmann.com/)</span>'s code on <span class="co">[</span><span class="ot">Dirichlet Distribution</span><span class="co">](https://observablehq.com/@herbps10/dirichlet-distribution)</span></span>
<span id="cb2-632"><a href="#cb2-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-633"><a href="#cb2-633" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The terminology is inspired by posts from Gabriel Peyré: <span class="co">[</span><span class="ot">https://x.com/gabrielpeyre/status/1830470713041354968</span><span class="co">](https://x.com/gabrielpeyre/status/1830470713041354968)</span>,</span>
<span id="cb2-634"><a href="#cb2-634" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">https://x.com/gabrielpeyre/status/1680804520862056448</span><span class="co">](https://x.com/gabrielpeyre/status/1680804520862056448)</span></span>
<span id="cb2-635"><a href="#cb2-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-636"><a href="#cb2-636" aria-hidden="true" tabindex="-1"></a><span class="fu">## {{&lt; fa link title="link" &gt;}} References</span></span>
<span id="cb2-637"><a href="#cb2-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-638"><a href="#cb2-638" aria-hidden="true" tabindex="-1"></a>::: {#refs}</span>
<span id="cb2-639"><a href="#cb2-639" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><span class="faux-block"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> 2024 Joseph Salmon</span> <span class="faux-block"><a href="https://github.com/josephsalmon/MyWebsite"><i class="fa-brands fa-github" aria-label="github"></i> Source Code</a></span></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p><span class="faux-block"> Designed with <i class="fa-solid fa-heart" aria-label="heart"></i></span> <span class="faux-block"> Built with <a href="https://quarto.org/">Quarto</a></span></p>
</div>
  </div>
</footer>




</body></html>