<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joseph Salmon">
<meta name="dcterms.date" content="2024-11-10">
<meta name="description" content="Iso, Iso, Iso … Tonic! Or how to fit a non-decreasing signal.">

<title>Isotonic regression – Joseph Salmon</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../..//img/Flag_of_Occitania.svg" rel="icon" type="image/svg+xml">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-25d362aa3afec45ecf1ae134bfa15e67.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-7b78b88afbcb31605f781eb1d5bd0002.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../../site_libs/quarto-contrib/pseudocode-2.4.1/pseudocode.min.js"></script>
<link href="../../site_libs/quarto-contrib/pseudocode-2.4.1/pseudocode.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(../../img/bg_pine_trees.jpg);
background-size: cover;
      }
</style>
<meta name="author" content="Joseph Salmon">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script type="text/javascript">
window.PlotlyConfig = {MathJaxConfig: 'local'};
if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
if (typeof require !== 'undefined') {
require.undef("plotly");
requirejs.config({
    paths: {
        'plotly': ['https://cdn.plot.ly/plotly-2.35.2.min']
    }
});
require(['plotly'], function(Plotly) {
    window._Plotly = Plotly;
});
}
</script>


  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../img/Flag_of_Occitania.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Joseph Salmon</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../Courses/index.html"> 
<span class="menu-text">Courses</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications/index.html"> 
<span class="menu-text">Articles</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../talks/index.html"> 
<span class="menu-text">Talks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../team/index.html"> 
<span class="menu-text">Team</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../code_new/index.html"> 
<span class="menu-text">Code</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../misc/index.html"> 
<span class="menu-text">Misc</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="../../blog/index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/josephsalmon"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://sigmoid.social/@josephsalmon" rel="me"> <i class="bi bi-mastodon" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/joseph-salmon-6134262a6/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:joseph.salmon@inria.fr"> <i class="bi bi-envelope" role="img" aria-label="email">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default blog-post page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Isotonic regression</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
                  <div>
        <div class="description">
          Iso, Iso, Iso … Tonic! Or how to fit a non-decreasing signal.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Quadratic programming</div>
                <div class="quarto-category">Calibration</div>
                <div class="quarto-category">PAVA</div>
                <div class="quarto-category">Optimization</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Joseph Salmon </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 10, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#introduction-formulation" id="toc-introduction-formulation" class="nav-link active" data-scroll-target="#introduction-formulation">Introduction &amp; formulation</a>
  <ul class="collapse">
  <li><a href="#visualization" id="toc-visualization" class="nav-link" data-scroll-target="#visualization">Visualization</a></li>
  <li><a href="#applications" id="toc-applications" class="nav-link" data-scroll-target="#applications">Applications</a></li>
  </ul></li>
  <li><a href="#optimization-duality-etc." id="toc-optimization-duality-etc." class="nav-link" data-scroll-target="#optimization-duality-etc.">Optimization, duality, etc.</a>
  <ul class="collapse">
  <li><a href="#notation" id="toc-notation" class="nav-link" data-scroll-target="#notation">Notation</a></li>
  <li><a href="#conic-duality-fenchel-transform" id="toc-conic-duality-fenchel-transform" class="nav-link" data-scroll-target="#conic-duality-fenchel-transform">Conic duality / Fenchel transform</a></li>
  <li><a href="#dual-problem" id="toc-dual-problem" class="nav-link" data-scroll-target="#dual-problem">Dual problem</a></li>
  <li><a href="#karush-kuhn-tucker-kkt-conditions" id="toc-karush-kuhn-tucker-kkt-conditions" class="nav-link" data-scroll-target="#karush-kuhn-tucker-kkt-conditions">Karush-Kuhn-Tucker (KKT) conditions</a></li>
  </ul></li>
  <li><a href="#algorithm" id="toc-algorithm" class="nav-link" data-scroll-target="#algorithm">Algorithm</a>
  <ul class="collapse">
  <li><a href="#pseudo-code-and-python-implementation" id="toc-pseudo-code-and-python-implementation" class="nav-link" data-scroll-target="#pseudo-code-and-python-implementation">Pseudo-code and Python implementation</a></li>
  <li><a href="#convergence" id="toc-convergence" class="nav-link" data-scroll-target="#convergence">Convergence</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><i class="fa-solid fa-link" title="link" aria-label="link"></i> References</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">
<div class="no-row-height column-margin column-container">
  <div class="">
    <img src="isotonic.png" style="width:100%">
  </div>
</div>





<div class="hidden">
{{
<p>% thin space, limits underneath in displays % thin space, limits underneath in displays }}</p>
</div>
<p><strong><u>Note</u></strong>: This blog is mainly inspired by the post by <span class="citation" data-cites="Pedregosa13">Pedregosa (<a href="#ref-Pedregosa13" role="doc-biblioref">2013</a>)</span> on Isotonic regression, a version of the PAVA algorithm provided by <span class="citation" data-cites="Best_Chakravarti90">Best and Chakravarti (<a href="#ref-Best_Chakravarti90" role="doc-biblioref">1990</a>)</span>.</p>
<section id="introduction-formulation" class="level1">
<h1>Introduction &amp; formulation</h1>
<p>Isotonic regression is a technique used to fit a non-decreasing function to a set of data points. We can think of isotonic regression as a generalization of linear regression where the function is constrained to be non-decreasing.</p>
<p>More formally suppose that one collects <span class="math inline">n</span> sample points <span class="math inline">y_1,\dots, y_n</span> and has weights <span class="math inline">w_1, \dots, w_n</span> associated with each data point.</p>
<p><strong><u>Note</u></strong>: when no a priori weights are given, we can set <span class="math inline">w_i = 1</span> for all <span class="math inline">i \in \llbracket 1, n \rrbracket</span>.</p>
<p>Then, the isotonic regression problem can be formulated as follows: <span id="eq-isotonic"><span class="math display">
\begin{align}
\min_{x \in \mathbb{R}^n}
\frac{1}{2}
&amp; \sum_{i=1}^{n} w_i (x_i - y_i)^2 \\
\text{s.t.} &amp; \quad x_1 \leq x_2 \leq \ldots \leq x_n \nonumber
\end{align}
\tag{1}</span></span></p>
<section id="visualization" class="level2">
<h2 class="anchored" data-anchor-id="visualization">Visualization</h2>
<p>Below you’ll find a visualization, on a synthetic dataset, of the most common algorithm, the Pools Adjacent Violators Algorithm (PAVA) to solve isotonic regression algorithm. The top plot shows the evolution of the PAVA algorithm, while the bottom plot shows the primal and dual objectives until convergence. Note that the essence of the algorithm is simple: it Pools Adjacent Violators, <em>i.e.,</em> it replaces adjacent points that are not in increasing order by averaging.</p>
<div id="43e82f11" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display">
<div>                            <div id="45cfed23-852a-4c66-866b-cdd43b464ad1" class="plotly-graph-div" style="height:600px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("45cfed23-852a-4c66-866b-cdd43b464ad1")) {                    Plotly.newPlot(                        "45cfed23-852a-4c66-866b-cdd43b464ad1",                        [{"legendgroup":"1","marker":{"color":"black","opacity":1,"size":10},"mode":"markers","name":"Raw data","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter","xaxis":"x","yaxis":"y"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","name":"PAVA iterations","showlegend":true,"x":[0],"y":[-3.0],"type":"scatter","xaxis":"x","yaxis":"y"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","name":"Duals","showlegend":true,"x":[0],"y":[0],"type":"scatter","xaxis":"x2","yaxis":"y2"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","name":"Primals","showlegend":true,"x":[0],"y":[19218.89901471994],"type":"scatter","xaxis":"x2","yaxis":"y2"}],                        {"template":{"data":{"barpolar":[{"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"bar":[{"error_x":{"color":"rgb(36,36,36)"},"error_y":{"color":"rgb(36,36,36)"},"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"carpet":[{"aaxis":{"endlinecolor":"rgb(36,36,36)","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"rgb(36,36,36)"},"baxis":{"endlinecolor":"rgb(36,36,36)","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"rgb(36,36,36)"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":1,"tickcolor":"rgb(36,36,36)","ticks":"outside"},"type":"choropleth"}],"contourcarpet":[{"colorbar":{"outlinewidth":1,"tickcolor":"rgb(36,36,36)","ticks":"outside"},"type":"contourcarpet"}],"contour":[{"colorbar":{"outlinewidth":1,"tickcolor":"rgb(36,36,36)","ticks":"outside"},"colorscale":[[0.0,"#440154"],[0.1111111111111111,"#482878"],[0.2222222222222222,"#3e4989"],[0.3333333333333333,"#31688e"],[0.4444444444444444,"#26828e"],[0.5555555555555556,"#1f9e89"],[0.6666666666666666,"#35b779"],[0.7777777777777778,"#6ece58"],[0.8888888888888888,"#b5de2b"],[1.0,"#fde725"]],"type":"contour"}],"heatmapgl":[{"colorbar":{"outlinewidth":1,"tickcolor":"rgb(36,36,36)","ticks":"outside"},"colorscale":[[0.0,"#440154"],[0.1111111111111111,"#482878"],[0.2222222222222222,"#3e4989"],[0.3333333333333333,"#31688e"],[0.4444444444444444,"#26828e"],[0.5555555555555556,"#1f9e89"],[0.6666666666666666,"#35b779"],[0.7777777777777778,"#6ece58"],[0.8888888888888888,"#b5de2b"],[1.0,"#fde725"]],"type":"heatmapgl"}],"heatmap":[{"colorbar":{"outlinewidth":1,"tickcolor":"rgb(36,36,36)","ticks":"outside"},"colorscale":[[0.0,"#440154"],[0.1111111111111111,"#482878"],[0.2222222222222222,"#3e4989"],[0.3333333333333333,"#31688e"],[0.4444444444444444,"#26828e"],[0.5555555555555556,"#1f9e89"],[0.6666666666666666,"#35b779"],[0.7777777777777778,"#6ece58"],[0.8888888888888888,"#b5de2b"],[1.0,"#fde725"]],"type":"heatmap"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":1,"tickcolor":"rgb(36,36,36)","ticks":"outside"},"colorscale":[[0.0,"#440154"],[0.1111111111111111,"#482878"],[0.2222222222222222,"#3e4989"],[0.3333333333333333,"#31688e"],[0.4444444444444444,"#26828e"],[0.5555555555555556,"#1f9e89"],[0.6666666666666666,"#35b779"],[0.7777777777777778,"#6ece58"],[0.8888888888888888,"#b5de2b"],[1.0,"#fde725"]],"type":"histogram2dcontour"}],"histogram2d":[{"colorbar":{"outlinewidth":1,"tickcolor":"rgb(36,36,36)","ticks":"outside"},"colorscale":[[0.0,"#440154"],[0.1111111111111111,"#482878"],[0.2222222222222222,"#3e4989"],[0.3333333333333333,"#31688e"],[0.4444444444444444,"#26828e"],[0.5555555555555556,"#1f9e89"],[0.6666666666666666,"#35b779"],[0.7777777777777778,"#6ece58"],[0.8888888888888888,"#b5de2b"],[1.0,"#fde725"]],"type":"histogram2d"}],"histogram":[{"marker":{"line":{"color":"white","width":0.6}},"type":"histogram"}],"mesh3d":[{"colorbar":{"outlinewidth":1,"tickcolor":"rgb(36,36,36)","ticks":"outside"},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":1,"tickcolor":"rgb(36,36,36)","ticks":"outside"}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":1,"tickcolor":"rgb(36,36,36)","ticks":"outside"}},"marker":{"colorbar":{"outlinewidth":1,"tickcolor":"rgb(36,36,36)","ticks":"outside"}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":1,"tickcolor":"rgb(36,36,36)","ticks":"outside"}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":1,"tickcolor":"rgb(36,36,36)","ticks":"outside"}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":1,"tickcolor":"rgb(36,36,36)","ticks":"outside"}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":1,"tickcolor":"rgb(36,36,36)","ticks":"outside"}},"type":"scattermapbox"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":1,"tickcolor":"rgb(36,36,36)","ticks":"outside"}},"type":"scatterpolargl"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":1,"tickcolor":"rgb(36,36,36)","ticks":"outside"}},"type":"scatterpolar"}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":1,"tickcolor":"rgb(36,36,36)","ticks":"outside"}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":1,"tickcolor":"rgb(36,36,36)","ticks":"outside"},"colorscale":[[0.0,"#440154"],[0.1111111111111111,"#482878"],[0.2222222222222222,"#3e4989"],[0.3333333333333333,"#31688e"],[0.4444444444444444,"#26828e"],[0.5555555555555556,"#1f9e89"],[0.6666666666666666,"#35b779"],[0.7777777777777778,"#6ece58"],[0.8888888888888888,"#b5de2b"],[1.0,"#fde725"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"rgb(237,237,237)"},"line":{"color":"white"}},"header":{"fill":{"color":"rgb(217,217,217)"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":1,"tickcolor":"rgb(36,36,36)","ticks":"outside"}},"colorscale":{"diverging":[[0.0,"rgb(103,0,31)"],[0.1,"rgb(178,24,43)"],[0.2,"rgb(214,96,77)"],[0.3,"rgb(244,165,130)"],[0.4,"rgb(253,219,199)"],[0.5,"rgb(247,247,247)"],[0.6,"rgb(209,229,240)"],[0.7,"rgb(146,197,222)"],[0.8,"rgb(67,147,195)"],[0.9,"rgb(33,102,172)"],[1.0,"rgb(5,48,97)"]],"sequential":[[0.0,"#440154"],[0.1111111111111111,"#482878"],[0.2222222222222222,"#3e4989"],[0.3333333333333333,"#31688e"],[0.4444444444444444,"#26828e"],[0.5555555555555556,"#1f9e89"],[0.6666666666666666,"#35b779"],[0.7777777777777778,"#6ece58"],[0.8888888888888888,"#b5de2b"],[1.0,"#fde725"]],"sequentialminus":[[0.0,"#440154"],[0.1111111111111111,"#482878"],[0.2222222222222222,"#3e4989"],[0.3333333333333333,"#31688e"],[0.4444444444444444,"#26828e"],[0.5555555555555556,"#1f9e89"],[0.6666666666666666,"#35b779"],[0.7777777777777778,"#6ece58"],[0.8888888888888888,"#b5de2b"],[1.0,"#fde725"]]},"colorway":["#1F77B4","#FF7F0E","#2CA02C","#D62728","#9467BD","#8C564B","#E377C2","#7F7F7F","#BCBD22","#17BECF"],"font":{"color":"rgb(36,36,36)"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"white","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30},"paper_bgcolor":"white","plot_bgcolor":"white","polar":{"angularaxis":{"gridcolor":"rgb(232,232,232)","linecolor":"rgb(36,36,36)","showgrid":false,"showline":true,"ticks":"outside"},"bgcolor":"white","radialaxis":{"gridcolor":"rgb(232,232,232)","linecolor":"rgb(36,36,36)","showgrid":false,"showline":true,"ticks":"outside"}},"scene":{"xaxis":{"backgroundcolor":"white","gridcolor":"rgb(232,232,232)","gridwidth":2,"linecolor":"rgb(36,36,36)","showbackground":true,"showgrid":false,"showline":true,"ticks":"outside","zeroline":false,"zerolinecolor":"rgb(36,36,36)"},"yaxis":{"backgroundcolor":"white","gridcolor":"rgb(232,232,232)","gridwidth":2,"linecolor":"rgb(36,36,36)","showbackground":true,"showgrid":false,"showline":true,"ticks":"outside","zeroline":false,"zerolinecolor":"rgb(36,36,36)"},"zaxis":{"backgroundcolor":"white","gridcolor":"rgb(232,232,232)","gridwidth":2,"linecolor":"rgb(36,36,36)","showbackground":true,"showgrid":false,"showline":true,"ticks":"outside","zeroline":false,"zerolinecolor":"rgb(36,36,36)"}},"shapedefaults":{"fillcolor":"black","line":{"width":0},"opacity":0.3},"ternary":{"aaxis":{"gridcolor":"rgb(232,232,232)","linecolor":"rgb(36,36,36)","showgrid":false,"showline":true,"ticks":"outside"},"baxis":{"gridcolor":"rgb(232,232,232)","linecolor":"rgb(36,36,36)","showgrid":false,"showline":true,"ticks":"outside"},"bgcolor":"white","caxis":{"gridcolor":"rgb(232,232,232)","linecolor":"rgb(36,36,36)","showgrid":false,"showline":true,"ticks":"outside"}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"rgb(232,232,232)","linecolor":"rgb(36,36,36)","showgrid":false,"showline":true,"ticks":"outside","title":{"standoff":15},"zeroline":false,"zerolinecolor":"rgb(36,36,36)"},"yaxis":{"automargin":true,"gridcolor":"rgb(232,232,232)","linecolor":"rgb(36,36,36)","showgrid":false,"showline":true,"ticks":"outside","title":{"standoff":15},"zeroline":false,"zerolinecolor":"rgb(36,36,36)"}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"X"},"range":[-0.5,25.5]},"yaxis":{"anchor":"x","domain":[0.625,1.0],"title":{"text":"Y"},"range":[0,250]},"xaxis2":{"anchor":"y2","domain":[0.0,1.0],"range":[0,25]},"yaxis2":{"anchor":"x2","domain":[0.0,0.375],"range":[0,25000]},"annotations":[{"font":{"size":16},"showarrow":false,"text":"PAVA output evolution","x":0.5,"xanchor":"center","xref":"paper","y":1.0,"yanchor":"bottom","yref":"paper"},{"font":{"size":16},"showarrow":false,"text":"Primal and dual objectives","x":0.5,"xanchor":"center","xref":"paper","y":0.375,"yanchor":"bottom","yref":"paper"}],"legend":{"tracegroupgap":180},"height":600,"sliders":[{"active":1,"currentvalue":{"prefix":"Iteration: #"},"steps":[{"args":[["0"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"0","method":"animate"},{"args":[["1"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"1","method":"animate"},{"args":[["2"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"2","method":"animate"},{"args":[["3"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"3","method":"animate"},{"args":[["4"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"4","method":"animate"},{"args":[["5"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"5","method":"animate"},{"args":[["6"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"6","method":"animate"},{"args":[["7"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"7","method":"animate"},{"args":[["8"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"8","method":"animate"},{"args":[["9"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"9","method":"animate"},{"args":[["10"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"10","method":"animate"},{"args":[["11"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"11","method":"animate"},{"args":[["12"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"12","method":"animate"},{"args":[["13"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"13","method":"animate"},{"args":[["14"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"14","method":"animate"},{"args":[["15"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"15","method":"animate"},{"args":[["16"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"16","method":"animate"},{"args":[["17"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"17","method":"animate"},{"args":[["18"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"18","method":"animate"},{"args":[["19"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"19","method":"animate"},{"args":[["20"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"20","method":"animate"},{"args":[["21"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"21","method":"animate"},{"args":[["22"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"22","method":"animate"},{"args":[["23"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"23","method":"animate"},{"args":[["24"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"24","method":"animate"},{"args":[["25"],{"mode":"immediate","frame":{"duration":300,"redraw":true},"transition":{"duration":0}}],"label":"25","method":"animate"}]}],"updatemenus":[{"buttons":[{"args":[null,{"frame":{"duration":500,"redraw":false},"fromcurrent":true,"transition":{"duration":50,"easing":"linear"}}],"label":"Play","method":"animate"},{"args":[[null],{"frame":{"duration":0,"redraw":false},"mode":"immediate","transition":{"duration":0}}],"label":"Pause","method":"animate"}],"direction":"left","pad":{"b":20,"r":5,"t":5},"showactive":false,"type":"buttons","x":0.5,"xanchor":"center","y":-0.28,"yanchor":"top"}]},                        {"responsive": true}                    ).then(function(){
                            Plotly.addFrames('45cfed23-852a-4c66-866b-cdd43b464ad1', [{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0],"y":[-3.0],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0],"y":[0.0],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0],"y":[19218.899014719937],"type":"scatter"}],"name":"0"},{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0,1],"y":[-3.0,35.657359027997266],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0,1],"y":[0.0,0.0],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0,1],"y":[19218.899014719937,19218.899014719937],"type":"scatter"}],"name":"1"},{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0,1,2],"y":[-3.0,35.657359027997266,79.93061443340548],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0,1,2],"y":[0.0,0.0,0.0],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0,1,2],"y":[19218.899014719937,19218.899014719937,19218.899014719937],"type":"scatter"}],"name":"2"},{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3],"y":[0.0,0.0,0.0,0.0],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3],"y":[19218.899014719937,19218.899014719937,19218.899014719937,19218.899014719937],"type":"scatter"}],"name":"3"},{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4],"y":[-3.0,35.657359027997266,75.90574270370168,75.90574270370168,75.90574270370168],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4],"y":[0.0,0.0,0.0,0.0,1646.040179115953],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4],"y":[19218.899014719937,19218.899014719937,19218.899014719937,19218.899014719937,15889.415926489995],"type":"scatter"}],"name":"4"},{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5],"y":[-3.0,35.657359027997266,70.32630039312696,70.32630039312696,70.32630039312696,70.32630039312696],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5],"y":[0.0,0.0,0.0,0.0,1646.040179115953,1832.821238098084],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5],"y":[19218.899014719937,19218.899014719937,19218.899014719937,19218.899014719937,15889.415926489995,12439.088303163002],"type":"scatter"}],"name":"5"},{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6],"y":[-3.0,35.657359027997266,70.32630039312696,70.32630039312696,70.32630039312696,70.32630039312696,129.29550745276566],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6],"y":[0.0,0.0,0.0,0.0,1646.040179115953,1832.821238098084,1832.821238098084],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6],"y":[19218.899014719937,19218.899014719937,19218.899014719937,19218.899014719937,15889.415926489995,12439.088303163002,12439.088303163002],"type":"scatter"}],"name":"6"},{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7],"y":[-3.0,35.657359027997266,70.32630039312696,70.32630039312696,70.32630039312696,70.32630039312696,129.29550745276566,147.9720770839918],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7],"y":[0.0,0.0,0.0,0.0,1646.040179115953,1832.821238098084,1832.821238098084,1832.821238098084],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7],"y":[19218.899014719937,19218.899014719937,19218.899014719937,19218.899014719937,15889.415926489995,12439.088303163002,12439.088303163002,12439.088303163002],"type":"scatter"}],"name":"7"},{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8],"y":[-3.0,35.657359027997266,70.32630039312696,70.32630039312696,70.32630039312696,70.32630039312696,120.37627113452281,120.37627113452281,120.37627113452281],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8],"y":[0.0,0.0,0.0,0.0,1646.040179115953,1832.821238098084,1832.821238098084,1832.821238098084,2920.0360352551797],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8],"y":[19218.899014719937,19218.899014719937,19218.899014719937,19218.899014719937,15889.415926489995,12439.088303163002,12439.088303163002,12439.088303163002,11841.668995911108],"type":"scatter"}],"name":"8"},{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9],"y":[-3.0,35.657359027997266,70.32630039312696,70.32630039312696,70.32630039312696,70.32630039312696,114.31451701331767,114.31451701331767,114.31451701331767,114.31451701331767],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9],"y":[0.0,0.0,0.0,0.0,1646.040179115953,1832.821238098084,1832.821238098084,1832.821238098084,2920.0360352551797,3140.5052134108846],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9],"y":[19218.899014719937,19218.899014719937,19218.899014719937,19218.899014719937,15889.415926489995,12439.088303163002,12439.088303163002,12439.088303163002,11841.668995911108,10811.879845480918],"type":"scatter"}],"name":"9"},{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10],"y":[-3.0,35.657359027997266,70.32630039312696,70.32630039312696,70.32630039312696,70.32630039312696,114.31451701331767,114.31451701331767,114.31451701331767,114.31451701331767,155.89476363991855],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10],"y":[0.0,0.0,0.0,0.0,1646.040179115953,1832.821238098084,1832.821238098084,1832.821238098084,2920.0360352551797,3140.5052134108846,3140.5052134108846],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10],"y":[19218.899014719937,19218.899014719937,19218.899014719937,19218.899014719937,15889.415926489995,12439.088303163002,12439.088303163002,12439.088303163002,11841.668995911108,10811.879845480918,10811.879845480918],"type":"scatter"}],"name":"10"},{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11],"y":[-3.0,35.657359027997266,70.32630039312696,70.32630039312696,70.32630039312696,70.32630039312696,114.31451701331767,114.31451701331767,114.31451701331767,114.31451701331767,136.0700480646593,136.0700480646593],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11],"y":[0.0,0.0,0.0,0.0,1646.040179115953,1832.821238098084,1832.821238098084,1832.821238098084,2920.0360352551797,3140.5052134108846,3140.5052134108846,3533.5245610508136],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11],"y":[19218.899014719937,19218.899014719937,19218.899014719937,19218.899014719937,15889.415926489995,12439.088303163002,12439.088303163002,12439.088303163002,11841.668995911108,10811.879845480918,10811.879845480918,10721.13678514058],"type":"scatter"}],"name":"11"},{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12],"y":[-3.0,35.657359027997266,70.32630039312696,70.32630039312696,70.32630039312696,70.32630039312696,114.31451701331767,114.31451701331767,114.31451701331767,114.31451701331767,125.79585466746512,125.79585466746512,125.79585466746512],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12],"y":[0.0,0.0,0.0,0.0,1646.040179115953,1832.821238098084,1832.821238098084,1832.821238098084,2920.0360352551797,3140.5052134108846,3140.5052134108846,3533.5245610508136,3850.20171093964],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12],"y":[19218.899014719937,19218.899014719937,19218.899014719937,19218.899014719937,15889.415926489995,12439.088303163002,12439.088303163002,12439.088303163002,11841.668995911108,10811.879845480918,10811.879845480918,10721.13678514058,9947.091120346347],"type":"scatter"}],"name":"12"},{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13],"y":[-3.0,35.657359027997266,70.32630039312696,70.32630039312696,70.32630039312696,70.32630039312696,114.31451701331767,114.31451701331767,114.31451701331767,114.31451701331767,125.79585466746512,125.79585466746512,125.79585466746512,163.9528664807629],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13],"y":[0.0,0.0,0.0,0.0,1646.040179115953,1832.821238098084,1832.821238098084,1832.821238098084,2920.0360352551797,3140.5052134108846,3140.5052134108846,3533.5245610508136,3850.20171093964,3850.20171093964],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13],"y":[19218.899014719937,19218.899014719937,19218.899014719937,19218.899014719937,15889.415926489995,12439.088303163002,12439.088303163002,12439.088303163002,11841.668995911108,10811.879845480918,10811.879845480918,10721.13678514058,9947.091120346347,9947.091120346347],"type":"scatter"}],"name":"13"},{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],"y":[-3.0,35.657359027997266,70.32630039312696,70.32630039312696,70.32630039312696,70.32630039312696,114.31451701331767,114.31451701331767,114.31451701331767,114.31451701331767,125.79585466746512,125.79585466746512,125.79585466746512,137.1776882679367,137.1776882679367],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],"y":[0.0,0.0,0.0,0.0,1646.040179115953,1832.821238098084,1832.821238098084,1832.821238098084,2920.0360352551797,3140.5052134108846,3140.5052134108846,3533.5245610508136,3850.20171093964,3850.20171093964,4567.111879268254],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],"y":[19218.899014719937,19218.899014719937,19218.899014719937,19218.899014719937,15889.415926489995,12439.088303163002,12439.088303163002,12439.088303163002,11841.668995911108,10811.879845480918,10811.879845480918,10721.13678514058,9947.091120346347,9947.091120346347,9754.99983674713],"type":"scatter"}],"name":"14"},{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],"y":[-3.0,35.657359027997266,70.32630039312696,70.32630039312696,70.32630039312696,70.32630039312696,114.31451701331767,114.31451701331767,114.31451701331767,114.31451701331767,125.79585466746512,125.79585466746512,125.79585466746512,134.3282708826208,134.3282708826208,134.3282708826208],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],"y":[0.0,0.0,0.0,0.0,1646.040179115953,1832.821238098084,1832.821238098084,1832.821238098084,2920.0360352551797,3140.5052134108846,3140.5052134108846,3533.5245610508136,3850.20171093964,3850.20171093964,4567.111879268254,4591.469417575514],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],"y":[19218.899014719937,19218.899014719937,19218.899014719937,19218.899014719937,15889.415926489995,12439.088303163002,12439.088303163002,12439.088303163002,11841.668995911108,10811.879845480918,10811.879845480918,10721.13678514058,9947.091120346347,9947.091120346347,9754.99983674713,9386.194758063913],"type":"scatter"}],"name":"15"},{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"y":[-3.0,35.657359027997266,70.32630039312696,70.32630039312696,70.32630039312696,70.32630039312696,114.31451701331767,114.31451701331767,114.31451701331767,114.31451701331767,125.79585466746512,125.79585466746512,125.79585466746512,134.3282708826208,134.3282708826208,134.3282708826208,155.6606672028108],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"y":[0.0,0.0,0.0,0.0,1646.040179115953,1832.821238098084,1832.821238098084,1832.821238098084,2920.0360352551797,3140.5052134108846,3140.5052134108846,3533.5245610508136,3850.20171093964,3850.20171093964,4567.111879268254,4591.469417575514,4591.469417575514],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"y":[19218.899014719937,19218.899014719937,19218.899014719937,19218.899014719937,15889.415926489995,12439.088303163002,12439.088303163002,12439.088303163002,11841.668995911108,10811.879845480918,10811.879845480918,10721.13678514058,9947.091120346347,9947.091120346347,9754.99983674713,9386.194758063913,9386.194758063913],"type":"scatter"}],"name":"16"},{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],"y":[-3.0,35.657359027997266,70.32630039312696,70.32630039312696,70.32630039312696,70.32630039312696,114.31451701331767,114.31451701331767,114.31451701331767,114.31451701331767,125.79585466746512,125.79585466746512,125.79585466746512,134.3282708826208,134.3282708826208,134.3282708826208,152.08962754880952,152.08962754880952],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],"y":[0.0,0.0,0.0,0.0,1646.040179115953,1832.821238098084,1832.821238098084,1832.821238098084,2920.0360352551797,3140.5052134108846,3140.5052134108846,3533.5245610508136,3850.20171093964,3850.20171093964,4567.111879268254,4591.469417575514,4591.469417575514,4604.221741785936],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],"y":[19218.899014719937,19218.899014719937,19218.899014719937,19218.899014719937,15889.415926489995,12439.088303163002,12439.088303163002,12439.088303163002,11841.668995911108,10811.879845480918,10811.879845480918,10721.13678514058,9947.091120346347,9947.091120346347,9754.99983674713,9386.194758063913,9386.194758063913,9343.53676762003],"type":"scatter"}],"name":"17"},{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],"y":[-3.0,35.657359027997266,70.32630039312696,70.32630039312696,70.32630039312696,70.32630039312696,114.31451701331767,114.31451701331767,114.31451701331767,114.31451701331767,125.79585466746512,125.79585466746512,125.79585466746512,134.3282708826208,134.3282708826208,134.3282708826208,136.467068018647,136.467068018647,136.467068018647],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],"y":[0.0,0.0,0.0,0.0,1646.040179115953,1832.821238098084,1832.821238098084,1832.821238098084,2920.0360352551797,3140.5052134108846,3140.5052134108846,3533.5245610508136,3850.20171093964,3850.20171093964,4567.111879268254,4591.469417575514,4591.469417575514,4604.221741785936,5336.414840606332],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],"y":[19218.899014719937,19218.899014719937,19218.899014719937,19218.899014719937,15889.415926489995,12439.088303163002,12439.088303163002,12439.088303163002,11841.668995911108,10811.879845480918,10811.879845480918,10721.13678514058,9947.091120346347,9947.091120346347,9754.99983674713,9386.194758063913,9386.194758063913,9343.53676762003,8339.863786042017],"type":"scatter"}],"name":"18"},{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],"y":[-3.0,35.657359027997266,70.32630039312696,70.32630039312696,70.32630039312696,70.32630039312696,114.31451701331767,114.31451701331767,114.31451701331767,114.31451701331767,125.79585466746512,125.79585466746512,125.79585466746512,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],"y":[0.0,0.0,0.0,0.0,1646.040179115953,1832.821238098084,1832.821238098084,1832.821238098084,2920.0360352551797,3140.5052134108846,3140.5052134108846,3533.5245610508136,3850.20171093964,3850.20171093964,4567.111879268254,4591.469417575514,4591.469417575514,4604.221741785936,5336.414840606332,5824.004139142984],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],"y":[19218.899014719937,19218.899014719937,19218.899014719937,19218.899014719937,15889.415926489995,12439.088303163002,12439.088303163002,12439.088303163002,11841.668995911108,10811.879845480918,10811.879845480918,10721.13678514058,9947.091120346347,9947.091120346347,9754.99983674713,9386.194758063913,9386.194758063913,9343.53676762003,8339.863786042017,6105.701541579706],"type":"scatter"}],"name":"19"},{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],"y":[-3.0,35.657359027997266,70.32630039312696,70.32630039312696,70.32630039312696,70.32630039312696,114.31451701331767,114.31451701331767,114.31451701331767,114.31451701331767,125.79585466746512,125.79585466746512,125.79585466746512,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,188.22612188617114],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],"y":[0.0,0.0,0.0,0.0,1646.040179115953,1832.821238098084,1832.821238098084,1832.821238098084,2920.0360352551797,3140.5052134108846,3140.5052134108846,3533.5245610508136,3850.20171093964,3850.20171093964,4567.111879268254,4591.469417575514,4591.469417575514,4604.221741785936,5336.414840606332,5824.004139142984,5824.004139142984],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],"y":[19218.899014719937,19218.899014719937,19218.899014719937,19218.899014719937,15889.415926489995,12439.088303163002,12439.088303163002,12439.088303163002,11841.668995911108,10811.879845480918,10811.879845480918,10721.13678514058,9947.091120346347,9947.091120346347,9754.99983674713,9386.194758063913,9386.194758063913,9343.53676762003,8339.863786042017,6105.701541579706,6105.701541579706],"type":"scatter"}],"name":"20"},{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21],"y":[-3.0,35.657359027997266,70.32630039312696,70.32630039312696,70.32630039312696,70.32630039312696,114.31451701331767,114.31451701331767,114.31451701331767,114.31451701331767,125.79585466746512,125.79585466746512,125.79585466746512,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,183.88912227704347,183.88912227704347],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21],"y":[0.0,0.0,0.0,0.0,1646.040179115953,1832.821238098084,1832.821238098084,1832.821238098084,2920.0360352551797,3140.5052134108846,3140.5052134108846,3533.5245610508136,3850.20171093964,3850.20171093964,4567.111879268254,4591.469417575514,4591.469417575514,4604.221741785936,5336.414840606332,5824.004139142984,5824.004139142984,5842.813704752596],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21],"y":[19218.899014719937,19218.899014719937,19218.899014719937,19218.899014719937,15889.415926489995,12439.088303163002,12439.088303163002,12439.088303163002,11841.668995911108,10811.879845480918,10811.879845480918,10721.13678514058,9947.091120346347,9947.091120346347,9754.99983674713,9386.194758063913,9386.194758063913,9343.53676762003,8339.863786042017,6105.701541579706,6105.701541579706,6068.430622939655],"type":"scatter"}],"name":"21"},{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22],"y":[-3.0,35.657359027997266,70.32630039312696,70.32630039312696,70.32630039312696,70.32630039312696,114.31451701331767,114.31451701331767,114.31451701331767,114.31451701331767,125.79585466746512,125.79585466746512,125.79585466746512,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,183.88912227704347,183.88912227704347,189.7747107964575],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22],"y":[0.0,0.0,0.0,0.0,1646.040179115953,1832.821238098084,1832.821238098084,1832.821238098084,2920.0360352551797,3140.5052134108846,3140.5052134108846,3533.5245610508136,3850.20171093964,3850.20171093964,4567.111879268254,4591.469417575514,4591.469417575514,4604.221741785936,5336.414840606332,5824.004139142984,5824.004139142984,5842.813704752596,5842.813704752596],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22],"y":[19218.899014719937,19218.899014719937,19218.899014719937,19218.899014719937,15889.415926489995,12439.088303163002,12439.088303163002,12439.088303163002,11841.668995911108,10811.879845480918,10811.879845480918,10721.13678514058,9947.091120346347,9947.091120346347,9754.99983674713,9386.194758063913,9386.194758063913,9343.53676762003,8339.863786042017,6105.701541579706,6105.701541579706,6068.430622939655,6068.430622939655],"type":"scatter"}],"name":"22"},{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],"y":[-3.0,35.657359027997266,70.32630039312696,70.32630039312696,70.32630039312696,70.32630039312696,114.31451701331767,114.31451701331767,114.31451701331767,114.31451701331767,125.79585466746512,125.79585466746512,125.79585466746512,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,179.86391171698543,179.86391171698543,179.86391171698543,179.86391171698543],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],"y":[0.0,0.0,0.0,0.0,1646.040179115953,1832.821238098084,1832.821238098084,1832.821238098084,2920.0360352551797,3140.5052134108846,3140.5052134108846,3533.5245610508136,3850.20171093964,3850.20171093964,4567.111879268254,4591.469417575514,4591.469417575514,4604.221741785936,5336.414840606332,5824.004139142984,5824.004139142984,5842.813704752596,5842.813704752596,6069.430709531298],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],"y":[19218.899014719937,19218.899014719937,19218.899014719937,19218.899014719937,15889.415926489995,12439.088303163002,12439.088303163002,12439.088303163002,11841.668995911108,10811.879845480918,10811.879845480918,10721.13678514058,9947.091120346347,9947.091120346347,9754.99983674713,9386.194758063913,9386.194758063913,9343.53676762003,8339.863786042017,6105.701541579706,6105.701541579706,6068.430622939655,6068.430622939655,6069.430709531276],"type":"scatter"}],"name":"23"},{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,70.32630039312696,70.32630039312696,70.32630039312696,70.32630039312696,114.31451701331767,114.31451701331767,114.31451701331767,114.31451701331767,125.79585466746512,125.79585466746512,125.79585466746512,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,179.86391171698543,179.86391171698543,179.86391171698543,179.86391171698543,191.94379124341003],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[0.0,0.0,0.0,0.0,1646.040179115953,1832.821238098084,1832.821238098084,1832.821238098084,2920.0360352551797,3140.5052134108846,3140.5052134108846,3533.5245610508136,3850.20171093964,3850.20171093964,4567.111879268254,4591.469417575514,4591.469417575514,4604.221741785936,5336.414840606332,5824.004139142984,5824.004139142984,5842.813704752596,5842.813704752596,6069.430709531298,6069.430709531298],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[19218.899014719937,19218.899014719937,19218.899014719937,19218.899014719937,15889.415926489995,12439.088303163002,12439.088303163002,12439.088303163002,11841.668995911108,10811.879845480918,10811.879845480918,10721.13678514058,9947.091120346347,9947.091120346347,9754.99983674713,9386.194758063913,9386.194758063913,9343.53676762003,8339.863786042017,6105.701541579706,6105.701541579706,6068.430622939655,6068.430622939655,6069.430709531276,6069.430709531276],"type":"scatter"}],"name":"24"},{"data":[{"legendgroup":"1","marker":{"color":"black","opacity":1},"mode":"markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,79.93061443340548,114.31471805599453,33.471895621705016,53.587973461402754,129.29550745276566,147.9720770839918,83.86122886681098,96.12925464970229,155.89476363991855,116.24533248940001,105.24746787307683,163.9528664807629,110.4025100551105,128.62943611198907,155.6606672028108,148.51858789480823,105.221948958322,101.78661367769953,188.22612188617114,179.5521226679158,189.7747107964575,161.9026915173973,191.94379124341003],"type":"scatter"},{"legendgroup":"1","marker":{"color":"red"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[-3.0,35.657359027997266,70.32630039312696,70.32630039312696,70.32630039312696,70.32630039312696,114.31451701331767,114.31451701331767,114.31451701331767,114.31451701331767,125.79585466746512,125.79585466746512,125.79585466746512,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,130.59609005450042,179.86391171698546,179.86391171698546,179.86391171698546,179.86391171698546,191.94379124341003],"type":"scatter"},{"legendgroup":"2","marker":{"color":"green"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[0.0,0.0,0.0,0.0,1646.040179115953,1832.821238098084,1832.821238098084,1832.821238098084,2920.0360352551797,3140.5052134108846,3140.5052134108846,3533.5245610508136,3850.20171093964,3850.20171093964,4567.111879268254,4591.469417575514,4591.469417575514,4604.221741785936,5336.414840606332,5824.004139142984,5824.004139142984,5842.813704752596,5842.813704752596,6069.430709531298,6069.430709531298],"type":"scatter"},{"legendgroup":"2","marker":{"color":"blue"},"mode":"lines+markers","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"y":[19218.899014719937,19218.899014719937,19218.899014719937,19218.899014719937,15889.415926489995,12439.088303163002,12439.088303163002,12439.088303163002,11841.668995911108,10811.879845480918,10811.879845480918,10721.13678514058,9947.091120346347,9947.091120346347,9754.99983674713,9386.194758063913,9386.194758063913,9343.53676762003,8339.863786042017,6105.701541579706,6105.701541579706,6068.430622939655,6068.430622939655,6069.430709531276,6069.430709531276],"type":"scatter"}],"name":"24"}]);
                        }).then(function(){
                            
var gd = document.getElementById('45cfed23-852a-4c66-866b-cdd43b464ad1');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
</section>
<section id="applications" class="level2">
<h2 class="anchored" data-anchor-id="applications">Applications</h2>
<p>Isotonic regression is used in a variety of applications, including:</p>
<ul>
<li><p><strong>Monotonicity constraints</strong>: In many applications, it is important to ensure that the relationship between two variables is monotonic. This is the case in physics or biology for instance.</p></li>
<li><p><strong>Calibration</strong> for machine learning models: Isotonic regression can be used to calibrate the output of a machine learning model to ensure that it is well-calibrated. It is common for binary classifiers to output probabilities that are not well-calibrated, and isotonic regression can be used to correct this. You will find a some details and examples in the <a href="https://scikit-learn.org/1.5/modules/calibration.html" target="_blank">scikit-learn documentation</a>.</p></li>
<li><p><strong>Sparse regression</strong>: isotonic regression has some links with the Slope penalty <span class="citation" data-cites="Bogdan_vandenBerg_Sabatti_Su_Candes15">Bogdan et al. (<a href="#ref-Bogdan_vandenBerg_Sabatti_Su_Candes15" role="doc-biblioref">2015</a>)</span>, a generalization of the Lasso penalty. The Slope estimator has been introduced to improve False Discovery Rate control in high-dimensional settings. It is a weighted ordered <span class="math inline">\ell_1</span> penalty, whose proximity operator can be computing thanks to the PAVA algorithm <span class="citation" data-cites="Zeng_Figueiredo14">Zeng and Figueiredo (<a href="#ref-Zeng_Figueiredo14" role="doc-biblioref">2014</a>)</span> (using Moreau’s identity). I became aware of this while working on <span class="citation" data-cites="Bellec_Salmon_Vaiter17">Bellec, Salmon, and Vaiter (<a href="#ref-Bellec_Salmon_Vaiter17" role="doc-biblioref">2017</a>)</span> : we were using that property to compute efficiently the GSlope estimator (and to control duality gap in this context).</p></li>
</ul>
</section>
</section>
<section id="optimization-duality-etc." class="level1">
<h1>Optimization, duality, etc.</h1>
<p>The formulation of the isotonic regression problem given in <a href="#eq-isotonic" class="quarto-xref">Equation&nbsp;1</a> is a quadratic program (QP) with linear constraints. Using a matrix notation, introducing the matrix <span class="math display">A = \begin{pmatrix} 1 &amp; -1 &amp;                       &amp;                       &amp;    \\
  &amp; 1  &amp; -1                    &amp;                       &amp;    \\
  &amp;    &amp; \ddots &amp; \ddots &amp;    \\
  &amp;    &amp;                       &amp; 1                     &amp; -1\end{pmatrix}
=
\begin{pmatrix}
a_1^\top \\
\vdots   \\
a_{n-1}^\top
\end{pmatrix}
\in \mathbb{R}^{n-1 \times n}\enspace,
</span> the isotonic regression problem can be formulated as follows: <span id="eq-isotonic-matrix"><span class="math display">
\begin{align}
\min_{x \in \mathbb{R}^n}
\frac{1}{2}
&amp; \sum_{i=1}^{n} w_i (x_i - y_i)^2 \\
\text{s.t.} &amp; \quad Ax \leq 0 \nonumber
\end{align}
\tag{2}</span></span></p>
<p>In what follows we will write <span class="math inline">W=\mathop{\mathrm{diag}}(w_1,\dots,w_n)</span>, assuming that <span class="math inline">w_i &gt; 0</span> for all <span class="math inline">i \in \llbracket 1, n \rrbracket</span>, so <span class="math inline">W^{-1}= \mathop{\mathrm{diag}}(1/w_1,\dots,1/w_n)</span>. Hence, we can rewrite the isotonic regression problem as</p>
<p><span id="eq-isotonic-matrix-2"><span class="math display">
\begin{align}
\min_{x \in \mathbb{R}^n}
\frac{1}{2}
&amp; (x-y)^\top W (x-y) \\
\text{s.t.} &amp; \quad Ax \leq 0 \enspace.
\end{align}
\tag{3}</span></span></p>
<p>Hence, the isotonic regression problem can be formulated as a convex quadratic program with linear constraints.</p>
<section id="notation" class="level3">
<h3 class="anchored" data-anchor-id="notation">Notation</h3>
<p>The set of <strong>isotonic vectors</strong> <span class="math inline">\mathcal{K} = \left\{ x \in \mathbb{R}^n : Ax \leq 0 \right\}</span> is a cone (stable by positive scalar multiplication). We remind also that the <strong>polar cone</strong> of <span class="math inline">\mathcal{K}</span> is <span class="math inline">\mathcal{K}^\circ= \left\{v \in \mathbb{R}^n : \langle v, x \rangle \leq 0 \text{ for all } x \in \mathcal{K}\right\}</span>.</p>
<p>For any set <span class="math inline">S \subset \llbracket 1, n\rrbracket</span>, the weighted average of <span class="math inline">y_i</span> over the indices in <span class="math inline">i \in S</span> reads: <span class="math display">
\bar{y}_S \triangleq \frac{\sum_{i \in S} w_i y_i}{\sum_{i' \in S} w_{'i'}} \enspace.
</span></p>
<div id="lem-polar" class="theorem lemma">
<p><span class="theorem-title"><strong>Lemma 1 (Polar cone of the isotonic cone)</strong></span> The polar cone of <span class="math inline">\mathcal{K}</span> is <span class="math display">
\mathcal{K}^\circ =\left\{ \sum_{i=1}^{n-1} \alpha_i a_i, \text{ for } \alpha_1 \geq 0, \dots, \alpha_{n-1} \geq 0 \right\} = A^\top \mathbb{R}_+^{n-1}\enspace.
</span></p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>Let <span class="math inline">x \in \mathcal{K}</span> and <span class="math inline">v = \sum_{i=1}^{n-1} \alpha_i a_i</span> with <span class="math inline">\alpha_1 \geq 0, \dots, \alpha_{n-1} \geq 0</span>. Then, note that <span class="math inline">A x \leq 0</span> is equivalent to <span class="math inline">\langle a_i, x \rangle \leq 0</span> for all <span class="math inline">i \in \llbracket 1, n-1 \rrbracket</span>. Hence, we have <span class="math display">
\begin{align*}
\langle v, x \rangle
&amp; = \sum_{i=1}^{n-1} \alpha_i \langle a_i, x \rangle\\
&amp; \leq 0 \enspace.
\end{align*}
</span> So <span class="math inline">\left\{ \sum_{i=1}^{n-1} \alpha_i a_i, \text{ with } \alpha_1 \geq 0, \dots, \alpha_{n-1} \geq 0 \right\} \subset \mathcal{K}^\circ</span>.</p>
<p>For the converse, let <span class="math inline">v \in \mathcal{K}^\circ</span>. One can check that <span class="math inline">(a_i)_{i=1,\dots,n-1}</span> are linearly independant, so adding the vector <span class="math inline">\mathbf{1}_n=(1,\dots,1)^\top/n</span> create a basis of <span class="math inline">\mathbb{R}^n</span>.</p>
<p>Hence one can write <span class="math inline">v= \alpha_n \mathbf{1}_n + \sum_{i=1}^{n-1} \alpha_i a_i</span>. Now choosing <span class="math inline">x=\mathbf{1}_n \in \mathcal{K}</span> yields <span class="math inline">\langle v, \mathbf{1}_n \rangle = \alpha_n \leq 0</span>. Choosing <span class="math inline">x = - \mathbf{1}_n \in \mathcal{K}</span> yields <span class="math inline">\langle v, - \mathbf{1}_n \rangle = - \alpha_n \leq 0</span>. Hence, <span class="math inline">\alpha_n = 0</span>.</p>
<p>Now, for all <span class="math inline">i \in \llbracket 1, n-1 \rrbracket</span>, choosing <span class="math inline">x = \sum_{k=i}^n e_i</span> for <span class="math inline">i \in \llbracket 2,n\rrbracket</span> yields <span class="math inline">\langle v, x \rangle = -\alpha_{i}\leq 0</span>. Hence, for all $ i, n-1 $, we have <span class="math inline">\alpha_i \geq 0</span>, so <span class="math inline">\mathcal{K}^\circ \subset \left\{ \sum_{i=1}^{n-1} \alpha_i a_i, \text{ with } \alpha_1 \geq 0, \dots, \alpha_{n-1} \geq 0 \right\}</span> and the lemma is proved.</p>
</div>
</section>
<section id="conic-duality-fenchel-transform" class="level2">
<h2 class="anchored" data-anchor-id="conic-duality-fenchel-transform">Conic duality / Fenchel transform</h2>
<p>Here we remind the definition of the Fenchel transform of a function <span class="math inline">f</span> defined on <span class="math inline">\mathbb{R}^n</span>: <span class="math display">
f^*(v) = \sup_{x \in \mathbb{R}^n} \left\{ \langle v, x \rangle - f(x) \right\}\enspace.
</span></p>
<p>We also write <span class="math inline">\iota_{\mathcal{K}}</span> the indicator function of the set <span class="math inline">\mathcal{K}</span>, that is <span class="math inline">\iota_{\mathcal{K}}(x) = 0</span> if <span class="math inline">x \in \mathcal{K}</span> and <span class="math inline">+\infty</span> otherwise.</p>
<div id="lem-fenchel" class="theorem lemma">
<p><span class="theorem-title"><strong>Lemma 2 (Fenchel transform of indicator of a cone)</strong></span> The Fenchel transform of the indicator function of a convex cone <span class="math inline">\mathcal{K}</span> is <span class="math display">
\iota_{\mathcal{K}}^*(v) = \iota_{\mathcal{K}^\circ}(v)\enspace,
</span> where <span class="math inline">\iota_{\mathcal{K}^\circ}</span> is the indicator function of the set <span class="math inline">\mathcal{K}^\circ</span>.</p>
</div>
</section>
<section id="dual-problem" class="level2">
<h2 class="anchored" data-anchor-id="dual-problem">Dual problem</h2>
<p>Let us now derive the dual problem of the isotonic regression problem given in <a href="#eq-isotonic-matrix" class="quarto-xref">Equation&nbsp;2</a>.</p>
<div id="thm-dual" class="theorem">
<p><span class="theorem-title"><strong>Theorem 1 (Dual problem of isotonic regression&gt;)</strong></span> The dual problem of the isotonic regression problem given in <a href="#eq-isotonic-matrix" class="quarto-xref">Equation&nbsp;2</a> is <span class="math display">
\begin{align*}
\max_{\alpha \in \mathbb{R}_+^{n-1}} &amp;
\left[
    - \frac{1}{2} (A^\top \alpha-W y)^\top W^{-1} (A^\top \alpha-W y)
    + \frac{1}{2} y^\top W y
\right] \enspace.
\end{align*}
</span></p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>With such ingredient we can write the isotonic regression problem as: <span id="eq-isotonic-matrix-2"><span class="math display">
\begin{align}
\min_{x \in \mathbb{R}^n}
\frac{1}{2}
(y-x)^\top W (y-x) + \iota_{\mathcal{K}}(x) \enspace.
\end{align}
\tag{4}</span></span> We can now rewrite the formulation as</p>
<p><span class="math display">
\begin{align*}
\min_{x \in \mathbb{R}^n} &amp;
\frac{1}{2}
z^\top W z + \iota_{\mathcal{K}}(x)\\
\text{s.t.} &amp; \quad z = y - x  \enspace.
\end{align*}
</span> We can now introduce the Lagrangian of the problem: <span class="math display">
\begin{align*}
\mathcal{L}(x, z, \lambda) &amp; = \frac{1}{2} z^\top W z + \iota_{\mathcal{K}}(x) + \lambda^\top (y - z - x)\\
&amp; = \frac{1}{2} z^\top W z + \iota_{\mathcal{K}}(x) + \lambda^\top y - \lambda^\top z - \lambda^\top x \enspace.
\end{align*}
</span> Assuming strong duality holds, we can write the dual problem as <span class="math display">
\begin{align*}
\min_{x \in \mathbb{R}^n, z \in \mathbb{R}^n} \max_{\lambda \in \mathbb{R}^n} ~
\mathcal{L}(x, z, \lambda) =
\max_{\lambda \in \mathbb{R}^n} \min_{x \in \mathbb{R}^n, z \in \mathbb{R}^n} &amp;
\mathcal{L}(x, z, \lambda) \enspace.
\end{align*}
</span> Now, one can check that the dual problem is equivalent to</p>
<p><span class="math display">
\max_{\lambda \in \mathbb{R}^n} \min_{x \in \mathbb{R}^n, z \in \mathbb{R}^n} \left\{ \frac{1}{2} z^\top W z + \iota_{\mathcal{K}}(x) + \lambda^\top y - \lambda^\top z - \lambda^\top x \right\} \enspace.
</span> Separating the terms in <span class="math inline">x</span> and <span class="math inline">z</span> yields <span class="math display">
\max_{\lambda \in \mathbb{R}^n}
\left[
    \min_{x \in \mathbb{R}^n} \left\{ \iota_{\mathcal{K}}(x) - \lambda^\top x + \lambda^\top y \right\} + \min_{z \in \mathbb{R}^n} \left\{ \frac{1}{2} z^\top W z - \lambda^\top z \right\}
\right]
\enspace.
</span> The second term is a simple quadratic problem with a unique solution given by <span class="math inline">z = W^{-1} \lambda</span>, hence this can be rewritten as <span class="math display">
\left[
- \frac{1}{2} \lambda^\top W^{-1} \lambda
\right]
\enspace.
</span> The first term is linked to the Fenchel transform of the indicator function of the cone <span class="math inline">\mathcal{K}</span>, and reads <span class="math display">
\left[
    - \iota_{\mathcal{K}^\circ}(\lambda) + \lambda^\top y = - \iota_{\mathcal{K}^\circ}(\lambda) + \lambda^\top W^{-1} W y
\right]
\enspace.
</span></p>
<p>Hence the dual problem reads: <span class="math display">
\begin{align*}
\max_{\lambda \in \mathbb{R}^n} &amp;
\left[
    - \iota_{\mathcal{K}^\circ}(\lambda) + \lambda^\top y - \frac{1}{2} \lambda^\top W^{-1} \lambda
\right] \enspace,
\end{align*}
</span> the later can be rewritten as</p>
<p><span class="math display">
\begin{align*}
\max_{\lambda \in \mathcal{K}^{\circ}} &amp;
\left[
    - \frac{1}{2} (\lambda-W y)^\top W^{-1} (\lambda-W y)
    + \frac{1}{2} y^\top W y
\right] \enspace.
\end{align*}
</span> Eventually, using the formulation of <span class="math inline">\mathcal{K}^{\circ}</span> given in <a href="#lem-polar" class="quarto-xref">Lemma&nbsp;1</a>, the dual problem can be rewritten as <span class="math display">
\begin{align*}
\max_{\alpha \in \mathbb{R}_+^{n-1}} &amp;
\left[
    - \frac{1}{2} (A^\top \alpha-W y)^\top W^{-1} (A^\top \alpha-W y)
    + \frac{1}{2} y^\top W y
\right] \enspace,
\end{align*}
</span> which is the targeted formulation.</p>
</div>
</section>
<section id="karush-kuhn-tucker-kkt-conditions" class="level2">
<h2 class="anchored" data-anchor-id="karush-kuhn-tucker-kkt-conditions">Karush-Kuhn-Tucker (KKT) conditions</h2>
<p>The KKT conditions for the isotonic regression problem are given by</p>
<div id="thm-kkt" class="theorem">
<p><span class="theorem-title"><strong>Theorem 2 (KKT conditions for isotonic regression)</strong></span> Let <span class="math inline">x^{\star} \in \mathcal{K}</span> and <span class="math inline">\alpha^{\star} \in \mathbb{R}_+^{n-1}</span> be primal and dual optimal solutions, then the KKT conditions for the isotonic regression problem reads <span class="math display">
\begin{align*}
W (x^{\star}-y) + A^\top \alpha^{\star} &amp; = 0 &amp; ~ (\textbf{stationarity})\\
\langle \alpha^{\star} , A x^{\star} \rangle &amp; = 0 &amp; ~ (\textbf{complementary slackness})\\
\alpha^{\star} &amp; \geq 0 &amp; ~ (\textbf{dual feasibility})\\
A x^{\star} &amp; \leq 0 &amp; ~  (\textbf{primal feasibility})
\end{align*}
</span></p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>See <span class="citation" data-cites="Boyd_Vandenberghe04">(<a href="#ref-Boyd_Vandenberghe04" role="doc-biblioref">Boyd and Vandenberghe 2004, sec. 5.5.3</a>)</span></p>
</div>
<p>In this convex setting (a primal strictly feasible point exists, say <span class="math inline">x=(1,\dots,n)^\top</span>, so the Slater condition holds), the KKT conditions are necessary and sufficient for optimality.</p>
<p><strong>Stationarity</strong> can be rephrased as:</p>
<p><span class="math display">
\begin{align*}
w_1 (x^{\star}_1- y_1) + \alpha^{\star}_1 &amp; = 0 \\
w_i (x^{\star}_i- y_i) + \alpha^{\star}_{i} - \alpha^{\star}_{i-1} &amp; = 0, \quad \text{for all } i \in \llbracket 2, n-1 \rrbracket\\
w_n (x^{\star}_n - y_n) - \alpha^{\star}_{n-1} &amp; = 0 \enspace.
\end{align*}
</span> With the convention <span class="math inline">\alpha_0^{\star} = \alpha_n^{\star} = 0</span>, this reduces to <span id="eq-stationarity"><span class="math display">
\begin{align*}
w_i (x^{\star}_i - y_i) + \alpha^{\star}_{i} - \alpha^{\star}_{i-1} &amp; = 0, \quad \text{for all } i \in \llbracket 1, n \rrbracket\\
\end{align*}
\tag{5}</span></span></p>
<p><strong>Complementarity slackness</strong> can also be rephrased: <span class="math display">
\begin{align*}
&amp; \alpha_i^{\star} (A x^{\star})_i  = 0 \quad \text{for all } i \in \llbracket 1, n-1 \rrbracket \\
\iff &amp; \alpha_i^{\star} (x^{\star}_i-x^{\star}_{i+1})  = 0 \quad \text{for all } i \in \llbracket 1, n-1 \rrbracket \enspace.
\end{align*}
</span></p>
<p>A simple consequence of the complementarity slackness is as follows: if <span class="math inline">\alpha_i^{\star} &gt; 0</span> for some <span class="math inline">i \in \llbracket 1, n-1 \rrbracket</span>, then <span class="math inline">x^{\star}_i = x^{\star}_{i+1}</span>. Hence, the set of (<span class="math inline">n-1</span>) constraints can be partitioned into contiguous blocks where <span class="math inline">x^\star</span> has constant value. Each block B can be written as <span class="math inline">B = \llbracket \underline{b}, \overline{b} \rrbracket</span> for some <span class="math inline">\underline{b} \leq \overline{b}</span> and <span class="math inline">x^{\star}_{\underline{b}} = x^{\star}_{\underline{b}+1} = \ldots = x^{\star}_{\overline{b}}</span>. When needed we use the convention <span class="math inline">x^{\star}_{0}=0</span> and <span class="math inline">x^{\star}_{n+1}=n+1</span>. and <span class="math inline">x^{\star}_{n+1}=0</span>. Then, note that by definition of a block, <span class="math inline">x^{\star}_{\underline{b}-1}&lt;x^{\star}_{\underline{b}}</span> and <span class="math inline">x^{\star}_{\overline{b}}&lt;x^{\star}_{\overline{b}+1}</span>, and by complementarity <span class="math inline">\alpha^{\star}_{\underline{b}-1} = \alpha^{\star}_{\overline{b}+1} = 0</span>.</p>
<p>Summing over the elements of <span class="math inline">B</span> in <a href="#eq-stationarity" class="quarto-xref">Equation&nbsp;5</a> yields (telescopic sum): <span class="math display">
\begin{align*}
\sum_{i \in B }w_i (x^{\star}_i - y_i) +  \alpha_{\overline{b}+1}^{\star} - \alpha_{\underline{b}-1}^{\star} &amp; = 0 \enspace.
\end{align*}
</span> Hence, noticing that the <span class="math inline">x_i^{\star}</span> in block <span class="math inline">B</span> are all equal, we have that:</p>
<p><span class="math display">
\begin{align*}
x^{\star}_{\underline{b}} = \ldots = x^{\star}_{\overline{b}} = \bar{y}_B  \big(= \bar{y}_{\llbracket \underline{b}, \overline{b} \rrbracket} \big)\enspace.
\end{align*}
</span></p>
<p>Now, from the values of <span class="math inline">x^{\star}_{\underline{b}} = \ldots = x^{\star}_{\overline{b}}</span> on the block <span class="math inline">B</span>, one can infer (by recursion) the <span class="math inline">\alpha_i</span>’s for <span class="math inline">i\in B</span>.</p>
<div id="lem-lambda" class="theorem lemma">
<p><span class="theorem-title"><strong>Lemma 3 (Expression of the dual variables)</strong></span> Let <span class="math inline">B =\llbracket \underline{b}, \overline{b} \rrbracket</span> be partitionning block for <span class="math inline">x^\star</span> (into constants pieces). For any <span class="math inline">i \in B</span>:</p>
<p><span class="math display">
\begin{align*}
\alpha^{\star}_{i} &amp; = \Big(\sum_{j \in B \cap \llbracket 1, i \rrbracket} w_j \Big)\left(\bar{y}_{B \cap \llbracket 1, i+1 \rrbracket} - \bar{y}_{B}\right) \enspace.
\end{align*}
</span></p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>The proof is a simple induction on the element of block <span class="math inline">B</span>. For <span class="math inline">i=\underline{b}</span> then <a href="#eq-stationarity" class="quarto-xref">Equation&nbsp;5</a> leads to <span class="math inline">\alpha^{\star}_{\underline{b}} = w_{\underline{b}} (\bar{y}_{\underline{b}} - x^{\star}_{\underline{b}}) = \Big(\sum_{j \in B \cap \llbracket 1, i \rrbracket} w_j \Big)\left(\bar{y}_{B \cap \llbracket 1, i \rrbracket} - \bar{y}_{B} \right)</span>. Now by induction assume the result for <span class="math inline">i\in B</span>, <span class="math inline">\alpha^{\star}_{i}  = \Big(\sum_{j \in B \cap \llbracket 1, i \rrbracket} w_j \Big)\left(\bar{y}_{B \cap \llbracket 1, i \rrbracket} - \bar{y}_{B}\right)</span>. Using <a href="#eq-stationarity" class="quarto-xref">Equation&nbsp;5</a> for <span class="math inline">i+1 \in B</span> yields</p>
<p><span class="math display">
\begin{align*}
\alpha^{\star}_{i+1}
&amp; = w_{i+1} (y_{i+1} - x^{\star}_{i+1}) + \alpha^{\star}_i\\
&amp; = w_{i+1} (y_{i+1} - \overline{y}_{B}) + \alpha^{\star}_i\\
&amp; = w_{i+1} (y_{i+1} - \overline{y}_{B}) + \Big(\sum_{j \in B \cap \llbracket 1, i \rrbracket} w_j  \Big)\left(\bar{y}_{B \cap \llbracket 1, i \rrbracket} -\bar{y}_{B}\right)\\
&amp; = \Big(\sum_{j \in B \cap \llbracket 1, i + 1 \rrbracket} w_j  \Big)\left(\bar{y}_{B \cap \llbracket 1, i+1 \rrbracket} - \bar{y}_{B}\right) \enspace,
\end{align*}
</span> hence the result.</p>
</div>
</section>
</section>
<section id="algorithm" class="level1">
<h1>Algorithm</h1>
<p>The intuition behind the PAVA algorithm is to merge adjacent blocks of constant values in the primal vector, as the targeted solution is simply the average of the observe signal over each block. Hence, the algorithm aims at creating the blocks of constant values in the primal vector. The dual variables can be inferred from the solution from the previous lemma.</p>
<section id="pseudo-code-and-python-implementation" class="level2">
<h2 class="anchored" data-anchor-id="pseudo-code-and-python-implementation">Pseudo-code and Python implementation</h2>
<div class="pseudocode-container quarto-float" data-indent-size="1.2em" data-caption-prefix="Algorithm" data-comment-delimiter="//" data-line-number="true" data-no-end="false" data-line-number-punc=":" data-pseudocode-number="1">
<div class="pseudocode">
\begin{algorithm} \caption{PAVA} \begin{algorithmic} \REQUIRE $y \in\mathbb{R}^n, w \in \mathbb{R}^n_{+}$ \STATE $r \leftarrow y$ \STATE $W \leftarrow y$ \STATE $J = [\{1\},\dots, \{n\}]$ \COMMENT{lists of blocks} \STATE $i=1$ (index of list start at 0 here) \WHILE{$i&lt;n$} \IF{$r_i &lt; r_{i-1}$} \COMMENT{Find adjacent violators and merge groups} \STATE $r_i \leftarrow \frac{W_i r_i + W_{i-1} r_{i-1}}{W_i + W_{i-1}}$ \STATE $W_i \leftarrow W_i + W_{i-1}$ \STATE $J_i \leftarrow J_i \cup J_{i-1}$ \STATE Remove $r_{i-1}$, $W_{i-1}$ and $J_{i-1}$ from the lists \IF{$i &gt; 1$} \STATE{$i\leftarrow i-1$} \ENDIF \ELSE \STATE{$i \leftarrow i + 1$} \ENDIF \ENDWHILE \FOR{$i=1$ to len($J$)} \STATE{$r_{J_i} \leftarrow \bar{y}_{J_i} \mathbf{1}_{J_i}$} \COMMENT{Set the block to the average value} \ENDFOR \RETURN{$r, J$} \end{algorithmic} \end{algorithm}
</div>
</div>
<p>Below you will find a simple version of the PAVA algorithm coded in Python. The <code>sklearn</code> version (in particular the <code>_isotonic.pyx</code> file, as available in October 2024, see <a href="https://github.com/scikit-learn/scikit-learn/blob/04fbe04fedda0e86e67867854900a49fb53c4c01/sklearn/_isotonic.pyx" target="_blank">source</a>). is more efficient but a little less readable.</p>
<div id="f6b8048b" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> PAVA(y, w):</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(y)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> y.copy()</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    ws <span class="op">=</span> w.copy()</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    target <span class="op">=</span> [[i] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n)]</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    counter <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> i <span class="op">&lt;</span> n:</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> r[i] <span class="op">&lt;</span> r[i <span class="op">-</span> <span class="dv">1</span>]:  <span class="co"># Find adjacent violators</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Pool the violators</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>            r[i] <span class="op">=</span> (ws[i] <span class="op">*</span> r[i] <span class="op">+</span> ws[i <span class="op">-</span> <span class="dv">1</span>] <span class="op">*</span> r[i <span class="op">-</span> <span class="dv">1</span>]) <span class="op">/</span> (ws[i] <span class="op">+</span> ws[i <span class="op">-</span> <span class="dv">1</span>])</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>            ws[i] <span class="op">+=</span> ws[i <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>            target[i] <span class="op">=</span> target[i<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> target[i]</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>            r.pop(i <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>            ws.pop(i <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>            target.pop(i <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>            n <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Move back one step if possible</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>                i <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>            i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>            counter <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    sol <span class="op">=</span> np.zeros_like(y)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, block <span class="kw">in</span> <span class="bu">enumerate</span>(target):</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        sol[block] <span class="op">=</span> r[i]</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sol, ws, target</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Below is a version of the algorithm similar to the one implemented in <code>sklearn</code> (yet in pure Python here). Moreover, it can be made an inplace method (as in <code>sklearn</code>), which is more memory efficient.</p>
<div id="5a6bd9ad" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> isotonic_regression(z, w):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> z.copy()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    n<span class="op">=</span><span class="bu">len</span>(y)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    target <span class="op">=</span> np.arange(<span class="bu">len</span>(y))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    targets <span class="op">=</span> [target.copy()]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> [<span class="dv">0</span>]</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> i <span class="op">&lt;</span> n:</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        k <span class="op">=</span> target[i] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> k <span class="op">==</span> n:</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> y[i] <span class="op">&lt;</span> y[k]:</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>            <span class="co"># We are in an increasing subsequence.</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>            i <span class="op">=</span> k</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>            targets.append(target.copy())</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>            idx.append(k)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        sum_wy <span class="op">=</span> w[i] <span class="op">*</span> y[i]</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        sum_w <span class="op">=</span> w[i]</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>            <span class="co"># We are within a decreasing subsequence.</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>            prev_y <span class="op">=</span> y[k]</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>            sum_wy <span class="op">+=</span> w[k] <span class="op">*</span> y[k]</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>            sum_w <span class="op">+=</span> w[k]</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>            k <span class="op">=</span> target[k] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> k <span class="op">==</span> n <span class="kw">or</span> prev_y <span class="op">&lt;</span> y[k]:</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>                targets.append(target.copy())</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>                idx.append(k)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Non-singleton decreasing subsequence is finished,</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>                <span class="co"># update first entry.</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>                y[i] <span class="op">=</span> sum_wy <span class="op">/</span> sum_w</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>                w[i] <span class="op">=</span> sum_w</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>                target[i] <span class="op">=</span> k <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>                target[k <span class="op">-</span> <span class="dv">1</span>] <span class="op">=</span> i</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Backtrack if we can.  This makes the algorithm</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># single-pass and ensures O(n) complexity.</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>                    i <span class="op">=</span> target[i <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Otherwise, restart from the same point.</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reconstruct the solution.</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> i <span class="op">&lt;</span> n:</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>        k <span class="op">=</span> target[i] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>        y[i <span class="op">+</span> <span class="dv">1</span> : k] <span class="op">=</span> y[i]</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> k</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y, targets, idx</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="convergence" class="level2">
<h2 class="anchored" data-anchor-id="convergence">Convergence</h2>
<div id="thm-convergence" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3 (Convergence of the PAVA algorithm)</strong></span> The PAVA algorithm converges in a finite number of iterations and output the primal solution of the isotonic regression problem.</p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>To show the convergence we will create a dual variable <span class="math inline">\alpha</span>, show that it is dual feasible, and that at the end of the algorithm it satisfies KKT along with the output of the PAVA algorithm.</p>
<p>For that let us first prove the following result:</p>
<p><strong>Fact 1</strong>. Let <span class="math inline">B \in J</span> be a block at some stage of the algorithm. Then, <span class="math display">\forall i \in B, \overline{y}_{B \cap \llbracket 1, i \rrbracket} \geq \overline{y}_{B} \enspace.
</span></p>
<p>To show this result, we will use induction and show that the merging process does maintain this condition. First, at initialization, the condition is true as the blocks have all size 1. Now, assume that the condition is true, and check what happen when we merge two consecutive groups <span class="math inline">J_i</span> and <span class="math inline">J_{i-1}</span> into <span class="math inline">B=J_{i-1} \cup J_{i}</span>. First the condition is true for <span class="math inline">J_i</span> and <span class="math inline">J_{i-1}</span>, so <span class="math inline">\overline{y}_{J_i \cap \llbracket 1, k \rrbracket} \geq \overline{y}_{J_i}</span> and <span class="math inline">\overline{y}_{J_{i-1} \cap \llbracket 1, k' \rrbracket} \geq \overline{y}_{J_{i-1}}</span> for any <span class="math inline">k \in J_i</span> and <span class="math inline">k' \in J_{i-1}</span>. Then, the test <span class="math inline">r_i &lt; r_{i-1}</span> is equivalent to <span class="math inline">\overline{y}_{J_i} &lt; \overline{y}_{J_{i-1}}</span>. So for any <span class="math inline">k \in J_{i-1}</span>, we have <span class="math inline">\overline{y}_{J_i \cap \llbracket k, n \rrbracket} \geq \overline{y}_{J_i}</span> using the induction hypothesis. For <span class="math inline">k'\in J_{i}</span>, <span class="math inline">\overline{y}_{B \cap \llbracket 1, k \rrbracket} = \overline{y}_{J_{i-1} \cap \llbracket 1, k \rrbracket} \geq \overline{y}_{J_{i-1}} \geq \overline{y}_{B}</span> (where the last inequality is due to the test <span class="math inline">r_i &lt; r_{i-1}</span>). For the case <span class="math inline">k' \in J_i</span>, we have</p>
<p><span class="math display">
\begin{align*}
\overline{y}_{B \cap \llbracket 1, k' \rrbracket}
&amp; = \overline{y}_{ J_{i-1} \cup (J_{i} \cap \llbracket 1, k' \rrbracket)} \\
&amp; \geq \frac{\Big(\sum_{\ell \in J_{i-1}} w_{\ell} \Big) \cdot \overline{y}_{J_{i-1}} + \Big(\sum_{\ell \in J_{i} \cap \llbracket 1, k' \rrbracket} w_{\ell} \Big) \cdot \overline{y}_{J_{i} \cap \llbracket 1, k' \rrbracket}}{\sum_{J_{i-1}} w_i + \sum_{J_{i} \cap \llbracket 1, k' \rrbracket} w_i}\\
&amp; \geq \frac{\Big(\sum_{\ell \in J_{i-1}} w_{\ell} \Big) \cdot \overline{y}_{J_{i-1}} + \Big(\sum_{\ell \in J_{i} \cap \llbracket 1, k' \rrbracket} w_{\ell} \Big) \cdot \overline{y}_{J_{i}}}{\sum_{J_{i-1}} w_i + \sum_{J_{i} \cap \llbracket 1, k' \rrbracket} w_i} \quad (\text{induction})\\
&amp; \geq \frac{\Big(\sum_{\ell \in J_{i-1}} w_{\ell} \Big) \cdot \overline{y}_{J_{i-1}} + \Big(\sum_{\ell \in J_{i} \cap \llbracket 1, k' \rrbracket} w_{\ell} \Big) \cdot \overline{y}_{J_{i}}}{\sum_{J_{i-1}} w_i + \sum_{J_{i} \cap \llbracket 1, k' \rrbracket} w_i} \quad (\text{PAVA})\\
\end{align*}
</span> Now, remember that <span class="math inline">\overline{y}_{B} = \frac{\Big(\sum_{\ell \in J_{i-1}} w_{\ell} \Big) \cdot \overline{y}_{J_{i-1}} + \Big(\sum_{\ell \in J_{i} } w_{\ell} \Big) \cdot \overline{y}_{J_{i}}}{\sum_{J_{i-1}} w_i + \sum_{J_{i}} w_i}</span> and that <span class="math inline">\overline{y}_{J_{i-1}} \geq  \overline{y}_{B} \geq \overline{y}_{J_{i}}</span> (since <span class="math inline">\overline{y}_{B}</span> is a convex combination of <span class="math inline">\overline{y}_{J_{i-1}}</span> and <span class="math inline">\overline{y}_{J_i}</span>), so the last inequality is true. One can check that the weight of <span class="math inline">J_{i}</span> is larger in the definition of <span class="math inline">\overline{y}_{B}</span> than in the last inequality above, and so among the two convex combinations, the larger is the former. Hence, the fact is proved by induction.</p>
<p><strong>Fact 2.</strong> If you update <span class="math inline">\alpha</span> recursively, starting from <span class="math inline">\alpha = \mathbf{0}_{n-1}</span> and for if for each updated block <span class="math inline">B \in J</span> you update <span class="math inline">\alpha</span> (as in <a href="#lem-lambda" class="quarto-xref">Lemma&nbsp;3</a>) by</p>
<p><span class="math display">
\begin{align*}
\forall i \in B, \alpha_i &amp; = \Big(\sum_{j \in B \cap \llbracket 1, i \rrbracket} w_j \Big)\left( \bar{y}_{B \cap \llbracket 1, i \rrbracket} - \bar{y}_{B}\right) \enspace,
\end{align*}
</span> then <span class="math inline">\alpha</span> is dual feasible for all steps of the algorithm</p>
<p>The proof is a direct consequence of Fact 1 and the fact that the weights <span class="math inline">w_i</span> are non-negative.</p>
<p><strong>Fact 3.</strong> <span class="math inline">\forall i \in B, \alpha_i=\alpha_{i-1} +w_i(x_i - y_i)</span> (where we assume that <span class="math inline">x_i = \overline{y}_B</span>), which means that <span class="math inline">\alpha</span> and <span class="math inline">x</span> hence created satsfies.</p>
<p>Again this result is simple to prove, by following the exact same line encountered in the proof of <a href="#lem-lambda" class="quarto-xref">Lemma&nbsp;3</a>.</p>
<p><strong>Fact 4.</strong> When you exit the while loop, the output of the PAVA algorithm is a primal feasible point.</p>
<p>Indeed, the only way to exist is to have all blocks mean values ordered. Hence, when the algorithm stops the primal point create (after the block averaging step) is primal feasible.</p>
<p>Leveraging Fact 1. to 4. ensures that the KKT conditions are satisfied with the primal and dual points created. Hence, at the end of the algorithm, and the optimal solution is found.</p>
<section id="duality-gap" class="level2">
<h2 class="anchored" data-anchor-id="duality-gap">Duality Gap</h2>
<p>Given a primal feasible point <span class="math inline">x \in \mathcal{K}</span> and a dual feasible point <span class="math inline">\alpha \in \mathbb{R}_+^{n-1}</span>, we can obtain upper and lower bounds on the optimal value of the primal problem .</p>
<p>Note that at optimality <span class="math inline">W x^\star = W y - A^\top \alpha^\star</span> Hence, using a value of <span class="math inline">x</span> at some stage of the algorithm (corresponding to a feasible <span class="math inline">\alpha</span>), the dual reads <span class="math inline">\frac{1}{2} y^\top W y - \frac{1}{2} x^\top W x</span>. For creating a primal feasible point, one can simply take the ordered version of the output, making the last element constant to create a non-decreasing vector. The later is coded in Python with the following function:</p>
<div id="680838f5" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> replace_after_first_non_increasing(x, w<span class="op">=</span>w):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(x)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, n):</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> x[i] <span class="op">&lt;</span> x[i <span class="op">-</span> <span class="dv">1</span>]:</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>            mean_value <span class="op">=</span> np.<span class="bu">sum</span>(x[i:] <span class="op">*</span> w[i:]) <span class="op">/</span> np.<span class="bu">sum</span>(w[i:])</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>            x[i:] <span class="op">=</span> mean_value</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As can be seen in the preliminary animation, the primal and dual objectives converge to the same value, which is the optimal value of the primal problem.</p>
</section>
</div>
</section>
</section>
<section id="references" class="level1">
<h1><i class="fa-solid fa-link" title="link" aria-label="link"></i> References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Bellec_Salmon_Vaiter17" class="csl-entry" role="listitem">
Bellec, P. C., J. Salmon, and S. Vaiter. 2017. <span>“A Sharp Oracle Inequality for <span>Graph-Slope</span>.”</span> <em>Electron. J. Statist.</em> 11 (2): 4851–70. <a href="https://arxiv.org/pdf/1706.06977.pdf">https://arxiv.org/pdf/1706.06977.pdf</a>.
</div>
<div id="ref-Best_Chakravarti90" class="csl-entry" role="listitem">
Best, M. J., and N. Chakravarti. 1990. <span>“Active Set Algorithms for Isotonic Regression; a Unifying Framework.”</span> <em>Math. Programming</em> 47 (3): 425–39.
</div>
<div id="ref-Bogdan_vandenBerg_Sabatti_Su_Candes15" class="csl-entry" role="listitem">
Bogdan, M., E. van den Berg, C. Sabatti, W. Su, and E. J. Candès. 2015. <span>“<span class="nocase">SLOPE-adaptive</span> Variable Selection via Convex Optimization.”</span> <em>Ann. Appl. Stat.</em> 9 (3): 1103.
</div>
<div id="ref-Boyd_Vandenberghe04" class="csl-entry" role="listitem">
Boyd, S., and L. Vandenberghe. 2004. <em>Convex Optimization</em>. Cambridge University Press.
</div>
<div id="ref-Pedregosa13" class="csl-entry" role="listitem">
Pedregosa, F. 2013. <span>“Isotonic Regression.”</span> <a href="https://fa.bianp.net/blog/2013/isotonic-regression/" class="uri">https://fa.bianp.net/blog/2013/isotonic-regression/</a>.
</div>
<div id="ref-Zeng_Figueiredo14" class="csl-entry" role="listitem">
Zeng, X., and M. A. T. Figueiredo. 2014. <span>“<span class="nocase">The Ordered Weighted <span class="math inline">\ell_1</span> Norm: Atomic Formulation, Projections, and Algorithms</span>.”</span> <em>ArXiv e-Prints</em>.
</div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<hr>

<span style="margin-top:20px; margin-bottom: 20px"></span>

<!-- <img style="width:100%;" src="/img/marvins_log_thumbnail.png"> -->

<!-- <p style="margin: 20px"> Do you enjoy my blog? Subscribe here to get notifications and updates (it's free!):</p> -->

<!-- <div class="grid">
  <div class=".d-none .d-md-block g-col-md-1"></div>
  <div class="g-col-12 g-col-md-10">
    <iframe src="https://embeds.beehiiv.com/c7111066-479b-43db-ad92-8d703fe96bf0?slim=true" data-test-id="beehiiv-embed" frameborder="0" scrolling="no" style="margin: 0; border-radius: 0px !important; background-color: transparent; width:100%; padding: 20px"></iframe>
  </div>
  <div class=".d-none .d-md-block g-col-md-1"></div>
</div> -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/josephsalmon\.eu\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb4" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Isotonic regression"</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - name:</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">      given: Joseph</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">      family: Salmon</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2024-11-10"</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Iso, Iso, Iso ... Tonic! Or how to fit a non-decreasing signal."</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [Quadratic programming, Calibration, PAVA, Optimization]</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> "isotonic.png"</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="an">reference-location:</span><span class="co"> document</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="an">fig-cap-location:</span><span class="co"> bottom</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="an">draft:</span><span class="co"> false</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="an">filters:</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">  - pseudocode</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co">    include-before-body: ../../html/margin_image.html</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co">    include-after-body: ../../html/blog_footer.html</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>::: {.hidden}</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>{{</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>\usepackage{amssymb, amsmath, amsthm}</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>\usepackage{stmaryrd}</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>\DeclareMathOperator*{\argmin}{arg\,min} % thin space, limits underneath in displays</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>\DeclareMathOperator*{\argmax}{arg\,max} % thin space, limits underneath in displays</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>\DeclareMathOperator{\diag}{diag}</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>**[Note]{.underline}**: This blog is mainly inspired by the post by  @Pedregosa13 on Isotonic regression, a version of the PAVA algorithm provided by @Best_Chakravarti90.</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction &amp; formulation</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>Isotonic regression is a technique used to fit a non-decreasing function to a set of data points.</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>We can think of isotonic regression as a generalization of linear regression where the function is constrained to be non-decreasing.</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>More formally suppose that one collects $n$ sample points $y_1,\dots, y_n$ and has weights $w_1, \dots, w_n$ associated with each data point.</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>**[Note]{.underline}**: when no a priori weights are given, we can set $w_i = 1$ for all $i \in \llbracket 1, n \rrbracket$.</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>Then, the isotonic regression problem can be formulated as follows:</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>\min_{x \in \mathbb{R}^n}</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>\frac{1}{2}</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>&amp; \sum_{i=1}^{n} w_i (x_i - y_i)^2 <span class="sc">\\</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>\text{s.t.} &amp; \quad x_1 \leq x_2 \leq \ldots \leq x_n \nonumber</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>$$ {#eq-isotonic}</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a><span class="fu">## Visualization</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>Below you'll find a visualization, on a synthetic dataset, of the most common algorithm, the Pools Adjacent Violators Algorithm (PAVA) to solve isotonic regression algorithm.</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>The top plot shows the evolution of the PAVA algorithm, while the bottom plot shows the primal and dual objectives until convergence.</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>Note that the essence of the algorithm is simple: it Pools Adjacent Violators, *i.e.,* it replaces adjacent points that are not in increasing order by averaging.</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotly.subplots <span class="im">import</span> make_subplots</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Easy to read code:</span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> isotonic_regression(y, w):</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(y)</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> y.copy()</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>    ws <span class="op">=</span> w.copy()</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>    target <span class="op">=</span> [[i] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n)]</span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>    targets <span class="op">=</span> [target.copy()]</span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>    counter <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> i <span class="op">&lt;</span> n:</span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> r[i] <span class="op">&lt;</span> r[i <span class="op">-</span> <span class="dv">1</span>]:  <span class="co"># Find adjacent violators</span></span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Pool the violators</span></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>            r[i] <span class="op">=</span> (ws[i] <span class="op">*</span> r[i] <span class="op">+</span> ws[i <span class="op">-</span> <span class="dv">1</span>] <span class="op">*</span> r[i <span class="op">-</span> <span class="dv">1</span>]) <span class="op">/</span> (ws[i] <span class="op">+</span> ws[i <span class="op">-</span> <span class="dv">1</span>])</span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>            ws[i] <span class="op">+=</span> ws[i <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>            target[i] <span class="op">=</span> target[i<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> target[i]</span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>            r.pop(i <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>            ws.pop(i <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>            target.pop(i <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>            n <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Move back one step if possible</span></span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>                i <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>            i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>            counter <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>            targets.append(target.copy())</span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>    sol <span class="op">=</span> np.zeros_like(y)</span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, block <span class="kw">in</span> <span class="bu">enumerate</span>(target):</span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>        sol[block] <span class="op">=</span> r[i]</span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sol, ws, targets</span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> np.random.default_rng(<span class="dv">1</span>)</span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a>n_sample <span class="op">=</span> <span class="dv">25</span></span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(n_sample)</span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> np.ones(n_sample)</span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> rng.integers(<span class="op">-</span><span class="dv">50</span>, <span class="dv">50</span>, size<span class="op">=</span>(n_sample,)) <span class="op">+</span> <span class="fl">50.</span> <span class="op">*</span> np.log(<span class="dv">1</span> <span class="op">+</span> np.arange(n_sample))</span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> replace_after_first_non_increasing(x, w<span class="op">=</span>w):</span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(x)</span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, n):</span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> x[i] <span class="op">&lt;</span> x[i <span class="op">-</span> <span class="dv">1</span>]:</span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a>            mean_value <span class="op">=</span> np.<span class="bu">sum</span>(x[i:] <span class="op">*</span> w[i:]) <span class="op">/</span> np.<span class="bu">sum</span>(w[i:])</span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a>            x[i:] <span class="op">=</span> mean_value</span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_signal_from_target(target, y, w<span class="op">=</span>w):</span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a>    signal <span class="op">=</span> np.zeros_like(y)</span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, block <span class="kw">in</span> <span class="bu">enumerate</span>(target):</span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a>        signal[block] <span class="op">=</span> np.<span class="bu">sum</span>(y[block] <span class="op">*</span> w[block]) <span class="op">/</span> np.<span class="bu">sum</span>(w[block])</span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> signal</span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a>sol, ws, targets <span class="op">=</span> isotonic_regression(z.tolist(), w.tolist())</span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a>primals, duals <span class="op">=</span> [], []</span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotly.subplots <span class="im">import</span> make_subplots</span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a>primals, duals <span class="op">=</span> [], []</span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_targets(y, targets, x):</span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(y)</span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create subplots</span></span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> make_subplots(rows<span class="op">=</span><span class="dv">2</span>, cols<span class="op">=</span><span class="dv">1</span>, subplot_titles<span class="op">=</span>(<span class="st">"PAVA output evolution"</span>, <span class="st">"Primal and dual objectives"</span>))</span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initial plot</span></span>
<span id="cb4-151"><a href="#cb4-151" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(go.Scatter(x<span class="op">=</span>x, y<span class="op">=</span>y, mode<span class="op">=</span><span class="st">'markers'</span>, name<span class="op">=</span><span class="st">'Raw data'</span>, marker<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'black'</span>, opacity<span class="op">=</span><span class="dv">1</span>, size<span class="op">=</span><span class="dv">10</span>), legendgroup<span class="op">=</span><span class="st">'1'</span>, showlegend<span class="op">=</span><span class="va">True</span>), row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb4-152"><a href="#cb4-152" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(go.Scatter(x<span class="op">=</span>[x[<span class="dv">0</span>]], y<span class="op">=</span>[y[<span class="dv">0</span>]], mode<span class="op">=</span><span class="st">'lines+markers'</span>, name<span class="op">=</span><span class="st">'PAVA iterations'</span>, marker<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'red'</span>), legendgroup<span class="op">=</span><span class="st">'1'</span>, showlegend<span class="op">=</span><span class="va">True</span>), row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb4-153"><a href="#cb4-153" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(go.Scatter(x<span class="op">=</span>[<span class="dv">0</span>], y<span class="op">=</span>[<span class="dv">0</span>], mode<span class="op">=</span><span class="st">'lines+markers'</span>, name<span class="op">=</span><span class="st">'Duals'</span>, marker<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'green'</span>), legendgroup<span class="op">=</span><span class="st">'2'</span>, showlegend<span class="op">=</span><span class="va">True</span>), row<span class="op">=</span><span class="dv">2</span>, col<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb4-154"><a href="#cb4-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-155"><a href="#cb4-155" aria-hidden="true" tabindex="-1"></a>    yy <span class="op">=</span> create_signal_from_target(targets[<span class="dv">0</span>], y)</span>
<span id="cb4-156"><a href="#cb4-156" aria-hidden="true" tabindex="-1"></a>    primal <span class="op">=</span> replace_after_first_non_increasing(np.array(yy))</span>
<span id="cb4-157"><a href="#cb4-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-158"><a href="#cb4-158" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(go.Scatter(x<span class="op">=</span>[<span class="dv">0</span>], y<span class="op">=</span>[<span class="fl">0.5</span> <span class="op">*</span> np.linalg.norm(primal <span class="op">-</span> y)<span class="op">**</span><span class="dv">2</span>], mode<span class="op">=</span><span class="st">'lines+markers'</span>, name<span class="op">=</span><span class="st">'Primals'</span>, marker<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'blue'</span>), legendgroup<span class="op">=</span><span class="st">'2'</span>, showlegend<span class="op">=</span><span class="va">True</span>), row<span class="op">=</span><span class="dv">2</span>, col<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb4-159"><a href="#cb4-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-160"><a href="#cb4-160" aria-hidden="true" tabindex="-1"></a>    fig.update_layout(</span>
<span id="cb4-161"><a href="#cb4-161" aria-hidden="true" tabindex="-1"></a>    legend_tracegroupgap <span class="op">=</span> <span class="dv">180</span>,</span>
<span id="cb4-162"><a href="#cb4-162" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">600</span>,</span>
<span id="cb4-163"><a href="#cb4-163" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-164"><a href="#cb4-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-165"><a href="#cb4-165" aria-hidden="true" tabindex="-1"></a>    frames <span class="op">=</span> []</span>
<span id="cb4-166"><a href="#cb4-166" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> iteration, target <span class="kw">in</span> <span class="bu">enumerate</span>(targets):</span>
<span id="cb4-167"><a href="#cb4-167" aria-hidden="true" tabindex="-1"></a>        yy <span class="op">=</span> create_signal_from_target(target, y)</span>
<span id="cb4-168"><a href="#cb4-168" aria-hidden="true" tabindex="-1"></a>        duals.append(<span class="fl">0.5</span> <span class="op">*</span> np.<span class="bu">sum</span>( w <span class="op">*</span> y<span class="op">**</span><span class="dv">2</span>) <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> np.<span class="bu">sum</span>(w<span class="op">*</span>yy<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb4-169"><a href="#cb4-169" aria-hidden="true" tabindex="-1"></a>        primal <span class="op">=</span> replace_after_first_non_increasing(yy.copy())</span>
<span id="cb4-170"><a href="#cb4-170" aria-hidden="true" tabindex="-1"></a>        primals.append(<span class="fl">0.5</span> <span class="op">*</span> np.<span class="bu">sum</span>( w<span class="op">*</span>(primal <span class="op">-</span> y)<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb4-171"><a href="#cb4-171" aria-hidden="true" tabindex="-1"></a>        frames.append(go.Frame(data<span class="op">=</span>[</span>
<span id="cb4-172"><a href="#cb4-172" aria-hidden="true" tabindex="-1"></a>            go.Scatter(x<span class="op">=</span>x, y<span class="op">=</span>y, mode<span class="op">=</span><span class="st">'markers'</span>, marker<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'black'</span>, opacity<span class="op">=</span><span class="dv">1</span>), legendgroup<span class="op">=</span><span class="st">'1'</span>, showlegend<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb4-173"><a href="#cb4-173" aria-hidden="true" tabindex="-1"></a>            go.Scatter(x<span class="op">=</span>x[:iteration<span class="op">+</span><span class="dv">1</span>], y<span class="op">=</span>yy[:iteration<span class="op">+</span><span class="dv">1</span>], mode<span class="op">=</span><span class="st">'lines+markers'</span>, marker<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'red'</span>), legendgroup<span class="op">=</span><span class="st">'1'</span>, showlegend<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb4-174"><a href="#cb4-174" aria-hidden="true" tabindex="-1"></a>            go.Scatter(x<span class="op">=</span>np.arange(iteration<span class="op">+</span><span class="dv">1</span>), y<span class="op">=</span>duals[:iteration<span class="op">+</span><span class="dv">1</span>], mode<span class="op">=</span><span class="st">'lines+markers'</span>, marker<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'green'</span>), legendgroup<span class="op">=</span><span class="st">'2'</span>, showlegend<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb4-175"><a href="#cb4-175" aria-hidden="true" tabindex="-1"></a>            go.Scatter(x<span class="op">=</span>np.arange(iteration<span class="op">+</span><span class="dv">1</span>), y<span class="op">=</span>primals[:iteration<span class="op">+</span><span class="dv">1</span>], mode<span class="op">=</span><span class="st">'lines+markers'</span>, marker<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'blue'</span>), legendgroup<span class="op">=</span><span class="st">'2'</span>, showlegend<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-176"><a href="#cb4-176" aria-hidden="true" tabindex="-1"></a>        ], name<span class="op">=</span><span class="bu">str</span>(iteration)))</span>
<span id="cb4-177"><a href="#cb4-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-178"><a href="#cb4-178" aria-hidden="true" tabindex="-1"></a>    frames.append(go.Frame(data<span class="op">=</span>[</span>
<span id="cb4-179"><a href="#cb4-179" aria-hidden="true" tabindex="-1"></a>        go.Scatter(x<span class="op">=</span>x, y<span class="op">=</span>y, mode<span class="op">=</span><span class="st">'markers'</span>, marker<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'black'</span>, opacity<span class="op">=</span><span class="dv">1</span>), legendgroup<span class="op">=</span><span class="st">'1'</span>, showlegend<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb4-180"><a href="#cb4-180" aria-hidden="true" tabindex="-1"></a>        go.Scatter(x<span class="op">=</span>x, y<span class="op">=</span>sol, mode<span class="op">=</span><span class="st">'lines+markers'</span>, marker<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'red'</span>), legendgroup<span class="op">=</span><span class="st">'1'</span>, showlegend<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb4-181"><a href="#cb4-181" aria-hidden="true" tabindex="-1"></a>        go.Scatter(x<span class="op">=</span>np.arange(<span class="bu">len</span>(duals)), y<span class="op">=</span>duals, mode<span class="op">=</span><span class="st">'lines+markers'</span>, marker<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'green'</span>), legendgroup<span class="op">=</span><span class="st">'2'</span>, showlegend<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb4-182"><a href="#cb4-182" aria-hidden="true" tabindex="-1"></a>        go.Scatter(x<span class="op">=</span>np.arange(<span class="bu">len</span>(primals)), y<span class="op">=</span>primals, mode<span class="op">=</span><span class="st">'lines+markers'</span>, marker<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'blue'</span>), legendgroup<span class="op">=</span><span class="st">'2'</span>, showlegend<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-183"><a href="#cb4-183" aria-hidden="true" tabindex="-1"></a>    ], name<span class="op">=</span><span class="bu">str</span>(iteration)))</span>
<span id="cb4-184"><a href="#cb4-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-185"><a href="#cb4-185" aria-hidden="true" tabindex="-1"></a>    fig.frames <span class="op">=</span> frames</span>
<span id="cb4-186"><a href="#cb4-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-187"><a href="#cb4-187" aria-hidden="true" tabindex="-1"></a>    steps <span class="op">=</span> [<span class="bu">dict</span>(method<span class="op">=</span><span class="st">"animate"</span>, args<span class="op">=</span>[[<span class="bu">str</span>(i)], <span class="bu">dict</span>(mode<span class="op">=</span><span class="st">"immediate"</span>, frame<span class="op">=</span><span class="bu">dict</span>(duration<span class="op">=</span><span class="dv">300</span>, redraw<span class="op">=</span><span class="va">True</span>), transition<span class="op">=</span><span class="bu">dict</span>(duration<span class="op">=</span><span class="dv">0</span>))], label<span class="op">=</span><span class="bu">str</span>(i)) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(frames))]</span>
<span id="cb4-188"><a href="#cb4-188" aria-hidden="true" tabindex="-1"></a>    sliders <span class="op">=</span> [<span class="bu">dict</span>(active<span class="op">=</span><span class="dv">1</span>, steps<span class="op">=</span>steps, currentvalue<span class="op">=</span>{<span class="st">"prefix"</span>: <span class="st">"Iteration: #"</span>})]</span>
<span id="cb4-189"><a href="#cb4-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-190"><a href="#cb4-190" aria-hidden="true" tabindex="-1"></a>    fig.update_layout(</span>
<span id="cb4-191"><a href="#cb4-191" aria-hidden="true" tabindex="-1"></a>        sliders<span class="op">=</span>sliders,</span>
<span id="cb4-192"><a href="#cb4-192" aria-hidden="true" tabindex="-1"></a>        updatemenus<span class="op">=</span>[{</span>
<span id="cb4-193"><a href="#cb4-193" aria-hidden="true" tabindex="-1"></a>            <span class="st">"buttons"</span>: [</span>
<span id="cb4-194"><a href="#cb4-194" aria-hidden="true" tabindex="-1"></a>                {<span class="st">"args"</span>: [<span class="va">None</span>, {<span class="st">"frame"</span>: {<span class="st">"duration"</span>: <span class="dv">500</span>, <span class="st">"redraw"</span>: <span class="va">False</span>}, <span class="st">"fromcurrent"</span>: <span class="va">True</span>, <span class="st">"transition"</span>: {<span class="st">"duration"</span>: <span class="dv">50</span>, <span class="st">"easing"</span>: <span class="st">"linear"</span>}}], <span class="st">"label"</span>: <span class="st">"Play"</span>, <span class="st">"method"</span>: <span class="st">"animate"</span>},</span>
<span id="cb4-195"><a href="#cb4-195" aria-hidden="true" tabindex="-1"></a>                {<span class="st">"args"</span>: [[<span class="va">None</span>], {<span class="st">"frame"</span>: {<span class="st">"duration"</span>: <span class="dv">0</span>, <span class="st">"redraw"</span>: <span class="va">False</span>}, <span class="st">"mode"</span>: <span class="st">"immediate"</span>, <span class="st">"transition"</span>: {<span class="st">"duration"</span>: <span class="dv">0</span>}}], <span class="st">"label"</span>: <span class="st">"Pause"</span>, <span class="st">"method"</span>: <span class="st">"animate"</span>}</span>
<span id="cb4-196"><a href="#cb4-196" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb4-197"><a href="#cb4-197" aria-hidden="true" tabindex="-1"></a>            <span class="st">"direction"</span>: <span class="st">"left"</span>, <span class="st">"pad"</span>: {<span class="st">"r"</span>: <span class="dv">5</span>, <span class="st">"t"</span>: <span class="dv">5</span>, <span class="st">"b"</span>: <span class="dv">20</span>}, <span class="st">"showactive"</span>: <span class="va">False</span>, <span class="st">"type"</span>: <span class="st">"buttons"</span>, <span class="st">"x"</span>: <span class="fl">0.5</span>, <span class="st">"xanchor"</span>: <span class="st">"center"</span>, <span class="st">"y"</span>: <span class="op">-</span><span class="fl">0.28</span>, <span class="st">"yanchor"</span>: <span class="st">"top"</span></span>
<span id="cb4-198"><a href="#cb4-198" aria-hidden="true" tabindex="-1"></a>        }],</span>
<span id="cb4-199"><a href="#cb4-199" aria-hidden="true" tabindex="-1"></a>    xaxis_title<span class="op">=</span><span class="st">"X"</span>, yaxis_title<span class="op">=</span><span class="st">"Y"</span>, template<span class="op">=</span><span class="st">'simple_white'</span>, xaxis<span class="op">=</span><span class="bu">dict</span>(<span class="bu">range</span><span class="op">=</span>[<span class="op">-</span><span class="fl">0.5</span>, n<span class="op">+</span><span class="fl">0.5</span>]), yaxis<span class="op">=</span><span class="bu">dict</span>(<span class="bu">range</span><span class="op">=</span>[<span class="dv">0</span>, <span class="dv">250</span>]), xaxis2<span class="op">=</span><span class="bu">dict</span>(<span class="bu">range</span><span class="op">=</span>[<span class="dv">0</span>, <span class="bu">len</span>(targets)]), yaxis2<span class="op">=</span><span class="bu">dict</span>(<span class="bu">range</span><span class="op">=</span>[<span class="dv">0</span>, <span class="dv">25000</span>]),</span>
<span id="cb4-200"><a href="#cb4-200" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-201"><a href="#cb4-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-202"><a href="#cb4-202" aria-hidden="true" tabindex="-1"></a>    fig.show()</span>
<span id="cb4-203"><a href="#cb4-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-204"><a href="#cb4-204" aria-hidden="true" tabindex="-1"></a>plot_targets(z, targets, x)</span>
<span id="cb4-205"><a href="#cb4-205" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-206"><a href="#cb4-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-207"><a href="#cb4-207" aria-hidden="true" tabindex="-1"></a><span class="fu">## Applications</span></span>
<span id="cb4-208"><a href="#cb4-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-209"><a href="#cb4-209" aria-hidden="true" tabindex="-1"></a>Isotonic regression is used in a variety of applications, including:</span>
<span id="cb4-210"><a href="#cb4-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-211"><a href="#cb4-211" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Monotonicity constraints**: In many applications, it is important to ensure that the relationship between two variables is monotonic. This is the case in physics or biology for instance.</span>
<span id="cb4-212"><a href="#cb4-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-213"><a href="#cb4-213" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Calibration** for machine learning models: Isotonic regression can be used to calibrate the output of a machine learning model to ensure that it is well-calibrated. It is common for binary classifiers to output probabilities that are not well-calibrated, and isotonic regression can be used to correct this.</span>
<span id="cb4-214"><a href="#cb4-214" aria-hidden="true" tabindex="-1"></a>You will find a some details and examples in the <span class="co">[</span><span class="ot">scikit-learn documentation</span><span class="co">](https://scikit-learn.org/1.5/modules/calibration.html)</span>.</span>
<span id="cb4-215"><a href="#cb4-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-216"><a href="#cb4-216" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Sparse regression**: isotonic regression has some links with the Slope penalty @Bogdan_vandenBerg_Sabatti_Su_Candes15, a generalization of the Lasso penalty. The Slope estimator has been introduced to improve False Discovery Rate control in high-dimensional settings. It is a weighted ordered $\ell_1$ penalty, whose proximity operator can be computing thanks to the PAVA algorithm @Zeng_Figueiredo14 (using Moreau's identity). I became aware of this while working on @Bellec_Salmon_Vaiter17 : we were using that property to compute efficiently the GSlope estimator (and to control duality gap in this context).</span>
<span id="cb4-217"><a href="#cb4-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-218"><a href="#cb4-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-219"><a href="#cb4-219" aria-hidden="true" tabindex="-1"></a><span class="fu"># Optimization, duality, etc.</span></span>
<span id="cb4-220"><a href="#cb4-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-221"><a href="#cb4-221" aria-hidden="true" tabindex="-1"></a>The formulation of the isotonic regression problem given in @eq-isotonic is a quadratic program (QP) with linear constraints.</span>
<span id="cb4-222"><a href="#cb4-222" aria-hidden="true" tabindex="-1"></a>Using a matrix notation, introducing the matrix</span>
<span id="cb4-223"><a href="#cb4-223" aria-hidden="true" tabindex="-1"></a>$$A = \begin{pmatrix} 1 &amp; -1 &amp;                       &amp;                       &amp;    <span class="sc">\\</span></span>
<span id="cb4-224"><a href="#cb4-224" aria-hidden="true" tabindex="-1"></a>  &amp; 1  &amp; -1                    &amp;                       &amp;    <span class="sc">\\</span></span>
<span id="cb4-225"><a href="#cb4-225" aria-hidden="true" tabindex="-1"></a>  &amp;    &amp; \ddots &amp; \ddots &amp;    <span class="sc">\\</span></span>
<span id="cb4-226"><a href="#cb4-226" aria-hidden="true" tabindex="-1"></a>  &amp;    &amp;                       &amp; 1                     &amp; -1\end{pmatrix}</span>
<span id="cb4-227"><a href="#cb4-227" aria-hidden="true" tabindex="-1"></a> =</span>
<span id="cb4-228"><a href="#cb4-228" aria-hidden="true" tabindex="-1"></a>\begin{pmatrix}</span>
<span id="cb4-229"><a href="#cb4-229" aria-hidden="true" tabindex="-1"></a>a_1^\top <span class="sc">\\</span></span>
<span id="cb4-230"><a href="#cb4-230" aria-hidden="true" tabindex="-1"></a>\vdots   <span class="sc">\\</span></span>
<span id="cb4-231"><a href="#cb4-231" aria-hidden="true" tabindex="-1"></a>a_{n-1}^\top</span>
<span id="cb4-232"><a href="#cb4-232" aria-hidden="true" tabindex="-1"></a>\end{pmatrix}</span>
<span id="cb4-233"><a href="#cb4-233" aria-hidden="true" tabindex="-1"></a> \in \mathbb{R}^{n-1 \times n}\enspace,</span>
<span id="cb4-234"><a href="#cb4-234" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-235"><a href="#cb4-235" aria-hidden="true" tabindex="-1"></a>the isotonic regression problem can be formulated as follows:</span>
<span id="cb4-236"><a href="#cb4-236" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-237"><a href="#cb4-237" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb4-238"><a href="#cb4-238" aria-hidden="true" tabindex="-1"></a>\min_{x \in \mathbb{R}^n}</span>
<span id="cb4-239"><a href="#cb4-239" aria-hidden="true" tabindex="-1"></a>\frac{1}{2}</span>
<span id="cb4-240"><a href="#cb4-240" aria-hidden="true" tabindex="-1"></a>&amp; \sum_{i=1}^{n} w_i (x_i - y_i)^2 <span class="sc">\\</span></span>
<span id="cb4-241"><a href="#cb4-241" aria-hidden="true" tabindex="-1"></a>\text{s.t.} &amp; \quad Ax \leq 0 \nonumber</span>
<span id="cb4-242"><a href="#cb4-242" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb4-243"><a href="#cb4-243" aria-hidden="true" tabindex="-1"></a>$$ {#eq-isotonic-matrix}</span>
<span id="cb4-244"><a href="#cb4-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-245"><a href="#cb4-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-246"><a href="#cb4-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-247"><a href="#cb4-247" aria-hidden="true" tabindex="-1"></a>In what follows we will write $W=\diag(w_1,\dots,w_n)$, assuming that $w_i &gt; 0$ for all $i \in \llbracket 1, n \rrbracket$, so $W^{-1}= \diag(1/w_1,\dots,1/w_n)$.</span>
<span id="cb4-248"><a href="#cb4-248" aria-hidden="true" tabindex="-1"></a>Hence, we can rewrite the isotonic regression problem as</span>
<span id="cb4-249"><a href="#cb4-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-250"><a href="#cb4-250" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-251"><a href="#cb4-251" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb4-252"><a href="#cb4-252" aria-hidden="true" tabindex="-1"></a>\min_{x \in \mathbb{R}^n}</span>
<span id="cb4-253"><a href="#cb4-253" aria-hidden="true" tabindex="-1"></a>\frac{1}{2}</span>
<span id="cb4-254"><a href="#cb4-254" aria-hidden="true" tabindex="-1"></a>&amp; (x-y)^\top W (x-y) <span class="sc">\\</span></span>
<span id="cb4-255"><a href="#cb4-255" aria-hidden="true" tabindex="-1"></a>\text{s.t.} &amp; \quad Ax \leq 0 \enspace.</span>
<span id="cb4-256"><a href="#cb4-256" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb4-257"><a href="#cb4-257" aria-hidden="true" tabindex="-1"></a>$$ {#eq-isotonic-matrix-2}</span>
<span id="cb4-258"><a href="#cb4-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-259"><a href="#cb4-259" aria-hidden="true" tabindex="-1"></a>Hence, the isotonic regression problem can be formulated as a convex quadratic program with linear constraints.</span>
<span id="cb4-260"><a href="#cb4-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-261"><a href="#cb4-261" aria-hidden="true" tabindex="-1"></a><span class="fu">### Notation</span></span>
<span id="cb4-262"><a href="#cb4-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-263"><a href="#cb4-263" aria-hidden="true" tabindex="-1"></a>The set of **isotonic vectors** $\mathcal{K} = \left<span class="sc">\{</span> x \in \mathbb{R}^n : Ax \leq 0 \right<span class="sc">\}</span>$</span>
<span id="cb4-264"><a href="#cb4-264" aria-hidden="true" tabindex="-1"></a>is a cone (stable by positive scalar multiplication).</span>
<span id="cb4-265"><a href="#cb4-265" aria-hidden="true" tabindex="-1"></a>We remind also that the **polar cone** of $\mathcal{K}$ is $\mathcal{K}^\circ= \left<span class="sc">\{</span>v \in \mathbb{R}^n : \langle v, x \rangle \leq 0 \text{ for all } x \in \mathcal{K}\right<span class="sc">\}</span>$.</span>
<span id="cb4-266"><a href="#cb4-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-267"><a href="#cb4-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-268"><a href="#cb4-268" aria-hidden="true" tabindex="-1"></a>For any set $S \subset \llbracket 1, n\rrbracket$, the weighted average of $y_i$ over the indices in $i \in S$ reads:</span>
<span id="cb4-269"><a href="#cb4-269" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-270"><a href="#cb4-270" aria-hidden="true" tabindex="-1"></a>\bar{y}_S \triangleq \frac{\sum_{i \in S} w_i y_i}{\sum_{i' \in S} w_{'i'}} \enspace.</span>
<span id="cb4-271"><a href="#cb4-271" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-272"><a href="#cb4-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-273"><a href="#cb4-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-274"><a href="#cb4-274" aria-hidden="true" tabindex="-1"></a>::: {#lem-polar}</span>
<span id="cb4-275"><a href="#cb4-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-276"><a href="#cb4-276" aria-hidden="true" tabindex="-1"></a><span class="fu">## Polar cone of the isotonic cone</span></span>
<span id="cb4-277"><a href="#cb4-277" aria-hidden="true" tabindex="-1"></a>The polar cone of $\mathcal{K}$ is</span>
<span id="cb4-278"><a href="#cb4-278" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-279"><a href="#cb4-279" aria-hidden="true" tabindex="-1"></a>\mathcal{K}^\circ =\left<span class="sc">\{</span> \sum_{i=1}^{n-1} \alpha_i a_i, \text{ for } \alpha_1 \geq 0, \dots, \alpha_{n-1} \geq 0 \right<span class="sc">\}</span> = A^\top \mathbb{R}_+^{n-1}\enspace.</span>
<span id="cb4-280"><a href="#cb4-280" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-281"><a href="#cb4-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-282"><a href="#cb4-282" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb4-283"><a href="#cb4-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-284"><a href="#cb4-284" aria-hidden="true" tabindex="-1"></a>::: {.proof}</span>
<span id="cb4-285"><a href="#cb4-285" aria-hidden="true" tabindex="-1"></a>Let $x \in \mathcal{K}$ and $v = \sum_{i=1}^{n-1} \alpha_i a_i$ with $\alpha_1 \geq 0, \dots, \alpha_{n-1} \geq 0$.</span>
<span id="cb4-286"><a href="#cb4-286" aria-hidden="true" tabindex="-1"></a>Then, note that $A x \leq 0$ is equivalent to $\langle a_i, x \rangle \leq 0$ for all $i \in \llbracket 1, n-1 \rrbracket$. Hence, we have</span>
<span id="cb4-287"><a href="#cb4-287" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-288"><a href="#cb4-288" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb4-289"><a href="#cb4-289" aria-hidden="true" tabindex="-1"></a>\langle v, x \rangle</span>
<span id="cb4-290"><a href="#cb4-290" aria-hidden="true" tabindex="-1"></a>&amp; = \sum_{i=1}^{n-1} \alpha_i \langle a_i, x \rangle<span class="sc">\\</span></span>
<span id="cb4-291"><a href="#cb4-291" aria-hidden="true" tabindex="-1"></a>&amp; \leq 0 \enspace.</span>
<span id="cb4-292"><a href="#cb4-292" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb4-293"><a href="#cb4-293" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-294"><a href="#cb4-294" aria-hidden="true" tabindex="-1"></a>So $\left<span class="sc">\{</span> \sum_{i=1}^{n-1} \alpha_i a_i, \text{ with } \alpha_1 \geq 0, \dots, \alpha_{n-1} \geq 0 \right<span class="sc">\}</span> \subset \mathcal{K}^\circ$.</span>
<span id="cb4-295"><a href="#cb4-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-296"><a href="#cb4-296" aria-hidden="true" tabindex="-1"></a>For the converse, let $v \in \mathcal{K}^\circ$.</span>
<span id="cb4-297"><a href="#cb4-297" aria-hidden="true" tabindex="-1"></a>One can check that $(a_i)_{i=1,\dots,n-1}$ are linearly independant, so adding the vector $\mathbf{1}_n=(1,\dots,1)^\top/n$ create a basis of $\mathbb{R}^n$.</span>
<span id="cb4-298"><a href="#cb4-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-299"><a href="#cb4-299" aria-hidden="true" tabindex="-1"></a>Hence one can write $v= \alpha_n \mathbf{1}_n + \sum_{i=1}^{n-1} \alpha_i a_i$.</span>
<span id="cb4-300"><a href="#cb4-300" aria-hidden="true" tabindex="-1"></a>Now choosing $x=\mathbf{1}_n \in \mathcal{K}$ yields $\langle v, \mathbf{1}_n \rangle = \alpha_n \leq 0$. Choosing $x = - \mathbf{1}_n \in \mathcal{K}$ yields $\langle v, - \mathbf{1}_n \rangle = - \alpha_n \leq 0$. Hence, $\alpha_n = 0$.</span>
<span id="cb4-301"><a href="#cb4-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-302"><a href="#cb4-302" aria-hidden="true" tabindex="-1"></a>Now, for all $i \in \llbracket 1, n-1 \rrbracket$, choosing $x = \sum_{k=i}^n e_i$ for $i \in \llbracket 2,n\rrbracket$ yields $\langle v, x \rangle = -\alpha_{i}\leq 0$. Hence, for all $ i\in \llbracket 1, n-1 \rrbracket$, we have $\alpha_i \geq 0$, so $\mathcal{K}^\circ \subset \left<span class="sc">\{</span> \sum_{i=1}^{n-1} \alpha_i a_i, \text{ with } \alpha_1 \geq 0, \dots, \alpha_{n-1} \geq 0 \right<span class="sc">\}</span>$ and the lemma is proved.</span>
<span id="cb4-303"><a href="#cb4-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-304"><a href="#cb4-304" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb4-305"><a href="#cb4-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-306"><a href="#cb4-306" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conic duality / Fenchel transform</span></span>
<span id="cb4-307"><a href="#cb4-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-308"><a href="#cb4-308" aria-hidden="true" tabindex="-1"></a>Here we remind the definition of the Fenchel transform of a function $f$ defined on $\mathbb{R}^n$:</span>
<span id="cb4-309"><a href="#cb4-309" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-310"><a href="#cb4-310" aria-hidden="true" tabindex="-1"></a>f^*(v) = \sup_{x \in \mathbb{R}^n} \left<span class="sc">\{</span> \langle v, x \rangle - f(x) \right<span class="sc">\}</span>\enspace.</span>
<span id="cb4-311"><a href="#cb4-311" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-312"><a href="#cb4-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-313"><a href="#cb4-313" aria-hidden="true" tabindex="-1"></a>We also write $\iota_{\mathcal{K}}$ the indicator function of the set $\mathcal{K}$, that is $\iota_{\mathcal{K}}(x) = 0$ if $x \in \mathcal{K}$ and $+\infty$ otherwise.</span>
<span id="cb4-314"><a href="#cb4-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-315"><a href="#cb4-315" aria-hidden="true" tabindex="-1"></a>::: {#lem-fenchel}</span>
<span id="cb4-316"><a href="#cb4-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-317"><a href="#cb4-317" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fenchel transform of indicator of a cone</span></span>
<span id="cb4-318"><a href="#cb4-318" aria-hidden="true" tabindex="-1"></a>The Fenchel transform of the indicator function of a convex cone $\mathcal{K}$ is</span>
<span id="cb4-319"><a href="#cb4-319" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-320"><a href="#cb4-320" aria-hidden="true" tabindex="-1"></a>\iota_{\mathcal{K}}^*(v) = \iota_{\mathcal{K}^\circ}(v)\enspace,</span>
<span id="cb4-321"><a href="#cb4-321" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-322"><a href="#cb4-322" aria-hidden="true" tabindex="-1"></a>where $\iota_{\mathcal{K}^\circ}$ is the indicator function of the set $\mathcal{K}^\circ$.</span>
<span id="cb4-323"><a href="#cb4-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-324"><a href="#cb4-324" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb4-325"><a href="#cb4-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-326"><a href="#cb4-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-327"><a href="#cb4-327" aria-hidden="true" tabindex="-1"></a><span class="fu">## Dual problem</span></span>
<span id="cb4-328"><a href="#cb4-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-329"><a href="#cb4-329" aria-hidden="true" tabindex="-1"></a>Let us now derive the dual problem of the isotonic regression problem given in @eq-isotonic-matrix.</span>
<span id="cb4-330"><a href="#cb4-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-331"><a href="#cb4-331" aria-hidden="true" tabindex="-1"></a>::: {#thm-dual}</span>
<span id="cb4-332"><a href="#cb4-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-333"><a href="#cb4-333" aria-hidden="true" tabindex="-1"></a><span class="fu">## Dual problem of isotonic regression&gt;</span></span>
<span id="cb4-334"><a href="#cb4-334" aria-hidden="true" tabindex="-1"></a>The dual problem of the isotonic regression problem given in @eq-isotonic-matrix is</span>
<span id="cb4-335"><a href="#cb4-335" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-336"><a href="#cb4-336" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb4-337"><a href="#cb4-337" aria-hidden="true" tabindex="-1"></a>\max_{\alpha \in \mathbb{R}_+^{n-1}} &amp;</span>
<span id="cb4-338"><a href="#cb4-338" aria-hidden="true" tabindex="-1"></a>\left[</span>
<span id="cb4-339"><a href="#cb4-339" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>\frac{1}{2} (A^\top \alpha-W y)^\top W^{-1} (A^\top \alpha-W y)</span>
<span id="cb4-340"><a href="#cb4-340" aria-hidden="true" tabindex="-1"></a><span class="ss">    + </span>\frac{1}{2} y^\top W y</span>
<span id="cb4-341"><a href="#cb4-341" aria-hidden="true" tabindex="-1"></a>\right] \enspace.</span>
<span id="cb4-342"><a href="#cb4-342" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb4-343"><a href="#cb4-343" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-344"><a href="#cb4-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-345"><a href="#cb4-345" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb4-346"><a href="#cb4-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-347"><a href="#cb4-347" aria-hidden="true" tabindex="-1"></a>::: {.proof}</span>
<span id="cb4-348"><a href="#cb4-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-349"><a href="#cb4-349" aria-hidden="true" tabindex="-1"></a>With such ingredient we can write the isotonic regression problem as:</span>
<span id="cb4-350"><a href="#cb4-350" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-351"><a href="#cb4-351" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb4-352"><a href="#cb4-352" aria-hidden="true" tabindex="-1"></a>\min_{x \in \mathbb{R}^n}</span>
<span id="cb4-353"><a href="#cb4-353" aria-hidden="true" tabindex="-1"></a>\frac{1}{2}</span>
<span id="cb4-354"><a href="#cb4-354" aria-hidden="true" tabindex="-1"></a>(y-x)^\top W (y-x) + \iota_{\mathcal{K}}(x) \enspace.</span>
<span id="cb4-355"><a href="#cb4-355" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb4-356"><a href="#cb4-356" aria-hidden="true" tabindex="-1"></a>$$ {#eq-isotonic-matrix-2}</span>
<span id="cb4-357"><a href="#cb4-357" aria-hidden="true" tabindex="-1"></a>We can now rewrite the formulation as</span>
<span id="cb4-358"><a href="#cb4-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-359"><a href="#cb4-359" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-360"><a href="#cb4-360" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb4-361"><a href="#cb4-361" aria-hidden="true" tabindex="-1"></a>\min_{x \in \mathbb{R}^n} &amp;</span>
<span id="cb4-362"><a href="#cb4-362" aria-hidden="true" tabindex="-1"></a>\frac{1}{2}</span>
<span id="cb4-363"><a href="#cb4-363" aria-hidden="true" tabindex="-1"></a>z^\top W z + \iota_{\mathcal{K}}(x)<span class="sc">\\</span></span>
<span id="cb4-364"><a href="#cb4-364" aria-hidden="true" tabindex="-1"></a>\text{s.t.} &amp; \quad z = y - x  \enspace.</span>
<span id="cb4-365"><a href="#cb4-365" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb4-366"><a href="#cb4-366" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-367"><a href="#cb4-367" aria-hidden="true" tabindex="-1"></a>We can now introduce the Lagrangian of the problem:</span>
<span id="cb4-368"><a href="#cb4-368" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-369"><a href="#cb4-369" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb4-370"><a href="#cb4-370" aria-hidden="true" tabindex="-1"></a>\mathcal{L}(x, z, \lambda) &amp; = \frac{1}{2} z^\top W z + \iota_{\mathcal{K}}(x) + \lambda^\top (y - z - x)<span class="sc">\\</span></span>
<span id="cb4-371"><a href="#cb4-371" aria-hidden="true" tabindex="-1"></a>&amp; = \frac{1}{2} z^\top W z + \iota_{\mathcal{K}}(x) + \lambda^\top y - \lambda^\top z - \lambda^\top x \enspace.</span>
<span id="cb4-372"><a href="#cb4-372" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb4-373"><a href="#cb4-373" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-374"><a href="#cb4-374" aria-hidden="true" tabindex="-1"></a>Assuming strong duality holds, we can write the dual problem as</span>
<span id="cb4-375"><a href="#cb4-375" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-376"><a href="#cb4-376" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb4-377"><a href="#cb4-377" aria-hidden="true" tabindex="-1"></a>\min_{x \in \mathbb{R}^n, z \in \mathbb{R}^n} \max_{\lambda \in \mathbb{R}^n} ~</span>
<span id="cb4-378"><a href="#cb4-378" aria-hidden="true" tabindex="-1"></a>\mathcal{L}(x, z, \lambda) =</span>
<span id="cb4-379"><a href="#cb4-379" aria-hidden="true" tabindex="-1"></a>\max_{\lambda \in \mathbb{R}^n} \min_{x \in \mathbb{R}^n, z \in \mathbb{R}^n} &amp;</span>
<span id="cb4-380"><a href="#cb4-380" aria-hidden="true" tabindex="-1"></a>\mathcal{L}(x, z, \lambda) \enspace.</span>
<span id="cb4-381"><a href="#cb4-381" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb4-382"><a href="#cb4-382" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-383"><a href="#cb4-383" aria-hidden="true" tabindex="-1"></a>Now, one can check that the dual problem is equivalent to</span>
<span id="cb4-384"><a href="#cb4-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-385"><a href="#cb4-385" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-386"><a href="#cb4-386" aria-hidden="true" tabindex="-1"></a>\max_{\lambda \in \mathbb{R}^n} \min_{x \in \mathbb{R}^n, z \in \mathbb{R}^n} \left<span class="sc">\{</span> \frac{1}{2} z^\top W z + \iota_{\mathcal{K}}(x) + \lambda^\top y - \lambda^\top z - \lambda^\top x \right<span class="sc">\}</span> \enspace.</span>
<span id="cb4-387"><a href="#cb4-387" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-388"><a href="#cb4-388" aria-hidden="true" tabindex="-1"></a>Separating the terms in $x$ and $z$ yields</span>
<span id="cb4-389"><a href="#cb4-389" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-390"><a href="#cb4-390" aria-hidden="true" tabindex="-1"></a>\max_{\lambda \in \mathbb{R}^n}</span>
<span id="cb4-391"><a href="#cb4-391" aria-hidden="true" tabindex="-1"></a>\left[</span>
<span id="cb4-392"><a href="#cb4-392" aria-hidden="true" tabindex="-1"></a>    \min_{x \in \mathbb{R}^n} \left<span class="sc">\{</span> \iota_{\mathcal{K}}(x) - \lambda^\top x + \lambda^\top y \right<span class="sc">\}</span> + \min_{z \in \mathbb{R}^n} \left<span class="sc">\{</span> \frac{1}{2} z^\top W z - \lambda^\top z \right<span class="sc">\}</span></span>
<span id="cb4-393"><a href="#cb4-393" aria-hidden="true" tabindex="-1"></a>\right]</span>
<span id="cb4-394"><a href="#cb4-394" aria-hidden="true" tabindex="-1"></a>\enspace.</span>
<span id="cb4-395"><a href="#cb4-395" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-396"><a href="#cb4-396" aria-hidden="true" tabindex="-1"></a>The second term is a simple quadratic problem with a unique solution given by $z = W^{-1} \lambda$, hence this can be rewritten as</span>
<span id="cb4-397"><a href="#cb4-397" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-398"><a href="#cb4-398" aria-hidden="true" tabindex="-1"></a>\left[</span>
<span id="cb4-399"><a href="#cb4-399" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>\frac{1}{2} \lambda^\top W^{-1} \lambda</span>
<span id="cb4-400"><a href="#cb4-400" aria-hidden="true" tabindex="-1"></a>\right]</span>
<span id="cb4-401"><a href="#cb4-401" aria-hidden="true" tabindex="-1"></a>\enspace.</span>
<span id="cb4-402"><a href="#cb4-402" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-403"><a href="#cb4-403" aria-hidden="true" tabindex="-1"></a>The first term is linked to the Fenchel transform of the indicator function of the cone $\mathcal{K}$, and reads</span>
<span id="cb4-404"><a href="#cb4-404" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-405"><a href="#cb4-405" aria-hidden="true" tabindex="-1"></a>\left[</span>
<span id="cb4-406"><a href="#cb4-406" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>\iota_{\mathcal{K}^\circ}(\lambda) + \lambda^\top y = - \iota_{\mathcal{K}^\circ}(\lambda) + \lambda^\top W^{-1} W y</span>
<span id="cb4-407"><a href="#cb4-407" aria-hidden="true" tabindex="-1"></a>\right]</span>
<span id="cb4-408"><a href="#cb4-408" aria-hidden="true" tabindex="-1"></a>\enspace.</span>
<span id="cb4-409"><a href="#cb4-409" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-410"><a href="#cb4-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-411"><a href="#cb4-411" aria-hidden="true" tabindex="-1"></a>Hence the dual problem reads:</span>
<span id="cb4-412"><a href="#cb4-412" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-413"><a href="#cb4-413" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb4-414"><a href="#cb4-414" aria-hidden="true" tabindex="-1"></a>\max_{\lambda \in \mathbb{R}^n} &amp;</span>
<span id="cb4-415"><a href="#cb4-415" aria-hidden="true" tabindex="-1"></a>\left[</span>
<span id="cb4-416"><a href="#cb4-416" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>\iota_{\mathcal{K}^\circ}(\lambda) + \lambda^\top y - \frac{1}{2} \lambda^\top W^{-1} \lambda</span>
<span id="cb4-417"><a href="#cb4-417" aria-hidden="true" tabindex="-1"></a>\right] \enspace,</span>
<span id="cb4-418"><a href="#cb4-418" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb4-419"><a href="#cb4-419" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-420"><a href="#cb4-420" aria-hidden="true" tabindex="-1"></a>the later can be rewritten as</span>
<span id="cb4-421"><a href="#cb4-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-422"><a href="#cb4-422" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-423"><a href="#cb4-423" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb4-424"><a href="#cb4-424" aria-hidden="true" tabindex="-1"></a>\max_{\lambda \in \mathcal{K}^{\circ}} &amp;</span>
<span id="cb4-425"><a href="#cb4-425" aria-hidden="true" tabindex="-1"></a>\left[</span>
<span id="cb4-426"><a href="#cb4-426" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>\frac{1}{2} (\lambda-W y)^\top W^{-1} (\lambda-W y)</span>
<span id="cb4-427"><a href="#cb4-427" aria-hidden="true" tabindex="-1"></a><span class="ss">    + </span>\frac{1}{2} y^\top W y</span>
<span id="cb4-428"><a href="#cb4-428" aria-hidden="true" tabindex="-1"></a>\right] \enspace.</span>
<span id="cb4-429"><a href="#cb4-429" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb4-430"><a href="#cb4-430" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-431"><a href="#cb4-431" aria-hidden="true" tabindex="-1"></a>Eventually, using the formulation of $\mathcal{K}^{\circ}$ given in @lem-polar, the dual problem can be rewritten as</span>
<span id="cb4-432"><a href="#cb4-432" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-433"><a href="#cb4-433" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb4-434"><a href="#cb4-434" aria-hidden="true" tabindex="-1"></a>\max_{\alpha \in \mathbb{R}_+^{n-1}} &amp;</span>
<span id="cb4-435"><a href="#cb4-435" aria-hidden="true" tabindex="-1"></a>\left[</span>
<span id="cb4-436"><a href="#cb4-436" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>\frac{1}{2} (A^\top \alpha-W y)^\top W^{-1} (A^\top \alpha-W y)</span>
<span id="cb4-437"><a href="#cb4-437" aria-hidden="true" tabindex="-1"></a><span class="ss">    + </span>\frac{1}{2} y^\top W y</span>
<span id="cb4-438"><a href="#cb4-438" aria-hidden="true" tabindex="-1"></a>\right] \enspace,</span>
<span id="cb4-439"><a href="#cb4-439" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb4-440"><a href="#cb4-440" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-441"><a href="#cb4-441" aria-hidden="true" tabindex="-1"></a>which is the targeted formulation.</span>
<span id="cb4-442"><a href="#cb4-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-443"><a href="#cb4-443" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb4-444"><a href="#cb4-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-445"><a href="#cb4-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-446"><a href="#cb4-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-447"><a href="#cb4-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-448"><a href="#cb4-448" aria-hidden="true" tabindex="-1"></a><span class="fu">## Karush-Kuhn-Tucker (KKT) conditions</span></span>
<span id="cb4-449"><a href="#cb4-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-450"><a href="#cb4-450" aria-hidden="true" tabindex="-1"></a>The KKT conditions for the isotonic regression problem are given by</span>
<span id="cb4-451"><a href="#cb4-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-452"><a href="#cb4-452" aria-hidden="true" tabindex="-1"></a>::: {#thm-kkt}</span>
<span id="cb4-453"><a href="#cb4-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-454"><a href="#cb4-454" aria-hidden="true" tabindex="-1"></a><span class="fu">## KKT conditions for isotonic regression</span></span>
<span id="cb4-455"><a href="#cb4-455" aria-hidden="true" tabindex="-1"></a>Let $x^{\star} \in \mathcal{K}$ and $\alpha^{\star} \in \mathbb{R}_+^{n-1}$ be primal and dual optimal solutions, then the KKT conditions for the isotonic regression problem reads</span>
<span id="cb4-456"><a href="#cb4-456" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-457"><a href="#cb4-457" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb4-458"><a href="#cb4-458" aria-hidden="true" tabindex="-1"></a>W (x^{\star}-y) + A^\top \alpha^{\star} &amp; = 0 &amp; ~ (\textbf{stationarity})<span class="sc">\\</span></span>
<span id="cb4-459"><a href="#cb4-459" aria-hidden="true" tabindex="-1"></a>\langle \alpha^{\star} , A x^{\star} \rangle &amp; = 0 &amp; ~ (\textbf{complementary slackness})<span class="sc">\\</span></span>
<span id="cb4-460"><a href="#cb4-460" aria-hidden="true" tabindex="-1"></a>\alpha^{\star} &amp; \geq 0 &amp; ~ (\textbf{dual feasibility})<span class="sc">\\</span></span>
<span id="cb4-461"><a href="#cb4-461" aria-hidden="true" tabindex="-1"></a>A x^{\star} &amp; \leq 0 &amp; ~  (\textbf{primal feasibility})</span>
<span id="cb4-462"><a href="#cb4-462" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb4-463"><a href="#cb4-463" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-464"><a href="#cb4-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-465"><a href="#cb4-465" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb4-466"><a href="#cb4-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-467"><a href="#cb4-467" aria-hidden="true" tabindex="-1"></a>::: {.proof}</span>
<span id="cb4-468"><a href="#cb4-468" aria-hidden="true" tabindex="-1"></a>See <span class="co">[</span><span class="ot">@Boyd_Vandenberghe04, Sec. 5.5.3 </span><span class="co">]</span></span>
<span id="cb4-469"><a href="#cb4-469" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb4-470"><a href="#cb4-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-471"><a href="#cb4-471" aria-hidden="true" tabindex="-1"></a>In this convex setting (a primal strictly feasible point exists, say $x=(1,\dots,n)^\top$, so the Slater condition holds), the KKT conditions are necessary and sufficient for optimality.</span>
<span id="cb4-472"><a href="#cb4-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-473"><a href="#cb4-473" aria-hidden="true" tabindex="-1"></a>**Stationarity** can be rephrased as:</span>
<span id="cb4-474"><a href="#cb4-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-475"><a href="#cb4-475" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-476"><a href="#cb4-476" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb4-477"><a href="#cb4-477" aria-hidden="true" tabindex="-1"></a>w_1 (x^{\star}_1- y_1) + \alpha^{\star}_1 &amp; = 0 <span class="sc">\\</span></span>
<span id="cb4-478"><a href="#cb4-478" aria-hidden="true" tabindex="-1"></a>w_i (x^{\star}_i- y_i) + \alpha^{\star}_{i} - \alpha^{\star}_{i-1} &amp; = 0, \quad \text{for all } i \in \llbracket 2, n-1 \rrbracket<span class="sc">\\</span></span>
<span id="cb4-479"><a href="#cb4-479" aria-hidden="true" tabindex="-1"></a>w_n (x^{\star}_n - y_n) - \alpha^{\star}_{n-1} &amp; = 0 \enspace.</span>
<span id="cb4-480"><a href="#cb4-480" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb4-481"><a href="#cb4-481" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-482"><a href="#cb4-482" aria-hidden="true" tabindex="-1"></a>With the convention $\alpha_0^{\star} = \alpha_n^{\star} = 0$, this reduces to</span>
<span id="cb4-483"><a href="#cb4-483" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-484"><a href="#cb4-484" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb4-485"><a href="#cb4-485" aria-hidden="true" tabindex="-1"></a>w_i (x^{\star}_i - y_i) + \alpha^{\star}_{i} - \alpha^{\star}_{i-1} &amp; = 0, \quad \text{for all } i \in \llbracket 1, n \rrbracket<span class="sc">\\</span></span>
<span id="cb4-486"><a href="#cb4-486" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb4-487"><a href="#cb4-487" aria-hidden="true" tabindex="-1"></a>$$ {#eq-stationarity}</span>
<span id="cb4-488"><a href="#cb4-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-489"><a href="#cb4-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-490"><a href="#cb4-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-491"><a href="#cb4-491" aria-hidden="true" tabindex="-1"></a>**Complementarity slackness** can also be rephrased:</span>
<span id="cb4-492"><a href="#cb4-492" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-493"><a href="#cb4-493" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb4-494"><a href="#cb4-494" aria-hidden="true" tabindex="-1"></a>&amp; \alpha_i^{\star} (A x^{\star})_i  = 0 \quad \text{for all } i \in \llbracket 1, n-1 \rrbracket <span class="sc">\\</span></span>
<span id="cb4-495"><a href="#cb4-495" aria-hidden="true" tabindex="-1"></a>\iff &amp; \alpha_i^{\star} (x^{\star}_i-x^{\star}_{i+1})  = 0 \quad \text{for all } i \in \llbracket 1, n-1 \rrbracket \enspace.</span>
<span id="cb4-496"><a href="#cb4-496" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb4-497"><a href="#cb4-497" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-498"><a href="#cb4-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-499"><a href="#cb4-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-500"><a href="#cb4-500" aria-hidden="true" tabindex="-1"></a>A simple consequence of the complementarity slackness is as follows: if $\alpha_i^{\star} &gt; 0$ for some $i \in \llbracket 1, n-1 \rrbracket$, then $x^{\star}_i = x^{\star}_{i+1}$.</span>
<span id="cb4-501"><a href="#cb4-501" aria-hidden="true" tabindex="-1"></a>Hence, the set of ($n-1$) constraints can be partitioned into contiguous blocks where $x^\star$ has constant value.</span>
<span id="cb4-502"><a href="#cb4-502" aria-hidden="true" tabindex="-1"></a>Each block B can be written as $B = \llbracket \underline{b}, \overline{b} \rrbracket$ for some $\underline{b} \leq \overline{b}$ and $x^{\star}_{\underline{b}} = x^{\star}_{\underline{b}+1} = \ldots = x^{\star}_{\overline{b}}$. When needed we use the convention $x^{\star}_{0}=0$ and $x^{\star}_{n+1}=n+1$. and $x^{\star}_{n+1}=0$. Then, note that by definition of a block, $x^{\star}_{\underline{b}-1}&lt;x^{\star}_{\underline{b}}$ and $x^{\star}_{\overline{b}}&lt;x^{\star}_{\overline{b}+1}$, and by complementarity $\alpha^{\star}_{\underline{b}-1} = \alpha^{\star}_{\overline{b}+1} = 0$.</span>
<span id="cb4-503"><a href="#cb4-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-504"><a href="#cb4-504" aria-hidden="true" tabindex="-1"></a>Summing over the elements of $B$ in @eq-stationarity yields (telescopic sum):</span>
<span id="cb4-505"><a href="#cb4-505" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-506"><a href="#cb4-506" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb4-507"><a href="#cb4-507" aria-hidden="true" tabindex="-1"></a>\sum_{i \in B }w_i (x^{\star}_i - y_i) +  \alpha_{\overline{b}+1}^{\star} - \alpha_{\underline{b}-1}^{\star} &amp; = 0 \enspace.</span>
<span id="cb4-508"><a href="#cb4-508" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb4-509"><a href="#cb4-509" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-510"><a href="#cb4-510" aria-hidden="true" tabindex="-1"></a>Hence, noticing that the $x_i^{\star}$  in block $B$ are all equal, we have that:</span>
<span id="cb4-511"><a href="#cb4-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-512"><a href="#cb4-512" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-513"><a href="#cb4-513" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb4-514"><a href="#cb4-514" aria-hidden="true" tabindex="-1"></a>x^{\star}_{\underline{b}} = \ldots = x^{\star}_{\overline{b}} = \bar{y}_B  \big(= \bar{y}_{\llbracket \underline{b}, \overline{b} \rrbracket} \big)\enspace.</span>
<span id="cb4-515"><a href="#cb4-515" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb4-516"><a href="#cb4-516" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-517"><a href="#cb4-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-518"><a href="#cb4-518" aria-hidden="true" tabindex="-1"></a>Now, from the values of $x^{\star}_{\underline{b}} = \ldots = x^{\star}_{\overline{b}}$ on the block $B$, one can infer (by recursion) the $\alpha_i$'s for $i\in B$.</span>
<span id="cb4-519"><a href="#cb4-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-520"><a href="#cb4-520" aria-hidden="true" tabindex="-1"></a>::: {#lem-lambda}</span>
<span id="cb4-521"><a href="#cb4-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-522"><a href="#cb4-522" aria-hidden="true" tabindex="-1"></a><span class="fu">## Expression of the dual variables</span></span>
<span id="cb4-523"><a href="#cb4-523" aria-hidden="true" tabindex="-1"></a>Let $B =\llbracket \underline{b}, \overline{b} \rrbracket$ be partitionning block for $x^\star$ (into constants pieces).</span>
<span id="cb4-524"><a href="#cb4-524" aria-hidden="true" tabindex="-1"></a>For any $i \in B$:</span>
<span id="cb4-525"><a href="#cb4-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-526"><a href="#cb4-526" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-527"><a href="#cb4-527" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb4-528"><a href="#cb4-528" aria-hidden="true" tabindex="-1"></a>\alpha^{\star}_{i} &amp; = \Big(\sum_{j \in B \cap \llbracket 1, i \rrbracket} w_j \Big)\left(\bar{y}_{B \cap \llbracket 1, i+1 \rrbracket} - \bar{y}_{B}\right) \enspace.</span>
<span id="cb4-529"><a href="#cb4-529" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb4-530"><a href="#cb4-530" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-531"><a href="#cb4-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-532"><a href="#cb4-532" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb4-533"><a href="#cb4-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-534"><a href="#cb4-534" aria-hidden="true" tabindex="-1"></a>::: {.proof}</span>
<span id="cb4-535"><a href="#cb4-535" aria-hidden="true" tabindex="-1"></a>The proof is a simple induction on the element of block $B$.</span>
<span id="cb4-536"><a href="#cb4-536" aria-hidden="true" tabindex="-1"></a>For $i=\underline{b}$ then @eq-stationarity leads to $\alpha^{\star}_{\underline{b}} = w_{\underline{b}} (\bar{y}_{\underline{b}} - x^{\star}_{\underline{b}}) = \Big(\sum_{j \in B \cap \llbracket 1, i \rrbracket} w_j \Big)\left(\bar{y}_{B \cap \llbracket 1, i \rrbracket} - \bar{y}_{B} \right)$.</span>
<span id="cb4-537"><a href="#cb4-537" aria-hidden="true" tabindex="-1"></a>Now by induction assume the result for $i\in B$, \emph{e.g.,} $\alpha^{\star}_{i}  = \Big(\sum_{j \in B \cap \llbracket 1, i \rrbracket} w_j \Big)\left(\bar{y}_{B \cap \llbracket 1, i \rrbracket} - \bar{y}_{B}\right)$.</span>
<span id="cb4-538"><a href="#cb4-538" aria-hidden="true" tabindex="-1"></a>Using @eq-stationarity for $i+1 \in B$ yields</span>
<span id="cb4-539"><a href="#cb4-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-540"><a href="#cb4-540" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-541"><a href="#cb4-541" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb4-542"><a href="#cb4-542" aria-hidden="true" tabindex="-1"></a>\alpha^{\star}_{i+1}</span>
<span id="cb4-543"><a href="#cb4-543" aria-hidden="true" tabindex="-1"></a>&amp; = w_{i+1} (y_{i+1} - x^{\star}_{i+1}) + \alpha^{\star}_i<span class="sc">\\</span></span>
<span id="cb4-544"><a href="#cb4-544" aria-hidden="true" tabindex="-1"></a>&amp; = w_{i+1} (y_{i+1} - \overline{y}_{B}) + \alpha^{\star}_i<span class="sc">\\</span></span>
<span id="cb4-545"><a href="#cb4-545" aria-hidden="true" tabindex="-1"></a>&amp; = w_{i+1} (y_{i+1} - \overline{y}_{B}) + \Big(\sum_{j \in B \cap \llbracket 1, i \rrbracket} w_j  \Big)\left(\bar{y}_{B \cap \llbracket 1, i \rrbracket} -\bar{y}_{B}\right)<span class="sc">\\</span></span>
<span id="cb4-546"><a href="#cb4-546" aria-hidden="true" tabindex="-1"></a>&amp; = \Big(\sum_{j \in B \cap \llbracket 1, i + 1 \rrbracket} w_j  \Big)\left(\bar{y}_{B \cap \llbracket 1, i+1 \rrbracket} - \bar{y}_{B}\right) \enspace,</span>
<span id="cb4-547"><a href="#cb4-547" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb4-548"><a href="#cb4-548" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-549"><a href="#cb4-549" aria-hidden="true" tabindex="-1"></a>hence the result.</span>
<span id="cb4-550"><a href="#cb4-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-551"><a href="#cb4-551" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb4-552"><a href="#cb4-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-553"><a href="#cb4-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-554"><a href="#cb4-554" aria-hidden="true" tabindex="-1"></a><span class="fu"># Algorithm</span></span>
<span id="cb4-555"><a href="#cb4-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-556"><a href="#cb4-556" aria-hidden="true" tabindex="-1"></a>The intuition behind the PAVA algorithm is to merge adjacent blocks of constant values in the primal vector, as the targeted solution is simply the average of the observe signal over each block.</span>
<span id="cb4-557"><a href="#cb4-557" aria-hidden="true" tabindex="-1"></a>Hence, the algorithm aims at creating the blocks of constant values in the primal vector. The dual variables can be inferred from the  solution from the previous lemma.</span>
<span id="cb4-558"><a href="#cb4-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-559"><a href="#cb4-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-560"><a href="#cb4-560" aria-hidden="true" tabindex="-1"></a><span class="fu">## Pseudo-code and Python implementation</span></span>
<span id="cb4-561"><a href="#cb4-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-562"><a href="#cb4-562" aria-hidden="true" tabindex="-1"></a><span class="in">```pseudocode</span></span>
<span id="cb4-563"><a href="#cb4-563" aria-hidden="true" tabindex="-1"></a><span class="in">#| html-indent-size: "1.2em"</span></span>
<span id="cb4-564"><a href="#cb4-564" aria-hidden="true" tabindex="-1"></a><span class="in">#| html-comment-delimiter: "//"</span></span>
<span id="cb4-565"><a href="#cb4-565" aria-hidden="true" tabindex="-1"></a><span class="in">#| html-line-number: true</span></span>
<span id="cb4-566"><a href="#cb4-566" aria-hidden="true" tabindex="-1"></a><span class="in">#| html-line-number-punc: ":"</span></span>
<span id="cb4-567"><a href="#cb4-567" aria-hidden="true" tabindex="-1"></a><span class="in">#| html-no-end: false</span></span>
<span id="cb4-568"><a href="#cb4-568" aria-hidden="true" tabindex="-1"></a><span class="in">#| pdf-placement: "htb!"</span></span>
<span id="cb4-569"><a href="#cb4-569" aria-hidden="true" tabindex="-1"></a><span class="in">#| pdf-line-number: true</span></span>
<span id="cb4-570"><a href="#cb4-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-571"><a href="#cb4-571" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{algorithm}</span></span>
<span id="cb4-572"><a href="#cb4-572" aria-hidden="true" tabindex="-1"></a><span class="in">\caption{PAVA}</span></span>
<span id="cb4-573"><a href="#cb4-573" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{algorithmic}</span></span>
<span id="cb4-574"><a href="#cb4-574" aria-hidden="true" tabindex="-1"></a><span class="in">\REQUIRE $y \in\mathbb{R}^n, w \in \mathbb{R}^n_{+}$</span></span>
<span id="cb4-575"><a href="#cb4-575" aria-hidden="true" tabindex="-1"></a><span class="in">\STATE $r \leftarrow y$</span></span>
<span id="cb4-576"><a href="#cb4-576" aria-hidden="true" tabindex="-1"></a><span class="in">\STATE $W \leftarrow y$</span></span>
<span id="cb4-577"><a href="#cb4-577" aria-hidden="true" tabindex="-1"></a><span class="in">\STATE $J = [\{1\},\dots, \{n\}]$ \COMMENT{lists of blocks}</span></span>
<span id="cb4-578"><a href="#cb4-578" aria-hidden="true" tabindex="-1"></a><span class="in">\STATE $i=1$ (index of list start at 0 here)</span></span>
<span id="cb4-579"><a href="#cb4-579" aria-hidden="true" tabindex="-1"></a><span class="in">\WHILE{$i&lt;n$}</span></span>
<span id="cb4-580"><a href="#cb4-580" aria-hidden="true" tabindex="-1"></a><span class="in">    \IF{$r_i &lt; r_{i-1}$} \COMMENT{Find adjacent violators and merge groups}</span></span>
<span id="cb4-581"><a href="#cb4-581" aria-hidden="true" tabindex="-1"></a><span class="in">        \STATE $r_i \leftarrow \frac{W_i r_i + W_{i-1} r_{i-1}}{W_i + W_{i-1}}$</span></span>
<span id="cb4-582"><a href="#cb4-582" aria-hidden="true" tabindex="-1"></a><span class="in">        \STATE $W_i \leftarrow W_i + W_{i-1}$</span></span>
<span id="cb4-583"><a href="#cb4-583" aria-hidden="true" tabindex="-1"></a><span class="in">        \STATE $J_i \leftarrow J_i \cup J_{i-1}$</span></span>
<span id="cb4-584"><a href="#cb4-584" aria-hidden="true" tabindex="-1"></a><span class="in">        \STATE Remove $r_{i-1}$, $W_{i-1}$ and $J_{i-1}$ from the lists</span></span>
<span id="cb4-585"><a href="#cb4-585" aria-hidden="true" tabindex="-1"></a><span class="in">        \IF{$i &gt; 1$}</span></span>
<span id="cb4-586"><a href="#cb4-586" aria-hidden="true" tabindex="-1"></a><span class="in">            \STATE{$i\leftarrow i-1$}</span></span>
<span id="cb4-587"><a href="#cb4-587" aria-hidden="true" tabindex="-1"></a><span class="in">        \ENDIF</span></span>
<span id="cb4-588"><a href="#cb4-588" aria-hidden="true" tabindex="-1"></a><span class="in">    \ELSE</span></span>
<span id="cb4-589"><a href="#cb4-589" aria-hidden="true" tabindex="-1"></a><span class="in">        \STATE{$i  \leftarrow i + 1$}</span></span>
<span id="cb4-590"><a href="#cb4-590" aria-hidden="true" tabindex="-1"></a><span class="in">    \ENDIF</span></span>
<span id="cb4-591"><a href="#cb4-591" aria-hidden="true" tabindex="-1"></a><span class="in">\ENDWHILE</span></span>
<span id="cb4-592"><a href="#cb4-592" aria-hidden="true" tabindex="-1"></a><span class="in">\FOR{$i=1$ to len($J$)}</span></span>
<span id="cb4-593"><a href="#cb4-593" aria-hidden="true" tabindex="-1"></a><span class="in">    \STATE{$r_{J_i} \leftarrow \bar{y}_{J_i} \mathbf{1}_{J_i}$}</span></span>
<span id="cb4-594"><a href="#cb4-594" aria-hidden="true" tabindex="-1"></a><span class="in">    \COMMENT{Set the block to the average value}</span></span>
<span id="cb4-595"><a href="#cb4-595" aria-hidden="true" tabindex="-1"></a><span class="in">\ENDFOR</span></span>
<span id="cb4-596"><a href="#cb4-596" aria-hidden="true" tabindex="-1"></a><span class="in">\RETURN{$r, J$}</span></span>
<span id="cb4-597"><a href="#cb4-597" aria-hidden="true" tabindex="-1"></a><span class="in">\end{algorithmic}</span></span>
<span id="cb4-598"><a href="#cb4-598" aria-hidden="true" tabindex="-1"></a><span class="in">\end{algorithm}</span></span>
<span id="cb4-599"><a href="#cb4-599" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-600"><a href="#cb4-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-601"><a href="#cb4-601" aria-hidden="true" tabindex="-1"></a>Below you will find a simple version of the PAVA algorithm coded in Python.</span>
<span id="cb4-602"><a href="#cb4-602" aria-hidden="true" tabindex="-1"></a>The <span class="in">`sklearn`</span> version (in particular the <span class="in">`_isotonic.pyx`</span> file, as available in October 2024, see <span class="co">[</span><span class="ot">source</span><span class="co">](https://github.com/scikit-learn/scikit-learn/blob/04fbe04fedda0e86e67867854900a49fb53c4c01/sklearn/_isotonic.pyx)</span>). is more efficient but a little less readable.</span>
<span id="cb4-603"><a href="#cb4-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-606"><a href="#cb4-606" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb4-607"><a href="#cb4-607" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb4-608"><a href="#cb4-608" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb4-609"><a href="#cb4-609" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-610"><a href="#cb4-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-611"><a href="#cb4-611" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> PAVA(y, w):</span>
<span id="cb4-612"><a href="#cb4-612" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(y)</span>
<span id="cb4-613"><a href="#cb4-613" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> y.copy()</span>
<span id="cb4-614"><a href="#cb4-614" aria-hidden="true" tabindex="-1"></a>    ws <span class="op">=</span> w.copy()</span>
<span id="cb4-615"><a href="#cb4-615" aria-hidden="true" tabindex="-1"></a>    target <span class="op">=</span> [[i] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n)]</span>
<span id="cb4-616"><a href="#cb4-616" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb4-617"><a href="#cb4-617" aria-hidden="true" tabindex="-1"></a>    counter <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-618"><a href="#cb4-618" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> i <span class="op">&lt;</span> n:</span>
<span id="cb4-619"><a href="#cb4-619" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> r[i] <span class="op">&lt;</span> r[i <span class="op">-</span> <span class="dv">1</span>]:  <span class="co"># Find adjacent violators</span></span>
<span id="cb4-620"><a href="#cb4-620" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Pool the violators</span></span>
<span id="cb4-621"><a href="#cb4-621" aria-hidden="true" tabindex="-1"></a>            r[i] <span class="op">=</span> (ws[i] <span class="op">*</span> r[i] <span class="op">+</span> ws[i <span class="op">-</span> <span class="dv">1</span>] <span class="op">*</span> r[i <span class="op">-</span> <span class="dv">1</span>]) <span class="op">/</span> (ws[i] <span class="op">+</span> ws[i <span class="op">-</span> <span class="dv">1</span>])</span>
<span id="cb4-622"><a href="#cb4-622" aria-hidden="true" tabindex="-1"></a>            ws[i] <span class="op">+=</span> ws[i <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb4-623"><a href="#cb4-623" aria-hidden="true" tabindex="-1"></a>            target[i] <span class="op">=</span> target[i<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> target[i]</span>
<span id="cb4-624"><a href="#cb4-624" aria-hidden="true" tabindex="-1"></a>            r.pop(i <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb4-625"><a href="#cb4-625" aria-hidden="true" tabindex="-1"></a>            ws.pop(i <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb4-626"><a href="#cb4-626" aria-hidden="true" tabindex="-1"></a>            target.pop(i <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb4-627"><a href="#cb4-627" aria-hidden="true" tabindex="-1"></a>            n <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb4-628"><a href="#cb4-628" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Move back one step if possible</span></span>
<span id="cb4-629"><a href="#cb4-629" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb4-630"><a href="#cb4-630" aria-hidden="true" tabindex="-1"></a>                i <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb4-631"><a href="#cb4-631" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb4-632"><a href="#cb4-632" aria-hidden="true" tabindex="-1"></a>            i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-633"><a href="#cb4-633" aria-hidden="true" tabindex="-1"></a>            counter <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-634"><a href="#cb4-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-635"><a href="#cb4-635" aria-hidden="true" tabindex="-1"></a>    sol <span class="op">=</span> np.zeros_like(y)</span>
<span id="cb4-636"><a href="#cb4-636" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, block <span class="kw">in</span> <span class="bu">enumerate</span>(target):</span>
<span id="cb4-637"><a href="#cb4-637" aria-hidden="true" tabindex="-1"></a>        sol[block] <span class="op">=</span> r[i]</span>
<span id="cb4-638"><a href="#cb4-638" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sol, ws, target</span>
<span id="cb4-639"><a href="#cb4-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-640"><a href="#cb4-640" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-641"><a href="#cb4-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-642"><a href="#cb4-642" aria-hidden="true" tabindex="-1"></a>Below is a version of the algorithm similar to the one implemented in <span class="in">`sklearn`</span> (yet in pure Python here). Moreover, it can be made an inplace method (as in <span class="in">`sklearn`</span>), which is more memory efficient.</span>
<span id="cb4-643"><a href="#cb4-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-646"><a href="#cb4-646" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb4-647"><a href="#cb4-647" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb4-648"><a href="#cb4-648" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb4-649"><a href="#cb4-649" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> isotonic_regression(z, w):</span>
<span id="cb4-650"><a href="#cb4-650" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> z.copy()</span>
<span id="cb4-651"><a href="#cb4-651" aria-hidden="true" tabindex="-1"></a>    n<span class="op">=</span><span class="bu">len</span>(y)</span>
<span id="cb4-652"><a href="#cb4-652" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-653"><a href="#cb4-653" aria-hidden="true" tabindex="-1"></a>    target <span class="op">=</span> np.arange(<span class="bu">len</span>(y))</span>
<span id="cb4-654"><a href="#cb4-654" aria-hidden="true" tabindex="-1"></a>    targets <span class="op">=</span> [target.copy()]</span>
<span id="cb4-655"><a href="#cb4-655" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> [<span class="dv">0</span>]</span>
<span id="cb4-656"><a href="#cb4-656" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> i <span class="op">&lt;</span> n:</span>
<span id="cb4-657"><a href="#cb4-657" aria-hidden="true" tabindex="-1"></a>        k <span class="op">=</span> target[i] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb4-658"><a href="#cb4-658" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> k <span class="op">==</span> n:</span>
<span id="cb4-659"><a href="#cb4-659" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb4-660"><a href="#cb4-660" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> y[i] <span class="op">&lt;</span> y[k]:</span>
<span id="cb4-661"><a href="#cb4-661" aria-hidden="true" tabindex="-1"></a>            <span class="co"># We are in an increasing subsequence.</span></span>
<span id="cb4-662"><a href="#cb4-662" aria-hidden="true" tabindex="-1"></a>            i <span class="op">=</span> k</span>
<span id="cb4-663"><a href="#cb4-663" aria-hidden="true" tabindex="-1"></a>            targets.append(target.copy())</span>
<span id="cb4-664"><a href="#cb4-664" aria-hidden="true" tabindex="-1"></a>            idx.append(k)</span>
<span id="cb4-665"><a href="#cb4-665" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb4-666"><a href="#cb4-666" aria-hidden="true" tabindex="-1"></a>        sum_wy <span class="op">=</span> w[i] <span class="op">*</span> y[i]</span>
<span id="cb4-667"><a href="#cb4-667" aria-hidden="true" tabindex="-1"></a>        sum_w <span class="op">=</span> w[i]</span>
<span id="cb4-668"><a href="#cb4-668" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb4-669"><a href="#cb4-669" aria-hidden="true" tabindex="-1"></a>            <span class="co"># We are within a decreasing subsequence.</span></span>
<span id="cb4-670"><a href="#cb4-670" aria-hidden="true" tabindex="-1"></a>            prev_y <span class="op">=</span> y[k]</span>
<span id="cb4-671"><a href="#cb4-671" aria-hidden="true" tabindex="-1"></a>            sum_wy <span class="op">+=</span> w[k] <span class="op">*</span> y[k]</span>
<span id="cb4-672"><a href="#cb4-672" aria-hidden="true" tabindex="-1"></a>            sum_w <span class="op">+=</span> w[k]</span>
<span id="cb4-673"><a href="#cb4-673" aria-hidden="true" tabindex="-1"></a>            k <span class="op">=</span> target[k] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb4-674"><a href="#cb4-674" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> k <span class="op">==</span> n <span class="kw">or</span> prev_y <span class="op">&lt;</span> y[k]:</span>
<span id="cb4-675"><a href="#cb4-675" aria-hidden="true" tabindex="-1"></a>                targets.append(target.copy())</span>
<span id="cb4-676"><a href="#cb4-676" aria-hidden="true" tabindex="-1"></a>                idx.append(k)</span>
<span id="cb4-677"><a href="#cb4-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-678"><a href="#cb4-678" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Non-singleton decreasing subsequence is finished,</span></span>
<span id="cb4-679"><a href="#cb4-679" aria-hidden="true" tabindex="-1"></a>                <span class="co"># update first entry.</span></span>
<span id="cb4-680"><a href="#cb4-680" aria-hidden="true" tabindex="-1"></a>                y[i] <span class="op">=</span> sum_wy <span class="op">/</span> sum_w</span>
<span id="cb4-681"><a href="#cb4-681" aria-hidden="true" tabindex="-1"></a>                w[i] <span class="op">=</span> sum_w</span>
<span id="cb4-682"><a href="#cb4-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-683"><a href="#cb4-683" aria-hidden="true" tabindex="-1"></a>                target[i] <span class="op">=</span> k <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb4-684"><a href="#cb4-684" aria-hidden="true" tabindex="-1"></a>                target[k <span class="op">-</span> <span class="dv">1</span>] <span class="op">=</span> i</span>
<span id="cb4-685"><a href="#cb4-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-686"><a href="#cb4-686" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb4-687"><a href="#cb4-687" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Backtrack if we can.  This makes the algorithm</span></span>
<span id="cb4-688"><a href="#cb4-688" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># single-pass and ensures O(n) complexity.</span></span>
<span id="cb4-689"><a href="#cb4-689" aria-hidden="true" tabindex="-1"></a>                    i <span class="op">=</span> target[i <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb4-690"><a href="#cb4-690" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Otherwise, restart from the same point.</span></span>
<span id="cb4-691"><a href="#cb4-691" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb4-692"><a href="#cb4-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-693"><a href="#cb4-693" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reconstruct the solution.</span></span>
<span id="cb4-694"><a href="#cb4-694" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-695"><a href="#cb4-695" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> i <span class="op">&lt;</span> n:</span>
<span id="cb4-696"><a href="#cb4-696" aria-hidden="true" tabindex="-1"></a>        k <span class="op">=</span> target[i] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb4-697"><a href="#cb4-697" aria-hidden="true" tabindex="-1"></a>        y[i <span class="op">+</span> <span class="dv">1</span> : k] <span class="op">=</span> y[i]</span>
<span id="cb4-698"><a href="#cb4-698" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> k</span>
<span id="cb4-699"><a href="#cb4-699" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y, targets, idx</span>
<span id="cb4-700"><a href="#cb4-700" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-701"><a href="#cb4-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-702"><a href="#cb4-702" aria-hidden="true" tabindex="-1"></a><span class="fu">## Convergence</span></span>
<span id="cb4-703"><a href="#cb4-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-704"><a href="#cb4-704" aria-hidden="true" tabindex="-1"></a>::: {#thm-convergence}</span>
<span id="cb4-705"><a href="#cb4-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-706"><a href="#cb4-706" aria-hidden="true" tabindex="-1"></a><span class="fu">## Convergence of the PAVA algorithm</span></span>
<span id="cb4-707"><a href="#cb4-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-708"><a href="#cb4-708" aria-hidden="true" tabindex="-1"></a>The PAVA algorithm converges in a finite number of iterations and output the primal solution of the isotonic regression problem.</span>
<span id="cb4-709"><a href="#cb4-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-710"><a href="#cb4-710" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb4-711"><a href="#cb4-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-712"><a href="#cb4-712" aria-hidden="true" tabindex="-1"></a>::: {.proof}</span>
<span id="cb4-713"><a href="#cb4-713" aria-hidden="true" tabindex="-1"></a>To show the convergence we will create a dual variable $\alpha$, show that it is dual feasible, and that at the end of the algorithm it satisfies KKT along with the output of the PAVA algorithm.</span>
<span id="cb4-714"><a href="#cb4-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-715"><a href="#cb4-715" aria-hidden="true" tabindex="-1"></a>For that let us first prove the following result:</span>
<span id="cb4-716"><a href="#cb4-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-717"><a href="#cb4-717" aria-hidden="true" tabindex="-1"></a>**Fact 1**. Let $B \in J$ be a block at some stage of the algorithm.</span>
<span id="cb4-718"><a href="#cb4-718" aria-hidden="true" tabindex="-1"></a>Then,</span>
<span id="cb4-719"><a href="#cb4-719" aria-hidden="true" tabindex="-1"></a>$$\forall i \in B, \overline{y}_{B \cap \llbracket 1, i \rrbracket} \geq \overline{y}_{B} \enspace.</span>
<span id="cb4-720"><a href="#cb4-720" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-721"><a href="#cb4-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-722"><a href="#cb4-722" aria-hidden="true" tabindex="-1"></a>To show this result, we will use induction and show that the merging process does maintain this condition.</span>
<span id="cb4-723"><a href="#cb4-723" aria-hidden="true" tabindex="-1"></a>First, at initialization, the condition is true as the blocks have all size 1.</span>
<span id="cb4-724"><a href="#cb4-724" aria-hidden="true" tabindex="-1"></a>Now, assume that the condition is true, and check what happen when we merge two consecutive groups $J_i$ and $J_{i-1}$ into $B=J_{i-1} \cup J_{i}$.</span>
<span id="cb4-725"><a href="#cb4-725" aria-hidden="true" tabindex="-1"></a>First the condition is true for $J_i$ and $J_{i-1}$, so $\overline{y}_{J_i \cap \llbracket 1, k \rrbracket} \geq \overline{y}_{J_i}$ and $\overline{y}_{J_{i-1} \cap \llbracket 1, k' \rrbracket} \geq \overline{y}_{J_{i-1}}$ for any $k \in J_i$ and $k' \in J_{i-1}$.</span>
<span id="cb4-726"><a href="#cb4-726" aria-hidden="true" tabindex="-1"></a>Then, the test $r_i &lt; r_{i-1}$ is equivalent to $\overline{y}_{J_i} &lt; \overline{y}_{J_{i-1}}$.</span>
<span id="cb4-727"><a href="#cb4-727" aria-hidden="true" tabindex="-1"></a>So for any $k \in J_{i-1}$, we have $\overline{y}_{J_i \cap \llbracket k, n \rrbracket} \geq \overline{y}_{J_i}$ using the induction hypothesis.</span>
<span id="cb4-728"><a href="#cb4-728" aria-hidden="true" tabindex="-1"></a>For $k'\in J_{i}$,  $\overline{y}_{B \cap \llbracket 1, k \rrbracket} = \overline{y}_{J_{i-1} \cap \llbracket 1, k \rrbracket} \geq \overline{y}_{J_{i-1}} \geq \overline{y}_{B}$ (where the last inequality is due to the test $r_i &lt; r_{i-1}$).</span>
<span id="cb4-729"><a href="#cb4-729" aria-hidden="true" tabindex="-1"></a>For the case $k' \in J_i$, we have</span>
<span id="cb4-730"><a href="#cb4-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-731"><a href="#cb4-731" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-732"><a href="#cb4-732" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb4-733"><a href="#cb4-733" aria-hidden="true" tabindex="-1"></a>\overline{y}_{B \cap \llbracket 1, k' \rrbracket}</span>
<span id="cb4-734"><a href="#cb4-734" aria-hidden="true" tabindex="-1"></a>&amp; = \overline{y}_{ J_{i-1} \cup (J_{i} \cap \llbracket 1, k' \rrbracket)} <span class="sc">\\</span></span>
<span id="cb4-735"><a href="#cb4-735" aria-hidden="true" tabindex="-1"></a>&amp; \geq \frac{\Big(\sum_{\ell \in J_{i-1}} w_{\ell} \Big) \cdot \overline{y}_{J_{i-1}} + \Big(\sum_{\ell \in J_{i} \cap \llbracket 1, k' \rrbracket} w_{\ell} \Big) \cdot \overline{y}_{J_{i} \cap \llbracket 1, k' \rrbracket}}{\sum_{J_{i-1}} w_i + \sum_{J_{i} \cap \llbracket 1, k' \rrbracket} w_i}<span class="sc">\\</span></span>
<span id="cb4-736"><a href="#cb4-736" aria-hidden="true" tabindex="-1"></a>&amp; \geq \frac{\Big(\sum_{\ell \in J_{i-1}} w_{\ell} \Big) \cdot \overline{y}_{J_{i-1}} + \Big(\sum_{\ell \in J_{i} \cap \llbracket 1, k' \rrbracket} w_{\ell} \Big) \cdot \overline{y}_{J_{i}}}{\sum_{J_{i-1}} w_i + \sum_{J_{i} \cap \llbracket 1, k' \rrbracket} w_i} \quad (\text{induction})<span class="sc">\\</span></span>
<span id="cb4-737"><a href="#cb4-737" aria-hidden="true" tabindex="-1"></a>&amp; \geq \frac{\Big(\sum_{\ell \in J_{i-1}} w_{\ell} \Big) \cdot \overline{y}_{J_{i-1}} + \Big(\sum_{\ell \in J_{i} \cap \llbracket 1, k' \rrbracket} w_{\ell} \Big) \cdot \overline{y}_{J_{i}}}{\sum_{J_{i-1}} w_i + \sum_{J_{i} \cap \llbracket 1, k' \rrbracket} w_i} \quad (\text{PAVA})<span class="sc">\\</span></span>
<span id="cb4-738"><a href="#cb4-738" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb4-739"><a href="#cb4-739" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-740"><a href="#cb4-740" aria-hidden="true" tabindex="-1"></a>Now, remember that $\overline{y}_{B} = \frac{\Big(\sum_{\ell \in J_{i-1}} w_{\ell} \Big) \cdot \overline{y}_{J_{i-1}} + \Big(\sum_{\ell \in J_{i} } w_{\ell} \Big) \cdot \overline{y}_{J_{i}}}{\sum_{J_{i-1}} w_i + \sum_{J_{i}} w_i}$ and that $\overline{y}_{J_{i-1}} \geq  \overline{y}_{B} \geq \overline{y}_{J_{i}}$ (since $\overline{y}_{B}$ is a convex combination of $\overline{y}_{J_{i-1}}$ and $\overline{y}_{J_i}$), so the last inequality is true. One can check that the weight of $J_{i}$ is larger in the definition of $\overline{y}_{B}$ than in the last inequality above, and so among the two convex combinations, the larger is the former.</span>
<span id="cb4-741"><a href="#cb4-741" aria-hidden="true" tabindex="-1"></a>Hence, the fact is proved by induction.</span>
<span id="cb4-742"><a href="#cb4-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-743"><a href="#cb4-743" aria-hidden="true" tabindex="-1"></a>**Fact 2.** If you update $\alpha$ recursively, starting from $\alpha = \mathbf{0}_{n-1}$ and for if for each updated block $B \in J$ you update $\alpha$ (as in @lem-lambda) by</span>
<span id="cb4-744"><a href="#cb4-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-745"><a href="#cb4-745" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-746"><a href="#cb4-746" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb4-747"><a href="#cb4-747" aria-hidden="true" tabindex="-1"></a>\forall i \in B, \alpha_i &amp; = \Big(\sum_{j \in B \cap \llbracket 1, i \rrbracket} w_j \Big)\left( \bar{y}_{B \cap \llbracket 1, i \rrbracket} - \bar{y}_{B}\right) \enspace,</span>
<span id="cb4-748"><a href="#cb4-748" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb4-749"><a href="#cb4-749" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-750"><a href="#cb4-750" aria-hidden="true" tabindex="-1"></a>then $\alpha$ is dual feasible for all steps of the algorithm</span>
<span id="cb4-751"><a href="#cb4-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-752"><a href="#cb4-752" aria-hidden="true" tabindex="-1"></a>The proof is a direct consequence of Fact 1 and the fact that the weights $w_i$ are non-negative.</span>
<span id="cb4-753"><a href="#cb4-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-754"><a href="#cb4-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-755"><a href="#cb4-755" aria-hidden="true" tabindex="-1"></a>**Fact 3.**</span>
<span id="cb4-756"><a href="#cb4-756" aria-hidden="true" tabindex="-1"></a>$\forall i \in B, \alpha_i=\alpha_{i-1} +w_i(x_i - y_i)$ (where we assume that $x_i = \overline{y}_B$), which means that $\alpha$ and $x$ hence created satsfies.</span>
<span id="cb4-757"><a href="#cb4-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-758"><a href="#cb4-758" aria-hidden="true" tabindex="-1"></a>Again this result is simple to prove, by following the exact same line encountered in the proof of @lem-lambda.</span>
<span id="cb4-759"><a href="#cb4-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-760"><a href="#cb4-760" aria-hidden="true" tabindex="-1"></a>**Fact 4.** When you exit the while loop, the output of the PAVA algorithm is a primal feasible point.</span>
<span id="cb4-761"><a href="#cb4-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-762"><a href="#cb4-762" aria-hidden="true" tabindex="-1"></a>Indeed, the only way to exist is to have all blocks mean values ordered.</span>
<span id="cb4-763"><a href="#cb4-763" aria-hidden="true" tabindex="-1"></a>Hence, when the algorithm stops the primal point create (after the block averaging step) is primal feasible.</span>
<span id="cb4-764"><a href="#cb4-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-765"><a href="#cb4-765" aria-hidden="true" tabindex="-1"></a>Leveraging Fact 1. to 4. ensures that the KKT conditions are satisfied with the primal and dual points created. Hence, at the end of the algorithm, and the optimal solution is found.</span>
<span id="cb4-766"><a href="#cb4-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-767"><a href="#cb4-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-768"><a href="#cb4-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-769"><a href="#cb4-769" aria-hidden="true" tabindex="-1"></a><span class="fu">## Duality Gap</span></span>
<span id="cb4-770"><a href="#cb4-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-771"><a href="#cb4-771" aria-hidden="true" tabindex="-1"></a>Given a primal feasible point $x \in \mathcal{K}$ and a dual feasible point $\alpha \in \mathbb{R}_+^{n-1}$, we can obtain upper and lower bounds on the optimal value of the primal problem .</span>
<span id="cb4-772"><a href="#cb4-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-773"><a href="#cb4-773" aria-hidden="true" tabindex="-1"></a>Note that at optimality $W x^\star = W y - A^\top \alpha^\star$</span>
<span id="cb4-774"><a href="#cb4-774" aria-hidden="true" tabindex="-1"></a>Hence, using a value of $x$ at some stage of the algorithm (corresponding to a feasible $\alpha$), the dual reads $\frac{1}{2} y^\top W y - \frac{1}{2} x^\top W x$.</span>
<span id="cb4-775"><a href="#cb4-775" aria-hidden="true" tabindex="-1"></a>For creating a primal feasible point, one can simply take the ordered version of the output, making the last element constant to create a non-decreasing vector.</span>
<span id="cb4-776"><a href="#cb4-776" aria-hidden="true" tabindex="-1"></a>The later is coded in Python with the following function:</span>
<span id="cb4-777"><a href="#cb4-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-780"><a href="#cb4-780" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb4-781"><a href="#cb4-781" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb4-782"><a href="#cb4-782" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb4-783"><a href="#cb4-783" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> replace_after_first_non_increasing(x, w<span class="op">=</span>w):</span>
<span id="cb4-784"><a href="#cb4-784" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(x)</span>
<span id="cb4-785"><a href="#cb4-785" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, n):</span>
<span id="cb4-786"><a href="#cb4-786" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> x[i] <span class="op">&lt;</span> x[i <span class="op">-</span> <span class="dv">1</span>]:</span>
<span id="cb4-787"><a href="#cb4-787" aria-hidden="true" tabindex="-1"></a>            mean_value <span class="op">=</span> np.<span class="bu">sum</span>(x[i:] <span class="op">*</span> w[i:]) <span class="op">/</span> np.<span class="bu">sum</span>(w[i:])</span>
<span id="cb4-788"><a href="#cb4-788" aria-hidden="true" tabindex="-1"></a>            x[i:] <span class="op">=</span> mean_value</span>
<span id="cb4-789"><a href="#cb4-789" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb4-790"><a href="#cb4-790" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span>
<span id="cb4-791"><a href="#cb4-791" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-792"><a href="#cb4-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-793"><a href="#cb4-793" aria-hidden="true" tabindex="-1"></a>As can be seen in the preliminary animation, the primal and dual objectives converge to the same value, which is the optimal value of the primal problem.</span>
<span id="cb4-794"><a href="#cb4-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-795"><a href="#cb4-795" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb4-796"><a href="#cb4-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-797"><a href="#cb4-797" aria-hidden="true" tabindex="-1"></a><span class="fu"># {{&lt; fa link title="link" &gt;}} References</span></span>
<span id="cb4-798"><a href="#cb4-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-799"><a href="#cb4-799" aria-hidden="true" tabindex="-1"></a>::: {#refs}</span>
<span id="cb4-800"><a href="#cb4-800" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><span class="faux-block"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> 2024 Joseph Salmon</span> <span class="faux-block"><a href="https://github.com/josephsalmon/MyWebsite"><i class="fa-brands fa-github" aria-label="github"></i> Source Code</a></span></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p><span class="faux-block"> Designed with <i class="fa-solid fa-heart" aria-label="heart"></i></span> <span class="faux-block"> Built with <a href="https://quarto.org/">Quarto</a></span></p>
</div>
  </div>
</footer>
    <script type="text/javascript">
    (function(d) {
      d.querySelectorAll(".pseudocode-container").forEach(function(el) {
        let pseudocodeOptions = {
          indentSize: el.dataset.indentSize || "1.2em",
          commentDelimiter: el.dataset.commentDelimiter || "//",
          lineNumber: el.dataset.lineNumber === "true" ? true : false,
          lineNumberPunc: el.dataset.lineNumberPunc || ":",
          noEnd: el.dataset.noEnd === "true" ? true : false,
          titlePrefix: el.dataset.captionPrefix || "Algorithm"
        };
        pseudocode.renderElement(el.querySelector(".pseudocode"), pseudocodeOptions);
      });
    })(document);
    (function(d) {
      d.querySelectorAll(".pseudocode-container").forEach(function(el) {
        let captionSpan = el.querySelector(".ps-root > .ps-algorithm > .ps-line > .ps-keyword")
        if (captionSpan !== null) {
          let captionPrefix = el.dataset.captionPrefix + " ";
          let captionNumber = "";
          if (el.dataset.pseudocodeNumber) {
            captionNumber = el.dataset.pseudocodeNumber + " ";
            if (el.dataset.chapterLevel) {
              captionNumber = el.dataset.chapterLevel + "." + captionNumber;
            }
          }
          captionSpan.innerHTML = captionPrefix + captionNumber;
        }
      });
    })(document);
    </script>
  




</body></html>